(function(){/*


  Shapespark 3D visualization viewer

  Copyright (C) 2014-present Shapespark

  The viewer uses the following open source libraries:

    Three.js: https://github.com/mrdoob/three.js,
    Copyright 2010-2015 three.js authors, MIT License

    PlayCanvas (GLSL shaders code): https://github.com/playcanvas/engine
    Copyright (C) 2011-2015 PlayCanvas Ltd., MIT License

    WebXR Polyfill: https://github.com/immersive-web/webxr-polyfill,
    Copyright (C) 2017 Google Inc, Apache 2.0 License

    Web Font Loader: https://github.com/typekit/webfontloader
    Copyright (C) 2010-2017 Adobe Systems Incorporated, Google Incorporated, Apache 2.0 License

    Basis Universal GPU Texture Codec: https://github.com/BinomialLLC/basis_universal
    Copyright (C) 2019 Binomial LLC., Apache License

    HTTP Live Streaming: https://github.com/video-dev/hls.js
    Copyright (c) 2017 Dailymotion (http://www.dailymotion.com), Apache 2.0 License

    node-qrcode: https://github.com/soldair/node-qrcode
    Copyright (c) 2012 Ryan Day,  MIT License

    Brotli: https://github.com/google/brotli
    Copyright (c) 2009, 2010, 2013-2016 by the Brotli Authors,  MIT License

    Bezier.js: https://github.com/Pomax/bezierjs
    Copyright (c) Pomax, MIT License

  and the following open fonts:

    Open Sans: https://fonts.google.com/specimen/Open+Sans
    Copyright (C) Google Inc., Apache 2.0 License

    Font Awesome: https://fontawesome.com/
    Copyright (C) 2017 Fonticons Inc, SIL Open Font License
*/
var m=m||{};m.scope={};m.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};m.arrayIterator=function(a){return{next:m.arrayIteratorImpl(a)}};m.ASSUME_ES5=!1;m.ASSUME_NO_NATIVE_MAP=!1;m.ASSUME_NO_NATIVE_SET=!1;m.SIMPLE_FROUND_POLYFILL=!1;m.ISOLATE_POLYFILLS=!1;m.FORCE_POLYFILL_PROMISE=!1;m.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
m.defineProperty=m.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};m.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};m.global=m.getGlobal(this);
m.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");m.TRUST_ES6_POLYFILLS=!m.ISOLATE_POLYFILLS||m.IS_SYMBOL_NATIVE;m.polyfills={};m.propertyToPolyfillSymbol={};m.POLYFILL_PREFIX="$jscp$";m.polyfill=function(a,b,c,d){b&&(m.ISOLATE_POLYFILLS?m.polyfillIsolated(a,b,c,d):m.polyfillUnisolated(a,b,c,d))};
m.polyfillUnisolated=function(a,b){var c=m.global;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&m.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
m.polyfillIsolated=function(a,b,c){var d=a.split(".");a=1===d.length;var e=d[0];e=!a&&e in m.polyfills?m.polyfills:m.global;for(var f=0;f<d.length-1;f++){var g=d[f];if(!(g in e))return;e=e[g]}d=d[d.length-1];c=m.IS_SYMBOL_NATIVE&&"es6"===c?e[d]:null;b=b(c);null!=b&&(a?m.defineProperty(m.polyfills,d,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===m.propertyToPolyfillSymbol[d]&&(m.propertyToPolyfillSymbol[d]=m.IS_SYMBOL_NATIVE?m.global.Symbol(d):m.POLYFILL_PREFIX+d),d=m.propertyToPolyfillSymbol[d],
m.defineProperty(e,d,{configurable:!0,writable:!0,value:b})))};m.initSymbol=function(){};m.polyfill("Symbol",function(a){function b(e){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new c("jscomp_symbol_"+(e||"")+"_"+d++,e)}function c(e,f){this.$jscomp$symbol$id_=e;m.defineProperty(this,"description",{configurable:!0,writable:!0,value:f})}if(a)return a;c.prototype.toString=function(){return this.$jscomp$symbol$id_};var d=0;return b},"es6","es3");
m.polyfill("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=m.global[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&m.defineProperty(d.prototype,a,{configurable:!0,writable:!0,value:function(){return m.iteratorPrototype(m.arrayIteratorImpl(this))}})}return a},"es6","es3");
m.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};m.createTemplateTagFirstArg=function(a){return a.raw=a};m.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};m.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):m.arrayIterator(a)};m.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};
m.arrayFromIterable=function(a){return a instanceof Array?a:m.arrayFromIterator(m.makeIterator(a))};m.objectCreate=m.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b};
m.getConstructImplementation=function(){function a(){function c(){}new c;Reflect.construct(c,[],function(){});return new c instanceof c}if(m.TRUST_ES6_POLYFILLS&&"undefined"!=typeof Reflect&&Reflect.construct){if(a())return Reflect.construct;var b=Reflect.construct;return function(c,d,e){c=b(c,d);e&&Reflect.setPrototypeOf(c,e.prototype);return c}}return function(c,d,e){void 0===e&&(e=c);e=m.objectCreate(e.prototype||Object.prototype);return Function.prototype.apply.call(c,e,d)||e}};m.construct={valueOf:m.getConstructImplementation}.valueOf();
m.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};m.setPrototypeOf=m.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:m.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;
m.inherits=function(a,b){a.prototype=m.objectCreate(b.prototype);a.prototype.constructor=a;if(m.setPrototypeOf){var c=m.setPrototypeOf;c(a,b)}else for(c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.superClass_=b.prototype};m.generator={};m.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};
m.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};m.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};m.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
m.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};m.generator.Context.prototype.next_=function(a){this.yieldResult=a};m.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};m.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};
m.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};m.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};m.generator.Context.prototype.yieldAll=function(a,b){a=m.makeIterator(a);var c=a.next();m.generator.ensureIteratorResultIsObject_(c);if(c.done)this.yieldResult=c.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(c.value,b)};
m.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};m.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};m.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};m.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};m.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
m.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};m.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
m.generator.Context.prototype.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};m.generator.Context.prototype.forIn=function(a){return new m.generator.Context.PropertyIterator(a)};
m.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};m.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};m.generator.Engine_=function(a){this.context_=new m.generator.Context;this.program_=a};
m.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};m.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(c){return{value:c,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
m.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
m.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var d=a.call(this.context_.yieldAllIterator_,b);m.generator.ensureIteratorResultIsObject_(d);if(!d.done)return this.context_.stop_(),d;var e=d.value}catch(f){return this.context_.yieldAllIterator_=null,this.context_.throw_(f),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,e);return this.nextStep_()};
m.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
m.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this.throw=function(b){return a.throw_(b)};this.return=function(b){return a.return_(b)};this[Symbol.iterator]=function(){return this}};m.generator.createGenerator=function(a,b){b=new m.generator.Generator_(new m.generator.Engine_(b));m.setPrototypeOf&&a.prototype&&m.setPrototypeOf(b,a.prototype);return b};
m.asyncExecutePromiseGenerator=function(a){function b(d){return a.next(d)}function c(d){return a.throw(d)}return new Promise(function(d,e){function f(g){g.done?d(g.value):Promise.resolve(g.value).then(b,c).then(f,e)}f(a.next())})};m.asyncExecutePromiseGeneratorFunction=function(a){return m.asyncExecutePromiseGenerator(a())};m.asyncExecutePromiseGeneratorProgram=function(a){return m.asyncExecutePromiseGenerator(new m.generator.Generator_(new m.generator.Engine_(a)))};
m.polyfill("Reflect",function(a){return a?a:{}},"es6","es3");m.polyfill("Reflect.construct",function(){return m.construct},"es6","es3");m.polyfill("Reflect.setPrototypeOf",function(a){if(a)return a;if(m.setPrototypeOf){var b=m.setPrototypeOf;return function(c,d){try{return b(c,d),!0}catch(e){return!1}}}return null},"es6","es5");
m.polyfill("Promise",function(a){function b(g){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=!1;var k=this.createResolveAndReject_();try{g(k.resolve,k.reject)}catch(h){k.reject(h)}}function c(){this.batch_=null}function d(g){return g instanceof b?g:new b(function(k){k(g)})}if(a&&(!(m.FORCE_POLYFILL_PROMISE||m.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&"undefined"===typeof m.global.PromiseRejectionEvent)||!m.global.Promise||-1===m.global.Promise.toString().indexOf("[native code]")))return a;
c.prototype.asyncExecute=function(g){if(null==this.batch_){this.batch_=[];var k=this;this.asyncExecuteFunction(function(){k.executeBatch_()})}this.batch_.push(g)};var e=m.global.setTimeout;c.prototype.asyncExecuteFunction=function(g){e(g,0)};c.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var g=this.batch_;this.batch_=[];for(var k=0;k<g.length;++k){var h=g[k];g[k]=null;try{h()}catch(l){this.asyncThrow_(l)}}}this.batch_=null};c.prototype.asyncThrow_=function(g){this.asyncExecuteFunction(function(){throw g;
})};b.prototype.createResolveAndReject_=function(){function g(l){return function(n){h||(h=!0,l.call(k,n))}}var k=this,h=!1;return{resolve:g(this.resolveTo_),reject:g(this.reject_)}};b.prototype.resolveTo_=function(g){if(g===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(g instanceof b)this.settleSameAsPromise_(g);else{a:switch(typeof g){case "object":var k=null!=g;break a;case "function":k=!0;break a;default:k=!1}k?this.resolveToNonPromiseObj_(g):this.fulfill_(g)}};
b.prototype.resolveToNonPromiseObj_=function(g){var k=void 0;try{k=g.then}catch(h){this.reject_(h);return}"function"==typeof k?this.settleSameAsThenable_(k,g):this.fulfill_(g)};b.prototype.reject_=function(g){this.settle_(2,g)};b.prototype.fulfill_=function(g){this.settle_(1,g)};b.prototype.settle_=function(g,k){if(0!=this.state_)throw Error("Cannot settle("+g+", "+k+"): Promise already settled in state"+this.state_);this.state_=g;this.result_=k;2===this.state_&&this.scheduleUnhandledRejectionCheck_();
this.executeOnSettledCallbacks_()};b.prototype.scheduleUnhandledRejectionCheck_=function(){var g=this;e(function(){if(g.notifyUnhandledRejection_()){var k=m.global.console;"undefined"!==typeof k&&k.error(g.result_)}},1)};b.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var g=m.global.CustomEvent,k=m.global.Event,h=m.global.dispatchEvent;if("undefined"===typeof h)return!0;"function"===typeof g?g=new g("unhandledrejection",{cancelable:!0}):"function"===typeof k?
g=new k("unhandledrejection",{cancelable:!0}):(g=m.global.document.createEvent("CustomEvent"),g.initCustomEvent("unhandledrejection",!1,!0,g));g.promise=this;g.reason=this.result_;return h(g)};b.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var g=0;g<this.onSettledCallbacks_.length;++g)f.asyncExecute(this.onSettledCallbacks_[g]);this.onSettledCallbacks_=null}};var f=new c;b.prototype.settleSameAsPromise_=function(g){var k=this.createResolveAndReject_();g.callWhenSettled_(k.resolve,
k.reject)};b.prototype.settleSameAsThenable_=function(g,k){var h=this.createResolveAndReject_();try{g.call(k,h.resolve,h.reject)}catch(l){h.reject(l)}};b.prototype.then=function(g,k){function h(v,p){return"function"==typeof v?function(w){try{l(v(w))}catch(u){n(u)}}:p}var l,n,r=new b(function(v,p){l=v;n=p});this.callWhenSettled_(h(g,l),h(k,n));return r};b.prototype.catch=function(g){return this.then(void 0,g)};b.prototype.callWhenSettled_=function(g,k){function h(){switch(l.state_){case 1:g(l.result_);
break;case 2:k(l.result_);break;default:throw Error("Unexpected state: "+l.state_);}}var l=this;null==this.onSettledCallbacks_?f.asyncExecute(h):this.onSettledCallbacks_.push(h);this.isRejectionHandled_=!0};b.resolve=d;b.reject=function(g){return new b(function(k,h){h(g)})};b.race=function(g){return new b(function(k,h){for(var l=m.makeIterator(g),n=l.next();!n.done;n=l.next())d(n.value).callWhenSettled_(k,h)})};b.all=function(g){var k=m.makeIterator(g),h=k.next();return h.done?d([]):new b(function(l,
n){function r(w){return function(u){v[w]=u;p--;0==p&&l(v)}}var v=[],p=0;do v.push(void 0),p++,d(h.value).callWhenSettled_(r(v.length-1),n),h=k.next();while(!h.done)})};return b},"es6","es3");m.iteratorFromArray=function(a,b){a instanceof String&&(a+="");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e};
m.polyfill("Array.prototype.keys",function(a){return a?a:function(){return m.iteratorFromArray(this,function(b){return b})}},"es6","es3");m.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};m.polyfill("Object.entries",function(a){return a?a:function(b){var c=[],d;for(d in b)m.owns(b,d)&&c.push([d,b[d]]);return c}},"es8","es3");
m.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};
m.polyfill("String.prototype.startsWith",function(a){return a?a:function(b,c){var d=m.checkStringArgs(this,b,"startsWith");b+="";var e=d.length,f=b.length;c=Math.max(0,Math.min(c|0,d.length));for(var g=0;g<f&&c<e;)if(d[c++]!=b[g++])return!1;return g>=f}},"es6","es3");m.checkEs6ConformanceViaProxy=function(){try{var a={},b=Object.create(new m.global.Proxy(a,{get:function(c,d,e){return c==a&&"q"==d&&e==b}}));return!0===b.q}catch(c){return!1}};m.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;
m.ES6_CONFORMANCE=m.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&m.checkEs6ConformanceViaProxy();
m.polyfill("WeakMap",function(a){function b(l){this.id_=(h+=Math.random()+1).toString();if(l){l=m.makeIterator(l);for(var n;!(n=l.next()).done;)n=n.value,this.set(n[0],n[1])}}function c(){if(!a||!Object.seal)return!1;try{var l=Object.seal({}),n=Object.seal({}),r=new a([[l,2],[n,3]]);if(2!=r.get(l)||3!=r.get(n))return!1;r.delete(l);r.set(n,4);return!r.has(l)&&4==r.get(n)}catch(v){return!1}}function d(){}function e(l){var n=typeof l;return"object"===n&&null!==l||"function"===n}function f(l){if(!m.owns(l,
k)){var n=new d;m.defineProperty(l,k,{value:n})}}function g(l){if(!m.ISOLATE_POLYFILLS){var n=Object[l];n&&(Object[l]=function(r){if(r instanceof d)return r;Object.isExtensible(r)&&f(r);return n(r)})}}if(m.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&m.ES6_CONFORMANCE)return a}else if(c())return a;var k="$jscomp_hidden_"+Math.random();g("freeze");g("preventExtensions");g("seal");var h=0;b.prototype.set=function(l,n){if(!e(l))throw Error("Invalid WeakMap key");f(l);if(!m.owns(l,k))throw Error("WeakMap key fail: "+
l);l[k][this.id_]=n;return this};b.prototype.get=function(l){return e(l)&&m.owns(l,k)?l[k][this.id_]:void 0};b.prototype.has=function(l){return e(l)&&m.owns(l,k)&&m.owns(l[k],this.id_)};b.prototype.delete=function(l){return e(l)&&m.owns(l,k)&&m.owns(l[k],this.id_)?delete l[k][this.id_]:!1};return b},"es6","es3");m.MapEntry=function(){};
m.polyfill("Map",function(a){function b(){var h={};return h.previous=h.next=h.head=h}function c(h,l){var n=h.head_;return m.iteratorPrototype(function(){if(n){for(;n.head!=h.head_;)n=n.previous;for(;n.next!=n.head;)return n=n.next,{done:!1,value:l(n)};n=null}return{done:!0,value:void 0}})}function d(h,l){var n=l&&typeof l;"object"==n||"function"==n?g.has(l)?n=g.get(l):(n=""+ ++k,g.set(l,n)):n="p_"+l;var r=h.data_[n];if(r&&m.owns(h.data_,n))for(h=0;h<r.length;h++){var v=r[h];if(l!==l&&v.key!==v.key||
l===v.key)return{id:n,list:r,index:h,entry:v}}return{id:n,list:r,index:-1,entry:void 0}}function e(h){this.data_={};this.head_=b();this.size=0;if(h){h=m.makeIterator(h);for(var l;!(l=h.next()).done;)l=l.value,this.set(l[0],l[1])}}function f(){if(m.ASSUME_NO_NATIVE_MAP||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var h=Object.seal({x:4}),l=new a(m.makeIterator([[h,"s"]]));if("s"!=l.get(h)||1!=l.size||l.get({x:4})||l.set({x:4},"t")!=l||2!=l.size)return!1;
var n=l.entries(),r=n.next();if(r.done||r.value[0]!=h||"s"!=r.value[1])return!1;r=n.next();return r.done||4!=r.value[0].x||"t"!=r.value[1]||!n.next().done?!1:!0}catch(v){return!1}}if(m.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&m.ES6_CONFORMANCE)return a}else if(f())return a;var g=new WeakMap;e.prototype.set=function(h,l){h=0===h?0:h;var n=d(this,h);n.list||(n.list=this.data_[n.id]=[]);n.entry?n.entry.value=l:(n.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:h,value:l},n.list.push(n.entry),
this.head_.previous.next=n.entry,this.head_.previous=n.entry,this.size++);return this};e.prototype.delete=function(h){h=d(this,h);return h.entry&&h.list?(h.list.splice(h.index,1),h.list.length||delete this.data_[h.id],h.entry.previous.next=h.entry.next,h.entry.next.previous=h.entry.previous,h.entry.head=null,this.size--,!0):!1};e.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=b();this.size=0};e.prototype.has=function(h){return!!d(this,h).entry};e.prototype.get=function(h){return(h=
d(this,h).entry)&&h.value};e.prototype.entries=function(){return c(this,function(h){return[h.key,h.value]})};e.prototype.keys=function(){return c(this,function(h){return h.key})};e.prototype.values=function(){return c(this,function(h){return h.value})};e.prototype.forEach=function(h,l){for(var n=this.entries(),r;!(r=n.next()).done;)r=r.value,h.call(l,r[1],r[0],this)};e.prototype[Symbol.iterator]=e.prototype.entries;var k=0;return e},"es6","es3");
m.polyfill("Set",function(a){function b(d){this.map_=new Map;if(d){d=m.makeIterator(d);for(var e;!(e=d.next()).done;)this.add(e.value)}this.size=this.map_.size}function c(){if(m.ASSUME_NO_NATIVE_SET||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var d=Object.seal({x:4}),e=new a(m.makeIterator([d]));if(!e.has(d)||1!=e.size||e.add(d)!=e||1!=e.size||e.add({x:4})!=e||2!=e.size)return!1;var f=e.entries(),g=f.next();if(g.done||g.value[0]!=d||g.value[1]!=d)return!1;
g=f.next();return g.done||g.value[0]==d||4!=g.value[0].x||g.value[1]!=g.value[0]?!1:f.next().done}catch(k){return!1}}if(m.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&m.ES6_CONFORMANCE)return a}else if(c())return a;b.prototype.add=function(d){d=0===d?0:d;this.map_.set(d,d);this.size=this.map_.size;return this};b.prototype.delete=function(d){d=this.map_.delete(d);this.size=this.map_.size;return d};b.prototype.clear=function(){this.map_.clear();this.size=0};b.prototype.has=function(d){return this.map_.has(d)};
b.prototype.entries=function(){return this.map_.entries()};b.prototype.values=function(){return this.map_.values()};b.prototype.keys=b.prototype.values;b.prototype[Symbol.iterator]=b.prototype.values;b.prototype.forEach=function(d,e){var f=this;this.map_.forEach(function(g){return d.call(e,g,g,f)})};return b},"es6","es3");m.polyfill("Object.is",function(a){return a?a:function(b,c){return b===c?0!==b||1/b===1/c:b!==b&&c!==c}},"es6","es3");
m.polyfill("Array.prototype.includes",function(a){return a?a:function(b,c){var d=this;d instanceof String&&(d=String(d));var e=d.length;c=c||0;for(0>c&&(c=Math.max(c+e,0));c<e;c++){var f=d[c];if(f===b||Object.is(f,b))return!0}return!1}},"es7","es3");m.polyfill("String.prototype.includes",function(a){return a?a:function(b,c){return-1!==m.checkStringArgs(this,b,"includes").indexOf(b,c||0)}},"es6","es3");
m.assign=m.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var e in d)m.owns(d,e)&&(a[e]=d[e])}return a};m.polyfill("Object.assign",function(a){return a||m.assign},"es6","es3");m.polyfill("Object.setPrototypeOf",function(a){return a||m.setPrototypeOf},"es6","es5");
m.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};m.polyfill("Array.prototype.findIndex",function(a){return a?a:function(b,c){return m.findInternal(this,b,c).i}},"es6","es3");m.polyfill("Number.EPSILON",function(){return Math.pow(2,-52)},"es6","es3");m.polyfill("Number.MAX_SAFE_INTEGER",function(){return 9007199254740991},"es6","es3");
m.polyfill("Number.MIN_SAFE_INTEGER",function(){return-9007199254740991},"es6","es3");m.polyfill("Array.from",function(a){return a?a:function(b,c,d){c=null!=c?c:function(k){return k};var e=[],f="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];if("function"==typeof f){b=f.call(b);for(var g=0;!(f=b.next()).done;)e.push(c.call(d,f.value,g++))}else for(f=b.length,g=0;g<f;g++)e.push(c.call(d,b[g],g));return e}},"es6","es3");
m.polyfill("Array.prototype.values",function(a){return a?a:function(){return m.iteratorFromArray(this,function(b,c){return c})}},"es8","es3");m.polyfill("Array.prototype.find",function(a){return a?a:function(b,c){return m.findInternal(this,b,c).v}},"es6","es3");m.polyfill("Math.sign",function(a){return a?a:function(b){b=Number(b);return 0===b||isNaN(b)?b:0<b?1:-1}},"es6","es3");
m.polyfill("Array.prototype.fill",function(a){return a?a:function(b,c,d){var e=this.length||0;0>c&&(c=Math.max(0,e+c));if(null==d||d>e)d=e;d=Number(d);0>d&&(d=Math.max(0,e+d));for(c=Number(c||0);c<d;c++)this[c]=b;return this}},"es6","es3");m.typedArrayFill=function(a){return a?a:Array.prototype.fill};m.polyfill("Int8Array.prototype.fill",m.typedArrayFill,"es6","es5");m.polyfill("Uint8Array.prototype.fill",m.typedArrayFill,"es6","es5");
m.polyfill("Uint8ClampedArray.prototype.fill",m.typedArrayFill,"es6","es5");m.polyfill("Int16Array.prototype.fill",m.typedArrayFill,"es6","es5");m.polyfill("Uint16Array.prototype.fill",m.typedArrayFill,"es6","es5");m.polyfill("Int32Array.prototype.fill",m.typedArrayFill,"es6","es5");m.polyfill("Uint32Array.prototype.fill",m.typedArrayFill,"es6","es5");m.polyfill("Float32Array.prototype.fill",m.typedArrayFill,"es6","es5");m.polyfill("Float64Array.prototype.fill",m.typedArrayFill,"es6","es5");
m.polyfill("Object.values",function(a){return a?a:function(b){var c=[],d;for(d in b)m.owns(b,d)&&c.push(b[d]);return c}},"es8","es3");m.polyfill("Math.log2",function(a){return a?a:function(b){return Math.log(b)/Math.LN2}},"es6","es3");m.polyfill("String.prototype.endsWith",function(a){return a?a:function(b,c){var d=m.checkStringArgs(this,b,"endsWith");b+="";void 0===c&&(c=d.length);c=Math.max(0,Math.min(c|0,d.length));for(var e=b.length;0<e&&0<c;)if(d[--c]!=b[--e])return!1;return 0>=e}},"es6","es3");
m.polyfill("Promise.prototype.finally",function(a){return a?a:function(b){return this.then(function(c){return Promise.resolve(b()).then(function(){return c})},function(c){return Promise.resolve(b()).then(function(){throw c;})})}},"es9","es3");(function(){function a(L,ea,va){return L.call.apply(L.bind,arguments)}function b(L,ea,va){if(!L)throw Error();if(2<arguments.length){var wa=Array.prototype.slice.call(arguments,2);return function(){var Ja=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(Ja,wa);return L.apply(ea,Ja)}}return function(){return L.apply(ea,arguments)}}function c(L,ea,va){c=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:b;return c.apply(null,arguments)}function d(L,
ea){this.a=L;this.m=ea||L;this.c=this.m.document}function e(L,ea,va,wa){ea=L.c.createElement(ea);if(va)for(var Ja in va)va.hasOwnProperty(Ja)&&("style"==Ja?ea.style.cssText=va[Ja]:ea.setAttribute(Ja,va[Ja]));wa&&ea.appendChild(L.c.createTextNode(wa));return ea}function f(L,ea,va){(L=L.c.getElementsByTagName(ea)[0])||(L=document.documentElement);L.insertBefore(va,L.lastChild)}function g(L){L.parentNode&&L.parentNode.removeChild(L)}function k(L,ea,va){ea=ea||[];va=va||[];for(var wa=L.className.split(/\s+/),
Ja=0;Ja<ea.length;Ja+=1){for(var Sa=!1,Ua=0;Ua<wa.length;Ua+=1)if(ea[Ja]===wa[Ua]){Sa=!0;break}Sa||wa.push(ea[Ja])}ea=[];for(Ja=0;Ja<wa.length;Ja+=1){Sa=!1;for(Ua=0;Ua<va.length;Ua+=1)if(wa[Ja]===va[Ua]){Sa=!0;break}Sa||ea.push(wa[Ja])}L.className=ea.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function h(L,ea){L=L.className.split(/\s+/);for(var va=0,wa=L.length;va<wa;va++)if(L[va]==ea)return!0;return!1}function l(L){if("string"===typeof L.f)return L.f;var ea=L.m.location.protocol;"about:"==
ea&&(ea=L.a.location.protocol);return"https:"==ea?"https:":"http:"}function n(L){return L.m.location.hostname||L.a.location.hostname}function r(L,ea,va){function wa(){fb&&Ja&&Sa&&(fb(Ua),fb=null)}ea=e(L,"link",{rel:"stylesheet",href:ea,media:"all"});var Ja=!1,Sa=!0,Ua=null,fb=va||null;Q?(ea.onload=function(){Ja=!0;wa()},ea.onerror=function(){Ja=!0;Ua=Error("Stylesheet failed to load");wa()}):setTimeout(function(){Ja=!0;wa()},0);f(L,"head",ea)}function v(L,ea,va,wa){var Ja=L.c.getElementsByTagName("head")[0];
if(Ja){var Sa=e(L,"script",{src:ea}),Ua=!1;Sa.onload=Sa.onreadystatechange=function(){Ua||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(Ua=!0,va&&va(null),Sa.onload=Sa.onreadystatechange=null,"HEAD"==Sa.parentNode.tagName&&Ja.removeChild(Sa))};Ja.appendChild(Sa);setTimeout(function(){Ua||(Ua=!0,va&&va(Error("Script load timeout")))},wa||5E3);return Sa}return null}function p(){this.a=0;this.c=null}function w(L){L.a++;return function(){L.a--;y(L)}}function u(L,ea){L.c=ea;
y(L)}function y(L){0==L.a&&L.c&&(L.c(),L.c=null)}function B(L){this.a=L||"-"}function D(L,ea){this.c=L;this.f=4;this.a="n";(L=(ea||"n4").match(/^([nio])([1-9])$/i))&&(this.a=L[1],this.f=parseInt(L[2],10))}function H(L){return W(L)+" "+(L.f+"00 300px ")+K(L.c)}function K(L){var ea=[];L=L.split(/,\s*/);for(var va=0;va<L.length;va++){var wa=L[va].replace(/['"]/g,"");-1!=wa.indexOf(" ")||/^\d/.test(wa)?ea.push("'"+wa+"'"):ea.push(wa)}return ea.join(",")}function J(L){return L.a+L.f}function W(L){var ea=
"normal";"o"===L.a?ea="oblique":"i"===L.a&&(ea="italic");return ea}function M(L,ea){this.c=L;this.f=L.m.document.documentElement;this.h=ea;this.a=new B("-");this.j=!1!==ea.events;this.g=!1!==ea.classes}function ba(L){L.g&&k(L.f,[L.a.c("wf","loading")]);ta(L,"loading")}function ha(L){if(L.g){var ea=h(L.f,L.a.c("wf","active")),va=[],wa=[L.a.c("wf","loading")];ea||va.push(L.a.c("wf","inactive"));k(L.f,va,wa)}ta(L,"inactive")}function ta(L,ea,va){if(L.j&&L.h[ea])if(va)L.h[ea](va.c,J(va));else L.h[ea]()}
function I(){this.c={}}function U(L,ea,va){var wa=[],Ja;for(Ja in ea)if(ea.hasOwnProperty(Ja)){var Sa=L.c[Ja];Sa&&wa.push(Sa(ea[Ja],va))}return wa}function ia(L,ea){this.c=L;this.f=ea;this.a=e(this.c,"span",{"aria-hidden":"true"},this.f)}function R(L){f(L.c,"body",L.a)}function E(L){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+K(L.c)+";font-style:"+(W(L)+
";font-weight:"+(L.f+"00;"))}function Y(L,ea,va,wa,Ja,Sa){this.g=L;this.j=ea;this.a=wa;this.c=va;this.f=Ja||3E3;this.h=Sa||void 0}function X(L,ea,va,wa,Ja,Sa,Ua){this.v=L;this.B=ea;this.c=va;this.a=wa;this.s=Ua||"BESbswy";this.f={};this.w=Ja||3E3;this.u=Sa||null;this.o=this.j=this.h=this.g=null;this.g=new ia(this.c,this.s);this.h=new ia(this.c,this.s);this.j=new ia(this.c,this.s);this.o=new ia(this.c,this.s);L=new D(this.a.c+",serif",J(this.a));L=E(L);this.g.a.style.cssText=L;L=new D(this.a.c+",sans-serif",
J(this.a));L=E(L);this.h.a.style.cssText=L;L=new D("serif",J(this.a));L=E(L);this.j.a.style.cssText=L;L=new D("sans-serif",J(this.a));L=E(L);this.o.a.style.cssText=L;R(this.g);R(this.h);R(this.j);R(this.o)}function fa(){if(null===Aa){var L=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);Aa=!!L&&(536>parseInt(L[1],10)||536===parseInt(L[1],10)&&11>=parseInt(L[2],10))}return Aa}function ka(L,ea,va){for(var wa in oa)if(oa.hasOwnProperty(wa)&&ea===L.f[oa[wa]]&&va===L.f[oa[wa]])return!0;
return!1}function qa(L){var ea=L.g.a.offsetWidth,va=L.h.a.offsetWidth,wa;(wa=ea===L.f.serif&&va===L.f["sans-serif"])||(wa=fa()&&ka(L,ea,va));wa?Ma()-L.A>=L.w?fa()&&ka(L,ea,va)&&(null===L.u||L.u.hasOwnProperty(L.a.c))?za(L,L.v):za(L,L.B):ya(L):za(L,L.v)}function ya(L){setTimeout(c(function(){qa(this)},L),50)}function za(L,ea){setTimeout(c(function(){g(this.g.a);g(this.h.a);g(this.j.a);g(this.o.a);ea(this.a)},L),0)}function T(L,ea,va){this.c=L;this.a=ea;this.f=0;this.o=this.j=!1;this.s=va}function V(L){0==
--L.f&&L.j&&(L.o?(L=L.a,L.g&&k(L.f,[L.a.c("wf","active")],[L.a.c("wf","loading"),L.a.c("wf","inactive")]),ta(L,"active")):ha(L.a))}function ma(L){this.j=L;this.a=new I;this.h=0;this.f=this.g=!0}function P(L,ea,va,wa,Ja){var Sa=0==--L.h;(L.f||L.g)&&setTimeout(function(){var Ua=Ja||null,fb=wa||{};if(0===va.length&&Sa)ha(ea.a);else{ea.f+=va.length;Sa&&(ea.j=Sa);var mb,yb=[];for(mb=0;mb<va.length;mb++){var jb=va[mb],ub=fb[jb.c],Gb=ea.a,zb=jb;Gb.g&&k(Gb.f,[Gb.a.c("wf",zb.c,J(zb).toString(),"loading")]);
ta(Gb,"fontloading",zb);Gb=null;null===Wa&&(Wa=window.FontFace?(zb=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent))?42<parseInt(zb[1],10):!0:!1);Wa?Gb=new Y(c(ea.g,ea),c(ea.h,ea),ea.c,jb,ea.s,ub):Gb=new X(c(ea.g,ea),c(ea.h,ea),ea.c,jb,ea.s,Ua,ub);yb.push(Gb)}for(mb=0;mb<yb.length;mb++)yb[mb].start()}},0)}function N(L,ea,va){var wa=[],Ja=va.timeout;ba(ea);wa=U(L.a,va,L.c);var Sa=new T(L.c,ea,Ja);L.h=wa.length;ea=0;for(va=wa.length;ea<va;ea++)wa[ea].load(function(Ua,fb,mb){P(L,Sa,Ua,fb,mb)})}
function da(L,ea){this.c=L;this.a=ea}function ua(L,ea,va){var wa=l(L.c);L=(L.a.api||"fast.fonts.net/jsapi").replace(/^.*http(s?):(\/\/)?/,"");return wa+"//"+L+"/"+ea+".js"+(va?"?v="+va:"")}function ja(L,ea){this.c=L;this.a=ea}function S(L,ea,va){L?this.c=L:this.c=ea+Ra;this.a=[];this.f=[];this.g=va||""}function sa(L,ea){for(var va=ea.length,wa=0;wa<va;wa++){var Ja=ea[wa].split(":");3==Ja.length&&L.f.push(Ja.pop());var Sa="";2==Ja.length&&""!=Ja[1]&&(Sa=":");L.a.push(Ja.join(Sa))}}function Ga(L){if(0==
L.a.length)throw Error("No fonts to load!");if(-1!=L.c.indexOf("kit="))return L.c;for(var ea=L.a.length,va=[],wa=0;wa<ea;wa++)va.push(L.a[wa].replace(/ /g,"+"));ea=L.c+"?family="+va.join("%7C");0<L.f.length&&(ea+="&subset="+L.f.join(","));0<L.g.length&&(ea+="&text="+encodeURIComponent(L.g));return ea}function Ya(L){this.f=L;this.a=[];this.c={}}function Za(L){for(var ea=L.f.length,va=0;va<ea;va++){var wa=L.f[va].split(":"),Ja=wa[0].replace(/\+/g," "),Sa=["n4"];if(2<=wa.length){var Ua=wa[1];var fb=
[];if(Ua){Ua=Ua.split(",");for(var mb=Ua.length,yb=0;yb<mb;yb++){var jb=Ua[yb];if(jb.match(/^[\w-]+$/)){var ub=cb.exec(jb.toLowerCase());if(null==ub)jb="";else{jb=ub[2];jb=null==jb||""==jb?"n":Oa[jb];ub=ub[1];if(null==ub||""==ub)ub="4";else{var Gb=db[ub];ub=Gb?Gb:isNaN(ub)?"4":ub.substr(0,1)}jb=[jb,ub].join("")}}else jb="";jb&&fb.push(jb)}}0<fb.length&&(Sa=fb);3==wa.length&&(wa=wa[2],fb=[],wa=wa?wa.split(","):fb,0<wa.length&&(wa=Pa[wa[0]])&&(L.c[Ja]=wa))}L.c[Ja]||(wa=Pa[Ja])&&(L.c[Ja]=wa);for(wa=
0;wa<Sa.length;wa+=1)L.a.push(new D(Ja,Sa[wa]))}}function Ca(L,ea){this.c=L;this.a=ea}function na(L,ea){this.c=L;this.a=ea}function Ea(L,ea){this.c=L;this.f=ea;this.a=[]}var Ma=Date.now||function(){return+new Date},Q=!!window.FontFace;B.prototype.c=function(L){for(var ea=[],va=0;va<arguments.length;va++)ea.push(arguments[va].replace(/[\W_]+/g,"").toLowerCase());return ea.join(this.a)};Y.prototype.start=function(){var L=this.c.m.document,ea=this,va=Ma(),wa=new Promise(function(Sa,Ua){function fb(){Ma()-
va>=ea.f?Ua():L.fonts.load(H(ea.a),ea.h).then(function(mb){1<=mb.length?Sa():setTimeout(fb,25)},function(){Ua()})}fb()}),Ja=new Promise(function(Sa,Ua){setTimeout(Ua,ea.f)});Promise.race([Ja,wa]).then(function(){ea.g(ea.a)},function(){ea.j(ea.a)})};var oa={D:"serif",C:"sans-serif"},Aa=null;X.prototype.start=function(){this.f.serif=this.j.a.offsetWidth;this.f["sans-serif"]=this.o.a.offsetWidth;this.A=Ma();qa(this)};var Wa=null;T.prototype.g=function(L){var ea=this.a;ea.g&&k(ea.f,[ea.a.c("wf",L.c,J(L).toString(),
"active")],[ea.a.c("wf",L.c,J(L).toString(),"loading"),ea.a.c("wf",L.c,J(L).toString(),"inactive")]);ta(ea,"fontactive",L);this.o=!0;V(this)};T.prototype.h=function(L){var ea=this.a;if(ea.g){var va=h(ea.f,ea.a.c("wf",L.c,J(L).toString(),"active")),wa=[],Ja=[ea.a.c("wf",L.c,J(L).toString(),"loading")];va||wa.push(ea.a.c("wf",L.c,J(L).toString(),"inactive"));k(ea.f,wa,Ja)}ta(ea,"fontinactive",L);V(this)};ma.prototype.load=function(L){this.c=new d(this.j,L.context||this.j);this.g=!1!==L.events;this.f=
!1!==L.classes;N(this,new M(this.c,L),L)};da.prototype.load=function(L){function ea(){if(Sa["__mti_fntLst"+wa]){var Ua=Sa["__mti_fntLst"+wa](),fb=[],mb;if(Ua)for(var yb=0;yb<Ua.length;yb++){var jb=Ua[yb].fontfamily;void 0!=Ua[yb].fontStyle&&void 0!=Ua[yb].fontWeight?(mb=Ua[yb].fontStyle+Ua[yb].fontWeight,fb.push(new D(jb,mb))):fb.push(new D(jb))}L(fb)}else setTimeout(function(){ea()},50)}var va=this,wa=va.a.projectId,Ja=va.a.version;if(wa){var Sa=va.c.m;v(this.c,ua(va,wa,Ja),function(Ua){Ua?L([]):
(Sa["__MonotypeConfiguration__"+wa]=function(){return va.a},ea())}).id="__MonotypeAPIScript__"+wa}else L([])};ja.prototype.load=function(L){var ea,va=this.a.urls||[],wa=this.a.families||[],Ja=this.a.testStrings||{},Sa=new p;var Ua=0;for(ea=va.length;Ua<ea;Ua++)r(this.c,va[Ua],w(Sa));var fb=[];Ua=0;for(ea=wa.length;Ua<ea;Ua++)if(va=wa[Ua].split(":"),va[1])for(var mb=va[1].split(","),yb=0;yb<mb.length;yb+=1)fb.push(new D(va[0],mb[yb]));else fb.push(new D(va[0]));u(Sa,function(){L(fb,Ja)})};var Ra="//fonts.googleapis.com/css",
Pa={latin:"BESbswy","latin-ext":"\u00e7\u00f6\u00fc\u011f\u015f",cyrillic:"\u0439\u044f\u0416",greek:"\u03b1\u03b2\u03a3",khmer:"\u1780\u1781\u1782",Hanuman:"\u1780\u1781\u1782"},db={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},Oa={i:"i",italic:"i",n:"n",normal:"n"},
cb=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/,hb={Arimo:!0,Cousine:!0,Tinos:!0};Ca.prototype.load=function(L){var ea=new p,va=this.c,wa=new S(this.a.api,l(va),this.a.text),Ja=this.a.families;sa(wa,Ja);var Sa=new Ya(Ja);Za(Sa);r(va,Ga(wa),w(ea));u(ea,function(){L(Sa.a,Sa.c,hb)})};na.prototype.load=function(L){var ea=this.a.id,va=this.c.m;ea?v(this.c,(this.a.api||"https://use.typekit.net")+"/"+ea+".js",
function(wa){if(wa)L([]);else if(va.Typekit&&va.Typekit.config&&va.Typekit.config.fn){wa=va.Typekit.config.fn;for(var Ja=[],Sa=0;Sa<wa.length;Sa+=2)for(var Ua=wa[Sa],fb=wa[Sa+1],mb=0;mb<fb.length;mb++)Ja.push(new D(Ua,fb[mb]));try{va.Typekit.load({events:!1,classes:!1,async:!0})}catch(yb){}L(Ja)}},2E3):L([])};Ea.prototype.load=function(L){var ea=this.f.id,va=this.c.m,wa=this;ea?(va.__webfontfontdeckmodule__||(va.__webfontfontdeckmodule__={}),va.__webfontfontdeckmodule__[ea]=function(Ja,Sa){Ja=0;for(var Ua=
Sa.fonts.length;Ja<Ua;++Ja){var fb=Sa.fonts[Ja],mb=wa.a,yb=mb.push,jb=fb.name;fb="font-weight:"+fb.weight+";font-style:"+fb.style;var ub=4,Gb="n",zb=null;fb&&((zb=fb.match(/(normal|oblique|italic)/i))&&zb[1]&&(Gb=zb[1].substr(0,1).toLowerCase()),(zb=fb.match(/([1-9]00|normal|bold)/i))&&zb[1]&&(/bold/i.test(zb[1])?ub=7:/[1-9]00/.test(zb[1])&&(ub=parseInt(zb[1].substr(0,1),10))));yb.call(mb,new D(jb,Gb+ub))}L(wa.a)},v(this.c,l(this.c)+(this.f.api||"//f.fontdeck.com/s/css/js/")+n(this.c)+"/"+ea+".js",
function(Ja){Ja&&L([])})):L([])};var ob=new ma(window);ob.a.c.custom=function(L,ea){return new ja(ea,L)};ob.a.c.fontdeck=function(L,ea){return new Ea(ea,L)};ob.a.c.monotype=function(L,ea){return new da(ea,L)};ob.a.c.typekit=function(L,ea){return new na(ea,L)};ob.a.c.google=function(L,ea){return new Ca(ea,L)};var Da={load:c(ob.load,ob)};"function"===typeof define&&define.amd?define(function(){return Da}):"undefined"!==typeof module&&module.exports?module.exports=Da:(window.WebFont=Da,window.WebFontConfig&&
ob.load(window.WebFontConfig))})();var G={REVISION:"71"};"object"===typeof module&&(module.exports=G);void 0===Math.sign&&(Math.sign=function(a){return 0>a?-1:0<a?1:+a});G.log=function(){console.log.apply(console,arguments)};G.warn=function(){console.warn.apply(console,arguments)};G.error=function(){console.error.apply(console,arguments)};G.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};G.CullFaceNone=0;G.CullFaceBack=1;G.CullFaceFront=2;G.CullFaceFrontBack=3;G.FrontFaceDirectionCW=0;G.FrontFaceDirectionCCW=1;G.BasicShadowMap=0;G.PCFShadowMap=1;
G.PCFSoftShadowMap=2;G.FrontSide=0;G.BackSide=1;G.DoubleSide=2;G.NoShading=0;G.FlatShading=1;G.SmoothShading=2;G.NoColors=0;G.FaceColors=1;G.VertexColors=2;G.NoBlending=0;G.NormalBlending=1;G.AdditiveBlending=2;G.SubtractiveBlending=3;G.MultiplyBlending=4;G.CustomBlending=5;G.AddEquation=100;G.SubtractEquation=101;G.ReverseSubtractEquation=102;G.MinEquation=103;G.MaxEquation=104;G.ZeroFactor=200;G.OneFactor=201;G.SrcColorFactor=202;G.OneMinusSrcColorFactor=203;G.SrcAlphaFactor=204;
G.OneMinusSrcAlphaFactor=205;G.DstAlphaFactor=206;G.OneMinusDstAlphaFactor=207;G.DstColorFactor=208;G.OneMinusDstColorFactor=209;G.SrcAlphaSaturateFactor=210;G.MultiplyOperation=0;G.MixOperation=1;G.AddOperation=2;G.UVMapping=300;G.CubeReflectionMapping=301;G.CubeRefractionMapping=302;G.EquirectangularReflectionMapping=303;G.EquirectangularRefractionMapping=304;G.SphericalReflectionMapping=305;G.Color=function(a){return 3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(a)};
G.Color.prototype={constructor:G.Color,r:1,g:1,b:1,set:function(a){a instanceof G.Color?this.copy(a):"number"===typeof a?this.setHex(a):"string"===typeof a&&this.setStyle(a);return this},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},setRGB:function(a,b,c){this.r=a;this.g=b;this.b=c;return this},setHSL:function(a,b,c){if(0===b)this.r=this.g=this.b=c;else{var d=function(e,f,g){0>g&&(g+=1);1<g&&--g;return g<1/6?e+6*(f-e)*g:.5>g?f:g<2/
3?e+6*(f-e)*(2/3-g):e};b=.5>=c?c*(1+b):c+b-c*b;c=2*c-b;this.r=d(c,b,a+1/3);this.g=d(c,b,a);this.b=d(c,b,a-1/3)}return this},setStyle:function(a){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(a))return a=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(a),this.r=Math.min(255,parseInt(a[1],10))/255,this.g=Math.min(255,parseInt(a[2],10))/255,this.b=Math.min(255,parseInt(a[3],10))/255,this;if(/^rgb\((\d+)%, ?(\d+)%, ?(\d+)%\)$/i.test(a))return a=/^rgb\((\d+)%, ?(\d+)%, ?(\d+)%\)$/i.exec(a),this.r=Math.min(100,parseInt(a[1],
10))/100,this.g=Math.min(100,parseInt(a[2],10))/100,this.b=Math.min(100,parseInt(a[3],10))/100,this;if(/^#([0-9a-f]{6})$/i.test(a))return a=/^#([0-9a-f]{6})$/i.exec(a),this.setHex(parseInt(a[1],16)),this;if(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(a))return a=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(a),this.setHex(parseInt(a[1]+a[1]+a[2]+a[2]+a[3]+a[3],16)),this;if(/^(\w+)$/i.test(a))return this.setHex(G.ColorKeywords[a]),this},copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;return this},copyGammaToLinear:function(a,
b){void 0===b&&(b=2);this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return this},copyLinearToGamma:function(a,b){void 0===b&&(b=2);b=0<b?1/b:1;this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return this},convertGammaToLinear:function(){var a=this.r,b=this.g,c=this.b;this.r=a*a;this.g=b*b;this.b=c*c;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return 255*
this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(a){a=a||{h:0,s:0,l:0};var b=this.r,c=this.g,d=this.b,e=Math.max(b,c,d),f=Math.min(b,c,d),g,k=(f+e)/2;if(f===e)f=g=0;else{var h=e-f;f=.5>=k?h/(e+f):h/(2-e-f);switch(e){case b:g=(c-d)/h+(c<d?6:0);break;case c:g=(d-b)/h+2;break;case d:g=(b-c)/h+4}g/=6}a.h=g;a.s=f;a.l=k;return a},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},
offsetHSL:function(a,b,c){var d=this.getHSL();d.h+=a;d.s+=b;d.l+=c;this.setHSL(d.h,d.s,d.l);return this},add:function(a){this.r+=a.r;this.g+=a.g;this.b+=a.b;return this},addColors:function(a,b){this.r=a.r+b.r;this.g=a.g+b.g;this.b=a.b+b.b;return this},addScalar:function(a){this.r+=a;this.g+=a;this.b+=a;return this},multiply:function(a){this.r*=a.r;this.g*=a.g;this.b*=a.b;return this},multiplyScalar:function(a){this.r*=a;this.g*=a;this.b*=a;return this},lerp:function(a,b){this.r+=(a.r-this.r)*b;this.g+=
(a.g-this.g)*b;this.b+=(a.b-this.b)*b;return this},equals:function(a){return a.r===this.r&&a.g===this.g&&a.b===this.b},fromArray:function(a){this.r=a[0];this.g=a[1];this.b=a[2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.r;a[b+1]=this.g;a[b+2]=this.b;return a},clone:function(){return(new G.Color).setRGB(this.r,this.g,this.b)}};
G.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,
darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,
grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,
lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,
palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,
tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};G.Quaternion=function(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._w=void 0!==d?d:1};
G.Quaternion.prototype={constructor:G.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get w(){return this._w},set w(a){this._w=a;this.onChangeCallback()},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._w=d;this.onChangeCallback();return this},copy:function(a){this._x=a.x;this._y=a.y;this._z=a.z;this._w=
a.w;this.onChangeCallback();return this},setFromEuler:function(a,b){if(!1===a instanceof G.Euler)throw Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var c=Math.cos(a._x/2),d=Math.cos(a._y/2),e=Math.cos(a._z/2),f=Math.sin(a._x/2),g=Math.sin(a._y/2),k=Math.sin(a._z/2);"XYZ"===a.order?(this._x=f*d*e+c*g*k,this._y=c*g*e-f*d*k,this._z=c*d*k+f*g*e,this._w=c*d*e-f*g*k):"YXZ"===a.order?(this._x=f*d*e+c*g*k,this._y=c*g*e-f*d*k,this._z=c*d*k-f*g*e,
this._w=c*d*e+f*g*k):"ZXY"===a.order?(this._x=f*d*e-c*g*k,this._y=c*g*e+f*d*k,this._z=c*d*k+f*g*e,this._w=c*d*e-f*g*k):"ZYX"===a.order?(this._x=f*d*e-c*g*k,this._y=c*g*e+f*d*k,this._z=c*d*k-f*g*e,this._w=c*d*e+f*g*k):"YZX"===a.order?(this._x=f*d*e+c*g*k,this._y=c*g*e+f*d*k,this._z=c*d*k-f*g*e,this._w=c*d*e-f*g*k):"XZY"===a.order&&(this._x=f*d*e-c*g*k,this._y=c*g*e-f*d*k,this._z=c*d*k+f*g*e,this._w=c*d*e+f*g*k);if(!1!==b)this.onChangeCallback();return this},setFromAxisAngle:function(a,b){b/=2;var c=
Math.sin(b);this._x=a.x*c;this._y=a.y*c;this._z=a.z*c;this._w=Math.cos(b);this.onChangeCallback();return this},setFromRotationMatrix:function(a){var b=a.elements,c=b[0];a=b[4];var d=b[8],e=b[1],f=b[5],g=b[9],k=b[2],h=b[6];b=b[10];var l=c+f+b;0<l?(c=.5/Math.sqrt(l+1),this._w=.25/c,this._x=(h-g)*c,this._y=(d-k)*c,this._z=(e-a)*c):c>f&&c>b?(c=2*Math.sqrt(1+c-f-b),this._w=(h-g)/c,this._x=.25*c,this._y=(a+e)/c,this._z=(d+k)/c):f>b?(c=2*Math.sqrt(1+f-c-b),this._w=(d-k)/c,this._x=(a+e)/c,this._y=.25*c,this._z=
(g+h)/c):(c=2*Math.sqrt(1+b-c-f),this._w=(e-a)/c,this._x=(d+k)/c,this._y=(g+h)/c,this._z=.25*c);this.onChangeCallback();return this},setFromUnitVectors:function(){var a,b;return function(c,d){void 0===a&&(a=new G.Vector3);b=c.dot(d)+1;1E-6>b?(b=0,Math.abs(c.x)>Math.abs(c.z)?a.set(-c.y,c.x,0):a.set(0,-c.z,c.y)):a.crossVectors(c,d);this._x=a.x;this._y=a.y;this._z=a.z;this._w=b;this.normalize();return this}}(),inverse:function(){this.conjugate().normalize();return this},conjugate:function(){this._x*=
-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();0===a?(this._z=this._y=this._x=0,this._w=1):(a=1/a,this._x*=a,this._y*=a,this._z*=a,this._w*=a);this.onChangeCallback();return this},
multiply:function(a,b){return void 0!==b?(G.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(a,b)):this.multiplyQuaternions(this,a)},multiplyQuaternions:function(a,b){var c=a._x,d=a._y,e=a._z;a=a._w;var f=b._x,g=b._y,k=b._z;b=b._w;this._x=c*b+a*f+d*k-e*g;this._y=d*b+a*g+e*f-c*k;this._z=e*b+a*k+c*g-d*f;this._w=a*b-c*f-d*g-e*k;this.onChangeCallback();return this},multiplyVector3:function(a){G.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");
return a.applyQuaternion(this)},slerp:function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var c=this._x,d=this._y,e=this._z,f=this._w,g=f*a._w+c*a._x+d*a._y+e*a._z;0>g?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,g=-g):this.copy(a);if(1<=g)return this._w=f,this._x=c,this._y=d,this._z=e,this;a=Math.acos(g);var k=Math.sqrt(1-g*g);if(.001>Math.abs(k))return this._w=.5*(f+this._w),this._x=.5*(c+this._x),this._y=.5*(d+this._y),this._z=.5*(e+this._z),this;g=Math.sin((1-b)*a)/k;b=
Math.sin(b*a)/k;this._w=f*g+this._w*b;this._x=c*g+this._x*b;this._y=d*g+this._y*b;this._z=e*g+this._z*b;this.onChangeCallback();return this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a,b){void 0===b&&(b=0);this._x=a[b];this._y=a[b+1];this._z=a[b+2];this._w=a[b+3];this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._w;return a},onChange:function(a){this.onChangeCallback=
a;return this},onChangeCallback:function(){},clone:function(){return new G.Quaternion(this._x,this._y,this._z,this._w)}};G.Quaternion.slerp=function(a,b,c,d){return c.copy(a).slerp(b,d)};G.Vector2=function(a,b){this.x=a||0;this.y=b||0};
G.Vector2.prototype={constructor:G.Vector2,set:function(a,b){this.x=a;this.y=b;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+a);}},copy:function(a){this.x=a.x;this.y=a.y;return this},add:function(a,b){if(void 0!==
b)return G.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;return this},addScalar:function(a){this.x+=a;this.y+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},sub:function(a,b){if(void 0!==b)return G.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;return this},subScalar:function(a){this.x-=
a;this.y-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;return this},divide:function(a){this.x/=a.x;this.y/=a.y;return this},divideScalar:function(a){0!==a?(a=1/a,this.x*=a,this.y*=a):this.y=this.x=0;return this},min:function(a){this.x>a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);return this},max:function(a){this.x<a.x&&(this.x=a.x);this.y<a.y&&(this.y=a.y);return this},
clamp:function(a,b){this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x);this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y);return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new G.Vector2,b=new G.Vector2);a.set(c,c);b.set(d,d);return this.clamp(a,b)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);
return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},
distanceToSquared:function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a},setLength:function(a){var b=this.length();0!==b&&a!==b&&this.multiplyScalar(a/b);return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this},lerpVectors:function(a,b,c){this.subVectors(b,a).multiplyScalar(c).add(a);return this},equals:function(a){return a.x===this.x&&a.y===this.y},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];return this},toArray:function(a,b){void 0===
a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];return this},clone:function(){return new G.Vector2(this.x,this.y)}};G.Vector3=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};
G.Vector3.prototype={constructor:G.Vector3,set:function(a,b,c){this.x=a;this.y=b;this.z=c;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+
a);}},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,b){if(void 0!==b)return G.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},sub:function(a,b){if(void 0!==b)return G.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),
this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},multiply:function(a,b){if(void 0!==b)return G.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b);this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;return this},
multiplyVectors:function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},applyEuler:function(){var a;return function(b){!1===b instanceof G.Euler&&G.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order.");void 0===a&&(a=new G.Quaternion);this.applyQuaternion(a.setFromEuler(b));return this}}(),applyAxisAngle:function(){var a;return function(b,c){void 0===a&&(a=new G.Quaternion);this.applyQuaternion(a.setFromAxisAngle(b,c));return this}}(),
applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[3]*c+a[6]*d;this.y=a[1]*b+a[4]*c+a[7]*d;this.z=a[2]*b+a[5]*c+a[8]*d;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12];this.y=a[1]*b+a[5]*c+a[9]*d+a[13];this.z=a[2]*b+a[6]*c+a[10]*d+a[14];return this},applyProjection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;var e=1/(a[3]*b+a[7]*c+a[11]*d+a[15]);this.x=(a[0]*b+a[4]*c+a[8]*d+a[12])*e;this.y=
(a[1]*b+a[5]*c+a[9]*d+a[13])*e;this.z=(a[2]*b+a[6]*c+a[10]*d+a[14])*e;return this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z;a=a.w;var k=a*b+f*d-g*c,h=a*c+g*b-e*d,l=a*d+e*c-f*b;b=-e*b-f*c-g*d;this.x=k*a+b*-e+h*-g-l*-f;this.y=h*a+b*-f+l*-e-k*-g;this.z=l*a+b*-g+k*-f-h*-e;return this},project:function(){var a;return function(b){void 0===a&&(a=new G.Matrix4);a.multiplyMatrices(b.projectionMatrix,a.getInverse(b.matrixWorld));return this.applyProjection(a)}}(),unproject:function(){var a;
return function(b){void 0===a&&(a=new G.Matrix4);a.multiplyMatrices(b.matrixWorld,a.getInverse(b.projectionMatrix));return this.applyProjection(a)}}(),transformDirection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d;this.y=a[1]*b+a[5]*c+a[9]*d;this.z=a[2]*b+a[6]*c+a[10]*d;this.normalize();return this},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){0!==a?(a=1/a,this.x*=a,this.y*=a,this.z*=a):this.z=this.y=this.x=0;
return this},min:function(a){this.x>a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);this.z>a.z&&(this.z=a.z);return this},max:function(a){this.x<a.x&&(this.x=a.x);this.y<a.y&&(this.y=a.y);this.z<a.z&&(this.z=a.z);return this},clamp:function(a,b){this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x);this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y);this.z<a.z?this.z=a.z:this.z>b.z&&(this.z=b.z);return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new G.Vector3,b=new G.Vector3);a.set(c,
c,c);b.set(d,d,d);return this.clamp(a,b)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=
0>this.z?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=
this.length();0!==b&&a!==b&&this.multiplyScalar(a/b);return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this},lerpVectors:function(a,b,c){this.subVectors(b,a).multiplyScalar(c).add(a);return this},cross:function(a,b){if(void 0!==b)return G.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,b);b=this.x;var c=this.y,d=this.z;this.x=c*a.z-d*a.y;this.y=d*a.x-b*a.z;this.z=b*a.y-c*
a.x;return this},crossVectors:function(a,b){var c=a.x,d=a.y;a=a.z;var e=b.x,f=b.y;b=b.z;this.x=d*b-a*f;this.y=a*e-c*b;this.z=c*f-d*e;return this},projectOnVector:function(){var a,b;return function(c){void 0===a&&(a=new G.Vector3);a.copy(c).normalize();b=this.dot(a);return this.copy(a).multiplyScalar(b)}}(),projectOnPlane:function(){var a;return function(b){void 0===a&&(a=new G.Vector3);a.copy(this).projectOnVector(b);return this.sub(a)}}(),reflect:function(){var a;return function(b){void 0===a&&(a=
new G.Vector3);return this.sub(a.copy(b).multiplyScalar(2*this.dot(b)))}}(),angleTo:function(a){a=this.dot(a)/(this.length()*a.length());return Math.acos(G.Math.clamp(a,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a},setEulerFromRotationMatrix:function(){G.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){G.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},
getPositionFromMatrix:function(a){G.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(a)},getScaleFromMatrix:function(a){G.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,b){G.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(a,b)},setFromMatrixPosition:function(a){this.x=
a.elements[12];this.y=a.elements[13];this.z=a.elements[14];return this},setFromMatrixScale:function(a){var b=this.set(a.elements[0],a.elements[1],a.elements[2]).length(),c=this.set(a.elements[4],a.elements[5],a.elements[6]).length();a=this.set(a.elements[8],a.elements[9],a.elements[10]).length();this.x=b;this.y=c;this.z=a;return this},setFromMatrixColumn:function(a,b){a*=4;b=b.elements;this.x=b[a];this.y=b[a+1];this.z=b[a+2];return this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===
this.z},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];return this},clone:function(){return new G.Vector3(this.x,this.y,this.z)}};G.Vector4=function(a,b,c,d){this.x=a||0;this.y=b||0;this.z=c||0;this.w=void 0!==d?d:1};
G.Vector4.prototype={constructor:G.Vector4,set:function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setW:function(a){this.w=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;
case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+a);}},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=void 0!==a.w?a.w:1;return this},add:function(a,b){if(void 0!==b)return G.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this},addVectors:function(a,
b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},sub:function(a,b){if(void 0!==b)return G.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;this.w-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiplyScalar:function(a){this.x*=
a;this.y*=a;this.z*=a;this.w*=a;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=this.w;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12]*e;this.y=a[1]*b+a[5]*c+a[9]*d+a[13]*e;this.z=a[2]*b+a[6]*c+a[10]*d+a[14]*e;this.w=a[3]*b+a[7]*c+a[11]*d+a[15]*e;return this},divideScalar:function(a){0!==a?(a=1/a,this.x*=a,this.y*=a,this.z*=a,this.w*=a):(this.z=this.y=this.x=0,this.w=1);return this},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);1E-4>
b?(this.x=1,this.z=this.y=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b);return this},setAxisAngleFromRotationMatrix:function(a){a=a.elements;var b=a[0];var c=a[4];var d=a[8],e=a[1],f=a[5],g=a[9];var k=a[2];var h=a[6];var l=a[10];if(.01>Math.abs(c-e)&&.01>Math.abs(d-k)&&.01>Math.abs(g-h)){if(.1>Math.abs(c+e)&&.1>Math.abs(d+k)&&.1>Math.abs(g+h)&&.1>Math.abs(b+f+l-3))return this.set(1,0,0,0),this;a=Math.PI;b=(b+1)/2;f=(f+1)/2;l=(l+1)/2;c=(c+e)/4;d=(d+k)/4;g=(g+h)/4;b>f&&b>l?.01>b?(h=0,c=k=.707106781):
(h=Math.sqrt(b),k=c/h,c=d/h):f>l?.01>f?(h=.707106781,k=0,c=.707106781):(k=Math.sqrt(f),h=c/k,c=g/k):.01>l?(k=h=.707106781,c=0):(c=Math.sqrt(l),h=d/c,k=g/c);this.set(h,k,c,a);return this}a=Math.sqrt((h-g)*(h-g)+(d-k)*(d-k)+(e-c)*(e-c));.001>Math.abs(a)&&(a=1);this.x=(h-g)/a;this.y=(d-k)/a;this.z=(e-c)/a;this.w=Math.acos((b+f+l-1)/2);return this},min:function(a){this.x>a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);this.z>a.z&&(this.z=a.z);this.w>a.w&&(this.w=a.w);return this},max:function(a){this.x<a.x&&
(this.x=a.x);this.y<a.y&&(this.y=a.y);this.z<a.z&&(this.z=a.z);this.w<a.w&&(this.w=a.w);return this},clamp:function(a,b){this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x);this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y);this.z<a.z?this.z=a.z:this.z>b.z&&(this.z=b.z);this.w<a.w?this.w=a.w:this.w>b.w&&(this.w=b.w);return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new G.Vector4,b=new G.Vector4);a.set(c,c,c,c);b.set(d,d,d,d);return this.clamp(a,b)}}(),floor:function(){this.x=
Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);
this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+
Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=this.length();0!==b&&a!==b&&this.multiplyScalar(a/b);return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;this.w+=(a.w-this.w)*b;return this},lerpVectors:function(a,b,c){this.subVectors(b,a).multiplyScalar(c).add(a);return this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},
fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];this.w=a[b+3];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;a[b+3]=this.w;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];this.w=a.array[b+3];return this},clone:function(){return new G.Vector4(this.x,this.y,this.z,this.w)}};
G.Euler=function(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._order=d||G.Euler.DefaultOrder};G.Euler.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" ");G.Euler.DefaultOrder="XYZ";
G.Euler.prototype={constructor:G.Euler,_x:0,_y:0,_z:0,_order:G.Euler.DefaultOrder,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get order(){return this._order},set order(a){this._order=a;this.onChangeCallback()},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._order=d||this._order;this.onChangeCallback();return this},copy:function(a){this._x=
a._x;this._y=a._y;this._z=a._z;this._order=a._order;this.onChangeCallback();return this},setFromRotationMatrix:function(a,b,c){var d=G.Math.clamp,e=a.elements;a=e[0];var f=e[4],g=e[8],k=e[1],h=e[5],l=e[9],n=e[2],r=e[6];e=e[10];b=b||this._order;"XYZ"===b?(this._y=Math.asin(d(g,-1,1)),.99999>Math.abs(g)?(this._x=Math.atan2(-l,e),this._z=Math.atan2(-f,a)):(this._x=Math.atan2(r,h),this._z=0)):"YXZ"===b?(this._x=Math.asin(-d(l,-1,1)),.99999>Math.abs(l)?(this._y=Math.atan2(g,e),this._z=Math.atan2(k,h)):
(this._y=Math.atan2(-n,a),this._z=0)):"ZXY"===b?(this._x=Math.asin(d(r,-1,1)),.99999>Math.abs(r)?(this._y=Math.atan2(-n,e),this._z=Math.atan2(-f,h)):(this._y=0,this._z=Math.atan2(k,a))):"ZYX"===b?(this._y=Math.asin(-d(n,-1,1)),.99999>Math.abs(n)?(this._x=Math.atan2(r,e),this._z=Math.atan2(k,a)):(this._x=0,this._z=Math.atan2(-f,h))):"YZX"===b?(this._z=Math.asin(d(k,-1,1)),.99999>Math.abs(k)?(this._x=Math.atan2(-l,h),this._y=Math.atan2(-n,a)):(this._x=0,this._y=Math.atan2(g,e))):"XZY"===b?(this._z=
Math.asin(-d(f,-1,1)),.99999>Math.abs(f)?(this._x=Math.atan2(r,h),this._y=Math.atan2(g,a)):(this._x=Math.atan2(-l,e),this._y=0)):G.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+b);this._order=b;if(!1!==c)this.onChangeCallback();return this},setFromQuaternion:function(){var a;return function(b,c,d){void 0===a&&(a=new G.Matrix4);a.makeRotationFromQuaternion(b);this.setFromRotationMatrix(a,c,d);return this}}(),setFromVector3:function(a,b){return this.set(a.x,a.y,a.z,b||this._order)},
reorder:function(){var a=new G.Quaternion;return function(b){a.setFromEuler(this);this.setFromQuaternion(a,b)}}(),equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){this._x=a[0];this._y=a[1];this._z=a[2];void 0!==a[3]&&(this._order=a[3]);this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._order;return a},toVector3:function(a){return a?
a.set(this._x,this._y,this._z):new G.Vector3(this._x,this._y,this._z)},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){},clone:function(){return new G.Euler(this._x,this._y,this._z,this._order)}};G.Line3=function(a,b){this.start=void 0!==a?a:new G.Vector3;this.end=void 0!==b?b:new G.Vector3};
G.Line3.prototype={constructor:G.Line3,set:function(a,b){this.start.copy(a);this.end.copy(b);return this},copy:function(a){this.start.copy(a.start);this.end.copy(a.end);return this},center:function(a){return(a||new G.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(a){return(a||new G.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(a,b){b=
b||new G.Vector3;return this.delta(b).multiplyScalar(a).add(this.start)},closestPointToPointParameter:function(){var a=new G.Vector3,b=new G.Vector3;return function(c,d){a.subVectors(c,this.start);b.subVectors(this.end,this.start);c=b.dot(b);c=b.dot(a)/c;d&&(c=G.Math.clamp(c,0,1));return c}}(),closestPointToPoint:function(a,b,c){a=this.closestPointToPointParameter(a,b);c=c||new G.Vector3;return this.delta(c).multiplyScalar(a).add(this.start)},applyMatrix4:function(a){this.start.applyMatrix4(a);this.end.applyMatrix4(a);
return this},equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end)},clone:function(){return(new G.Line3).copy(this)}};G.Box2=function(a,b){this.min=void 0!==a?a:new G.Vector2(Infinity,Infinity);this.max=void 0!==b?b:new G.Vector2(-Infinity,-Infinity)};
G.Box2.prototype={constructor:G.Box2,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(a){return(a||new G.Vector2).addVectors(this.min,
this.max).multiplyScalar(.5)},size:function(a){return(a||new G.Vector2).subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&
this.min.y<=a.min.y&&a.max.y<=this.max.y?!0:!1},getParameter:function(a,b){return(b||new G.Vector2).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y?!1:!0},clampPoint:function(a,b){return(b||new G.Vector2).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new G.Vector2;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),
intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)},clone:function(){return(new G.Box2).copy(this)}};G.Box3=function(a,b){this.min=void 0!==a?a:new G.Vector3(Infinity,Infinity,Infinity);this.max=void 0!==b?b:new G.Vector3(-Infinity,-Infinity,-Infinity)};
G.Box3.prototype={constructor:G.Box3,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(a){return(a||
new G.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new G.Vector3).subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z?!1:!0},
containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z?!0:!1},getParameter:function(a,b){return(b||new G.Vector3).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z?!1:
!0},clampPoint:function(a,b){return(b||new G.Vector3).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new G.Vector3;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),getBoundingSphere:function(){var a=new G.Vector3;return function(b){b=b||new G.Sphere;b.center=this.center();b.radius=.5*this.size(a).length();return b}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);
return this},applyMatrix4:function(){var a=[new G.Vector3,new G.Vector3,new G.Vector3,new G.Vector3,new G.Vector3,new G.Vector3,new G.Vector3,new G.Vector3];return function(b){a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b);a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b);a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b);a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b);a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b);a[5].set(this.max.x,this.min.y,
this.max.z).applyMatrix4(b);a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b);a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b);this.makeEmpty();this.setFromPoints(a);return this}}(),translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)},clone:function(){return(new G.Box3).copy(this)}};G.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);0<arguments.length&&G.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")};
G.Matrix3.prototype={constructor:G.Matrix3,set:function(a,b,c,d,e,f,g,k,h){var l=this.elements;l[0]=a;l[3]=b;l[6]=c;l[1]=d;l[4]=e;l[7]=f;l[2]=g;l[5]=k;l[8]=h;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},copy:function(a){a=a.elements;this.set(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]);return this},multiplyVector3:function(a){G.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return a.applyMatrix3(this)},multiplyVector3Array:function(a){G.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");
return this.applyToVector3Array(a)},applyToVector3Array:function(){var a=new G.Vector3;return function(b,c,d){void 0===c&&(c=0);void 0===d&&(d=b.length);for(var e=0;e<d;e+=3,c+=3)a.x=b[c],a.y=b[c+1],a.z=b[c+2],a.applyMatrix3(this),b[c]=a.x,b[c+1]=a.y,b[c+2]=a.z;return b}}(),multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[3]*=a;b[6]*=a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this},determinant:function(){var a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],k=a[6],h=
a[7];a=a[8];return b*f*a-b*g*h-c*e*a+c*g*k+d*e*h-d*f*k},getInverse:function(a,b){a=a.elements;var c=this.elements;c[0]=a[10]*a[5]-a[6]*a[9];c[1]=-a[10]*a[1]+a[2]*a[9];c[2]=a[6]*a[1]-a[2]*a[5];c[3]=-a[10]*a[4]+a[6]*a[8];c[4]=a[10]*a[0]-a[2]*a[8];c[5]=-a[6]*a[0]+a[2]*a[4];c[6]=a[9]*a[4]-a[5]*a[8];c[7]=-a[9]*a[0]+a[1]*a[8];c[8]=a[5]*a[0]-a[1]*a[4];a=a[0]*c[0]+a[1]*c[3]+a[2]*c[6];if(0===a){if(b)throw Error("Matrix3.getInverse(): can't invert matrix, determinant is 0");G.warn("Matrix3.getInverse(): can't invert matrix, determinant is 0");
this.identity();return this}this.multiplyScalar(1/a);return this},transpose:function(){var a=this.elements;var b=a[1];a[1]=a[3];a[3]=b;b=a[2];a[2]=a[6];a[6]=b;b=a[5];a[5]=a[7];a[7]=b;return this},flattenToArrayOffset:function(a,b){var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];return a},getNormalMatrix:function(a){this.getInverse(a).transpose();return this},transposeIntoArray:function(a){var b=this.elements;a[0]=b[0];a[1]=
b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=b[2];a[7]=b[5];a[8]=b[8];return this},fromArray:function(a){this.elements.set(a);return this},toArray:function(){var a=this.elements;return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8]]},clone:function(){return(new G.Matrix3).fromArray(this.elements)}};G.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);0<arguments.length&&G.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")};
G.Matrix4.prototype={constructor:G.Matrix4,set:function(a,b,c,d,e,f,g,k,h,l,n,r,v,p,w,u){var y=this.elements;y[0]=a;y[4]=b;y[8]=c;y[12]=d;y[1]=e;y[5]=f;y[9]=g;y[13]=k;y[2]=h;y[6]=l;y[10]=n;y[14]=r;y[3]=v;y[7]=p;y[11]=w;y[15]=u;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(a){this.elements.set(a.elements);return this},extractPosition:function(a){G.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(a)},
copyPosition:function(a){var b=this.elements;a=a.elements;b[12]=a[12];b[13]=a[13];b[14]=a[14];return this},extractBasis:function(a,b,c){var d=this.elements;a.set(d[0],d[1],d[2]);b.set(d[4],d[5],d[6]);c.set(d[8],d[9],d[10]);return this},makeBasis:function(a,b,c){this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1);return this},extractRotation:function(){var a=new G.Vector3;return function(b){var c=this.elements;b=b.elements;var d=1/a.set(b[0],b[1],b[2]).length(),e=1/a.set(b[4],b[5],b[6]).length(),
f=1/a.set(b[8],b[9],b[10]).length();c[0]=b[0]*d;c[1]=b[1]*d;c[2]=b[2]*d;c[4]=b[4]*e;c[5]=b[5]*e;c[6]=b[6]*e;c[8]=b[8]*f;c[9]=b[9]*f;c[10]=b[10]*f;return this}}(),makeRotationFromEuler:function(a){!1===a instanceof G.Euler&&G.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var b=this.elements,c=a.x,d=a.y,e=a.z,f=Math.cos(c);c=Math.sin(c);var g=Math.cos(d);d=Math.sin(d);var k=Math.cos(e);e=Math.sin(e);if("XYZ"===a.order){a=f*k;var h=f*e,
l=c*k,n=c*e;b[0]=g*k;b[4]=-g*e;b[8]=d;b[1]=h+l*d;b[5]=a-n*d;b[9]=-c*g;b[2]=n-a*d;b[6]=l+h*d;b[10]=f*g}else"YXZ"===a.order?(a=g*k,h=g*e,l=d*k,n=d*e,b[0]=a+n*c,b[4]=l*c-h,b[8]=f*d,b[1]=f*e,b[5]=f*k,b[9]=-c,b[2]=h*c-l,b[6]=n+a*c,b[10]=f*g):"ZXY"===a.order?(a=g*k,h=g*e,l=d*k,n=d*e,b[0]=a-n*c,b[4]=-f*e,b[8]=l+h*c,b[1]=h+l*c,b[5]=f*k,b[9]=n-a*c,b[2]=-f*d,b[6]=c,b[10]=f*g):"ZYX"===a.order?(a=f*k,h=f*e,l=c*k,n=c*e,b[0]=g*k,b[4]=l*d-h,b[8]=a*d+n,b[1]=g*e,b[5]=n*d+a,b[9]=h*d-l,b[2]=-d,b[6]=c*g,b[10]=f*g):"YZX"===
a.order?(a=f*g,h=f*d,l=c*g,n=c*d,b[0]=g*k,b[4]=n-a*e,b[8]=l*e+h,b[1]=e,b[5]=f*k,b[9]=-c*k,b[2]=-d*k,b[6]=h*e+l,b[10]=a-n*e):"XZY"===a.order&&(a=f*g,h=f*d,l=c*g,n=c*d,b[0]=g*k,b[4]=-e,b[8]=d*k,b[1]=a*e+n,b[5]=f*k,b[9]=h*e-l,b[2]=l*e-h,b[6]=c*k,b[10]=n*e+a);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},setRotationFromQuaternion:function(a){G.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(a)},
makeRotationFromQuaternion:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,k=d+d,h=e+e;a=c*g;var l=c*k;c*=h;var n=d*k;d*=h;e*=h;g*=f;k*=f;f*=h;b[0]=1-(n+e);b[4]=l-f;b[8]=c+k;b[1]=l+f;b[5]=1-(a+e);b[9]=d-g;b[2]=c-k;b[6]=d+g;b[10]=1-(a+n);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},lookAt:function(){var a=new G.Vector3,b=new G.Vector3,c=new G.Vector3;return function(d,e,f){var g=this.elements;c.subVectors(d,e).normalize();0===c.length()&&(c.z=1);a.crossVectors(f,
c).normalize();0===a.length()&&(c.x+=1E-4,a.crossVectors(f,c).normalize());b.crossVectors(c,a);g[0]=a.x;g[4]=b.x;g[8]=c.x;g[1]=a.y;g[5]=b.y;g[9]=c.y;g[2]=a.z;g[6]=b.z;g[10]=c.z;return this}}(),multiply:function(a,b){return void 0!==b?(G.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements;b=this.elements;a=c[0];var e=c[4],f=c[8],
g=c[12],k=c[1],h=c[5],l=c[9],n=c[13],r=c[2],v=c[6],p=c[10],w=c[14],u=c[3],y=c[7],B=c[11];c=c[15];var D=d[0],H=d[4],K=d[8],J=d[12],W=d[1],M=d[5],ba=d[9],ha=d[13],ta=d[2],I=d[6],U=d[10],ia=d[14],R=d[3],E=d[7],Y=d[11];d=d[15];b[0]=a*D+e*W+f*ta+g*R;b[4]=a*H+e*M+f*I+g*E;b[8]=a*K+e*ba+f*U+g*Y;b[12]=a*J+e*ha+f*ia+g*d;b[1]=k*D+h*W+l*ta+n*R;b[5]=k*H+h*M+l*I+n*E;b[9]=k*K+h*ba+l*U+n*Y;b[13]=k*J+h*ha+l*ia+n*d;b[2]=r*D+v*W+p*ta+w*R;b[6]=r*H+v*M+p*I+w*E;b[10]=r*K+v*ba+p*U+w*Y;b[14]=r*J+v*ha+p*ia+w*d;b[3]=u*D+y*
W+B*ta+c*R;b[7]=u*H+y*M+B*I+c*E;b[11]=u*K+y*ba+B*U+c*Y;b[15]=u*J+y*ha+B*ia+c*d;return this},multiplyToArray:function(a,b,c){var d=this.elements;this.multiplyMatrices(a,b);c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];c[4]=d[4];c[5]=d[5];c[6]=d[6];c[7]=d[7];c[8]=d[8];c[9]=d[9];c[10]=d[10];c[11]=d[11];c[12]=d[12];c[13]=d[13];c[14]=d[14];c[15]=d[15];return this},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=
a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this},multiplyVector3:function(a){G.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");return a.applyProjection(this)},multiplyVector4:function(a){G.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},multiplyVector3Array:function(a){G.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");
return this.applyToVector3Array(a)},applyToVector3Array:function(){var a=new G.Vector3;return function(b,c,d){void 0===c&&(c=0);void 0===d&&(d=b.length);for(var e=0;e<d;e+=3,c+=3)a.x=b[c],a.y=b[c+1],a.z=b[c+2],a.applyMatrix4(this),b[c]=a.x,b[c+1]=a.y,b[c+2]=a.z;return b}}(),rotateAxis:function(a){G.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");a.transformDirection(this)},crossVector:function(a){G.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");
return a.applyMatrix4(this)},determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],k=a[9],h=a[13],l=a[2],n=a[6],r=a[10],v=a[14];return a[3]*(+e*k*n-d*h*n-e*g*r+c*h*r+d*g*v-c*k*v)+a[7]*(+b*k*v-b*h*r+e*f*r-d*f*v+d*h*l-e*k*l)+a[11]*(+b*h*n-b*g*v-e*f*n+c*f*v+e*g*l-c*h*l)+a[15]*(-d*g*l-b*k*n+b*g*r+d*f*n-c*f*r+c*k*l)},transpose:function(){var a=this.elements;var b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=
a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this},flattenToArrayOffset:function(a,b){var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a},getPosition:function(){var a=new G.Vector3;return function(){G.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var b=this.elements;
return a.set(b[12],b[13],b[14])}}(),setPosition:function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this},getInverse:function(a,b){var c=this.elements,d=a.elements;a=d[0];var e=d[4],f=d[8],g=d[12],k=d[1],h=d[5],l=d[9],n=d[13],r=d[2],v=d[6],p=d[10],w=d[14],u=d[3],y=d[7],B=d[11];d=d[15];c[0]=l*w*y-n*p*y+n*v*B-h*w*B-l*v*d+h*p*d;c[4]=g*p*y-f*w*y-g*v*B+e*w*B+f*v*d-e*p*d;c[8]=f*n*y-g*l*y+g*h*B-e*n*B-f*h*d+e*l*d;c[12]=g*l*v-f*n*v-g*h*p+e*n*p+f*h*w-e*l*w;c[1]=n*p*u-l*w*u-n*r*B+k*w*B+l*r*
d-k*p*d;c[5]=f*w*u-g*p*u+g*r*B-a*w*B-f*r*d+a*p*d;c[9]=g*l*u-f*n*u-g*k*B+a*n*B+f*k*d-a*l*d;c[13]=f*n*r-g*l*r+g*k*p-a*n*p-f*k*w+a*l*w;c[2]=h*w*u-n*v*u+n*r*y-k*w*y-h*r*d+k*v*d;c[6]=g*v*u-e*w*u-g*r*y+a*w*y+e*r*d-a*v*d;c[10]=e*n*u-g*h*u+g*k*y-a*n*y-e*k*d+a*h*d;c[14]=g*h*r-e*n*r-g*k*v+a*n*v+e*k*w-a*h*w;c[3]=l*v*u-h*p*u-l*r*y+k*p*y+h*r*B-k*v*B;c[7]=e*p*u-f*v*u+f*r*y-a*p*y-e*r*B+a*v*B;c[11]=f*h*u-e*l*u-f*k*y+a*l*y+e*k*B-a*h*B;c[15]=e*l*r-f*h*r+f*k*v-a*l*v-e*k*p+a*h*p;c=a*c[0]+k*c[4]+r*c[8]+u*c[12];if(0==
c){if(b)throw Error("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");G.warn("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");this.identity();return this}this.multiplyScalar(1/c);return this},translate:function(){G.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){G.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){G.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){G.error("THREE.Matrix4: .rotateZ() has been removed.")},
rotateByAxis:function(){G.error("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(a){var b=this.elements,c=a.x,d=a.y;a=a.z;b[0]*=c;b[4]*=d;b[8]*=a;b[1]*=c;b[5]*=d;b[9]*=a;b[2]*=c;b[6]*=d;b[10]*=a;b[3]*=c;b[7]*=d;b[11]*=a;return this},getMaxScaleOnAxis:function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],Math.max(a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10])))},makeTranslation:function(a,b,c){this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,
0,1);return this},makeRotationX:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(1,0,0,0,0,b,-a,0,0,a,b,0,0,0,0,1);return this},makeRotationY:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1);return this},makeRotationZ:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,-a,0,0,a,b,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(a,b){var c=Math.cos(b);b=Math.sin(b);var d=1-c,e=a.x,f=a.y;a=a.z;var g=d*e,k=d*f;this.set(g*e+c,g*f-b*a,g*a+b*f,0,g*
f+b*a,k*f+c,k*a-b*e,0,g*a-b*f,k*a+b*e,d*a*a+c,0,0,0,0,1);return this},makeScale:function(a,b,c){this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1);return this},compose:function(a,b,c){this.makeRotationFromQuaternion(b);this.scale(c);this.setPosition(a);return this},decompose:function(){var a=new G.Vector3,b=new G.Matrix4;return function(c,d,e){var f=this.elements,g=a.set(f[0],f[1],f[2]).length(),k=a.set(f[4],f[5],f[6]).length(),h=a.set(f[8],f[9],f[10]).length();0>this.determinant()&&(g=-g);c.x=f[12];c.y=f[13];
c.z=f[14];b.elements.set(this.elements);c=1/g;f=1/k;var l=1/h;b.elements[0]*=c;b.elements[1]*=c;b.elements[2]*=c;b.elements[4]*=f;b.elements[5]*=f;b.elements[6]*=f;b.elements[8]*=l;b.elements[9]*=l;b.elements[10]*=l;d.setFromRotationMatrix(b);e.x=g;e.y=k;e.z=h;return this}}(),makeFrustum:function(a,b,c,d,e,f){var g=this.elements;g[0]=2*e/(b-a);g[4]=0;g[8]=(b+a)/(b-a);g[12]=0;g[1]=0;g[5]=2*e/(d-c);g[9]=(d+c)/(d-c);g[13]=0;g[2]=0;g[6]=0;g[10]=-(f+e)/(f-e);g[14]=-2*f*e/(f-e);g[3]=0;g[7]=0;g[11]=-1;g[15]=
0;return this},makePerspective:function(a,b,c,d){a=c*Math.tan(G.Math.degToRad(.5*a));var e=-a;return this.makeFrustum(e*b,a*b,e,a,c,d)},makeOrthographic:function(a,b,c,d,e,f){var g=this.elements,k=b-a,h=c-d,l=f-e;g[0]=2/k;g[4]=0;g[8]=0;g[12]=-((b+a)/k);g[1]=0;g[5]=2/h;g[9]=0;g[13]=-((c+d)/h);g[2]=0;g[6]=0;g[10]=-2/l;g[14]=-((f+e)/l);g[3]=0;g[7]=0;g[11]=0;g[15]=1;return this},fromArray:function(a){this.elements.set(a);return this},toArray:function(){var a=this.elements;return[a[0],a[1],a[2],a[3],a[4],
a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]},clone:function(){return(new G.Matrix4).fromArray(this.elements)}};G.Triangle=function(a,b,c){this.a=void 0!==a?a:new G.Vector3;this.b=void 0!==b?b:new G.Vector3;this.c=void 0!==c?c:new G.Vector3};G.Triangle.normal=function(){var a=new G.Vector3;return function(b,c,d,e){e=e||new G.Vector3;e.subVectors(d,c);a.subVectors(b,c);e.cross(a);b=e.lengthSq();return 0<b?e.multiplyScalar(1/Math.sqrt(b)):e.set(0,0,0)}}();
G.Triangle.barycoordFromPoint=function(){var a=new G.Vector3,b=new G.Vector3,c=new G.Vector3;return function(d,e,f,g,k){a.subVectors(g,e);b.subVectors(f,e);c.subVectors(d,e);d=a.dot(a);e=a.dot(b);f=a.dot(c);var h=b.dot(b);g=b.dot(c);var l=d*h-e*e;k=k||new G.Vector3;if(0==l)return k.set(-2,-1,-1);l=1/l;h=(h*f-e*g)*l;d=(d*g-e*f)*l;return k.set(1-h-d,d,h)}}();
G.Triangle.containsPoint=function(){var a=new G.Vector3;return function(b,c,d,e){b=G.Triangle.barycoordFromPoint(b,c,d,e,a);return 0<=b.x&&0<=b.y&&1>=b.x+b.y}}();
G.Triangle.prototype={constructor:G.Triangle,set:function(a,b,c){this.a.copy(a);this.b.copy(b);this.c.copy(c);return this},setFromPointsAndIndices:function(a,b,c,d){this.a.copy(a[b]);this.b.copy(a[c]);this.c.copy(a[d]);return this},copy:function(a){this.a.copy(a.a);this.b.copy(a.b);this.c.copy(a.c);return this},area:function(){var a=new G.Vector3,b=new G.Vector3;return function(){a.subVectors(this.c,this.b);b.subVectors(this.a,this.b);return.5*a.cross(b).length()}}(),midpoint:function(a){return(a||
new G.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(a){return G.Triangle.normal(this.a,this.b,this.c,a)},plane:function(a){return(a||new G.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(a,b){return G.Triangle.barycoordFromPoint(a,this.a,this.b,this.c,b)},containsPoint:function(a){return G.Triangle.containsPoint(a,this.a,this.b,this.c)},equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)},clone:function(){return(new G.Triangle).copy(this)}};
G.Ray=function(a,b){this.origin=void 0!==a?a:new G.Vector3;this.direction=void 0!==b?b:new G.Vector3};
G.Ray.prototype={constructor:G.Ray,set:function(a,b){this.origin.copy(a);this.direction.copy(b);return this},copy:function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this},at:function(a,b){return(b||new G.Vector3).copy(this.direction).multiplyScalar(a).add(this.origin)},recast:function(){var a=new G.Vector3;return function(b){this.origin.copy(this.at(b,a));return this}}(),closestPointToPoint:function(a,b){b=b||new G.Vector3;b.subVectors(a,this.origin);a=b.dot(this.direction);
return 0>a?b.copy(this.origin):b.copy(this.direction).multiplyScalar(a).add(this.origin)},distanceToPoint:function(){var a=new G.Vector3;return function(b){var c=a.subVectors(b,this.origin).dot(this.direction);if(0>c)return this.origin.distanceTo(b);a.copy(this.direction).multiplyScalar(c).add(this.origin);return a.distanceTo(b)}}(),distanceSqToSegment:function(){var a=new G.Vector3,b=new G.Vector3,c=new G.Vector3;return function(d,e,f,g){a.copy(d).add(e).multiplyScalar(.5);b.copy(e).sub(d).normalize();
c.copy(this.origin).sub(a);var k=.5*d.distanceTo(e),h=-this.direction.dot(b),l=c.dot(this.direction),n=-c.dot(b),r=c.lengthSq(),v=Math.abs(1-h*h);if(0<v){d=h*n-l;e=h*l-n;var p=k*v;0<=d?e>=-p?e<=p?(k=1/v,d*=k,e*=k,h=d*(d+h*e+2*l)+e*(h*d+e+2*n)+r):(e=k,d=Math.max(0,-(h*e+l)),h=-d*d+e*(e+2*n)+r):(e=-k,d=Math.max(0,-(h*e+l)),h=-d*d+e*(e+2*n)+r):e<=-p?(d=Math.max(0,-(-h*k+l)),e=0<d?-k:Math.min(Math.max(-k,-n),k),h=-d*d+e*(e+2*n)+r):e<=p?(d=0,e=Math.min(Math.max(-k,-n),k),h=e*(e+2*n)+r):(d=Math.max(0,-(h*
k+l)),e=0<d?k:Math.min(Math.max(-k,-n),k),h=-d*d+e*(e+2*n)+r)}else e=0<h?-k:k,d=Math.max(0,-(h*e+l)),h=-d*d+e*(e+2*n)+r;f&&f.copy(this.direction).multiplyScalar(d).add(this.origin);g&&g.copy(b).multiplyScalar(e).add(a);return h}}(),isIntersectionSphere:function(a){return this.distanceToPoint(a.center)<=a.radius},intersectSphere:function(){var a=new G.Vector3;return function(b,c){a.subVectors(b.center,this.origin);var d=a.dot(this.direction),e=a.dot(a)-d*d;b=b.radius*b.radius;if(e>b)return null;b=
Math.sqrt(b-e);e=d-b;d+=b;return 0>e&&0>d?null:0>e?this.at(d,c):this.at(e,c)}}(),isIntersectionPlane:function(a){var b=a.distanceToPoint(this.origin);return 0===b||0>a.normal.dot(this.direction)*b?!0:!1},distanceToPlane:function(a){var b=a.normal.dot(this.direction);if(0==b)return 0==a.distanceToPoint(this.origin)?0:null;a=-(this.origin.dot(a.normal)+a.constant)/b;return 0<=a?a:null},intersectPlane:function(a,b){a=this.distanceToPlane(a);return null===a?null:this.at(a,b)},isIntersectionBox:function(){var a=
new G.Vector3;return function(b){return null!==this.intersectBox(b,a)}}(),intersectBox:function(a,b){var c=1/this.direction.x;var d=1/this.direction.y;var e=1/this.direction.z,f=this.origin;if(0<=c){var g=(a.min.x-f.x)*c;c*=a.max.x-f.x}else g=(a.max.x-f.x)*c,c*=a.min.x-f.x;if(0<=d){var k=(a.min.y-f.y)*d;d*=a.max.y-f.y}else k=(a.max.y-f.y)*d,d*=a.min.y-f.y;if(g>d||k>c)return null;if(k>g||g!==g)g=k;if(d<c||c!==c)c=d;0<=e?(k=(a.min.z-f.z)*e,a=(a.max.z-f.z)*e):(k=(a.max.z-f.z)*e,a=(a.min.z-f.z)*e);if(g>
a||k>c)return null;if(k>g||g!==g)g=k;if(a<c||c!==c)c=a;return 0>c?null:this.at(0<=g?g:c,b)},intersectTriangle:function(){var a=new G.Vector3,b=new G.Vector3,c=new G.Vector3,d=new G.Vector3;return function(e,f,g,k,h){b.subVectors(f,e);c.subVectors(g,e);d.crossVectors(b,c);f=this.direction.dot(d);if(0<f){if(k)return null;k=1}else if(0>f)k=-1,f=-f;else return null;a.subVectors(this.origin,e);e=k*this.direction.dot(c.crossVectors(a,c));if(0>e)return null;g=k*this.direction.dot(b.cross(a));if(0>g||e+g>
f)return null;e=-k*a.dot(d);return 0>e?null:this.at(e/f,h)}}(),applyMatrix4:function(a){this.direction.add(this.origin).applyMatrix4(a);this.origin.applyMatrix4(a);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)},clone:function(){return(new G.Ray).copy(this)}};G.Sphere=function(a,b){this.center=void 0!==a?a:new G.Vector3;this.radius=void 0!==b?b:0};
G.Sphere.prototype={constructor:G.Sphere,set:function(a,b){this.center.copy(a);this.radius=b;return this},setFromPoints:function(){var a=new G.Box3;return function(b,c){var d=this.center;void 0!==c?d.copy(c):a.setFromPoints(b).center(d);for(var e=c=0,f=b.length;e<f;e++)c=Math.max(c,d.distanceToSquared(b[e]));this.radius=Math.sqrt(c);return this}}(),copy:function(a){this.center.copy(a.center);this.radius=a.radius;return this},empty:function(){return 0>=this.radius},containsPoint:function(a){return a.distanceToSquared(this.center)<=
this.radius*this.radius},distanceToPoint:function(a){return a.distanceTo(this.center)-this.radius},intersectsSphere:function(a){var b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b},clampPoint:function(a,b){var c=this.center.distanceToSquared(a);b=b||new G.Vector3;b.copy(a);c>this.radius*this.radius&&(b.sub(this.center).normalize(),b.multiplyScalar(this.radius).add(this.center));return b},getBoundingBox:function(a){a=a||new G.Box3;a.set(this.center,this.center);a.expandByScalar(this.radius);
return a},applyMatrix4:function(a){this.center.applyMatrix4(a);this.radius*=a.getMaxScaleOnAxis();return this},translate:function(a){this.center.add(a);return this},equals:function(a){return a.center.equals(this.center)&&a.radius===this.radius},clone:function(){return(new G.Sphere).copy(this)}};G.Plane=function(a,b){this.normal=void 0!==a?a:new G.Vector3(1,0,0);this.constant=void 0!==b?b:0};
G.Plane.prototype={constructor:G.Plane,set:function(a,b){this.normal.copy(a);this.constant=b;return this},setComponents:function(a,b,c,d){this.normal.set(a,b,c);this.constant=d;return this},setFromNormalAndCoplanarPoint:function(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);return this},setFromCoplanarPoints:function(){var a=new G.Vector3,b=new G.Vector3;return function(c,d,e){d=a.subVectors(e,d).cross(b.subVectors(c,d)).normalize();this.setFromNormalAndCoplanarPoint(d,c);return this}}(),
copy:function(a){this.normal.copy(a.normal);this.constant=a.constant;return this},normalize:function(){var a=1/this.normal.length();this.normal.multiplyScalar(a);this.constant*=a;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,b){return this.orthoPoint(a,b).sub(a).negate()},orthoPoint:function(a,
b){a=this.distanceToPoint(a);return(b||new G.Vector3).copy(this.normal).multiplyScalar(a)},isIntersectionLine:function(a){var b=this.distanceToPoint(a.start);a=this.distanceToPoint(a.end);return 0>b&&0<a||0>a&&0<b},intersectLine:function(){var a=new G.Vector3;return function(b,c){c=c||new G.Vector3;var d=b.delta(a),e=this.normal.dot(d);if(0==e){if(0==this.distanceToPoint(b.start))return c.copy(b.start)}else if(e=-(b.start.dot(this.normal)+this.constant)/e,!(0>e||1<e))return c.copy(d).multiplyScalar(e).add(b.start)}}(),
coplanarPoint:function(a){return(a||new G.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var a=new G.Vector3,b=new G.Vector3,c=new G.Matrix3;return function(d,e){e=e||c.getNormalMatrix(d);e=a.copy(this.normal).applyMatrix3(e);var f=this.coplanarPoint(b);f.applyMatrix4(d);this.setFromNormalAndCoplanarPoint(e,f);return this}}(),translate:function(a){this.constant-=a.dot(this.normal);return this},equals:function(a){return a.normal.equals(this.normal)&&a.constant==
this.constant},clone:function(){return(new G.Plane).copy(this)}};
G.Math={generateUUID:function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),b=Array(36),c=0,d;return function(){for(var e=0;36>e;e++)8==e||13==e||18==e||23==e?b[e]="-":14==e?b[e]="4":(2>=c&&(c=33554432+16777216*Math.random()|0),d=c&15,c>>=4,b[e]=a[19==e?d&3|8:d]);return b.join("")}}(),clamp:function(a,b,c){return a<b?b:a>c?c:a},clampBottom:function(a,b){return a<b?b:a},mapLinear:function(a,b,c,d,e){return d+(a-b)*(e-d)/(c-b)},smoothstep:function(a,b,c){if(a<=b)return 0;
if(a>=c)return 1;a=(a-b)/(c-b);return a*a*(3-2*a)},smootherstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*a*(a*(6*a-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(a,b){return Math.floor(this.randFloat(a,b))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(.5-Math.random())},degToRad:function(){var a=Math.PI/180;return function(b){return b*a}}(),radToDeg:function(){var a=
180/Math.PI;return function(b){return b*a}}(),isPowerOfTwo:function(a){return 0===(a&a-1)&&0!==a},nextPowerOfTwo:function(a){a--;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;a++;return a}};G.Clock=function(a){this.autoStart=void 0!==a?a:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1};
G.Clock.prototype={constructor:G.Clock,start:function(){this.oldTime=this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();this.running=!0},stop:function(){this.getElapsedTime();this.running=!1},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var a=0;this.autoStart&&!this.running&&this.start();if(this.running){var b=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();a=
.001*(b-this.oldTime);this.oldTime=b;this.elapsedTime+=a}return a}};G.EventDispatcher=function(){};
G.EventDispatcher.prototype={constructor:G.EventDispatcher,apply:function(a){a.addEventListener=G.EventDispatcher.prototype.addEventListener;a.hasEventListener=G.EventDispatcher.prototype.hasEventListener;a.removeEventListener=G.EventDispatcher.prototype.removeEventListener;a.dispatchEvent=G.EventDispatcher.prototype.dispatchEvent},addEventListener:function(a,b){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[a]&&(c[a]=[]);-1===c[a].indexOf(b)&&c[a].push(b)},hasEventListener:function(a,
b){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)?!0:!1},removeEventListener:function(a,b){void 0!==this._listeners&&(a=this._listeners[a],void 0!==a&&(b=a.indexOf(b),-1!==b&&a.splice(b,1)))},dispatchEvent:function(a){if(void 0!==this._listeners){var b=this._listeners[a.type];if(void 0!==b){a.target=this;for(var c=[],d=b.length,e=0;e<d;e++)c[e]=b[e];for(e=0;e<d;e++)c[e].call(this,a)}}}};
G.Object3D=function(){Object.defineProperty(this,"id",{value:G.Object3DIdCount++});this.name="";this.parent=void 0;this.children=[];this.up=G.Object3D.DefaultUp.clone();var a=new G.Vector3,b=new G.Euler,c=new G.Quaternion,d=new G.Vector3(1,1,1);b.onChange(function(){c.setFromEuler(b,!1)});c.onChange(function(){b.setFromQuaternion(c,void 0,!1)});Object.defineProperties(this,{position:{enumerable:!0,value:a},rotation:{enumerable:!0,value:b},quaternion:{enumerable:!0,value:c},scale:{enumerable:!0,value:d}});
this.rotationAutoUpdate=!0;this.matrix=new G.Matrix4;this.matrixWorld=new G.Matrix4;this.matrixAutoUpdate=!0;this.matrixWorldNeedsUpdate=!1;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.userData={}};G.Object3D.DefaultUp=new G.Vector3(0,1,0);
G.Object3D.prototype={constructor:G.Object3D,applyMatrix:function(a){this.matrix.multiplyMatrices(a,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(a,b){this.quaternion.setFromAxisAngle(a,b)},setRotationFromEuler:function(a){this.quaternion.setFromEuler(a,!0)},setRotationFromMatrix:function(a){this.quaternion.setFromRotationMatrix(a)},setRotationFromQuaternion:function(a){this.quaternion.copy(a)},rotateOnAxis:function(){var a=new G.Quaternion;
return function(b,c){a.setFromAxisAngle(b,c);this.quaternion.multiply(a);return this}}(),rotateX:function(){var a=new G.Vector3(1,0,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateY:function(){var a=new G.Vector3(0,1,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateZ:function(){var a=new G.Vector3(0,0,1);return function(b){return this.rotateOnAxis(a,b)}}(),translateOnAxis:function(){var a=new G.Vector3;return function(b,c){a.copy(b).applyQuaternion(this.quaternion);this.position.add(a.multiplyScalar(c));
return this}}(),translate:function(a,b){G.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(b,a)},translateX:function(){var a=new G.Vector3(1,0,0);return function(b){return this.translateOnAxis(a,b)}}(),translateY:function(){var a=new G.Vector3(0,1,0);return function(b){return this.translateOnAxis(a,b)}}(),translateZ:function(){var a=new G.Vector3(0,0,1);return function(b){return this.translateOnAxis(a,b)}}(),localToWorld:function(a){return a.applyMatrix4(this.matrixWorld)},
worldToLocal:function(){var a=new G.Matrix4;return function(b){return b.applyMatrix4(a.getInverse(this.matrixWorld))}}(),lookAt:function(){var a=new G.Matrix4;return function(b){a.lookAt(b,this.position,this.up);this.quaternion.setFromRotationMatrix(a)}}(),add:function(a){if(1<arguments.length){for(var b=0;b<arguments.length;b++)this.add(arguments[b]);return this}if(a===this)return G.error("THREE.Object3D.add: object can't be added as a child of itself.",a),this;a instanceof G.Object3D?(void 0!==
a.parent&&a.parent.remove(a),a.parent=this,a.dispatchEvent({type:"added"}),this.children.push(a)):G.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",a);return this},remove:function(a){if(1<arguments.length)for(var b=0;b<arguments.length;b++)this.remove(arguments[b]);b=this.children.indexOf(a);-1!==b&&(a.parent=void 0,a.dispatchEvent({type:"removed"}),this.children.splice(b,1))},getChildByName:function(a){G.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");
return this.getObjectByName(a)},getObjectById:function(a){return this.getObjectByProperty("id",a)},getObjectByName:function(a){return this.getObjectByProperty("name",a)},getObjectByProperty:function(a,b){if(this[a]===b)return this;for(var c=0,d=this.children.length;c<d;c++){var e=this.children[c].getObjectByProperty(a,b);if(void 0!==e)return e}},getWorldPosition:function(a){a=a||new G.Vector3;this.updateMatrixWorld(!0);return a.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var a=
new G.Vector3,b=new G.Vector3;return function(c){c=c||new G.Quaternion;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,c,b);return c}}(),getWorldRotation:function(){var a=new G.Quaternion;return function(b){b=b||new G.Euler;this.getWorldQuaternion(a);return b.setFromQuaternion(a,this.rotation.order,!1)}}(),getWorldScale:function(){var a=new G.Vector3,b=new G.Quaternion;return function(c){c=c||new G.Vector3;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,b,c);return c}}(),getWorldDirection:function(){var a=
new G.Quaternion;return function(b){b=b||new G.Vector3;this.getWorldQuaternion(a);return b.set(0,0,1).applyQuaternion(a)}}(),raycast:function(){},traverse:function(a){a(this);for(var b=0,c=this.children.length;b<c;b++)this.children[b].traverse(a)},traverseVisible:function(a){if(!1!==this.visible){a(this);for(var b=0,c=this.children.length;b<c;b++)this.children[b].traverseVisible(a)}},traverseAncestors:function(a){this.parent&&(a(this.parent),this.parent.traverseAncestors(a))},updateMatrix:function(){this.matrix.compose(this.position,
this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===a)void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0;for(var b=0,c=this.children.length;b<c;b++)this.children[b].updateMatrixWorld(a)},clone:function(a,b){void 0===a&&(a=new G.Object3D);void 0===b&&(b=!0);a.name=
this.name;a.up.copy(this.up);a.position.copy(this.position);a.quaternion.copy(this.quaternion);a.scale.copy(this.scale);a.rotationAutoUpdate=this.rotationAutoUpdate;a.matrix.copy(this.matrix);a.matrixWorld.copy(this.matrixWorld);a.matrixAutoUpdate=this.matrixAutoUpdate;a.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate;a.visible=this.visible;a.castShadow=this.castShadow;a.receiveShadow=this.receiveShadow;a.frustumCulled=this.frustumCulled;a.userData=JSON.parse(JSON.stringify(this.userData));if(!0===
b)for(b=0;b<this.children.length;b++)a.add(this.children[b].clone());return a}};G.EventDispatcher.prototype.apply(G.Object3D.prototype);G.Object3DIdCount=0;G.Face3=function(a,b,c,d,e,f){this.a=a;this.b=b;this.c=c;this.normal=d instanceof G.Vector3?d:new G.Vector3;this.vertexNormals=d instanceof Array?d:[];this.color=e instanceof G.Color?e:new G.Color;this.vertexColors=e instanceof Array?e:[];this.vertexTangents=[];this.materialIndex=void 0!==f?f:0};
G.Face3.prototype={constructor:G.Face3,clone:function(){var a=new G.Face3(this.a,this.b,this.c);a.normal.copy(this.normal);a.color.copy(this.color);a.materialIndex=this.materialIndex;for(var b=0,c=this.vertexNormals.length;b<c;b++)a.vertexNormals[b]=this.vertexNormals[b].clone();b=0;for(c=this.vertexColors.length;b<c;b++)a.vertexColors[b]=this.vertexColors[b].clone();b=0;for(c=this.vertexTangents.length;b<c;b++)a.vertexTangents[b]=this.vertexTangents[b].clone();return a}};
G.BufferAttribute=function(a,b){this.array=a;this.itemSize=b;this.needsUpdate=!1};
G.BufferAttribute.prototype={constructor:G.BufferAttribute,get length(){return this.array.length},copyAt:function(a,b,c){a*=this.itemSize;c*=b.itemSize;for(var d=0,e=this.itemSize;d<e;d++)this.array[a+d]=b.array[c+d];return this},set:function(a,b){void 0===b&&(b=0);this.array.set(a,b);return this},setX:function(a,b){this.array[a*this.itemSize]=b;return this},setY:function(a,b){this.array[a*this.itemSize+1]=b;return this},setZ:function(a,b){this.array[a*this.itemSize+2]=b;return this},setXY:function(a,
b,c){a*=this.itemSize;this.array[a]=b;this.array[a+1]=c;return this},setXYZ:function(a,b,c,d){a*=this.itemSize;this.array[a]=b;this.array[a+1]=c;this.array[a+2]=d;return this},setXYZW:function(a,b,c,d,e){a*=this.itemSize;this.array[a]=b;this.array[a+1]=c;this.array[a+2]=d;this.array[a+3]=e;return this},clone:function(){return new G.BufferAttribute(new this.array.constructor(this.array),this.itemSize)}};
G.BufferGeometry=function(){Object.defineProperty(this,"id",{value:G.GeometryIdCount++});this.name="";this.attributes={};this.attributesKeys=[];this.offsets=this.drawcalls=[];this.boundingSphere=this.boundingBox=null};
G.BufferGeometry.prototype={constructor:G.BufferGeometry,addAttribute:function(a,b){this.attributes[a]=b;this.attributesKeys=Object.keys(this.attributes)},getAttribute:function(a){return this.attributes[a]},addDrawCall:function(a,b,c){this.drawcalls.push({start:a,count:b,index:void 0!==c?c:0})},applyMatrix:function(a){var b=this.attributes.position;void 0!==b&&(a.applyToVector3Array(b.array),b.needsUpdate=!0);b=this.attributes.normal;void 0!==b&&((new G.Matrix3).getNormalMatrix(a).applyToVector3Array(b.array),
b.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere()},center:function(){this.computeBoundingBox();var a=this.boundingBox.center().negate();this.applyMatrix((new G.Matrix4).setPosition(a));return a},computeBoundingBox:function(){var a=new G.Vector3;return function(){null===this.boundingBox&&(this.boundingBox=new G.Box3);var b=this.attributes.position.array;if(b){var c=this.boundingBox;c.makeEmpty();for(var d=0,e=b.length;d<e;d+=
3)a.set(b[d],b[d+1],b[d+2]),c.expandByPoint(a)}if(void 0===b||0===b.length)this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0);(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&G.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')}}(),computeBoundingSphere:function(){var a=new G.Box3,b=new G.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=
new G.Sphere);var c=this.attributes.position.array;if(c){a.makeEmpty();for(var d=this.boundingSphere.center,e=0,f=c.length;e<f;e+=3)b.set(c[e],c[e+1],c[e+2]),a.expandByPoint(b);a.center(d);var g=0;e=0;for(f=c.length;e<f;e+=3)b.set(c[e],c[e+1],c[e+2]),g=Math.max(g,d.distanceToSquared(b));this.boundingSphere.radius=Math.sqrt(g);isNaN(this.boundingSphere.radius)&&G.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}(),
computeVertexNormals:function(){var a=this.attributes;if(a.position){var b=a.position.array;if(void 0===a.normal)this.addAttribute("normal",new G.BufferAttribute(new Float32Array(b.length),3));else for(var c=a.normal.array,d=0,e=c.length;d<e;d++)c[d]=0;c=a.normal.array;var f=new G.Vector3,g=new G.Vector3,k=new G.Vector3,h=new G.Vector3,l=new G.Vector3;if(a.index)for(var n=a.index.array,r=0<this.offsets.length?this.offsets:[{start:0,count:n.length,index:0}],v=0,p=r.length;v<p;++v){e=r[v].start;var w=
r[v].count;var u=r[v].index;d=e;for(e+=w;d<e;d+=3){w=3*(u+n[d]);var y=3*(u+n[d+1]);var B=3*(u+n[d+2]);f.fromArray(b,w);g.fromArray(b,y);k.fromArray(b,B);h.subVectors(k,g);l.subVectors(f,g);h.cross(l);c[w]+=h.x;c[w+1]+=h.y;c[w+2]+=h.z;c[y]+=h.x;c[y+1]+=h.y;c[y+2]+=h.z;c[B]+=h.x;c[B+1]+=h.y;c[B+2]+=h.z}}else for(d=0,e=b.length;d<e;d+=9)f.fromArray(b,d),g.fromArray(b,d+3),k.fromArray(b,d+6),h.subVectors(k,g),l.subVectors(f,g),h.cross(l),c[d]=h.x,c[d+1]=h.y,c[d+2]=h.z,c[d+3]=h.x,c[d+4]=h.y,c[d+5]=h.z,
c[d+6]=h.x,c[d+7]=h.y,c[d+8]=h.z;this.normalizeNormals();a.normal.needsUpdate=!0}},computeTangents:function(){function a(da,ua,ja){r.fromArray(d,3*da);v.fromArray(d,3*ua);p.fromArray(d,3*ja);w.fromArray(f,2*da);u.fromArray(f,2*ua);y.fromArray(f,2*ja);B=v.x-r.x;D=p.x-r.x;H=v.y-r.y;K=p.y-r.y;J=v.z-r.z;W=p.z-r.z;M=u.x-w.x;ba=y.x-w.x;ha=u.y-w.y;ta=y.y-w.y;I=1/(M*ta-ba*ha);U.set((ta*B-ha*D)*I,(ta*H-ha*K)*I,(ta*J-ha*W)*I);ia.set((M*D-ba*B)*I,(M*K-ba*H)*I,(M*W-ba*J)*I);h[da].add(U);h[ua].add(U);h[ja].add(U);
l[da].add(ia);l[ua].add(ia);l[ja].add(ia)}function b(da){T.fromArray(e,3*da);V.copy(T);P=h[da];ya.copy(P);ya.sub(T.multiplyScalar(T.dot(P))).normalize();za.crossVectors(V,P);N=za.dot(l[da]);ma=0>N?-1:1;k[4*da]=ya.x;k[4*da+1]=ya.y;k[4*da+2]=ya.z;k[4*da+3]=ma}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)G.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");
else{var c=this.attributes.index.array,d=this.attributes.position.array,e=this.attributes.normal.array,f=this.attributes.uv.array,g=d.length/3;void 0===this.attributes.tangent&&this.addAttribute("tangent",new G.BufferAttribute(new Float32Array(4*g),4));for(var k=this.attributes.tangent.array,h=[],l=[],n=0;n<g;n++)h[n]=new G.Vector3,l[n]=new G.Vector3;var r=new G.Vector3,v=new G.Vector3,p=new G.Vector3,w=new G.Vector2,u=new G.Vector2,y=new G.Vector2,B,D,H,K,J,W,M,ba,ha,ta,I,U=new G.Vector3,ia=new G.Vector3,
R;0===this.drawcalls.length&&this.addDrawCall(0,c.length,0);var E=this.drawcalls;n=0;for(R=E.length;n<R;++n){var Y=E[n].start;var X=E[n].count;var fa=E[n].index;g=Y;for(Y+=X;g<Y;g+=3){X=fa+c[g];var ka=fa+c[g+1];var qa=fa+c[g+2];a(X,ka,qa)}}var ya=new G.Vector3,za=new G.Vector3,T=new G.Vector3,V=new G.Vector3,ma,P,N;n=0;for(R=E.length;n<R;++n)for(Y=E[n].start,X=E[n].count,fa=E[n].index,g=Y,Y+=X;g<Y;g+=3)X=fa+c[g],ka=fa+c[g+1],qa=fa+c[g+2],b(X),b(ka),b(qa)}},normalizeNormals:function(){for(var a=this.attributes.normal.array,
b,c,d,e=0,f=a.length;e<f;e+=3)b=a[e],c=a[e+1],d=a[e+2],b=1/Math.sqrt(b*b+c*c+d*d),a[e]*=b,a[e+1]*=b,a[e+2]*=b},clone:function(){var a=new G.BufferGeometry;for(b in this.attributes)a.addAttribute(b,this.attributes[b].clone());var b=0;for(var c=this.offsets.length;b<c;b++){var d=this.offsets[b];a.offsets.push({start:d.start,index:d.index,count:d.count})}return a},dispose:function(){this.dispatchEvent({type:"dispose"})}};G.EventDispatcher.prototype.apply(G.BufferGeometry.prototype);
G.Camera=function(){G.Object3D.call(this);this.matrixWorldInverse=new G.Matrix4;this.projectionMatrix=new G.Matrix4};G.Camera.prototype=Object.create(G.Object3D.prototype);G.Camera.prototype.constructor=G.Camera;G.Camera.prototype.getWorldDirection=function(){var a=new G.Quaternion;return function(b){b=b||new G.Vector3;this.getWorldQuaternion(a);return b.set(0,0,-1).applyQuaternion(a)}}();
G.Camera.prototype.lookAt=function(){var a=new G.Matrix4;return function(b){a.lookAt(this.position,b,this.up);this.quaternion.setFromRotationMatrix(a)}}();G.Camera.prototype.clone=function(a){void 0===a&&(a=new G.Camera);G.Object3D.prototype.clone.call(this,a);a.matrixWorldInverse.copy(this.matrixWorldInverse);a.projectionMatrix.copy(this.projectionMatrix);return a};
G.PerspectiveCamera=function(a,b,c,d){G.Camera.call(this);this.zoom=1;this.fov=void 0!==a?a:50;this.aspect=void 0!==b?b:1;this.near=void 0!==c?c:.1;this.far=void 0!==d?d:2E3;this.updateProjectionMatrix()};G.PerspectiveCamera.prototype=Object.create(G.Camera.prototype);G.PerspectiveCamera.prototype.constructor=G.PerspectiveCamera;G.PerspectiveCamera.prototype.setLens=function(a,b){void 0===b&&(b=24);this.fov=2*G.Math.radToDeg(Math.atan(b/(2*a)));this.updateProjectionMatrix()};
G.PerspectiveCamera.prototype.setViewOffset=function(a,b,c,d,e,f){this.fullWidth=a;this.fullHeight=b;this.x=c;this.y=d;this.width=e;this.height=f;this.updateProjectionMatrix()};
G.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var a=G.Math.radToDeg(2*Math.atan(Math.tan(.5*G.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var b=this.fullWidth/this.fullHeight;a=Math.tan(G.Math.degToRad(.5*a))*this.near;var c=-a,d=b*c;b=Math.abs(b*a-d);c=Math.abs(a-c);this.projectionMatrix.makeFrustum(d+this.x*b/this.fullWidth,d+(this.x+this.width)*b/this.fullWidth,a-(this.y+this.height)*c/this.fullHeight,a-this.y*c/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(a,
this.aspect,this.near,this.far)};G.PerspectiveCamera.prototype.clone=function(){var a=new G.PerspectiveCamera;G.Camera.prototype.clone.call(this,a);a.zoom=this.zoom;a.fov=this.fov;a.aspect=this.aspect;a.near=this.near;a.far=this.far;a.projectionMatrix.copy(this.projectionMatrix);return a};G.OrthographicCamera=function(a,b,c,d,e,f){G.Camera.call(this);this.zoom=1;this.left=a;this.right=b;this.top=c;this.bottom=d;this.near=void 0!==e?e:.1;this.far=void 0!==f?f:2E3;this.updateProjectionMatrix()};
G.OrthographicCamera.prototype=Object.create(G.Camera.prototype);G.OrthographicCamera.prototype.constructor=G.OrthographicCamera;G.OrthographicCamera.prototype.updateProjectionMatrix=function(){var a=(this.right-this.left)/(2*this.zoom),b=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/2,d=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(c-a,c+a,d+b,d-b,this.near,this.far)};
G.OrthographicCamera.prototype.clone=function(){var a=new G.OrthographicCamera;G.Camera.prototype.clone.call(this,a);a.zoom=this.zoom;a.left=this.left;a.right=this.right;a.top=this.top;a.bottom=this.bottom;a.near=this.near;a.far=this.far;a.projectionMatrix.copy(this.projectionMatrix);return a};G.Mesh=function(a,b){G.Object3D.call(this);this.geometry=void 0!==a?a:new G.Geometry;this.material=void 0!==b?b:new G.MeshBasicMaterial({color:16777215*Math.random()});this.updateMorphTargets()};
G.Mesh.prototype=Object.create(G.Object3D.prototype);G.Mesh.prototype.constructor=G.Mesh;G.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&0<this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var a=0,b=this.geometry.morphTargets.length;a<b;a++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[a].name]=a}};
G.Mesh.prototype.getMorphTargetIndexByName=function(a){if(void 0!==this.morphTargetDictionary[a])return this.morphTargetDictionary[a];G.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+a+" does not exist. Returning 0.");return 0};G.Mesh.prototype.clone=function(a,b){void 0===a&&(a=new G.Mesh(this.geometry,this.material));G.Object3D.prototype.clone.call(this,a,b);return a};G.Scene=function(){G.Object3D.call(this);this.overrideMaterial=null;this.autoUpdate=!0};G.Scene.prototype=Object.create(G.Object3D.prototype);
G.Scene.prototype.constructor=G.Scene;G.Scene.prototype.clone=function(a){void 0===a&&(a=new G.Scene);G.Object3D.prototype.clone.call(this,a);null!==this.overrideMaterial&&(a.overrideMaterial=this.overrideMaterial.clone());a.autoUpdate=this.autoUpdate;a.matrixAutoUpdate=this.matrixAutoUpdate;return a};
G.UniformsUtils={merge:function(a){for(var b={},c=0;c<a.length;c++){var d=this.clone(a[c]),e;for(e in d)b[e]=d[e]}return b},clone:function(a){var b={},c;for(c in a){b[c]={};for(var d in a[c]){var e=a[c][d];b[c][d]=e&&void 0!==e.clone?e.clone():e instanceof Array?e.slice():e}}return b}};
G.BoxBufferGeometry=function(a,b,c,d,e,f){function g(v,p,w,u,y,B,D,H,K,J){var W=B/K,M=D/J,ba=B/2,ha=D/2,ta=H/2;D=K+1;var I=J+1;B=0;var U,ia,R=new G.Vector3;for(ia=0;ia<I;ia++){var E=ia*M-ha;for(U=0;U<D;U++)R[v]=(U*W-ba)*u,R[p]=E*y,R[w]=ta,h.push(R.x,R.y,R.z),R[v]=0,R[p]=0,R[w]=0<H?1:-1,l.push(R.x,R.y,R.z),n.push(U/K),n.push(1-ia/J),B+=1}for(ia=0;ia<J;ia++)for(U=0;U<K;U++)v=r+U+D*(ia+1),p=r+(U+1)+D*(ia+1),w=r+(U+1)+D*ia,k.push(r+U+D*ia,v,w),k.push(v,p,w);r+=B}G.BufferGeometry.call(this);this.parameters=
{width:a,height:b,depth:c,widthSegments:d,heightSegments:e,depthSegments:f};d=Math.floor(d)||1;e=Math.floor(e)||1;f=Math.floor(f)||1;var k=[],h=[],l=[],n=[],r=0;g("z","y","x",-1,-1,c,b,a,f,e);g("z","y","x",1,-1,c,b,-a,f,e);g("x","z","y",1,1,a,c,b,d,f);g("x","z","y",1,-1,a,c,-b,d,f);g("x","y","z",1,-1,a,b,c,d,e);g("x","y","z",-1,-1,a,b,-c,d,e);console.assert(65536>=h.length);this.addAttribute("index",new G.BufferAttribute(new Uint16Array(k),1));this.addAttribute("position",new G.BufferAttribute(new Float32Array(h),
3));this.addAttribute("normal",new G.BufferAttribute(new Float32Array(l),3));this.addAttribute("uv",new G.BufferAttribute(new Float32Array(n),2))};G.BoxBufferGeometry.prototype=Object.create(G.BufferGeometry.prototype);G.BoxBufferGeometry.prototype.constructor=G.BoxBufferGeometry;
G.SphereBufferGeometry=function(a,b,c,d,e,f,g){G.BufferGeometry.call(this);this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g};a=a||50;b=Math.max(3,Math.floor(b)||8);c=Math.max(2,Math.floor(c)||6);d=void 0!==d?d:0;e=void 0!==e?e:2*Math.PI;f=void 0!==f?f:0;g=void 0!==g?g:Math.PI;var k=f+g,h,l,n=0,r=[],v=new G.Vector3,p=new G.Vector3,w=[],u=[],y=[],B=[];for(l=0;l<=c;l++){var D=[],H=l/c;for(h=0;h<=b;h++){var K=h/b;v.x=-a*Math.cos(d+K*e)*Math.sin(f+
H*g);v.y=a*Math.cos(f+H*g);v.z=a*Math.sin(d+K*e)*Math.sin(f+H*g);u.push(v.x,v.y,v.z);p.set(v.x,v.y,v.z).normalize();y.push(p.x,p.y,p.z);B.push(K,1-H);D.push(n++)}r.push(D)}for(l=0;l<c;l++)for(h=0;h<b;h++)a=r[l][h+1],d=r[l][h],e=r[l+1][h],g=r[l+1][h+1],(0!==l||0<f)&&w.push(a,d,g),(l!==c-1||k<Math.PI)&&w.push(d,e,g);console.assert(65536>=u.length);this.addAttribute("index",new G.BufferAttribute(new Uint16Array(w),1));this.addAttribute("position",new G.BufferAttribute(new Float32Array(u),3));this.addAttribute("normal",
new G.BufferAttribute(new Float32Array(y),3));this.addAttribute("uv",new G.BufferAttribute(new Float32Array(B),2))};G.SphereBufferGeometry.prototype=Object.create(G.BufferGeometry.prototype);G.SphereBufferGeometry.prototype.constructor=G.SphereBufferGeometry;
G.PlaneBufferGeometry=function(a,b,c,d){G.BufferGeometry.call(this);this.type="PlaneBufferGeometry";this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};var e=a/2,f=b/2;c=c||1;d=d||1;var g=c+1,k=d+1,h=a/c,l=b/d;b=new Float32Array(g*k*3);a=new Float32Array(g*k*3);for(var n=new Float32Array(g*k*2),r=0,v=0,p=0;p<k;p++)for(var w=p*l-f,u=0;u<g;u++)b[r]=u*h-e,b[r+1]=-w,a[r+2]=1,n[v]=u/c,n[v+1]=1-p/d,r+=3,v+=2;r=0;e=new (65535<b.length/3?Uint32Array:Uint16Array)(c*d*6);for(p=0;p<d;p++)for(u=
0;u<c;u++)f=u+g*(p+1),k=u+1+g*(p+1),h=u+1+g*p,e[r]=u+g*p,e[r+1]=f,e[r+2]=h,e[r+3]=f,e[r+4]=k,e[r+5]=h,r+=6;this.addAttribute("index",new G.BufferAttribute(e,1));this.addAttribute("position",new G.BufferAttribute(b,3));this.addAttribute("normal",new G.BufferAttribute(a,3));this.addAttribute("uv",new G.BufferAttribute(n,2))};G.PlaneBufferGeometry.prototype=Object.create(G.BufferGeometry.prototype);G.PlaneBufferGeometry.prototype.constructor=G.PlaneBufferGeometry;
G.CylinderBufferGeometry=function(a,b,c,d,e,f,g,k){function h(y){var B,D=new G.Vector2,H=new G.Vector3,K=!0===y?a:b,J=!0===y?1:-1;var W=p;for(B=1;B<=d;B++)n.push(0,u*J,0),r.push(0,J,0),v.push(.5,.5),p++;var M=p;for(B=0;B<=d;B++){var ba=B/d*k+g,ha=Math.cos(ba);ba=Math.sin(ba);H.x=K*ba;H.y=u*J;H.z=K*ha;n.push(H.x,H.y,H.z);r.push(0,J,0);D.x=.5*ha+.5;D.y=.5*ba*J+.5;v.push(D.x,D.y);p++}for(B=0;B<d;B++)D=W+B,H=M+B,!0===y?l.push(H,H+1,D):l.push(H+1,H,D)}G.BufferGeometry.call(this);this.parameters={radiusTop:a,
radiusBottom:b,height:c,radialSegments:d,heightSegments:e,openEnded:f,thetaStart:g,thetaLength:k};a=void 0!==a?a:20;b=void 0!==b?b:20;c=void 0!==c?c:100;d=Math.floor(d)||8;e=Math.floor(e)||1;f=void 0!==f?f:!1;g=void 0!==g?g:0;k=void 0!==k?k:2*Math.PI;var l=[],n=[],r=[],v=[],p=0,w=[],u=c/2;(function(){var y,B,D=new G.Vector3,H=new G.Vector3,K=(b-a)/c;for(B=0;B<=e;B++){var J=[],W=B/e,M=W*(b-a)+a;for(y=0;y<=d;y++){var ba=y/d,ha=ba*k+g,ta=Math.sin(ha);ha=Math.cos(ha);H.x=M*ta;H.y=-W*c+u;H.z=M*ha;n.push(H.x,
H.y,H.z);D.set(ta,K,ha).normalize();r.push(D.x,D.y,D.z);v.push(ba,1-W);J.push(p++)}w.push(J)}for(y=0;y<d;y++)for(B=0;B<e;B++)D=w[B+1][y],H=w[B+1][y+1],K=w[B][y+1],l.push(w[B][y],D,K),l.push(D,H,K)})();!1===f&&(0<a&&h(!0),0<b&&h(!1));console.assert(65536>=n.length);this.addAttribute("index",new G.BufferAttribute(new Uint16Array(l),1));this.addAttribute("position",new G.BufferAttribute(new Float32Array(n),3));this.addAttribute("normal",new G.BufferAttribute(new Float32Array(r),3));this.addAttribute("uv",
new G.BufferAttribute(new Float32Array(v),2))};G.CylinderBufferGeometry.prototype=Object.create(G.BufferGeometry.prototype);G.CylinderBufferGeometry.prototype.constructor=G.CylinderBufferGeometry;
G.TorusBufferGeometry=function(a,b,c,d,e){G.BufferGeometry.call(this);this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e};a=a||1;b=b||.4;c=Math.floor(c)||8;d=Math.floor(d)||6;e=e||2*Math.PI;var f=[],g=[],k=[],h=[],l=new G.Vector3,n=new G.Vector3,r=new G.Vector3,v,p;for(v=0;v<=c;v++)for(p=0;p<=d;p++){var w=p/d*e,u=v/c*Math.PI*2;n.x=(a+b*Math.cos(u))*Math.cos(w);n.y=(a+b*Math.cos(u))*Math.sin(w);n.z=b*Math.sin(u);g.push(n.x,n.y,n.z);l.x=a*Math.cos(w);l.y=a*Math.sin(w);r.subVectors(n,
l).normalize();k.push(r.x,r.y,r.z);h.push(p/d);h.push(v/c)}for(v=1;v<=c;v++)for(p=1;p<=d;p++)a=(d+1)*(v-1)+p-1,b=(d+1)*(v-1)+p,e=(d+1)*v+p,f.push((d+1)*v+p-1,a,e),f.push(a,b,e);console.assert(65536>=g.length);this.addAttribute("index",new G.BufferAttribute(new Uint16Array(f),1));this.addAttribute("position",new G.BufferAttribute(new Float32Array(g),3));this.addAttribute("normal",new G.BufferAttribute(new Float32Array(k),3));this.addAttribute("uv",new G.BufferAttribute(new Float32Array(h),2))};
G.TorusBufferGeometry.prototype=Object.create(G.BufferGeometry.prototype);G.TorusBufferGeometry.prototype.constructor=G.TorusBufferGeometry;function Fa(a){var b={};a&&a.substring(1).split("&").forEach(function(c){var d=c.indexOf("=");0<=d?b[c.substring(0,d)]=c.substring(d+1):b[c]=void 0});return b}function Ha(a){return a in Fa(window.location.hash)}window.THREE=G;
window.WALK={EDIT_MODE:"editor"in Fa(window.location.search),NO_SCREENSHOTS:Ha("noscreenshots"),DEBUG:Ha("debug"),DEBUG_SHARED_BUFFERS:Ha("debugbuffers"),DEBUG_CAMERA_PATH:Ha("debugcamerapath"),ALWAYS_RENDER:!1,LOG_INFO:Ha("log")||Ha("savelog"),LOG_TO_SERVER:Ha("savelog"),LOG_TIME:!1,PROGRESSIVE_LOADER_AFTER_SEC:25,CONTEXT_LOST_RESTORE_LIMIT:4,HEAD_LIGHT:!1,RETRIES_ON_LOAD_ERROR:3,DEFAULT_ANISOTROPY:4,NO_ANISOTROPY:1,FORCE_FXAA:!1,FORCE_WEBGL1:Ha("webgl1"),FONT_FAMILIES_TO_LOAD:[],MAX_TWO_POINTERS_IN_LINE_DIFF:40,
CAMERA_WALK_NEAR:.01,CAMERA_ORBIT_NEAR_FROM_1M:.01,CAMERA_MIN_FAR:100,SKY_DISTANCE_TO_SCENE:100,CAMERA_DEFAULT_FOV:70,CAMERA_DEFAULT_MOVE_MAX_SPEED:1.11,CAMERA_MOVE_MAX_SPEED_SHIFT_FACTOR:2,CAMERA_LOOK_SPEED:Math.PI/1500,CAMERA_LOOK_SMOOTHING:.1,CAMERA_ARROWS_TURN_SPEED:Math.PI/2,CAMERA_SCROLL_SPEED:.5,CAMERA_FULL_ACCELERATION_TIME:.5,CAMERA_FULL_DECELERATION_TIME:.166,CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE:1,CAMERA_FIXED_HEIGHT:null,MAX_GROUND_SEARCH_DEPTH:5.5,MATERIAL_PICKER_BALL_MAX_SIZE:.1,COVER_JSON_URL:"./cover.json",
AUTO_TOUR_IN_VIEW_STILL_TIME_MS:3E3,CLICK_MOVE_MIN_DISTANCE_TO_OBSTACLE:.7,CLICK_MOVE_SHOW_TARGET_INDICATOR:!Ha("nomovetarget"),KEY_MOVE_MIN_DISTANCE_TO_OBSTACLE:.1,MIN_DISTANCE_TO_CEILING:.1,LIGHT_PROBE_MIRROR_SIZE:512,LIGHT_PROBE_MAX_MIP_SIZE:128,LIGHT_PROBE_MIN_MIP_SIZE:4,LIGHT_PROBE_GLOSS_FOR_MIP:[.99,.9,.85,.7,.4,.25],DEBUG_LIGHT_PROBE_MIPS:!1,ENABLE_AUTO_EXPOSURE_CONTROLS:!1,EDITOR_COVER_WIDTH:1920,EDITOR_COVER_HEIGHT:1080,MAX_PANORAMA_SIZE:8192,OBJECT_VISIBILITY_TARGET_SIZE:128,DEFAULT_SKY_NAME:"default",
EDITOR_CONTROLLED_SKY_NAME:"sky0",EDITOR_SELECTION_COLOR:(new G.Color(5021401)).convertGammaToLinear(),ALLOW_MOBILE_VR:!0,FALLBACK_CAMERA_HEIGHT:1.6,LOAD_PRIORITY:{CORE_RESOURCE:0,COLORMAP:1,UV0:1,DIFFUSE:2,LIGHTMAP:3,SKY:4,SPECULARITY:5,VIDEO:6},MERGE_TRANSPARENT_DISABLED:Ha("nomergetransparent"),urlHashContains:Ha,urlHashGetArgument:function(a){var b=Fa(window.location.hash);return a in b&&void 0!==b[a]?decodeURI(b[a]):null},urlHashRemoveArgument:function(a){var b=Fa(window.location.hash);return Object.keys(b).filter(function(c){return c!==
a}).map(function(c){var d=b[c];return c+(void 0===d?"":"="+d)}).join("&")},TELEPORT_TO_VIEW_MAX_TIME:3,TELEPORT_TO_POINT_MAX_TIME:4.5,TELEPORT_PATH_MAX_TIME:6,TELEPORT_TO_VIEW_ACCELERATION:4,TELEPORT_TO_POINT_ACCELERATION:2,TELEPORT_PATH_ACCELERATION:2,GAZE_POINTER_SHOW_LOADING_AFTER_S:2.5,GAZE_POINTER_ACTIVATE_AFTER_S:4.5,SPRITE_ANCHOR_FONT_SIZE:128,POINTER_PRIORITY:{TRANSFORM_CONTROLS:1,EDITOR_SELECTOR:2,INTERACTION_DISPATCHER:3},AVATAR_COLORS:"#65ffcc #dfe592 #99dd92 #cc96b1 #94c4d3 #93d8b9 #65c4ff #ff6565 #cca499 #b394cc #e29191 #ff65f4 #656bff #ffa560 #6bff63 #949ace #ad65ff #ff6584".split(" "),
STRINGS:{},DEFAULT_LANGUAGE:"English",ENABLE_MINIMAP:!0,FLIP_MOUSE:Ha("flipmouse"),AUTO_PLAY:Ha("autoplay"),HIDE_PLAY:Ha("hideplay"),SHOW_HELP_ON_LOAD:Ha("help"),GAZE_IN_POINTER_LOCK:Ha("gazeinpointerlock"),NO_GAZE_TELEPORT:Ha("nogazeteleport"),VR_LO:Ha("vrlo"),VR_HI:Ha("vrhi"),MOBILE_HI:Ha("mobilehi"),NO_BASIS:Ha("nobasis")};
window.WebXRConfig={cardboardConfig:{ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:null,CARDBOARD_UI_DISABLED:!1,K_FILTER:.98,ROTATE_INSTRUCTIONS_DISABLED:!1,PREDICTION_TIME_S:.04,YAW_ONLY:!1,BUFFER_SCALE:1,DIRTY_SUBMIT_FRAME_BINDINGS:!1}};
window.GLC={REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,FUNC_ADD:32774,FUNC_SUBTRACT:32778,
FUNC_REVERSE_SUBTRACT:32779,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,HALF_FLOAT_OES:36193,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,
COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4x4_KHR:37808};/*
 Copyright (C) 2014-present Shapespark
*/
var La=2*Math.PI;WALK.defer=function(a){setTimeout(a,0)};function Qa(a,b,c){return function(){a!==b.length&&(c(b[a]),WALK.defer(Qa(a+1,b,c)))}}WALK.iterateAsync=function(a,b){WALK.defer(Qa(0,a,b))};WALK.find=function(a,b){for(var c=0;c<a.length;c+=1){var d=a[c];if(b(d))return d}};WALK.filter=function(a,b){for(var c=a.length,d=[],e=0;e<c;e+=1)b(a[e])&&d.push(a[e]);return d};
WALK.indexOfMax=function(a,b){if(0===a.length)return null;for(var c=0,d=b?b(a[0]):a[0],e=1;e<a.length;e+=1){var f=b?b(a[e]):a[e];f>d&&(c=e,d=f)}return c};WALK.any=function(a,b){for(var c=a.length,d=0;d<c;d+=1)if(b(a[d]))return!0;return!1};WALK.removeFromArray=function(a,b){a=b.indexOf(a);console.assert(-1!==a);return b.splice(a,1)};WALK.shiftItem=function(a,b,c){var d=a.indexOf(b);b=a[d];for(var e=c>d?1:-1;d!==c;d+=e)a[d]=a[d+e];a[c]=b};
WALK.copyProperties=function(a,b,c){for(var d=0;d<b.length;d+=1){var e=b[d],f=a[e];void 0!==f&&(c[e]=f)}};WALK.normalizeRotation=function(a){a%=La;return a>Math.PI?-La+a:a<-Math.PI?La+a:a};WALK.yawRotationToPoint=function(a,b){return Math.atan2(-(b.x-a.x),b.y-a.y)};WALK.setTextContent=function(a,b){void 0!==a.textContent?a.textContent=b:void 0!==a.innerText?a.innerText=b:console.warn("textContent and innerText properties are missing")};WALK.log2=function(a){return Math.log(a)/Math.log(2)};
WALK.mipsCount=function(a,b){return WALK.log2(b)-WALK.log2(a)+1};WALK.LIGHT_PROBE_MIPS_COUNT=WALK.mipsCount(WALK.LIGHT_PROBE_MIN_MIP_SIZE,WALK.LIGHT_PROBE_MAX_MIP_SIZE);WALK.isModifierPressed=function(a){return a.ctrlKey||a.altKey||a.metaKey};WALK.round=function(a,b){void 0===b&&(b=3);return+(Math.round(a+"e+"+b)+"e-"+b)};WALK.preloadImage=function(a){var b=new Image;b.src=a;return b};
WALK.onVideoDataReady=function(a,b){function c(){a.readyState>=a.HAVE_CURRENT_DATA&&(a.removeEventListener("playing",c),a.removeEventListener("timeupdate",c),b(a))}a.readyState>=a.HAVE_CURRENT_DATA?b(a):(a.addEventListener("playing",c),a.addEventListener("timeupdate",c))};WALK.cloneObject=function(a){return JSON.parse(JSON.stringify(a))};WALK.readOnlyCopy=function(a){return"object"===typeof a?Object.freeze(WALK.cloneObject(a)):a};
WALK.deepEqual=function(a,b){if(a===b)return!0;if("object"!==typeof a||null===a||"object"!==typeof b||null===b||Object.keys(a).length!==Object.keys(b).length)return!1;for(var c=m.makeIterator(Object.keys(a)),d=c.next();!d.done;d=c.next())if(d=d.value,!b.hasOwnProperty(d)||!WALK.deepEqual(a[d],b[d]))return!1;return!0};WALK.executableOnlyOnce=function(a){var b=!1,c;return function(){if(b)return c;c=a();a=null;b=!0;return c}};
WALK.preventClosureCompilerDeadCodeRemoval=function(a){WALK.preventClosureCompilerDeadCodeRemoval[" "](a);return a};WALK.preventClosureCompilerDeadCodeRemoval[" "]=function(){return null};WALK.ICONS={};function Va(a,b,c){WALK.ICONS[a]={name:a,value:b,fontFamily:c}}function gb(a,b){Va(a,b,"FontAwesomeSolid")}function ib(a,b){Va(a,b,"FontAwesomeRegular")}function nb(a,b){Va(a,b,"FontAwesomeBrands")}gb("address-book","\uf2b9");gb("address-card","\uf2bb");gb("area-chart","\uf1fe");gb("arrows","\uf0b2");gb("arrow-up","\uf062");gb("arrow-down","\uf063");gb("assistive-listening-systems","\uf2a2");gb("asterisk","\uf069");gb("audio-description","\uf29e");gb("at","\uf1fa");gb("bars","\uf0c9");
gb("bell","\uf0f3");gb("book","\uf02d");gb("bookmark","\uf02e");gb("bullhorn","\uf0a1");gb("calculator","\uf1ec");gb("camera","\uf030");gb("chart-bar","\uf080");gb("chart-pie","\uf200");gb("chevron-up","\uf077");gb("chevron-down","\uf078");gb("cloud","\uf0c2");gb("cog","\uf013");gb("comment","\uf075");ib("compass","\uf14e");ib("credit-card","\uf09d");gb("crosshairs","\uf05b");gb("desktop","\uf108");gb("download","\uf019");gb("envelope","\uf0e0");gb("expand","\uf424");gb("external-link","\uf35d");
ib("eye","\uf06e");gb("eye-dropper","\uf1fb");gb("film","\uf008");gb("flag","\uf024");gb("folder","\uf07b");gb("gift","\uf06b");gb("headphones","\uf025");gb("highlighter","\uf591");gb("home","\uf015");ib("image","\uf03e");gb("sign-in","\uf2f6");gb("info","\uf129");ib("lightbulb","\uf0eb");gb("magic","\uf0d0");gb("magnet","\uf076");gb("map-marker","\uf3c5");gb("map-pin","\uf276");gb("map-signs","\uf277");gb("paint-brush","\uf1fc");gb("pencil","\uf303");gb("pen","\uf304");gb("phone","\uf095");
gb("question","\uf128");gb("search","\uf002");gb("share","\uf064");gb("share-alt","\uf1e0");gb("shopping-cart","\uf07a");gb("sliders","\uf1de");gb("star","\uf005");ib("sticky-note","\uf249");gb("sync","\uf2f1");ib("edit","\uf044");gb("tachometer","\uf3fd");gb("tag","\uf02b");gb("video","\uf03d");gb("wrench","\uf0ad");gb("palette","\uf53f");gb("paint-roller","\uf5aa");gb("play","\uf04b");gb("pause","\uf04c");gb("plus","\uf067");nb("youtube","\uf167");nb("vimeo","\uf40a");nb("facebook","\uf09a");
nb("twitter","\uf099");nb("instagram","\uf16d");nb("linkedin","\uf08c");nb("skype","\uf17e");nb("whatsapp","\uf232");nb("facebook-messenger","\uf39f");nb("telegram","\uf2c6");nb("slack","\uf198");var rb=!1,tb={NOT_NEEDED:0,TEST_NEEDED:1,NEEDED:2},Ab=new function(){function a(){for(d+=1;d<b.length;d+=1){var e=b[d];if(0<e.length){for(var f=0;f<e.length;f+=1)c[d]+=1,WALK.defer(e[f]);e.length=0;break}}}var b=[],c=[],d=Infinity;(function(){var e=0,f;for(f in WALK.LOAD_PRIORITY)WALK.LOAD_PRIORITY.hasOwnProperty(f)&&(e=Math.max(e,WALK.LOAD_PRIORITY[f]));for(f=0;f<=e;f+=1)b[f]=[],c[f]=0})();this.add=function(e,f){e<=d?(c[e]+=1,d=e,WALK.defer(f)):(b[e].push(f),0===c[d]&&a())};this.finished=function(e){--c[e];
var f=c[e];console.assert(0<=f);e===d&&0===f&&a()}};
function Db(a){for(var b=m.makeIterator(Object.entries({"https://cdn0.shapespark.com/":"https://cdn0-jsbr.shapespark.com/","https://cdn0.dev.shapespark.com/":"https://cdn0-jsbr-dev.shapespark.com/","https://cdn0-shapespark-cn-dev.oss-accelerate.aliyuncs.com/":"https://cdn0-jsbr-cn-dev.shapespark.com.cn/","https://cdn0-shapespark-cn.oss-accelerate.aliyuncs.com/":"https://cdn0-jsbr.shapespark.com.cn/","https://cdncn0-shapespark.oss-accelerate.aliyuncs.com/":"https://cdncn0-jsbr.shapespark.com.cn/"})),c=
b.next();!c.done;c=b.next()){var d=m.makeIterator(c.value);c=d.next().value;d=d.next().value;if(a.startsWith(c))return a.replace(c,d)}return a}
var Jb=new function(){function a(n){n=new Int8Array(n);return(new BrotliDecode(n)).buffer}function b(n){k=n;for(var r=0;r<f.length;r+=1)f[r](n);f=null}function c(n){h?n():(g.push(n),1===g.length&&WALK.loadScriptAndExecute(WALK.getViewerAssetUrl("lib/brotli.min.js"),function(){h=!0;for(var r=0;r<g.length;r+=1)g[r]();g=null},function(){return WALK.USER_MSG.error("Cannot load required library")}))}function d(){200<=l.status&&300>l.status||0===l.status?b("SSSSSS"===l.responseText):(console.error("br.buf response",
l.status),b(!0))}function e(n){void 0!==k?n(k):(f.push(n),1===f.length&&(l.addEventListener("load",d,!1),l.open("GET",WALK.getViewerAssetUrl("3dassets/br.buf"),!0),l.send()))}var f=[],g=[],k=void 0,h=!1,l=new XMLHttpRequest;this.decode=function(n,r,v){r?c(function(){v(a(n))}):e(function(p){p?v(n):c(function(){v(a(n))})})}};function Pb(a,b){return function(c){Ab.finished(a);b(c)}}
function Tb(a){this.method=a;this.binaryResult=!1;this.dataContentType=this.data=null;"GET"===a?(this.retriesLeft=WALK.RETRIES_ON_LOAD_ERROR,this.retryDelayMs=1E3+1E3*Math.random()):this.retryDelayMs=this.retriesLeft=0}Tb.prototype={constructor:Tb,retryScheduled:function(){console.assert(0<this.retriesLeft);--this.retriesLeft;this.retryDelayMs*=2}};function Vb(a,b,c,d,e,f){setTimeout(function(){Xb(a,b,c,d,e,f)},b.retryDelayMs);b.retryScheduled()}
function Xb(a,b,c,d,e,f){function g(n,r){var v=!0!==WALK.DETECTOR.canForceBrotliBuffers?tb.NOT_NEEDED:0<=l.getAllResponseHeaders().toLowerCase().indexOf("js-content-encoding:")?tb.NEEDED:"br"===l.getResponseHeader("content-encoding")?tb.TEST_NEEDED:tb.NOT_NEEDED;v===tb.NOT_NEEDED?r(n):Jb.decode(n,v===tb.NEEDED,r)}function k(){var n=l.status||0;n="GET"===b.method&&(500<=n||0===n)?0!==b.retriesLeft:!1;console.warn("Failed to "+b.method+": "+a+" ("+l.status+")"+(n?", retrying in "+b.retryDelayMs/1E3+
"s":""));if(n)f&&!rb&&(console.warn("Switch to jsbr hosts."),rb=!0),Vb(a,b,c,d,e,f);else if(void 0!==d){try{var r=JSON.parse(l.responseText).message}catch(v){r=void 0}d(l.status,r)}b=l=null}function h(){if(void 0!==c)if(b.binaryResult)g(l.response,c);else{var n=l.getResponseHeader("content-type"),r=l.responseText;r&&-1!==n.indexOf("text/plain")?g(r,c):r?g(r,function(v){c(JSON.parse(v))}):c()}b=l=null}var l=new XMLHttpRequest;void 0!==e&&l.addEventListener("progress",e,!1);l.addEventListener("load",
function(){200<=l.status&&300>l.status||0===l.status?h():k()},!1);l.addEventListener("error",k,!1);l.addEventListener("abort",k,!1);f&&rb&&(a=Db(a));l.open(b.method,a,!0);b.binaryResult&&(l.responseType="arraybuffer");b.dataContentType&&l.setRequestHeader("Content-Type",b.dataContentType);"POST"===b.method&&l.setRequestHeader("X-Requested-By","Shapespark");l.send(b.data)}WALK.ajaxGet=function(a,b,c,d,e,f){var g=new Tb("GET");g.binaryResult=b;Xb(a,g,c,d,e,f)};
WALK.queueAjaxGet=function(a,b,c,d,e,f,g){g=void 0===g?!1:g;Ab.add(a,function(){WALK.ajaxGet(b,c,Pb(a,d),Pb(a,e),f,g)})};WALK.ajaxPost=function(a,b,c,d,e,f){var g=new Tb("POST");g.data=c;g.dataContentType=b;Xb(a,g,d,e,f)};function Yb(a,b,c,d,e){function f(){a(b,c,d,e)}return function(){console.warn("Failed to get: "+b+(f?", retrying in "+c.retryDelayMs/1E3+"s":""));0<c.retriesLeft?(setTimeout(f,c.retryDelayMs),c.retryScheduled()):e()}}
function Zb(a,b,c,d){var e=new Image;e.onload=function(){c(e);e=null};e.onerror=Yb(Zb,a,b,c,d);e.crossOrigin="anonymous";e.src=a}WALK.queueImageGet=function(a,b,c,d){Ab.add(a,function(){var e=new Tb("GET");Zb(b,e,Pb(a,c),Pb(a,d))})};
function $b(a,b,c,d){var e=document.createElement("video");e.autoplay=!0;e.muted=!0;e.loop=!0;e.setAttribute("playsinline","");e.setAttribute("webkit-playsinline","");e.crossOrigin="anonymous";e.onerror=Yb($b,a,b,c,d);WALK.onVideoDataReady(e,function(){e.onerror=void 0;c(e);e=null});e.src=a;e.play().catch(function(){})}WALK.queueVideoGet=function(a,b,c,d){Ab.add(a,function(){var e=new Tb("GET");$b(b,e,Pb(a,c),Pb(a,d))})};
WALK.loadScriptAndExecute=function(){function a(e){c.add(e);var f=d.get(e);d.delete(e);f.forEach(function(g){try{(0,g.onSuccess)()}catch(k){console.log(k)}})}function b(e){var f=d.get(e);d.delete(e);console.error("Can't load script : "+e);f.forEach(function(g){if(void 0!==g.onError){g=g.onError.bind(null,e);try{g()}catch(k){console.log(k)}}})}var c=new Set,d=new Map;return function(e,f,g){if(c.has(e))f();else if(d.has(e))d.get(e).push({onSuccess:f,onError:g});else{d.set(e,[{onSuccess:f,onError:g}]);
f=a.bind(this,e);g=b.bind(this,e);var k=document.createElement("script");k.onload=f;k.onerror=g;k.src=e;k.type="text/javascript";document.body.appendChild(k)}}}();WALK.loadScriptsUrlAndExecute=function(a,b,c){function d(e){return new Promise(function(f,g){WALK.loadScriptAndExecute(e,f,g)})}a=a.map(function(e){return d(e)});Promise.all(a).then(b).catch(function(e){void 0!==c&&c(e)})};var ac=[],dc=0,ec=void 0,fc=0;function gc(a,b){for(a=a.toString();a.length<b;)a="0"+a;return a}function hc(){0!==fc&&(ac[ac.length-1]+=" ["+(fc+1).toString()+" copies]",fc=0)}function ic(){hc();0<dc&&ac.push("[truncated, removed lines "+dc.toString()+"]");WALK.ajaxPost("./logs","application/json",JSON.stringify({logs:ac}));ac.length=0;ec=void 0;fc=dc=0}
function jc(a){var b=console[a].bind(console);console[a]=function(){for(var c="",d="",e=0;e<arguments.length;++e)d+=(0===e?"":" ")+arguments[e];WALK.LOG_TIME&&(c=new Date,c=gc(c.getHours(),2)+":"+gc(c.getMinutes(),2)+":"+gc(c.getSeconds(),2)+","+gc(c.getMilliseconds(),3)+" ");e=c;var f=d;ec===f?fc+=1:499<=ac.length?dc+=1:(hc(),ec=f,e=e+a.toUpperCase()+" "+f,ac.push(e),1==ac.length&&setTimeout(ic,5E3));b(c+d)}}
function kc(){window.onerror=function(a,b,c,d,e){console.error("Error occured: "+a+" ("+b+"#"+c.toString()+":"+d.toString()+"/"+e+")");return!1}}WALK.log=function(){};WALK.logInfoMessages=function(){WALK.log=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];console.log.apply(console,m.arrayFromIterable(b))}};WALK.initLoggingToServer=function(a){a&&(jc("log"),jc("info"));jc("warn");jc("error");kc()};WALK.LOG_INFO&&WALK.logInfoMessages();WALK.LOG_TO_SERVER&&WALK.initLoggingToServer(!0);/*

 nosleep.js
 Copyright (c) 2017, Rich Tibbett

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.

 webxr-polyfill
 Copyright (c) 2017 Google
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 cardboard-vr-display
 Copyright (c) 2015-2017 Google
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 webvr-polyfill-dpdb 
 Copyright (c) 2017 Google
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 wglu-preserve-state
 Copyright (c) 2016, Brandon Jones.

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
*/
function lc(){function a(q){q=void 0===q?{}:q;this.config=Object.freeze(Object.assign({},Ih,q));this.global=this.config.global;this.nativeWebXR="xr"in this.global.navigator;this.injected=!1;this.nativeWebXR?this._injectCompatibilityShims(this.global):this._injectPolyfill(this.global)}function b(q,x){var C,F;return m.asyncExecutePromiseGeneratorProgram(function(aa){return 1==aa.nextAddress?x.webvr?aa.yield(c(q),3):aa.jumpTo(2):2!=aa.nextAddress&&(C=aa.yieldResult)?aa.return(C):(F=v(q))&&x.cardboard||
!F&&x.allowCardboardOnDesktop?(q.VRFrameData||(q.VRFrameData=function(){this.rightViewMatrix=new Float32Array(16);this.leftViewMatrix=new Float32Array(16);this.rightProjectionMatrix=new Float32Array(16);this.leftProjectionMatrix=new Float32Array(16);this.pose=null}),aa.return(new f(q,x.cardboardConfig))):aa.return(new d(q))})}function c(q){var x,C;return m.asyncExecutePromiseGeneratorProgram(function(F){switch(F.nextAddress){case 1:x=null;if(!("getVRDisplays"in q.navigator)){F.jumpTo(2);break}F.setCatchFinallyBlocks(3);
return F.yield(q.navigator.getVRDisplays(),5);case 5:(C=F.yieldResult)&&C.length&&(x=new g(q,C[0]));F.leaveTryBlock(2);break;case 3:F.enterCatchBlock();case 2:return F.return(x)}})}function d(q){q=r.call(this,q)||this;q.sessions=new Map;q.projectionMatrix=X();q.identityMatrix=X();return q}function e(q,x){this.mode=q;this.enabledFeatures=x;this.baseLayer=this.ended=null;this.id=++Jh}function f(q,x){x=new Kh(x||{});q=g.call(this,q,x)||this;q.display=x;q.frame={rightViewMatrix:new Float32Array(16),leftViewMatrix:new Float32Array(16),
rightProjectionMatrix:new Float32Array(16),leftProjectionMatrix:new Float32Array(16),pose:null,timestamp:null};return q}function g(q,x){var C=x.capabilities.canPresent;var F=r.call(this,q)||this;F.display=x;F.frame=new q.VRFrameData;F.sessions=new Map;F.immersiveSession=null;F.canPresent=C;F.baseModelMatrix=X();F.gamepadInputSources={};F.tempVec3=new Float32Array(3);F.onVRDisplayPresentChange=F.onVRDisplayPresentChange.bind(F);q.window.addEventListener("vrdisplaypresentchange",F.onVRDisplayPresentChange);
F.CAN_USE_GAMEPAD=q.navigator&&"getGamepads"in q.navigator;F.HAS_BITMAP_SUPPORT=!(!q.ImageBitmapRenderingContext||!q.createImageBitmap);return F}function k(q,x,C){C=void 0===C?{}:C;this.mode=q;this.enabledFeatures=x;this.outputContext=null;this.immersive="immersive-vr"==q||"immersive-ar"==q;this.baseLayer=this.ended=null;this.id=++Lh;this.modifiedCanvasLayer=!1;this.outputContext&&(this.renderContext=this.outputContext.canvas.getContext(C.renderContextType||"2d"))}function h(q,x,C,F){C=void 0===C?
0:C;F=void 0===F?-1:F;this.polyfill=q;this.display=x;this.gamepad=this.nativeGamepad=null;this.inputSource=new u(this);this.lastPosition=ma();this.emulatedPosition=!1;this.basePoseMatrix=X();this.outputMatrix=X();this.primaryButtonIndex=C;this.primaryActionPressed=!1;this.primarySqueezeButtonIndex=F;this.primarySqueezeActionPressed=!1;this.handedness="";this.targetRayMode="gaze";this.armModel=null}function l(q,x,C){C||(C={});if(C.userAgentOverrides)for(var F in C.userAgentOverrides)if(navigator.userAgent.includes(F)){F=
C.userAgentOverrides[F];for(var aa in F)aa in C?Object.assign(C[aa],F[aa]):C[aa]=F[aa];break}aa=Array(C.axes&&C.axes.length?C.axes.length:q.axes.length);F=Array(C.buttons&&C.buttons.length?C.buttons.length:q.buttons.length);var pa=null;if(C.gripTransform){var ra=C.gripTransform.orientation||[0,0,0,1];pa=X();ya(pa,ia(ra,ra),C.gripTransform.position||[0,0,0])}ra=null;if(C.targetRayTransform){var Ia=C.targetRayTransform.orientation||[0,0,0,1];ra=X();ya(ra,ia(Ia,Ia),C.targetRayTransform.position||[0,
0,0])}Ia=C.profiles;C.displayProfiles&&x.displayName in C.displayProfiles&&(Ia=C.displayProfiles[x.displayName]);this[Ub]={gamepad:q,map:C,profiles:Ia||[q.id],mapping:C.mapping||q.mapping,axes:aa,buttons:F,gripTransform:pa,targetRayTransform:ra};this._update()}function n(){this.hand="right";this.headElbowOffset=Zf;this.controllerQ=na();this.lastControllerQ=na();this.headQ=na();this.headPos=ma();this.elbowPos=ma();this.wristPos=ma();this.lastTime=this.time=null;this.rootQ=na();this.position=ma()}function r(q){var x=
Y.call(this)||this;x.global=q;x.onWindowResize=x.onWindowResize.bind(x);x.global.window.addEventListener("resize",x.onWindowResize);x.environmentBlendMode="opaque";return x}function v(q){var x=!1;q=q.navigator.userAgent||q.navigator.vendor||q.opera;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(q)||
/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(q.substr(0,
4)))x=!0;return x}function p(q){var x=q.prototype.getContext;q.prototype.getContext=function(C,F){if(C=x.call(this,C,F))C[$f]=!0,F&&"xrCompatible"in F&&(C[af]=F.xrCompatible);return C}}function w(q){if("function"===typeof q.prototype.makeXRCompatible)return!1;q.prototype.makeXRCompatible=function(){this[af]=!0;return Promise.resolve()};return!0}function u(q){this[Jc]={impl:q,gripSpace:new I("grip",this),targetRaySpace:new I("target-ray",this)}}function y(q,x,C){var F=Y.call(this)||this;var aa="inline"!=
x,pa=new H({inlineVerticalFieldOfView:aa?null:.5*Math.PI});F[xa]={device:q,mode:x,immersive:aa,ended:!1,suspended:!1,frameCallbacks:[],currentFrameCallbacks:null,frameHandle:0,deviceFrameHandle:null,id:C,activeRenderState:pa,pendingRenderState:null,viewerSpace:new ta("viewer"),viewSpaces:[],currentInputSources:[]};aa?F[xa].viewSpaces.push(new B("left"),new B("right")):F[xa].viewSpaces.push(new B("none"));F[xa].onDeviceFrame=function(){if(!F[xa].ended&&!F[xa].suspended){F[xa].deviceFrameHandle=null;
F[xa].startDeviceFrameLoop();if(null!==F[xa].pendingRenderState&&(F[xa].activeRenderState=new H(F[xa].pendingRenderState),F[xa].pendingRenderState=null,F[xa].activeRenderState.baseLayer))F[xa].device.onBaseLayerSet(F[xa].id,F[xa].activeRenderState.baseLayer);if(null!==F[xa].activeRenderState.baseLayer){var ra=new K(q,F,F[xa].id),Ia=F[xa].currentFrameCallbacks=F[xa].frameCallbacks;F[xa].frameCallbacks=[];ra[Hb].active=!0;ra[Hb].animationFrame=!0;F[xa].device.onFrameStart(F[xa].id,F[xa].activeRenderState);
F._checkInputSourcesChange();for(var $a=mb(),ab=0;ab<Ia.length;ab++)try{Ia[ab].cancelled||"function"!==typeof Ia[ab].callback||Ia[ab].callback($a,ra)}catch(eb){console.error(eb)}F[xa].currentFrameCallbacks=null;ra[Hb].active=!1;F[xa].device.onFrameEnd(F[xa].id)}}};F[xa].startDeviceFrameLoop=function(){null===F[xa].deviceFrameHandle&&(F[xa].deviceFrameHandle=F[xa].device.requestAnimationFrame(F[xa].onDeviceFrame))};F[xa].stopDeviceFrameLoop=function(){var ra=F[xa].deviceFrameHandle;null!==ra&&(F[xa].device.cancelAnimationFrame(ra),
F[xa].deviceFrameHandle=null)};F[xa].onPresentationEnd=function(ra){ra!==F[xa].id?(F[xa].suspended=!1,F[xa].startDeviceFrameLoop(),F.dispatchEvent("focus",{session:F})):(F[xa].ended=!0,F[xa].stopDeviceFrameLoop(),q.removeEventListener("@@webxr-polyfill/vr-present-end",F[xa].onPresentationEnd),q.removeEventListener("@@webxr-polyfill/vr-present-start",F[xa].onPresentationStart),q.removeEventListener("@@webxr-polyfill/input-select-start",F[xa].onSelectStart),q.removeEventListener("@@webxr-polyfill/input-select-end",
F[xa].onSelectEnd),F.dispatchEvent("end",Aa("end",{session:F})))};q.addEventListener("@@webxr-polyfill/vr-present-end",F[xa].onPresentationEnd);F[xa].onPresentationStart=function(ra){ra!==F[xa].id&&(F[xa].suspended=!0,F[xa].stopDeviceFrameLoop(),F.dispatchEvent("blur",{session:F}))};q.addEventListener("@@webxr-polyfill/vr-present-start",F[xa].onPresentationStart);F[xa].onSelectStart=function(ra){ra.sessionId===F[xa].id&&F[xa].dispatchInputSourceEvent("selectstart",ra.inputSource)};q.addEventListener("@@webxr-polyfill/input-select-start",
F[xa].onSelectStart);F[xa].onSelectEnd=function(ra){ra.sessionId===F[xa].id&&(F[xa].dispatchInputSourceEvent("selectend",ra.inputSource),F[xa].dispatchInputSourceEvent("select",ra.inputSource))};q.addEventListener("@@webxr-polyfill/input-select-end",F[xa].onSelectEnd);F[xa].onSqueezeStart=function(ra){ra.sessionId===F[xa].id&&F[xa].dispatchInputSourceEvent("squeezestart",ra.inputSource)};q.addEventListener("@@webxr-polyfill/input-squeeze-start",F[xa].onSqueezeStart);F[xa].onSqueezeEnd=function(ra){ra.sessionId===
F[xa].id&&(F[xa].dispatchInputSourceEvent("squeezeend",ra.inputSource),F[xa].dispatchInputSourceEvent("squeeze",ra.inputSource))};q.addEventListener("@@webxr-polyfill/input-squeeze-end",F[xa].onSqueezeEnd);F[xa].dispatchInputSourceEvent=function(ra,Ia){var $a=new K(q,F,F[xa].id);Ia=oa(ra,{frame:$a,inputSource:Ia});$a[Hb].active=!0;F.dispatchEvent(ra,Ia);$a[Hb].active=!1};F[xa].startDeviceFrameLoop();F.onblur=void 0;F.onfocus=void 0;F.onresetpose=void 0;F.onend=void 0;F.onselect=void 0;F.onselectstart=
void 0;F.onselectend=void 0;return F}function B(q){return I.call(this,q)||this}function D(q,x,C){C=void 0===C?{}:C;C=Object.assign({},Mh,C);if(!(q instanceof y))throw Error("session must be a XRSession");if(q.ended)throw Error("InvalidStateError");if(x[$f]&&!0!==x[af])throw Error("InvalidStateError");var F=x.getParameter(x.FRAMEBUFFER_BINDING);this[Qc]={context:x,config:C,framebuffer:F,session:q}}function H(q){q=void 0===q?{}:q;q=Object.assign({},Nh,q);this[Rc]={config:q}}function K(q,x,C){this[Hb]=
{id:++ie,active:!1,animationFrame:!1,device:q,session:x,sessionId:C}}function J(q,x,C,F){if(!Gb.includes(C))throw Error("XREye must be one of: "+Gb);var aa=Object.create(null),pa=new W(aa);this[zb]={device:q,eye:C,viewport:pa,temp:aa,sessionId:F,transform:x}}function W(q){this[ub]={target:q}}function M(q,x,C){q=ba.call(this,q,void 0===C?!1:C)||this;q[jb]={views:x};return q}function ba(q,x){this[yb]={transform:q,emulatedPosition:x}}function ha(q){var x=Y.call(this)||this;x[wa]={device:null,devicePromise:q,
immersiveSession:null,inlineSessions:new Set};q.then(function(C){x[wa].device=C});return x}function ta(q,x){x=void 0===x?null:x;if(!va.includes(q))throw Error("XRReferenceSpaceType must be one of "+va);var C=I.call(this,q)||this;if("bounded-floor"===q&&!x)throw Error("XRReferenceSpace cannot use 'bounded-floor' type if the platform does not provide the floor level");"bounded-floor"!==q&&"local-floor"!==q||x||(x=fa(new Float32Array(16)),x[13]=1.6);C._inverseBaseMatrix=x||fa(new Float32Array(16));C[ea]=
{type:q,transform:x,originOffset:fa(new Float32Array(16))};return C}function I(q,x){this[L]={specialType:void 0===q?null:q,inputSource:void 0===x?null:x,baseMatrix:null,inverseBaseMatrix:null,lastFrameId:-1}}function U(){this[Da]={matrix:null,position:null,orientation:null,inverse:null};if(0===arguments.length)this[Da].matrix=fa(new Float32Array(16));else if(1===arguments.length)arguments[0]instanceof Float32Array?this[Da].matrix=arguments[0]:(this[Da].position=this._getPoint(arguments[0]),this[Da].orientation=
DOMPointReadOnly.fromPoint({x:0,y:0,z:0,w:1}));else if(2===arguments.length)this[Da].position=this._getPoint(arguments[0]),this[Da].orientation=this._getPoint(arguments[1]);else throw Error("Too many arguments!");if(this[Da].matrix){var q=ma();za(q,this[Da].matrix);this[Da].position=DOMPointReadOnly.fromPoint({x:q[0],y:q[1],z:q[2]});q=na();T(q,this[Da].matrix);this[Da].orientation=DOMPointReadOnly.fromPoint({x:q[0],y:q[1],z:q[2],w:q[3]})}else{this[Da].matrix=fa(new Float32Array(16));q=this[Da].matrix;
var x=this[Da].orientation.x,C=this[Da].orientation.y,F=this[Da].orientation.z,aa=this[Da].orientation.w,pa=new cb(4);pa[0]=x;pa[1]=C;pa[2]=F;pa[3]=aa;ya(q,pa,N(this[Da].position.x,this[Da].position.y,this[Da].position.z))}}function ia(q,x){var C=x[0],F=x[1],aa=x[2];x=x[3];var pa=C*C+F*F+aa*aa+x*x;0<pa&&(pa=1/Math.sqrt(pa),q[0]=C*pa,q[1]=F*pa,q[2]=aa*pa,q[3]=x*pa);return q}function R(q,x){q[0]=x[0];q[1]=x[1];q[2]=x[2];q[3]=x[3];return q}function E(q){var x=new cb(4);x[0]=q[0];x[1]=q[1];x[2]=q[2];
x[3]=q[3];return x}function Y(){this[Oa]={listeners:new Map}}function X(){var q=new cb(16);cb!=Float32Array&&(q[1]=0,q[2]=0,q[3]=0,q[4]=0,q[6]=0,q[7]=0,q[8]=0,q[9]=0,q[11]=0,q[12]=0,q[13]=0,q[14]=0);q[0]=1;q[5]=1;q[10]=1;q[15]=1;return q}function fa(q){q[0]=1;q[1]=0;q[2]=0;q[3]=0;q[4]=0;q[5]=1;q[6]=0;q[7]=0;q[8]=0;q[9]=0;q[10]=1;q[11]=0;q[12]=0;q[13]=0;q[14]=0;q[15]=1;return q}function ka(q,x){var C=x[0],F=x[1],aa=x[2],pa=x[3],ra=x[4],Ia=x[5],$a=x[6],ab=x[7],eb=x[8],Bb=x[9],Kb=x[10],Mb=x[11],Cb=x[12],
Lb=x[13],qb=x[14];x=x[15];var Qb=C*Ia-F*ra,sb=C*$a-aa*ra,vb=C*ab-pa*ra,bb=F*$a-aa*Ia,wb=F*ab-pa*Ia,mc=aa*ab-pa*$a,Sc=eb*Lb-Bb*Cb,nc=eb*qb-Kb*Cb,bc=eb*x-Mb*Cb,Kc=Bb*qb-Kb*Lb,Rb=Bb*x-Mb*Lb,cc=Kb*x-Mb*qb,pb=Qb*cc-sb*Rb+vb*Kc+bb*bc-wb*nc+mc*Sc;if(!pb)return null;pb=1/pb;q[0]=(Ia*cc-$a*Rb+ab*Kc)*pb;q[1]=(aa*Rb-F*cc-pa*Kc)*pb;q[2]=(Lb*mc-qb*wb+x*bb)*pb;q[3]=(Kb*wb-Bb*mc-Mb*bb)*pb;q[4]=($a*bc-ra*cc-ab*nc)*pb;q[5]=(C*cc-aa*bc+pa*nc)*pb;q[6]=(qb*vb-Cb*mc-x*sb)*pb;q[7]=(eb*mc-Kb*vb+Mb*sb)*pb;q[8]=(ra*Rb-Ia*
bc+ab*Sc)*pb;q[9]=(F*bc-C*Rb-pa*Sc)*pb;q[10]=(Cb*wb-Lb*vb+x*Qb)*pb;q[11]=(Bb*vb-eb*wb-Mb*Qb)*pb;q[12]=(Ia*nc-ra*Kc-$a*Sc)*pb;q[13]=(C*Kc-F*nc+aa*Sc)*pb;q[14]=(Lb*sb-Cb*bb-qb*Qb)*pb;q[15]=(eb*bb-Bb*sb+Kb*Qb)*pb;return q}function qa(q,x,C){var F=x[0],aa=x[1],pa=x[2],ra=x[3],Ia=x[4],$a=x[5],ab=x[6],eb=x[7],Bb=x[8],Kb=x[9],Mb=x[10],Cb=x[11],Lb=x[12],qb=x[13],Qb=x[14];x=x[15];var sb=C[0],vb=C[1],bb=C[2],wb=C[3];q[0]=sb*F+vb*Ia+bb*Bb+wb*Lb;q[1]=sb*aa+vb*$a+bb*Kb+wb*qb;q[2]=sb*pa+vb*ab+bb*Mb+wb*Qb;q[3]=
sb*ra+vb*eb+bb*Cb+wb*x;sb=C[4];vb=C[5];bb=C[6];wb=C[7];q[4]=sb*F+vb*Ia+bb*Bb+wb*Lb;q[5]=sb*aa+vb*$a+bb*Kb+wb*qb;q[6]=sb*pa+vb*ab+bb*Mb+wb*Qb;q[7]=sb*ra+vb*eb+bb*Cb+wb*x;sb=C[8];vb=C[9];bb=C[10];wb=C[11];q[8]=sb*F+vb*Ia+bb*Bb+wb*Lb;q[9]=sb*aa+vb*$a+bb*Kb+wb*qb;q[10]=sb*pa+vb*ab+bb*Mb+wb*Qb;q[11]=sb*ra+vb*eb+bb*Cb+wb*x;sb=C[12];vb=C[13];bb=C[14];wb=C[15];q[12]=sb*F+vb*Ia+bb*Bb+wb*Lb;q[13]=sb*aa+vb*$a+bb*Kb+wb*qb;q[14]=sb*pa+vb*ab+bb*Mb+wb*Qb;q[15]=sb*ra+vb*eb+bb*Cb+wb*x;return q}function ya(q,x,C){var F=
x[0],aa=x[1],pa=x[2],ra=x[3],Ia=F+F,$a=aa+aa,ab=pa+pa;x=F*Ia;var eb=F*$a;F*=ab;var Bb=aa*$a;aa*=ab;pa*=ab;Ia*=ra;$a*=ra;ra*=ab;q[0]=1-(Bb+pa);q[1]=eb+ra;q[2]=F-$a;q[3]=0;q[4]=eb-ra;q[5]=1-(x+pa);q[6]=aa+Ia;q[7]=0;q[8]=F+$a;q[9]=aa-Ia;q[10]=1-(x+Bb);q[11]=0;q[12]=C[0];q[13]=C[1];q[14]=C[2];q[15]=1;return q}function za(q,x){q[0]=x[12];q[1]=x[13];q[2]=x[14];return q}function T(q,x){var C=x[0]+x[5]+x[10];0<C?(C=2*Math.sqrt(C+1),q[3]=.25*C,q[0]=(x[6]-x[9])/C,q[1]=(x[8]-x[2])/C,q[2]=(x[1]-x[4])/C):x[0]>
x[5]&&x[0]>x[10]?(C=2*Math.sqrt(1+x[0]-x[5]-x[10]),q[3]=(x[6]-x[9])/C,q[0]=.25*C,q[1]=(x[1]+x[4])/C,q[2]=(x[8]+x[2])/C):x[5]>x[10]?(C=2*Math.sqrt(1+x[5]-x[0]-x[10]),q[3]=(x[8]-x[2])/C,q[0]=(x[1]+x[4])/C,q[1]=.25*C,q[2]=(x[6]+x[9])/C):(C=2*Math.sqrt(1+x[10]-x[0]-x[5]),q[3]=(x[1]-x[4])/C,q[0]=(x[8]+x[2])/C,q[1]=(x[6]+x[9])/C,q[2]=.25*C);return q}function V(q,x,C,F,aa){x=1/Math.tan(x/2);q[0]=x/C;q[1]=0;q[2]=0;q[3]=0;q[4]=0;q[5]=x;q[6]=0;q[7]=0;q[8]=0;q[9]=0;q[11]=-1;q[12]=0;q[13]=0;q[15]=0;null!=aa&&
Infinity!==aa?(C=1/(F-aa),q[10]=(aa+F)*C,q[14]=2*aa*F*C):(q[10]=-1,q[14]=-2*F);return q}function ma(){var q=new cb(3);cb!=Float32Array&&(q[0]=0,q[1]=0,q[2]=0);return q}function P(q){var x=new cb(3);x[0]=q[0];x[1]=q[1];x[2]=q[2];return x}function N(q,x,C){var F=new cb(3);F[0]=q;F[1]=x;F[2]=C;return F}function da(q,x){q[0]=x[0];q[1]=x[1];q[2]=x[2];return q}function ua(q,x,C){q[0]=x[0]+C[0];q[1]=x[1]+C[1];q[2]=x[2]+C[2];return q}function ja(q,x,C){q[0]=x[0]*C;q[1]=x[1]*C;q[2]=x[2]*C;return q}function S(q,
x){var C=x[0],F=x[1],aa=x[2];C=C*C+F*F+aa*aa;0<C&&(C=1/Math.sqrt(C),q[0]=x[0]*C,q[1]=x[1]*C,q[2]=x[2]*C);return q}function sa(q,x){return q[0]*x[0]+q[1]*x[1]+q[2]*x[2]}function Ga(q,x,C){var F=x[0],aa=x[1];x=x[2];var pa=C[0],ra=C[1];C=C[2];q[0]=aa*C-x*ra;q[1]=x*pa-F*C;q[2]=F*ra-aa*pa;return q}function Ya(q,x,C){var F=C[0],aa=C[1],pa=C[2],ra=x[0],Ia=x[1];x=x[2];var $a=aa*x-pa*Ia,ab=pa*ra-F*x,eb=F*Ia-aa*ra;C=2*C[3];q[0]=ra+$a*C+2*(aa*eb-pa*ab);q[1]=Ia+ab*C+2*(pa*$a-F*eb);q[2]=x+eb*C+2*(F*ab-aa*$a);
return q}function Za(){var q=new cb(9);cb!=Float32Array&&(q[1]=0,q[2]=0,q[3]=0,q[5]=0,q[6]=0,q[7]=0);q[0]=1;q[4]=1;q[8]=1;return q}function Ca(){var q=new cb(4);cb!=Float32Array&&(q[0]=0,q[1]=0,q[2]=0,q[3]=0);return q}function na(){var q=new cb(4);cb!=Float32Array&&(q[0]=0,q[1]=0,q[2]=0);q[3]=1;return q}function Ea(q,x,C){var F=x[0],aa=x[1],pa=x[2];x=x[3];var ra=C[0],Ia=C[1],$a=C[2];C=C[3];q[0]=F*C+x*ra+aa*$a-pa*Ia;q[1]=aa*C+x*Ia+pa*ra-F*$a;q[2]=pa*C+x*$a+F*Ia-aa*ra;q[3]=x*C-F*ra-aa*Ia-pa*$a;return q}
function Ma(q,x,C,F){var aa=x[0],pa=x[1],ra=x[2];x=x[3];var Ia=C[0],$a=C[1],ab=C[2];C=C[3];var eb=aa*Ia+pa*$a+ra*ab+x*C;0>eb&&(eb=-eb,Ia=-Ia,$a=-$a,ab=-ab,C=-C);if(1E-6<1-eb){var Bb=Math.acos(eb);var Kb=Math.sin(Bb);eb=Math.sin((1-F)*Bb)/Kb;F=Math.sin(F*Bb)/Kb}else eb=1-F;q[0]=eb*aa+F*Ia;q[1]=eb*pa+F*$a;q[2]=eb*ra+F*ab;q[3]=eb*x+F*C;return q}function Q(q,x){var C=x[0],F=x[1],aa=x[2];x=x[3];var pa=C*C+F*F+aa*aa+x*x;pa=pa?1/pa:0;q[0]=-C*pa;q[1]=-F*pa;q[2]=-aa*pa;q[3]=x*pa;return q}function oa(q,x){q=
new Event(q,x);q[bf]={frame:x.frame,inputSource:x.inputSource};Object.setPrototypeOf(q,oa.prototype);Object.defineProperty(q,"frame",{get:function(){return this[bf].frame}});Object.defineProperty(q,"inputSource",{get:function(){return this[bf].inputSource}});return q}function Aa(q,x){q=new Event(q,x);q[ag]={session:x.session};Object.setPrototypeOf(q,Aa.prototype);Object.defineProperty(q,"session",{get:function(){return this[ag].session}});return q}function Wa(q,x){q=new Event(q,x);q[je]={session:x.session,
added:x.added,removed:x.removed};Object.setPrototypeOf(q,Wa.prototype);Object.defineProperty(q,"session",{get:function(){return this[je].session}});Object.defineProperty(q,"added",{get:function(){return this[je].added}});Object.defineProperty(q,"removed",{get:function(){return this[je].removed}});return q}function Ra(q,x){q=new Event(q,x);q[cf]={referenceSpace:x.referenceSpace,transform:x.transform||null};Object.setPrototypeOf(q,Ra.prototype);Object.defineProperty(q,"referenceSpace",{get:function(){return this[cf].referenceSpace}});
Object.defineProperty(q,"transform",{get:function(){return this[cf].transform}});return q}function Pa(q,x,C){function F($a,ab,eb){return $a<ab?ab:$a>eb?eb:$a}var aa=x[0]*x[0],pa=x[1]*x[1],ra=x[2]*x[2],Ia=x[3]*x[3];"XYZ"===C?(q[0]=Math.atan2(2*(x[0]*x[3]-x[1]*x[2]),Ia-aa-pa+ra),q[1]=Math.asin(F(2*(x[0]*x[2]+x[1]*x[3]),-1,1)),q[2]=Math.atan2(2*(x[2]*x[3]-x[0]*x[1]),Ia+aa-pa-ra)):"YXZ"===C?(q[0]=Math.asin(F(2*(x[0]*x[3]-x[1]*x[2]),-1,1)),q[1]=Math.atan2(2*(x[0]*x[2]+x[1]*x[3]),Ia-aa-pa+ra),q[2]=Math.atan2(2*
(x[0]*x[1]+x[2]*x[3]),Ia-aa+pa-ra)):"ZXY"===C?(q[0]=Math.asin(F(2*(x[0]*x[3]+x[1]*x[2]),-1,1)),q[1]=Math.atan2(2*(x[1]*x[3]-x[2]*x[0]),Ia-aa-pa+ra),q[2]=Math.atan2(2*(x[2]*x[3]-x[0]*x[1]),Ia-aa+pa-ra)):"ZYX"===C?(q[0]=Math.atan2(2*(x[0]*x[3]+x[2]*x[1]),Ia-aa-pa+ra),q[1]=Math.asin(F(2*(x[1]*x[3]-x[0]*x[2]),-1,1)),q[2]=Math.atan2(2*(x[0]*x[1]+x[2]*x[3]),Ia+aa-pa-ra)):"YZX"===C?(q[0]=Math.atan2(2*(x[0]*x[3]-x[2]*x[1]),Ia-aa+pa-ra),q[1]=Math.atan2(2*(x[1]*x[3]-x[0]*x[2]),Ia+aa-pa-ra),q[2]=Math.asin(F(2*
(x[0]*x[1]+x[2]*x[3]),-1,1))):"XZY"===C?(q[0]=Math.atan2(2*(x[0]*x[3]+x[1]*x[2]),Ia-aa+pa-ra),q[1]=Math.atan2(2*(x[0]*x[2]+x[1]*x[3]),Ia+aa-pa-ra),q[2]=Math.asin(F(2*(x[2]*x[3]-x[0]*x[1]),-1,1))):console.log("No order given for quaternion to euler conversion.")}var db="undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{},Oa=Symbol("@@webxr-polyfill/EventTarget");Y.prototype.addEventListener=function(q,x){if("string"!==typeof q)throw Error("`type` must be a string");
if("function"!==typeof x)throw Error("`listener` must be a function");var C=this[Oa].listeners.get(q)||[];C.push(x);this[Oa].listeners.set(q,C)};Y.prototype.removeEventListener=function(q,x){if("string"!==typeof q)throw Error("`type` must be a string");if("function"!==typeof x)throw Error("`listener` must be a function");q=this[Oa].listeners.get(q)||[];for(var C=q.length;0<=C;C--)q[C]===x&&q.pop()};Y.prototype.dispatchEvent=function(q,x){for(var C=this[Oa].listeners.get(q)||[],F=[],aa=0;aa<C.length;aa++)F[aa]=
C[aa];C=m.makeIterator(F);for(F=C.next();!F.done;F=C.next())F=F.value,F(x);if("function"===typeof this["on"+q])this["on"+q](x)};var cb="undefined"!==typeof Float32Array?Float32Array:Array;(function(){var q=ma();return function(x,C,F,aa,pa,ra){C||(C=3);F||(F=0);for(aa=aa?Math.min(aa*C+F,x.length):x.length;F<aa;F+=C)q[0]=x[F],q[1]=x[F+1],q[2]=x[F+2],pa(q,q,ra),x[F]=q[0],x[F+1]=q[1],x[F+2]=q[2];return x}})();(function(){var q=Ca();return function(x,C,F,aa,pa,ra){C||(C=4);F||(F=0);for(aa=aa?Math.min(aa*
C+F,x.length):x.length;F<aa;F+=C)q[0]=x[F],q[1]=x[F+1],q[2]=x[F+2],q[3]=x[F+3],pa(q,q,ra),x[F]=q[0],x[F+1]=q[1],x[F+2]=q[2],x[F+3]=q[3];return x}})();(function(){var q=ma(),x=N(1,0,0),C=N(0,1,0);return function(F,aa,pa){var ra=sa(aa,pa);if(-.999999>ra){Ga(q,x,aa);pa=q[0];ra=q[1];var Ia=q[2];1E-6>Math.sqrt(pa*pa+ra*ra+Ia*Ia)&&Ga(q,C,aa);S(q,q);aa=Math.PI;aa*=.5;pa=Math.sin(aa);F[0]=pa*q[0];F[1]=pa*q[1];F[2]=pa*q[2];F[3]=Math.cos(aa);return F}if(.999999<ra)return F[0]=0,F[1]=0,F[2]=0,F[3]=1,F;Ga(q,
aa,pa);F[0]=q[0];F[1]=q[1];F[2]=q[2];F[3]=1+ra;return ia(F,F)}})();(function(){var q=na(),x=na();return function(C,F,aa,pa,ra,Ia){Ma(q,F,ra,Ia);Ma(x,aa,pa,Ia);Ma(C,q,x,2*Ia*(1-Ia));return C}})();(function(){var q=Za();return function(x,C,F,aa){q[0]=F[0];q[3]=F[1];q[6]=F[2];q[1]=aa[0];q[4]=aa[1];q[7]=aa[2];q[2]=-C[0];q[5]=-C[1];q[8]=-C[2];C=q[0]+q[4]+q[8];if(0<C)C=Math.sqrt(C+1),x[3]=.5*C,C=.5/C,x[0]=(q[5]-q[7])*C,x[1]=(q[6]-q[2])*C,x[2]=(q[1]-q[3])*C;else{F=0;q[4]>q[0]&&(F=1);q[8]>q[3*F+F]&&(F=2);
aa=(F+1)%3;var pa=(F+2)%3;C=Math.sqrt(q[3*F+F]-q[3*aa+aa]-q[3*pa+pa]+1);x[F]=.5*C;C=.5/C;x[3]=(q[3*aa+pa]-q[3*pa+aa])*C;x[aa]=(q[3*aa+F]+q[3*F+aa])*C;x[pa]=(q[3*pa+F]+q[3*F+pa])*C}return ia(x,x)}})();if(!("DOMPointReadOnly"in window)){var hb=Symbol("@@webxr-polyfill/DOMPointReadOnly"),ob=function(q,x,C,F){if(1===arguments.length)this[hb]={x:q.x,y:q.y,z:q.z,w:q.w};else if(4===arguments.length)this[hb]={x:q,y:x,z:C,w:F};else throw new TypeError("Must supply either 1 or 4 arguments");};ob.fromPoint=
function(q){return new ob(q.x,q.y,q.z,q.w)};m.global.Object.defineProperties(ob.prototype,{x:{configurable:!0,enumerable:!0,get:function(){return this[hb].x}},y:{configurable:!0,enumerable:!0,get:function(){return this[hb].y}},z:{configurable:!0,enumerable:!0,get:function(){return this[hb].z}},w:{configurable:!0,enumerable:!0,get:function(){return this[hb].w}}});window.DOMPointReadOnly=ob}var Da=Symbol("@@webxr-polyfill/XRRigidTransform");U.prototype._getPoint=function(q){return q instanceof DOMPointReadOnly?
q:DOMPointReadOnly.fromPoint(q)};m.global.Object.defineProperties(U.prototype,{matrix:{configurable:!0,enumerable:!0,get:function(){return this[Da].matrix}},position:{configurable:!0,enumerable:!0,get:function(){return this[Da].position}},orientation:{configurable:!0,enumerable:!0,get:function(){return this[Da].orientation}},inverse:{configurable:!0,enumerable:!0,get:function(){if(null===this[Da].inverse){var q=fa(new Float32Array(16));ka(q,this[Da].matrix);this[Da].inverse=new U(q);this[Da].inverse[Da].inverse=
this}return this[Da].inverse}}});var L=Symbol("@@webxr-polyfill/XRSpace");I.prototype._ensurePoseUpdated=function(q,x){x!=this[L].lastFrameId&&(this[L].lastFrameId=x,this._onPoseUpdate(q))};I.prototype._onPoseUpdate=function(q){"viewer"==this[L].specialType&&(this._baseMatrix=q.getBasePoseMatrix())};I.prototype._getSpaceRelativeTransform=function(q){if(!this._inverseBaseMatrix||!q._baseMatrix)return null;var x=new Float32Array(16);qa(x,this._inverseBaseMatrix,q._baseMatrix);return new U(x)};m.global.Object.defineProperties(I.prototype,
{_specialType:{configurable:!0,enumerable:!0,get:function(){return this[L].specialType}},_inputSource:{configurable:!0,enumerable:!0,get:function(){return this[L].inputSource}},_baseMatrix:{configurable:!0,enumerable:!0,set:function(q){this[L].baseMatrix=q;this[L].inverseBaseMatrix=null},get:function(){!this[L].baseMatrix&&this[L].inverseBaseMatrix&&(this[L].baseMatrix=new Float32Array(16),ka(this[L].baseMatrix,this[L].inverseBaseMatrix));return this[L].baseMatrix}},_inverseBaseMatrix:{configurable:!0,
enumerable:!0,set:function(q){this[L].inverseBaseMatrix=q;this[L].baseMatrix=null},get:function(){!this[L].inverseBaseMatrix&&this[L].baseMatrix&&(this[L].inverseBaseMatrix=new Float32Array(16),ka(this[L].inverseBaseMatrix,this[L].baseMatrix));return this[L].inverseBaseMatrix}}});var ea=Symbol("@@webxr-polyfill/XRReferenceSpace"),va=["viewer","local","local-floor","bounded-floor","unbounded"];m.inherits(ta,I);ta.prototype._transformBasePoseMatrix=function(q,x){qa(q,this._inverseBaseMatrix,x)};ta.prototype._originOffsetMatrix=
function(){return this[ea].originOffset};ta.prototype._adjustForOriginOffset=function(q){var x=new Float32Array(16);ka(x,this[ea].originOffset);qa(q,x,q)};ta.prototype._getSpaceRelativeTransform=function(q){q=I.prototype._getSpaceRelativeTransform.call(this,q);this._adjustForOriginOffset(q.matrix);return new XRRigidTransform(q.matrix)};ta.prototype.getOffsetReferenceSpace=function(q){var x=new ta(this[ea].type,this[ea].transform,this[ea].bounds);qa(x[ea].originOffset,this[ea].originOffset,q.matrix);
return x};var wa=Symbol("@@webxr-polyfill/XR"),Ja=["inline","immersive-vr","immersive-ar"],Sa={inline:{requiredFeatures:["viewer"],optionalFeatures:[]},"immersive-vr":{requiredFeatures:["viewer","local"],optionalFeatures:[]},"immersive-ar":{requiredFeatures:["viewer","local"],optionalFeatures:[]}};m.inherits(ha,Y);ha.prototype.isSessionSupported=function(q){var x=this;return m.asyncExecutePromiseGeneratorProgram(function(C){return 1==C.nextAddress?x[wa].device?C.jumpTo(2):C.yield(x[wa].devicePromise,
2):"inline"!=q?C.return(Promise.resolve(x[wa].device.isSessionSupported(q))):C.return(Promise.resolve(!0))})};ha.prototype.requestSession=function(q,x){var C=this,F,aa,pa,ra,Ia,$a,ab,eb,Bb,Kb,Mb,Cb,Lb;return m.asyncExecutePromiseGeneratorProgram(function(qb){if(1==qb.nextAddress){if(C[wa].device)return qb.jumpTo(2);if("inline"!=q)throw Error("Polyfill Error: Must call navigator.xr.isSessionSupported() with any XRSessionMode\nor navigator.xr.requestSession('inline') prior to requesting an immersive\nsession. This is a limitation specific to the WebXR Polyfill and does not apply\nto native implementations of the API.");
return qb.yield(C[wa].devicePromise,2)}if(5!=qb.nextAddress){if(!Ja.includes(q))throw new TypeError("The provided value '"+q+"' is not a valid enum value of type XRSessionMode");F=Sa[q];aa=F.requiredFeatures.concat(x&&x.requiredFeatures?x.requiredFeatures:[]);pa=F.optionalFeatures.concat(x&&x.optionalFeatures?x.optionalFeatures:[]);ra=new Set;Ia=!1;$a=m.makeIterator(aa);for(ab=$a.next();!ab.done;ab=$a.next())eb=ab.value,C[wa].device.isFeatureSupported(eb)?ra.add(eb):(console.error("The required feature '"+
eb+"' is not supported"),Ia=!0);if(Ia)throw new DOMException("Session does not support some required features","NotSupportedError");Bb=m.makeIterator(pa);for(ab=Bb.next();!ab.done;ab=Bb.next())Kb=ab.value,C[wa].device.isFeatureSupported(Kb)?ra.add(Kb):console.log("The optional feature '"+Kb+"' is not supported");return qb.yield(C[wa].device.requestSession(q,ra),5)}Mb=qb.yieldResult;Cb=new XRSession(C[wa].device,q,Mb);"inline"==q?C[wa].inlineSessions.add(Cb):C[wa].immersiveSession=Cb;Lb=function(){"inline"==
q?C[wa].inlineSessions.delete(Cb):C[wa].immersiveSession=null;Cb.removeEventListener("end",Lb)};Cb.addEventListener("end",Lb);return qb.return(Cb)})};if(!1==="performance"in db){var Ua=Date.now();var fb=function(){return Date.now()-Ua}}else fb=function(){return performance.now()};var mb=fb,yb=Symbol("@@webxr-polyfill/XRPose");m.global.Object.defineProperties(ba.prototype,{transform:{configurable:!0,enumerable:!0,get:function(){return this[yb].transform}},emulatedPosition:{configurable:!0,enumerable:!0,
get:function(){return this[yb].emulatedPosition}}});var jb=Symbol("@@webxr-polyfill/XRViewerPose");m.inherits(M,ba);m.global.Object.defineProperties(M.prototype,{views:{configurable:!0,enumerable:!0,get:function(){return this[jb].views}}});var ub=Symbol("@@webxr-polyfill/XRViewport");m.global.Object.defineProperties(W.prototype,{x:{configurable:!0,enumerable:!0,get:function(){return this[ub].target.x}},y:{configurable:!0,enumerable:!0,get:function(){return this[ub].target.y}},width:{configurable:!0,
enumerable:!0,get:function(){return this[ub].target.width}},height:{configurable:!0,enumerable:!0,get:function(){return this[ub].target.height}}});var Gb=["left","right","none"],zb=Symbol("@@webxr-polyfill/XRView");J.prototype._getViewport=function(q){if(this[zb].device.getViewport(this[zb].sessionId,this.eye,q,this[zb].temp))return this[zb].viewport};m.global.Object.defineProperties(J.prototype,{eye:{configurable:!0,enumerable:!0,get:function(){return this[zb].eye}},projectionMatrix:{configurable:!0,
enumerable:!0,get:function(){return this[zb].device.getProjectionMatrix(this.eye)}},transform:{configurable:!0,enumerable:!0,get:function(){return this[zb].transform}}});var Hb=Symbol("@@webxr-polyfill/XRFrame"),ie=0;K.prototype.getViewerPose=function(q){if(!this[Hb].animationFrame)throw new DOMException("getViewerPose can only be called on XRFrame objects passed to XRSession.requestAnimationFrame callbacks.","InvalidStateError");if(!this[Hb].active)throw new DOMException("XRFrame access outside the callback that produced it is invalid.",
"InvalidStateError");var x=this[Hb].device,C=this[Hb].session;C[xa].viewerSpace._ensurePoseUpdated(x,this[Hb].id);q._ensurePoseUpdated(x,this[Hb].id);var F=q._getSpaceRelativeTransform(C[xa].viewerSpace),aa=[];C=m.makeIterator(C[xa].viewSpaces);for(var pa=C.next();!pa.done;pa=C.next()){pa=pa.value;pa._ensurePoseUpdated(x,this[Hb].id);var ra=q._getSpaceRelativeTransform(pa);pa=new J(x,ra,pa.eye,this[Hb].sessionId);aa.push(pa)}return new M(F,aa,!1)};K.prototype.getPose=function(q,x){if(!this[Hb].active)throw new DOMException("XRFrame access outside the callback that produced it is invalid.",
"InvalidStateError");var C=this[Hb].device;if("target-ray"===q._specialType||"grip"===q._specialType)return C.getInputPose(q._inputSource,x,q._specialType);q._ensurePoseUpdated(C,this[Hb].id);x._ensurePoseUpdated(C,this[Hb].id);return(q=x._getSpaceRelativeTransform(q))?new XRPose(q,!1):null};m.global.Object.defineProperties(K.prototype,{session:{configurable:!0,enumerable:!0,get:function(){return this[Hb].session}}});var Rc=Symbol("@@webxr-polyfill/XRRenderState"),Nh=Object.freeze({depthNear:.1,depthFar:1E3,
inlineVerticalFieldOfView:null,baseLayer:null});m.global.Object.defineProperties(H.prototype,{depthNear:{configurable:!0,enumerable:!0,get:function(){return this[Rc].config.depthNear}},depthFar:{configurable:!0,enumerable:!0,get:function(){return this[Rc].config.depthFar}},inlineVerticalFieldOfView:{configurable:!0,enumerable:!0,get:function(){return this[Rc].config.inlineVerticalFieldOfView}},baseLayer:{configurable:!0,enumerable:!0,get:function(){return this[Rc].config.baseLayer}}});var $f=Symbol("@@webxr-polyfill/polyfilled-xr-compatible"),
af=Symbol("@@webxr-polyfill/xr-compatible"),Qc=Symbol("@@webxr-polyfill/XRWebGLLayer"),Mh=Object.freeze({antialias:!0,depth:!1,stencil:!1,alpha:!0,multiview:!1,ignoreDepthValues:!1,framebufferScaleFactor:1});D.prototype.getViewport=function(q){return q._getViewport(this)};D.getNativeFramebufferScaleFactor=function(q){if(!q)throw new TypeError("getNativeFramebufferScaleFactor must be passed a session.");return q[xa].ended?0:1};m.global.Object.defineProperties(D.prototype,{context:{configurable:!0,
enumerable:!0,get:function(){return this[Qc].context}},antialias:{configurable:!0,enumerable:!0,get:function(){return this[Qc].config.antialias}},ignoreDepthValues:{configurable:!0,enumerable:!0,get:function(){return!0}},framebuffer:{configurable:!0,enumerable:!0,get:function(){return this[Qc].framebuffer}},framebufferWidth:{configurable:!0,enumerable:!0,get:function(){return this[Qc].context.drawingBufferWidth}},framebufferHeight:{configurable:!0,enumerable:!0,get:function(){return this[Qc].context.drawingBufferHeight}},
_session:{configurable:!0,enumerable:!0,get:function(){return this[Qc].session}}});var bf=Symbol("@@webxr-polyfill/XRInputSourceEvent"),ag=Symbol("@@webxr-polyfill/XRSessionEvent"),je=Symbol("@@webxr-polyfill/XRInputSourcesChangeEvent"),xa=Symbol("@@webxr-polyfill/XRSession");m.inherits(B,I);B.prototype._onPoseUpdate=function(q){this._inverseBaseMatrix=q.getBaseViewMatrix(this._specialType)};m.global.Object.defineProperties(B.prototype,{eye:{configurable:!0,enumerable:!0,get:function(){return this._specialType}}});
m.inherits(y,Y);y.prototype.requestReferenceSpace=function(q){var x=this,C,F;return m.asyncExecutePromiseGeneratorProgram(function(aa){if(1==aa.nextAddress){if(x[xa].ended)return aa.return();if(!va.includes(q))throw new TypeError("XRReferenceSpaceType must be one of "+va);if(!x[xa].device.doesSessionSupportReferenceSpace(x[xa].id,q))throw new DOMException("The "+q+" reference space is not supported by this session.","NotSupportedError");return"viewer"===q?aa.return(x[xa].viewerSpace):aa.yield(x[xa].device.requestFrameOfReferenceTransform(q),
2)}C=aa.yieldResult;if("bounded-floor"===q){if(!C)throw new DOMException(q+" XRReferenceSpace not supported by this device.","NotSupportedError");F=x[xa].device.requestStageBounds();if(!F)throw new DOMException(q+" XRReferenceSpace not supported by this device.","NotSupportedError");throw new DOMException("The WebXR polyfill does not support the "+q+" reference space yet.","NotSupportedError");}return aa.return(new ta(q,C))})};y.prototype.requestAnimationFrame=function(q){if(!this[xa].ended){var x=
++this[xa].frameHandle;this[xa].frameCallbacks.push({handle:x,callback:q,cancelled:!1});return x}};y.prototype.cancelAnimationFrame=function(q){var x=this[xa].frameCallbacks,C=x.findIndex(function(F){return F&&F.handle===q});-1<C&&(x[C].cancelled=!0,x.splice(C,1));if(x=this[xa].currentFrameCallbacks)C=x.findIndex(function(F){return F&&F.handle===q}),-1<C&&(x[C].cancelled=!0)};y.prototype.end=function(){var q=this;return m.asyncExecutePromiseGeneratorProgram(function(x){if(q[xa].ended)return x.return();
q[xa].immersive&&(q[xa].ended=!0,q[xa].device.removeEventListener("@@webxr-polyfill/vr-present-start",q[xa].onPresentationStart),q[xa].device.removeEventListener("@@webxr-polyfill/vr-present-end",q[xa].onPresentationEnd),q[xa].device.removeEventListener("@@webxr-polyfill/input-select-start",q[xa].onSelectStart),q[xa].device.removeEventListener("@@webxr-polyfill/input-select-end",q[xa].onSelectEnd),q.dispatchEvent("end",Aa("end",{session:q})));q[xa].stopDeviceFrameLoop();return x.return(q[xa].device.endSession(q[xa].id))})};
y.prototype.updateRenderState=function(q){if(this[xa].ended)throw Error("Can't call updateRenderState on an XRSession that has already ended.");if(q.baseLayer&&q.baseLayer._session!==this)throw Error("Called updateRenderState with a base layer that was created by a different session.");if(null!==q.inlineVerticalFieldOfView&&void 0!==q.inlineVerticalFieldOfView){if(this[xa].immersive)throw Error("inlineVerticalFieldOfView must not be set for an XRRenderState passed to updateRenderState for an immersive session.");
q.inlineVerticalFieldOfView=Math.min(3.13,Math.max(.01,q.inlineVerticalFieldOfView))}if(null===this[xa].pendingRenderState){var x=this[xa].activeRenderState;this[xa].pendingRenderState={depthNear:x.depthNear,depthFar:x.depthFar,inlineVerticalFieldOfView:x.inlineVerticalFieldOfView,baseLayer:x.baseLayer}}Object.assign(this[xa].pendingRenderState,q)};y.prototype._checkInputSourcesChange=function(){for(var q=[],x=[],C=this.inputSources,F=this[xa].currentInputSources,aa=m.makeIterator(C),pa=aa.next();!pa.done;pa=
aa.next())pa=pa.value,F.includes(pa)||q.push(pa);F=m.makeIterator(F);for(aa=F.next();!aa.done;aa=F.next())aa=aa.value,C.includes(aa)||x.push(aa);(0<q.length||0<x.length)&&this.dispatchEvent("inputsourceschange",Wa("inputsourceschange",{session:this,added:q,removed:x}));this[xa].currentInputSources.length=0;q=m.makeIterator(C);for(pa=q.next();!pa.done;pa=q.next())this[xa].currentInputSources.push(pa.value)};m.global.Object.defineProperties(y.prototype,{renderState:{configurable:!0,enumerable:!0,get:function(){return this[xa].activeRenderState}},
environmentBlendMode:{configurable:!0,enumerable:!0,get:function(){return this[xa].device.environmentBlendMode||"opaque"}},inputSources:{configurable:!0,enumerable:!0,get:function(){return this[xa].device.getInputSources()}}});var Jc=Symbol("@@webxr-polyfill/XRInputSource");m.global.Object.defineProperties(u.prototype,{handedness:{configurable:!0,enumerable:!0,get:function(){return this[Jc].impl.handedness}},targetRayMode:{configurable:!0,enumerable:!0,get:function(){return this[Jc].impl.targetRayMode}},
gripSpace:{configurable:!0,enumerable:!0,get:function(){var q=this[Jc].impl.targetRayMode;return"gaze"===q||"screen"===q?null:this[Jc].gripSpace}},targetRaySpace:{configurable:!0,enumerable:!0,get:function(){return this[Jc].targetRaySpace}},profiles:{configurable:!0,enumerable:!0,get:function(){return this[Jc].impl.profiles}},gamepad:{configurable:!0,enumerable:!0,get:function(){return this[Jc].impl.gamepad}}});var cf=Symbol("@@webxr-polyfill/XRReferenceSpaceEvent"),df={XRSystem:ha,XRSession:y,XRSessionEvent:Aa,
XRFrame:K,XRView:J,XRViewport:W,XRViewerPose:M,XRWebGLLayer:D,XRSpace:I,XRReferenceSpace:ta,XRReferenceSpaceEvent:Ra,XRInputSource:u,XRInputSourceEvent:oa,XRInputSourcesChangeEvent:Wa,XRRenderState:H,XRRigidTransform:U,XRPose:ba},ef="undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},Kh=function(q){return q&&q.__esModule&&Object.prototype.hasOwnProperty.call(q,"default")?q["default"]:q}(function(q,x){return x={exports:{}},q(x,x.exports),x.exports}(function(q){(function(x,
C){q.exports=C()})(ef,function(){function x(t,z,A,O){this.x=t||0;this.y=z||0;this.z=A||0;this.w=void 0!==O?O:1}function C(t,z,A){this.x=t||0;this.y=z||0;this.z=A||0}function F(t,z,A){if(z){for(var O=[],la=null,Z=0;Z<z.length;++Z){var ca=z[Z];switch(ca){case t.TEXTURE_BINDING_2D:case t.TEXTURE_BINDING_CUBE_MAP:var Ba=z[++Z];if(Ba<t.TEXTURE0||Ba>t.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit");O.push(null,null);break}la||(la=t.getParameter(t.ACTIVE_TEXTURE));
t.activeTexture(Ba);O.push(t.getParameter(ca),null);break;case t.ACTIVE_TEXTURE:la=t.getParameter(t.ACTIVE_TEXTURE);O.push(null);break;default:O.push(t.getParameter(ca))}}A(t);for(Z=0;Z<z.length;++Z){ca=z[Z];A=O[Z];switch(ca){case t.ACTIVE_TEXTURE:break;case t.ARRAY_BUFFER_BINDING:t.bindBuffer(t.ARRAY_BUFFER,A);break;case t.COLOR_CLEAR_VALUE:t.clearColor(A[0],A[1],A[2],A[3]);break;case t.COLOR_WRITEMASK:t.colorMask(A[0],A[1],A[2],A[3]);break;case t.CURRENT_PROGRAM:t.useProgram(A);break;case t.ELEMENT_ARRAY_BUFFER_BINDING:t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,
A);break;case t.FRAMEBUFFER_BINDING:t.bindFramebuffer(t.FRAMEBUFFER,A);break;case t.RENDERBUFFER_BINDING:t.bindRenderbuffer(t.RENDERBUFFER,A);break;case t.TEXTURE_BINDING_2D:Ba=z[++Z];if(Ba<t.TEXTURE0||Ba>t.TEXTURE31)break;t.activeTexture(Ba);t.bindTexture(t.TEXTURE_2D,A);break;case t.TEXTURE_BINDING_CUBE_MAP:Ba=z[++Z];if(Ba<t.TEXTURE0||Ba>t.TEXTURE31)break;t.activeTexture(Ba);t.bindTexture(t.TEXTURE_CUBE_MAP,A);break;case t.VIEWPORT:t.viewport(A[0],A[1],A[2],A[3]);break;case t.BLEND:case t.CULL_FACE:case t.DEPTH_TEST:case t.SCISSOR_TEST:case t.STENCIL_TEST:A?
t.enable(ca):t.disable(ca);break;default:console.log("No GL restore behavior for 0x"+ca.toString(16))}la&&t.activeTexture(la)}}else A(t)}function aa(t,z){ff(t,t+" has been deprecated. This may not work on native WebVR displays. "+(z?"Please use "+z+" instead.":""))}function pa(t){var z=t.indexOf("://");z=t.indexOf("/",-1!==z?z+3:0);-1===z&&(z=t.length);return t.substring(0,z)}function ra(t){if(Sb()){var z=t.style.width,A=t.style.height;t.style.width=parseInt(z)+1+"px";t.style.height=parseInt(A)+"px";
setTimeout(function(){t.style.width=z;t.style.height=A},100)}window.canvas=t}function Ia(t,z){for(var A in z)z.hasOwnProperty(A)&&(t[A]=z[A]);return t}function $a(){var t=!1,z=navigator.userAgent||navigator.vendor||window.opera;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(z)||
/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(z.substr(0,
4)))t=!0;return t}function ab(t,z){for(var A={},O=t.getProgramParameter(z,t.ACTIVE_UNIFORMS),la,Z=0;Z<O;Z++)la=t.getActiveUniform(z,Z).name.replace("[0]",""),A[la]=t.getUniformLocation(z,la);return A}function eb(t,z,A,O){var la=t.createShader(t.VERTEX_SHADER);t.shaderSource(la,z);t.compileShader(la);z=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(z,A);t.compileShader(z);A=t.createProgram();t.attachShader(A,la);t.attachShader(A,z);for(var Z in O)t.bindAttribLocation(A,O[Z],Z);t.linkProgram(A);t.deleteShader(la);
t.deleteShader(z);return A}function Bb(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.msExitFullscreen)document.msExitFullscreen();else return!1;return!0}function Kb(t){if(gf())return!1;if(t.requestFullscreen)t.requestFullscreen();else if(t.webkitRequestFullscreen)t.webkitRequestFullscreen();else if(t.mozRequestFullScreen)t.mozRequestFullScreen();
else if(t.msRequestFullscreen)t.msRequestFullscreen();else return!1;return!0}function Mb(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio}function Cb(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio}function Lb(){var t=90==window.orientation||-90==window.orientation;return bg()?!t:t}function qb(t,z,A,O){this.gl=t;this.cardboardUI=z;this.bufferScale=A;this.dirtySubmitFrameBindings=O;this.ctxAttribs=t.getContextAttributes();this.instanceExt=
t.getExtension("ANGLE_instanced_arrays");this.meshHeight=this.meshWidth=20;this.bufferWidth=t.drawingBufferWidth;this.bufferHeight=t.drawingBufferHeight;this.realBindFramebuffer=t.bindFramebuffer;this.realEnable=t.enable;this.realDisable=t.disable;this.realColorMask=t.colorMask;this.realClearColor=t.clearColor;this.realViewport=t.viewport;Sb()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(t.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(t.canvas.__proto__,
"height"));this.isPatched=!1;this.lastBoundFramebuffer=null;this.stencilTest=this.scissorTest=this.blend=this.depthTest=this.cullFace=!1;this.viewport=[0,0,0,0];this.colorMask=[!0,!0,!0,!0];this.clearColor=[0,0,0,0];this.attribs={position:0,texCoord:1};this.program=eb(t,"attribute vec2 position;\nattribute vec3 texCoord;\nvarying vec2 vTexCoord;\nuniform vec4 viewportOffsetScale[2];\nvoid main() {\n  vec4 viewport = viewportOffsetScale[int(texCoord.z)];\n  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;\n  gl_Position = vec4( position, 1.0, 1.0 );\n}",
"precision mediump float;\nuniform sampler2D diffuse;\nvarying vec2 vTexCoord;\nvoid main() {\n  gl_FragColor = texture2D(diffuse, vTexCoord);\n}",this.attribs);this.uniforms=ab(t,this.program);this.viewportOffsetScale=new Float32Array(8);this.setTextureBounds();this.vertexBuffer=t.createBuffer();this.indexBuffer=t.createBuffer();this.indexCount=0;this.renderTarget=t.createTexture();this.framebuffer=t.createFramebuffer();this.stencilBuffer=this.depthBuffer=this.depthStencilBuffer=null;this.ctxAttribs.depth&&
this.ctxAttribs.stencil?this.depthStencilBuffer=t.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=t.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=t.createRenderbuffer());this.patch();this.onResize()}function Qb(t){this.gl=t;this.attribs={position:0};this.program=eb(t,"attribute vec2 position;\nuniform mat4 projectionMat;\nvoid main() {\n  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );\n}","precision mediump float;\nuniform vec4 color;\nvoid main() {\n  gl_FragColor = color;\n}",
this.attribs);this.uniforms=ab(t,this.program);this.vertexBuffer=t.createBuffer();this.arrowVertexCount=this.arrowOffset=this.gearVertexCount=this.gearOffset=0;this.projMat=new Float32Array(16);this.listener=null;this.onResize()}function sb(t){this.coefficients=t}function vb(t){this.width=t.width||Cb();this.height=t.height||Mb();this.widthMeters=t.widthMeters;this.heightMeters=t.heightMeters;this.bevelMeters=t.bevelMeters}function bb(t,z){this.viewer=hf.CardboardV2;this.updateDeviceParams(t);this.distortion=
new sb(this.viewer.distortionCoefficients);for(t=0;t<z.length;t++){var A=z[t];hf[A.id]=new wb(A)}}function wb(t){this.id=t.id;this.label=t.label;this.fov=t.fov;this.interLensDistance=t.interLensDistance;this.baselineLensDistance=t.baselineLensDistance;this.screenLensDistance=t.screenLensDistance;this.distortionCoefficients=t.distortionCoefficients;this.inverseCoefficients=t.inverseCoefficients}function mc(t,z){this.dpdb=Oh;this.recalculateDeviceParams_();if(t){this.onDeviceParamsUpdated=z;var A=new XMLHttpRequest,
O=this;A.open("GET",t,!0);A.addEventListener("load",function(){O.loading=!1;200<=A.status&&299>=A.status?(O.dpdb=JSON.parse(A.response),O.recalculateDeviceParams_()):console.error("Error loading online DPDB!")});A.send()}}function Sc(t){this.xdpi=t.xdpi;this.ydpi=t.ydpi;this.bevelMm=t.bevelMm}function nc(t,z){this.set(t,z)}function bc(t,z){this.kFilter=t;this.isDebug=z;this.currentAccelMeasurement=new nc;this.currentGyroMeasurement=new nc;this.previousGyroMeasurement=new nc;Sb()?this.filterQ=new x(-1,
0,0,1):this.filterQ=new x(1,0,0,1);this.previousFilterQ=new x;this.previousFilterQ.copy(this.filterQ);this.accelQ=new x;this.isOrientationInitialized=!1;this.estimatedGravity=new C;this.measuredGravity=new C;this.gyroIntegralQ=new x}function Kc(t,z){this.predictionTimeS=t;this.isDebug=z;this.previousQ=new x;this.previousTimestampS=null;this.deltaQ=new x;this.outQ=new x}function Rb(t,z,A,O){this.yawOnly=A;this.accelerometer=new C;this.gyroscope=new C;this.filter=new bc(t,O);this.posePredictor=new Kc(z,
O);this.isFirefoxAndroid=Ph();this.isIOS=Sb();t=cg();this.isDeviceMotionInRadians=!this.isIOS&&t&&66>t;this.isWithoutDeviceMotion=Qh()||Rh();this.filterToWorldQ=new x;Sb()?this.filterToWorldQ.setFromAxisAngle(new C(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new C(1,0,0),-Math.PI/2);this.inverseWorldToScreenQ=new x;this.worldToScreenQ=new x;this.originalPoseAdjustQ=new x;this.originalPoseAdjustQ.setFromAxisAngle(new C(0,0,1),-window.orientation*Math.PI/180);this.setScreenTransform_();Lb()&&
this.filterToWorldQ.multiply(this.inverseWorldToScreenQ);this.resetQ=new x;this.orientationOut_=new Float32Array(4);this.start()}function cc(){this.loadIcon_();var t=document.createElement("div"),z=t.style;z.position="fixed";z.top=0;z.right=0;z.bottom=0;z.left=0;z.backgroundColor="gray";z.fontFamily="sans-serif";z.zIndex=1E6;var A=document.createElement("img");A.src=this.icon;z=A.style;z.marginLeft="25%";z.marginTop="25%";z.width="50%";t.appendChild(A);A=document.createElement("div");z=A.style;z.textAlign=
"center";z.fontSize="16px";z.lineHeight="24px";z.margin="24px 25%";z.width="50%";A.innerHTML="Place your phone into your Cardboard viewer.";t.appendChild(A);var O=document.createElement("div");z=O.style;z.backgroundColor="#CFD8DC";z.position="fixed";z.bottom=0;z.width="100%";z.height="48px";z.padding="14px 24px";z.boxSizing="border-box";z.color="#656A6B";t.appendChild(O);var la=document.createElement("div");la.style.float="left";la.innerHTML="No Cardboard viewer?";var Z=document.createElement("a");
Z.href="https://www.google.com/get/cardboard/get-cardboard/";Z.innerHTML="get one";Z.target="_blank";z=Z.style;z.float="right";z.fontWeight=600;z.textTransform="uppercase";z.borderLeft="1px solid gray";z.paddingLeft="24px";z.textDecoration="none";z.color="#656A6B";O.appendChild(la);O.appendChild(Z);this.overlay=t;this.text=A;this.hide()}function pb(t){try{this.selectedKey=localStorage.getItem("WEBVR_CARDBOARD_VIEWER")}catch(z){console.error("Failed to load viewer profile: %s",z)}this.selectedKey||
(this.selectedKey=t||"CardboardV1");this.dialog=this.createDialog_(bb.Viewers);this.root=null;this.onChangeCallbacks_=[]}function dg(t){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:t.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:t.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:t.canPresent},maxLayers:{writable:!1,enumerable:!0,value:t.maxLayers},hasOrientation:{enumerable:!0,get:function(){aa("VRDisplayCapabilities.prototype.hasOrientation",
"VRDisplay.prototype.getFrameData");return t.hasOrientation}}})}function Eb(t){t=t||{};t="wakelock"in t?t.wakelock:!0;this.isPolyfilled=!0;this.displayId=Sh++;this.displayName="";this.depthNear=.01;this.depthFar=1E4;this.isPresenting=!1;Object.defineProperty(this,"isConnected",{get:function(){aa("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay");return!1}});this.capabilities=new dg({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1});
this.stageParameters=null;this.waitingForPresent_=!1;this.fullscreenErrorHandler_=this.fullscreenChangeHandler_=this.fullscreenEventTarget_=this.fullscreenElementCachedStyle_=this.fullscreenWrapper_=this.fullscreenElement_=this.originalParent_=this.layer_=null;t&&$a()&&(this.wakelock_=new Th)}function Nb(t){var z=Ia({},Uh);t=Ia(z,t||{});Eb.call(this,{wakelock:t.MOBILE_WAKE_LOCK});this.config=t;this.displayName="Cardboard VRDisplay";this.capabilities=new dg({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,
canPresent:!0,maxLayers:1});this.stageParameters=null;this.bufferScale_=this.config.BUFFER_SCALE;this.poseSensor_=new Vh(this.config);this.cardboardUI_=this.distorter_=null;this.dpdb_=new mc(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this));this.deviceInfo_=new bb(this.dpdb_.getDeviceParams(),t.ADDITIONAL_VIEWERS);this.viewerSelector_=new pb(t.DEFAULT_VIEWER);this.viewerSelector_.onChange(this.onViewerChanged_.bind(this));this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer());
this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new cc);Sb()&&window.addEventListener("resize",this.onResize_.bind(this))}var Wh=function(){function t(z,A){for(var O=0;O<A.length;O++){var la=A[O];la.enumerable=la.enumerable||!1;la.configurable=!0;"value"in la&&(la.writable=!0);Object.defineProperty(z,la.key,la)}}return function(z,A,O){A&&t(z.prototype,A);O&&t(z,O);return z}}(),Xh=function(){return function(t,z){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t)){var A=
[],O=!0,la=!1,Z=void 0;try{for(var ca=t[Symbol.iterator](),Ba;!(O=(Ba=ca.next()).done)&&(A.push(Ba.value),!z||A.length!==z);O=!0);}catch(Na){la=!0,Z=Na}finally{try{if(!O&&ca["return"])ca["return"]()}finally{if(la)throw Z;}}return A}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),Sb=function(){var t=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return t}}(),gf=function(){var t=-1!==navigator.userAgent.indexOf("Version")&&-1!==navigator.userAgent.indexOf("Android")&&
-1!==navigator.userAgent.indexOf("Chrome");return function(){return t}}(),Yh=function(){var t=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return t}}(),Ph=function(){var t=-1!==navigator.userAgent.indexOf("Firefox")&&-1!==navigator.userAgent.indexOf("Android");return function(){return t}}(),cg=function(){var t=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),z=t?parseInt(t[1],10):null;return function(){return z}}(),Rh=function(){var t=!1;t=Sb()&&Yh()&&-1!==navigator.userAgent.indexOf("13_4");
return function(){return t}}(),Qh=function(){var t=!1;if(65===cg()){var z=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(z){z=z[1].split(".");z=Xh(z,4);var A=z[3];t=3325===parseInt(z[2],10)&&148>parseInt(A,10)}}return function(){return t}}(),bg=function(){var t=-1!==navigator.userAgent.indexOf("R7 Build");return function(){return t}}(),Zh=function(){function t(Z,ca,Ba,Na,Ka,Ta){var Xa=Na||null;Na=Ta.depthNear;Ta=Ta.depthFar;var kb=Math.tan(Xa?Xa.upDegrees*z:A),xb=Math.tan(Xa?Xa.downDegrees*
z:A),Ib=Math.tan(Xa?Xa.leftDegrees*z:A);Xa=Math.tan(Xa?Xa.rightDegrees*z:A);var lb=2/(Ib+Xa),Fb=2/(kb+xb);Z[0]=lb;Z[1]=0;Z[2]=0;Z[3]=0;Z[4]=0;Z[5]=Fb;Z[6]=0;Z[7]=0;Z[8]=-((Ib-Xa)*lb*.5);Z[9]=(kb-xb)*Fb*.5;Z[10]=Ta/(Na-Ta);Z[11]=-1;Z[12]=0;Z[13]=0;Z[14]=Ta*Na/(Na-Ta);Z[15]=0;Z=Ba.orientation||O;Ba=Ba.position||la;xb=Z[0];lb=Z[1];Fb=Z[2];Ta=Z[3];var Wb=xb+xb;Xa=lb+lb;kb=Fb+Fb;Z=xb*Wb;Na=xb*Xa;xb*=kb;Ib=lb*Xa;lb*=kb;Fb*=kb;Wb*=Ta;Xa*=Ta;Ta*=kb;ca[0]=1-(Ib+Fb);ca[1]=Na+Ta;ca[2]=xb-Xa;ca[3]=0;ca[4]=Na-
Ta;ca[5]=1-(Z+Fb);ca[6]=lb+Wb;ca[7]=0;ca[8]=xb+Xa;ca[9]=lb-Wb;ca[10]=1-(Z+Ib);ca[11]=0;ca[12]=Ba[0];ca[13]=Ba[1];ca[14]=Ba[2];ca[15]=1;if(Ka)if(Ba=Ka[0],Z=Ka[1],Ka=Ka[2],ca===ca)ca[12]=ca[0]*Ba+ca[4]*Z+ca[8]*Ka+ca[12],ca[13]=ca[1]*Ba+ca[5]*Z+ca[9]*Ka+ca[13],ca[14]=ca[2]*Ba+ca[6]*Z+ca[10]*Ka+ca[14],ca[15]=ca[3]*Ba+ca[7]*Z+ca[11]*Ka+ca[15];else{Na=ca[0];Ta=ca[1];kb=ca[2];xb=ca[3];Ib=ca[4];Xa=ca[5];lb=ca[6];Fb=ca[7];Wb=ca[8];var zc=ca[9];var Ac=ca[10];var Bc=ca[11];ca[0]=Na;ca[1]=Ta;ca[2]=kb;ca[3]=xb;
ca[4]=Ib;ca[5]=Xa;ca[6]=lb;ca[7]=Fb;ca[8]=Wb;ca[9]=zc;ca[10]=Ac;ca[11]=Bc;ca[12]=Na*Ba+Ib*Z+Wb*Ka+ca[12];ca[13]=Ta*Ba+Xa*Z+zc*Ka+ca[13];ca[14]=kb*Ba+lb*Z+Ac*Ka+ca[14];ca[15]=xb*Ba+Fb*Z+Bc*Ka+ca[15]}Ka=ca[0];Ba=ca[1];Z=ca[2];Na=ca[3];Ta=ca[4];kb=ca[5];xb=ca[6];Ib=ca[7];Xa=ca[8];lb=ca[9];Fb=ca[10];Wb=ca[11];zc=ca[12];Ac=ca[13];Bc=ca[14];var hd=ca[15],vd=Ka*kb-Ba*Ta,wd=Ka*xb-Z*Ta,xd=Ka*Ib-Na*Ta,yd=Ba*xb-Z*kb,zd=Ba*Ib-Na*kb,Ad=Z*Ib-Na*xb,Bd=Xa*Ac-lb*zc,Cd=Xa*Bc-Fb*zc,Dd=Xa*hd-Wb*zc,Ed=lb*Bc-Fb*Ac,Fd=
lb*hd-Wb*Ac,Gd=Fb*hd-Wb*Bc,Ob=vd*Gd-wd*Fd+xd*Ed+yd*Dd-zd*Cd+Ad*Bd;Ob&&(Ob=1/Ob,ca[0]=(kb*Gd-xb*Fd+Ib*Ed)*Ob,ca[1]=(Z*Fd-Ba*Gd-Na*Ed)*Ob,ca[2]=(Ac*Ad-Bc*zd+hd*yd)*Ob,ca[3]=(Fb*zd-lb*Ad-Wb*yd)*Ob,ca[4]=(xb*Dd-Ta*Gd-Ib*Cd)*Ob,ca[5]=(Ka*Gd-Z*Dd+Na*Cd)*Ob,ca[6]=(Bc*xd-zc*Ad-hd*wd)*Ob,ca[7]=(Xa*Ad-Fb*xd+Wb*wd)*Ob,ca[8]=(Ta*Fd-kb*Dd+Ib*Bd)*Ob,ca[9]=(Ba*Dd-Ka*Fd-Na*Bd)*Ob,ca[10]=(zc*zd-Ac*xd+hd*vd)*Ob,ca[11]=(lb*xd-Xa*zd-Wb*vd)*Ob,ca[12]=(kb*Cd-Ta*Ed-xb*Bd)*Ob,ca[13]=(Ka*Ed-Ba*Cd+Z*Bd)*Ob,ca[14]=(Ac*wd-zc*
yd-Bc*vd)*Ob,ca[15]=(Xa*yd-lb*wd+Fb*vd)*Ob)}var z=Math.PI/180,A=.25*Math.PI,O=new Float32Array([0,0,0,1]),la=new Float32Array([0,0,0]);return function(Z,ca,Ba){if(!Z||!ca)return!1;Z.pose=ca;Z.timestamp=ca.timestamp;t(Z.leftProjectionMatrix,Z.leftViewMatrix,ca,Ba._getFieldOfView("left"),Ba._getEyeOffset("left"),Ba);t(Z.rightProjectionMatrix,Z.rightViewMatrix,ca,Ba._getFieldOfView("right"),Ba._getEyeOffset("right"),Ba);return!0}}(),ff=function(){var t={};return function(z,A){void 0===t[z]&&(console.warn("webvr-polyfill: "+
A),t[z]=!0)}}();qb.prototype.destroy=function(){var t=this.gl;this.unpatch();t.deleteProgram(this.program);t.deleteBuffer(this.vertexBuffer);t.deleteBuffer(this.indexBuffer);t.deleteTexture(this.renderTarget);t.deleteFramebuffer(this.framebuffer);this.depthStencilBuffer&&t.deleteRenderbuffer(this.depthStencilBuffer);this.depthBuffer&&t.deleteRenderbuffer(this.depthBuffer);this.stencilBuffer&&t.deleteRenderbuffer(this.stencilBuffer);this.cardboardUI&&this.cardboardUI.destroy()};qb.prototype.onResize=
function(){var t=this.gl,z=this;F(t,[t.RENDERBUFFER_BINDING,t.TEXTURE_BINDING_2D,t.TEXTURE0],function(A){z.realBindFramebuffer.call(A,A.FRAMEBUFFER,null);z.scissorTest&&z.realDisable.call(A,A.SCISSOR_TEST);z.realColorMask.call(A,!0,!0,!0,!0);z.realViewport.call(A,0,0,A.drawingBufferWidth,A.drawingBufferHeight);z.realClearColor.call(A,0,0,0,1);A.clear(A.COLOR_BUFFER_BIT);z.realBindFramebuffer.call(A,A.FRAMEBUFFER,z.framebuffer);A.bindTexture(A.TEXTURE_2D,z.renderTarget);A.texImage2D(A.TEXTURE_2D,0,
z.ctxAttribs.alpha?A.RGBA:A.RGB,z.bufferWidth,z.bufferHeight,0,z.ctxAttribs.alpha?A.RGBA:A.RGB,A.UNSIGNED_BYTE,null);A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.LINEAR);A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.LINEAR);A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE);A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE);A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_2D,z.renderTarget,0);z.ctxAttribs.depth&&z.ctxAttribs.stencil?(A.bindRenderbuffer(A.RENDERBUFFER,
z.depthStencilBuffer),A.renderbufferStorage(A.RENDERBUFFER,A.DEPTH_STENCIL,z.bufferWidth,z.bufferHeight),A.framebufferRenderbuffer(A.FRAMEBUFFER,A.DEPTH_STENCIL_ATTACHMENT,A.RENDERBUFFER,z.depthStencilBuffer)):z.ctxAttribs.depth?(A.bindRenderbuffer(A.RENDERBUFFER,z.depthBuffer),A.renderbufferStorage(A.RENDERBUFFER,A.DEPTH_COMPONENT16,z.bufferWidth,z.bufferHeight),A.framebufferRenderbuffer(A.FRAMEBUFFER,A.DEPTH_ATTACHMENT,A.RENDERBUFFER,z.depthBuffer)):z.ctxAttribs.stencil&&(A.bindRenderbuffer(A.RENDERBUFFER,
z.stencilBuffer),A.renderbufferStorage(A.RENDERBUFFER,A.STENCIL_INDEX8,z.bufferWidth,z.bufferHeight),A.framebufferRenderbuffer(A.FRAMEBUFFER,A.STENCIL_ATTACHMENT,A.RENDERBUFFER,z.stencilBuffer));!A.checkFramebufferStatus(A.FRAMEBUFFER)===A.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!");z.realBindFramebuffer.call(A,A.FRAMEBUFFER,z.lastBoundFramebuffer);z.scissorTest&&z.realEnable.call(A,A.SCISSOR_TEST);z.realColorMask.apply(A,z.colorMask);z.realViewport.apply(A,z.viewport);z.realClearColor.apply(A,
z.clearColor)});if(this.cardboardUI)this.cardboardUI.onResize()};qb.prototype.patch=function(){if(!this.isPatched){var t=this,z=this.gl.canvas,A=this.gl;Sb()||(z.width=Cb()*this.bufferScale,z.height=Mb()*this.bufferScale,Object.defineProperty(z,"width",{configurable:!0,enumerable:!0,get:function(){return t.bufferWidth},set:function(O){t.bufferWidth=O;t.realCanvasWidth.set.call(z,O);t.onResize()}}),Object.defineProperty(z,"height",{configurable:!0,enumerable:!0,get:function(){return t.bufferHeight},
set:function(O){t.bufferHeight=O;t.realCanvasHeight.set.call(z,O);t.onResize()}}));this.lastBoundFramebuffer=A.getParameter(A.FRAMEBUFFER_BINDING);null==this.lastBoundFramebuffer&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(A.FRAMEBUFFER,this.framebuffer));this.gl.bindFramebuffer=function(O,la){t.lastBoundFramebuffer=la?la:t.framebuffer;t.realBindFramebuffer.call(A,O,t.lastBoundFramebuffer)};this.cullFace=A.getParameter(A.CULL_FACE);this.depthTest=A.getParameter(A.DEPTH_TEST);
this.blend=A.getParameter(A.BLEND);this.scissorTest=A.getParameter(A.SCISSOR_TEST);this.stencilTest=A.getParameter(A.STENCIL_TEST);A.enable=function(O){switch(O){case A.CULL_FACE:t.cullFace=!0;break;case A.DEPTH_TEST:t.depthTest=!0;break;case A.BLEND:t.blend=!0;break;case A.SCISSOR_TEST:t.scissorTest=!0;break;case A.STENCIL_TEST:t.stencilTest=!0}t.realEnable.call(A,O)};A.disable=function(O){switch(O){case A.CULL_FACE:t.cullFace=!1;break;case A.DEPTH_TEST:t.depthTest=!1;break;case A.BLEND:t.blend=
!1;break;case A.SCISSOR_TEST:t.scissorTest=!1;break;case A.STENCIL_TEST:t.stencilTest=!1}t.realDisable.call(A,O)};this.colorMask=A.getParameter(A.COLOR_WRITEMASK);A.colorMask=function(O,la,Z,ca){t.colorMask[0]=O;t.colorMask[1]=la;t.colorMask[2]=Z;t.colorMask[3]=ca;t.realColorMask.call(A,O,la,Z,ca)};this.clearColor=A.getParameter(A.COLOR_CLEAR_VALUE);A.clearColor=function(O,la,Z,ca){t.clearColor[0]=O;t.clearColor[1]=la;t.clearColor[2]=Z;t.clearColor[3]=ca;t.realClearColor.call(A,O,la,Z,ca)};this.viewport=
A.getParameter(A.VIEWPORT);A.viewport=function(O,la,Z,ca){t.viewport[0]=O;t.viewport[1]=la;t.viewport[2]=Z;t.viewport[3]=ca;t.realViewport.call(A,O,la,Z,ca)};this.isPatched=!0;ra(z)}};qb.prototype.unpatch=function(){if(this.isPatched){var t=this.gl,z=this.gl.canvas;Sb()||(Object.defineProperty(z,"width",this.realCanvasWidth),Object.defineProperty(z,"height",this.realCanvasHeight));z.width=this.bufferWidth;z.height=this.bufferHeight;t.bindFramebuffer=this.realBindFramebuffer;t.enable=this.realEnable;
t.disable=this.realDisable;t.colorMask=this.realColorMask;t.clearColor=this.realClearColor;t.viewport=this.realViewport;this.lastBoundFramebuffer==this.framebuffer&&t.bindFramebuffer(t.FRAMEBUFFER,null);this.isPatched=!1;setTimeout(function(){ra(z)},1)}};qb.prototype.setTextureBounds=function(t,z){t||(t=[0,0,.5,1]);z||(z=[.5,0,.5,1]);this.viewportOffsetScale[0]=t[0];this.viewportOffsetScale[1]=t[1];this.viewportOffsetScale[2]=t[2];this.viewportOffsetScale[3]=t[3];this.viewportOffsetScale[4]=z[0];
this.viewportOffsetScale[5]=z[1];this.viewportOffsetScale[6]=z[2];this.viewportOffsetScale[7]=z[3]};qb.prototype.submitFrame=function(){var t=this.gl,z=this,A=[];this.dirtySubmitFrameBindings||A.push(t.CURRENT_PROGRAM,t.ARRAY_BUFFER_BINDING,t.ELEMENT_ARRAY_BUFFER_BINDING,t.TEXTURE_BINDING_2D,t.TEXTURE0);F(t,A,function(O){z.realBindFramebuffer.call(O,O.FRAMEBUFFER,null);var la=0,Z=0;z.instanceExt&&(la=O.getVertexAttrib(z.attribs.position,z.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),Z=O.getVertexAttrib(z.attribs.texCoord,
z.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE));z.cullFace&&z.realDisable.call(O,O.CULL_FACE);z.depthTest&&z.realDisable.call(O,O.DEPTH_TEST);z.blend&&z.realDisable.call(O,O.BLEND);z.scissorTest&&z.realDisable.call(O,O.SCISSOR_TEST);z.stencilTest&&z.realDisable.call(O,O.STENCIL_TEST);z.realColorMask.call(O,!0,!0,!0,!0);z.realViewport.call(O,0,0,O.drawingBufferWidth,O.drawingBufferHeight);if(z.ctxAttribs.alpha||Sb())z.realClearColor.call(O,0,0,0,1),O.clear(O.COLOR_BUFFER_BIT);O.useProgram(z.program);
O.bindBuffer(O.ELEMENT_ARRAY_BUFFER,z.indexBuffer);O.bindBuffer(O.ARRAY_BUFFER,z.vertexBuffer);O.enableVertexAttribArray(z.attribs.position);O.enableVertexAttribArray(z.attribs.texCoord);O.vertexAttribPointer(z.attribs.position,2,O.FLOAT,!1,20,0);O.vertexAttribPointer(z.attribs.texCoord,3,O.FLOAT,!1,20,8);z.instanceExt&&(0!=la&&z.instanceExt.vertexAttribDivisorANGLE(z.attribs.position,0),0!=Z&&z.instanceExt.vertexAttribDivisorANGLE(z.attribs.texCoord,0));O.activeTexture(O.TEXTURE0);O.uniform1i(z.uniforms.diffuse,
0);O.bindTexture(O.TEXTURE_2D,z.renderTarget);O.uniform4fv(z.uniforms.viewportOffsetScale,z.viewportOffsetScale);O.drawElements(O.TRIANGLES,z.indexCount,O.UNSIGNED_SHORT,0);z.cardboardUI&&z.cardboardUI.renderNoState();z.realBindFramebuffer.call(z.gl,O.FRAMEBUFFER,z.framebuffer);z.ctxAttribs.preserveDrawingBuffer||(z.realClearColor.call(O,0,0,0,0),O.clear(O.COLOR_BUFFER_BIT));z.dirtySubmitFrameBindings||z.realBindFramebuffer.call(O,O.FRAMEBUFFER,z.lastBoundFramebuffer);z.cullFace&&z.realEnable.call(O,
O.CULL_FACE);z.depthTest&&z.realEnable.call(O,O.DEPTH_TEST);z.blend&&z.realEnable.call(O,O.BLEND);z.scissorTest&&z.realEnable.call(O,O.SCISSOR_TEST);z.stencilTest&&z.realEnable.call(O,O.STENCIL_TEST);z.realColorMask.apply(O,z.colorMask);z.realViewport.apply(O,z.viewport);!z.ctxAttribs.alpha&&z.ctxAttribs.preserveDrawingBuffer||z.realClearColor.apply(O,z.clearColor);z.instanceExt&&(0!=la&&z.instanceExt.vertexAttribDivisorANGLE(z.attribs.position,la),0!=Z&&z.instanceExt.vertexAttribDivisorANGLE(z.attribs.texCoord,
Z))});Sb()&&(t=t.canvas,t.width!=z.bufferWidth||t.height!=z.bufferHeight)&&(z.bufferWidth=t.width,z.bufferHeight=t.height,z.onResize())};qb.prototype.updateDeviceInfo=function(t){var z=this.gl,A=this;F(z,[z.ARRAY_BUFFER_BINDING,z.ELEMENT_ARRAY_BUFFER_BINDING],function(O){var la=A.computeMeshVertices_(A.meshWidth,A.meshHeight,t);O.bindBuffer(O.ARRAY_BUFFER,A.vertexBuffer);O.bufferData(O.ARRAY_BUFFER,la,O.STATIC_DRAW);A.indexCount||(la=A.computeMeshIndices_(A.meshWidth,A.meshHeight),O.bindBuffer(O.ELEMENT_ARRAY_BUFFER,
A.indexBuffer),O.bufferData(O.ELEMENT_ARRAY_BUFFER,la,O.STATIC_DRAW),A.indexCount=la.length)})};qb.prototype.computeMeshVertices_=function(t,z,A){for(var O=new Float32Array(2*t*z*5),la=A.getLeftEyeVisibleTanAngles(),Z=A.getLeftEyeNoLensTanAngles(),ca=A.getLeftEyeVisibleScreenRect(Z),Ba=0,Na=0;2>Na;Na++){for(var Ka=0;Ka<z;Ka++)for(var Ta=0;Ta<t;Ta++,Ba++){var Xa=Ta/(t-1),kb=Ka/(z-1),xb=Xa,Ib=kb,lb=la[0];Xa=lb+(la[2]-lb)*Xa;lb=la[3];var Fb=lb+(la[1]-lb)*kb;kb=Math.sqrt(Xa*Xa+Fb*Fb);lb=A.distortion.distortInverse(kb);
Fb=Fb*lb/kb;Xa=(Xa*lb/kb-Z[0])/(Z[2]-Z[0]);kb=(Fb-Z[3])/(Z[1]-Z[3]);Xa=2*(ca.x+Xa*ca.width-.5);kb=2*(ca.y+kb*ca.height-.5);O[5*Ba]=Xa;O[5*Ba+1]=kb;O[5*Ba+2]=xb;O[5*Ba+3]=Ib;O[5*Ba+4]=Na}Ka=la[2]-la[0];la[0]=-(Ka+la[0]);la[2]=Ka-la[2];Ka=Z[2]-Z[0];Z[0]=-(Ka+Z[0]);Z[2]=Ka-Z[2];ca.x=1-(ca.x+ca.width)}return O};qb.prototype.computeMeshIndices_=function(t,z){for(var A=new Uint16Array(2*(t-1)*(z-1)*6),O=t/2,la=z/2,Z=0,ca=0,Ba=0;2>Ba;Ba++)for(var Na=0;Na<z;Na++)for(var Ka=0;Ka<t;Ka++,Z++)0!=Ka&&0!=Na&&(Ka<=
O==Na<=la?(A[ca++]=Z,A[ca++]=Z-t-1,A[ca++]=Z-t,A[ca++]=Z-t-1,A[ca++]=Z,A[ca++]=Z-1):(A[ca++]=Z-1,A[ca++]=Z-t,A[ca++]=Z,A[ca++]=Z-t,A[ca++]=Z-1,A[ca++]=Z-t-1));return A};qb.prototype.getOwnPropertyDescriptor_=function(t,z){t=Object.getOwnPropertyDescriptor(t,z);if(void 0===t.get||void 0===t.set)t.configurable=!0,t.enumerable=!0,t.get=function(){return this.getAttribute(z)},t.set=function(A){this.setAttribute(z,A)};return t};var eg=Math.PI/180;Qb.prototype.destroy=function(){var t=this.gl;this.listener&&
t.canvas.removeEventListener("click",this.listener,!1);t.deleteProgram(this.program);t.deleteBuffer(this.vertexBuffer)};Qb.prototype.listen=function(t,z){var A=this.gl.canvas;this.listener=function(O){var la=A.clientWidth/2,Z=O.touches?O.touches[0].clientX:O.clientX,ca=O.touches?O.touches[0].clientY:O.clientY;Z>la-42&&Z<la+42&&ca>A.clientHeight-42?t(O):42>Z&&42>ca&&z(O)};A.addEventListener("click",this.listener,!1);A.addEventListener("touchstart",this.listener,!1)};Qb.prototype.onResize=function(){var t=
this.gl,z=this;F(t,[t.ARRAY_BUFFER_BINDING],function(A){function O(xb,Ib){var lb=(90-xb)*eg;xb=Math.cos(lb);lb=Math.sin(lb);Z.push(.3125*xb*Ta+ca,.3125*lb*Ta+Ta);Z.push(Ib*xb*Ta+ca,Ib*lb*Ta+Ta)}function la(xb,Ib){Z.push(Xa+xb,A.drawingBufferHeight-Xa-Ib)}var Z=[],ca=A.drawingBufferWidth/2,Ba=A.drawingBufferWidth/(Math.max(screen.width,screen.height)*window.devicePixelRatio)*window.devicePixelRatio,Na=4*Ba/2,Ka=42*Ba,Ta=28*Ba/2,Xa=14*Ba;Z.push(ca-Na,Ka);Z.push(ca-Na,A.drawingBufferHeight);Z.push(ca+
Na,Ka);Z.push(ca+Na,A.drawingBufferHeight);z.gearOffset=Z.length/2;for(Ka=0;6>=Ka;Ka++){var kb=60*Ka;O(kb,1);O(kb+12,1);O(kb+20,.75);O(kb+40,.75);O(kb+48,1)}z.gearVertexCount=Z.length/2-z.gearOffset;z.arrowOffset=Z.length/2;Ka=Na/Math.sin(45*eg);la(0,Ta);la(Ta,0);la(Ta+Ka,Ka);la(Ka,Ta+Ka);la(Ka,Ta-Ka);la(0,Ta);la(Ta,2*Ta);la(Ta+Ka,2*Ta-Ka);la(Ka,Ta-Ka);la(0,Ta);la(Ka,Ta-Na);la(28*Ba,Ta-Na);la(Ka,Ta+Na);la(28*Ba,Ta+Na);z.arrowVertexCount=Z.length/2-z.arrowOffset;A.bindBuffer(A.ARRAY_BUFFER,z.vertexBuffer);
A.bufferData(A.ARRAY_BUFFER,new Float32Array(Z),A.STATIC_DRAW)})};Qb.prototype.render=function(){var t=this.gl,z=this;F(t,[t.CULL_FACE,t.DEPTH_TEST,t.BLEND,t.SCISSOR_TEST,t.STENCIL_TEST,t.COLOR_WRITEMASK,t.VIEWPORT,t.CURRENT_PROGRAM,t.ARRAY_BUFFER_BINDING],function(A){A.disable(A.CULL_FACE);A.disable(A.DEPTH_TEST);A.disable(A.BLEND);A.disable(A.SCISSOR_TEST);A.disable(A.STENCIL_TEST);A.colorMask(!0,!0,!0,!0);A.viewport(0,0,A.drawingBufferWidth,A.drawingBufferHeight);z.renderNoState()})};Qb.prototype.renderNoState=
function(){var t=this.gl;t.useProgram(this.program);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);t.enableVertexAttribArray(this.attribs.position);t.vertexAttribPointer(this.attribs.position,2,t.FLOAT,!1,8,0);t.uniform4f(this.uniforms.color,1,1,1,1);var z=this.projMat,A=t.drawingBufferWidth,O=t.drawingBufferHeight,la=1/(0-A),Z=1/(0-O),ca=1/-1023.9;z[0]=-2*la;z[1]=0;z[2]=0;z[3]=0;z[4]=0;z[5]=-2*Z;z[6]=0;z[7]=0;z[8]=0;z[9]=0;z[10]=2*ca;z[11]=0;z[12]=(0+A)*la;z[13]=(O+0)*Z;z[14]=1024.1*ca;z[15]=1;t.uniformMatrix4fv(this.uniforms.projectionMat,
!1,this.projMat);t.drawArrays(t.TRIANGLE_STRIP,0,4);t.drawArrays(t.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount);t.drawArrays(t.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)};sb.prototype.distortInverse=function(t){for(var z=0,A=1,O=t-this.distort(z);1E-4<Math.abs(A-z);){var la=t-this.distort(A);O=A-(A-z)/(la-O)*la;z=A;A=O;O=la}return A};sb.prototype.distort=function(t){for(var z=t*t,A=0,O=0;O<this.coefficients.length;O++)A=z*(A+this.coefficients[O]);return(A+1)*t};var vc=Math.PI/
180,wc=180/Math.PI;C.prototype={constructor:C,set:function(t,z,A){this.x=t;this.y=z;this.z=A;return this},copy:function(t){this.x=t.x;this.y=t.y;this.z=t.z;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var t=this.length();0!==t?this.multiplyScalar(1/t):this.z=this.y=this.x=0;return this},multiplyScalar:function(t){this.x*=t;this.y*=t;this.z*=t},applyQuaternion:function(t){var z=this.x,A=this.y,O=this.z,la=t.x,Z=t.y,ca=t.z;t=t.w;var Ba=
t*z+Z*O-ca*A,Na=t*A+ca*z-la*O,Ka=t*O+la*A-Z*z;z=-la*z-Z*A-ca*O;this.x=Ba*t+z*-la+Na*-ca-Ka*-Z;this.y=Na*t+z*-Z+Ka*-la-Ba*-ca;this.z=Ka*t+z*-ca+Ba*-Z-Na*-la;return this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},crossVectors:function(t,z){var A=t.x,O=t.y;t=t.z;var la=z.x,Z=z.y;z=z.z;this.x=O*z-t*Z;this.y=t*la-A*z;this.z=A*Z-O*la;return this}};x.prototype={constructor:x,set:function(t,z,A,O){this.x=t;this.y=z;this.z=A;this.w=O;return this},copy:function(t){this.x=t.x;this.y=t.y;this.z=
t.z;this.w=t.w;return this},setFromEulerXYZ:function(t,z,A){var O=Math.cos(t/2),la=Math.cos(z/2),Z=Math.cos(A/2);t=Math.sin(t/2);z=Math.sin(z/2);A=Math.sin(A/2);this.x=t*la*Z+O*z*A;this.y=O*z*Z-t*la*A;this.z=O*la*A+t*z*Z;this.w=O*la*Z-t*z*A;return this},setFromEulerYXZ:function(t,z,A){var O=Math.cos(t/2),la=Math.cos(z/2),Z=Math.cos(A/2);t=Math.sin(t/2);z=Math.sin(z/2);A=Math.sin(A/2);this.x=t*la*Z+O*z*A;this.y=O*z*Z-t*la*A;this.z=O*la*A-t*z*Z;this.w=O*la*Z+t*z*A;return this},setFromAxisAngle:function(t,
z){z/=2;var A=Math.sin(z);this.x=t.x*A;this.y=t.y*A;this.z=t.z*A;this.w=Math.cos(z);return this},multiply:function(t){return this.multiplyQuaternions(this,t)},multiplyQuaternions:function(t,z){var A=t.x,O=t.y,la=t.z;t=t.w;var Z=z.x,ca=z.y,Ba=z.z;z=z.w;this.x=A*z+t*Z+O*Ba-la*ca;this.y=O*z+t*ca+la*Z-A*Ba;this.z=la*z+t*Ba+A*ca-O*Z;this.w=t*z-A*Z-O*ca-la*Ba;return this},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;this.normalize();return this},normalize:function(){var t=Math.sqrt(this.x*this.x+
this.y*this.y+this.z*this.z+this.w*this.w);0===t?(this.z=this.y=this.x=0,this.w=1):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t);return this},slerp:function(t,z){if(0===z)return this;if(1===z)return this.copy(t);var A=this.x,O=this.y,la=this.z,Z=this.w,ca=Z*t.w+A*t.x+O*t.y+la*t.z;0>ca?(this.w=-t.w,this.x=-t.x,this.y=-t.y,this.z=-t.z,ca=-ca):this.copy(t);if(1<=ca)return this.w=Z,this.x=A,this.y=O,this.z=la,this;t=Math.acos(ca);var Ba=Math.sqrt(1-ca*ca);if(.001>Math.abs(Ba))return this.w=.5*(Z+this.w),
this.x=.5*(A+this.x),this.y=.5*(O+this.y),this.z=.5*(la+this.z),this;ca=Math.sin((1-z)*t)/Ba;z=Math.sin(z*t)/Ba;this.w=Z*ca+this.w*z;this.x=A*ca+this.x*z;this.y=O*ca+this.y*z;this.z=la*ca+this.z*z;return this},setFromUnitVectors:function(){var t,z;return function(A,O){void 0===t&&(t=new C);z=A.dot(O)+1;1E-6>z?(z=0,Math.abs(A.x)>Math.abs(A.z)?t.set(-A.y,A.x,0):t.set(0,-A.z,A.y)):t.crossVectors(A,O);this.x=t.x;this.y=t.y;this.z=t.z;this.w=z;this.normalize();return this}}()};var $h=new vb({widthMeters:.11,
heightMeters:.062,bevelMeters:.004}),ai=new vb({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),hf={CardboardV1:new wb({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new wb({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,
interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-9.904169E-4,6.183535E-5,-1.6981803E-6]})};bb.prototype.updateDeviceParams=function(t){this.device=this.determineDevice_(t)||this.device};bb.prototype.getDevice=function(){return this.device};bb.prototype.setViewer=function(t){this.viewer=t;this.distortion=new sb(this.viewer.distortionCoefficients)};
bb.prototype.determineDevice_=function(t){if(!t){if(Sb())return console.warn("Using fallback iOS device measurements."),ai;console.warn("Using fallback Android device measurements.");return $h}var z=.0254/t.xdpi,A=.0254/t.ydpi,O=Cb(),la=Mb();return new vb({widthMeters:z*O,heightMeters:A*la,bevelMeters:.001*t.bevelMm})};bb.prototype.getDistortedFieldOfViewLeftEye=function(){var t=this.viewer,z=this.device,A=this.distortion,O=t.screenLensDistance,la=t.interLensDistance/2,Z=t.baselineLensDistance-z.bevelMeters,
ca=z.heightMeters-Z;z=wc*Math.atan(A.distort((z.widthMeters-t.interLensDistance)/2/O));la=wc*Math.atan(A.distort(la/O));Z=wc*Math.atan(A.distort(Z/O));A=wc*Math.atan(A.distort(ca/O));return{leftDegrees:Math.min(z,t.fov),rightDegrees:Math.min(la,t.fov),downDegrees:Math.min(Z,t.fov),upDegrees:Math.min(A,t.fov)}};bb.prototype.getLeftEyeVisibleTanAngles=function(){var t=this.viewer,z=this.device,A=this.distortion,O=Math.tan(-vc*t.fov),la=Math.tan(vc*t.fov),Z=Math.tan(vc*t.fov),ca=Math.tan(-vc*t.fov),
Ba=z.widthMeters/4,Na=z.heightMeters/2,Ka=t.interLensDistance/2-Ba,Ta=-(t.baselineLensDistance-z.bevelMeters-Na),Xa=t.screenLensDistance;t=A.distort((Ka-Ba)/Xa);z=A.distort((Ta+Na)/Xa);Ba=A.distort((Ka+Ba)/Xa);A=A.distort((Ta-Na)/Xa);Na=new Float32Array(4);Na[0]=Math.max(O,t);Na[1]=Math.min(la,z);Na[2]=Math.min(Z,Ba);Na[3]=Math.max(ca,A);return Na};bb.prototype.getLeftEyeNoLensTanAngles=function(){var t=this.viewer,z=this.device,A=this.distortion,O=new Float32Array(4),la=A.distortInverse(Math.tan(-vc*
t.fov)),Z=A.distortInverse(Math.tan(vc*t.fov)),ca=A.distortInverse(Math.tan(vc*t.fov));A=A.distortInverse(Math.tan(-vc*t.fov));var Ba=z.widthMeters/4,Na=z.heightMeters/2,Ka=t.interLensDistance/2-Ba;z=-(t.baselineLensDistance-z.bevelMeters-Na);t=t.screenLensDistance;O[0]=Math.max(la,(Ka-Ba)/t);O[1]=Math.min(Z,(z+Na)/t);O[2]=Math.min(ca,(Ka+Ba)/t);O[3]=Math.max(A,(z-Na)/t);return O};bb.prototype.getLeftEyeVisibleScreenRect=function(t){var z=this.viewer,A=this.device,O=z.screenLensDistance,la=(A.widthMeters-
z.interLensDistance)/2;z=z.baselineLensDistance-A.bevelMeters;var Z=(t[0]*O+la)/A.widthMeters,ca=(t[3]*O+z)/A.heightMeters;return{x:Z,y:ca,width:(t[2]*O+la)/A.widthMeters-Z,height:(t[1]*O+z)/A.heightMeters-ca}};bb.prototype.getFieldOfViewLeftEye=function(t){return t?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()};bb.prototype.getFieldOfViewRightEye=function(t){t=this.getFieldOfViewLeftEye(t);return{leftDegrees:t.rightDegrees,rightDegrees:t.leftDegrees,upDegrees:t.upDegrees,
downDegrees:t.downDegrees}};bb.prototype.getUndistortedFieldOfViewLeftEye=function(){var t=this.getUndistortedParams_();return{leftDegrees:wc*Math.atan(t.outerDist),rightDegrees:wc*Math.atan(t.innerDist),downDegrees:wc*Math.atan(t.bottomDist),upDegrees:wc*Math.atan(t.topDist)}};bb.prototype.getUndistortedViewportLeftEye=function(){var t=this.getUndistortedParams_(),z=this.device,A=this.viewer.screenLensDistance,O=z.width/(z.widthMeters/A);z=z.height/(z.heightMeters/A);A=Math.round((t.eyePosX-t.outerDist)*
O);var la=Math.round((t.eyePosY-t.bottomDist)*z);return{x:A,y:la,width:Math.round((t.eyePosX+t.innerDist)*O)-A,height:Math.round((t.eyePosY+t.topDist)*z)-la}};bb.prototype.getUndistortedParams_=function(){var t=this.viewer,z=this.device,A=t.screenLensDistance,O=t.interLensDistance/2/A,la=z.heightMeters/A,Z=z.widthMeters/A/2-O;z=(t.baselineLensDistance-z.bevelMeters)/A;t=this.distortion.distortInverse(Math.tan(vc*t.fov));return{outerDist:Math.min(Z,t),innerDist:Math.min(O,t),topDist:Math.min(la-z,
t),bottomDist:Math.min(z,t),eyePosX:Z,eyePosY:z}};bb.Viewers=hf;var Oh={format:1,last_updated:"2019-11-09T17:36:14Z",devices:[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1E3},
{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},
{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],
dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],
bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1E3},{type:"android",
rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},
{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},
{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,
316.1],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},
{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},
{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},
{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},
{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],
dpi:[196.7,205.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,
437.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,
431.6],bw:5,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],
bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,
256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,
bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,
518.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1E3},{type:"android",
rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",
rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",
rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},
{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],
dpi:307.9,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1E3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1E3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1E3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1E3},{type:"ios",rules:[{res:[1125,2001]}],
dpi:[410.9,415.4],bw:4,ac:1E3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1E3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],
dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}]};mc.prototype.getDeviceParams=function(){return this.deviceParams};mc.prototype.recalculateDeviceParams_=function(){var t=this.calcDeviceParams_();
if(t){if(this.deviceParams=t,this.onDeviceParamsUpdated)this.onDeviceParamsUpdated(this.deviceParams)}else console.error("Failed to recalculate device parameters.")};mc.prototype.calcDeviceParams_=function(){var t=this.dpdb;if(!t)return console.error("DPDB not available."),null;if(1!=t.format)return console.error("DPDB has unexpected format version."),null;if(!t.devices||!t.devices.length)return console.error("DPDB does not have a devices section."),null;var z=navigator.userAgent||navigator.vendor||
window.opera,A=Cb(),O=Mb();if(!t.devices)return console.error("DPDB has no devices section."),null;for(var la=0;la<t.devices.length;la++){var Z=t.devices[la];if(!Z.rules)console.warn("Device["+la+"] has no rules section.");else if("ios"!=Z.type&&"android"!=Z.type)console.warn("Device["+la+"] has invalid type.");else if(Sb()==("ios"==Z.type)){for(var ca=!1,Ba=0;Ba<Z.rules.length;Ba++)if(this.ruleMatches_(Z.rules[Ba],z,A,O)){ca=!0;break}if(ca)return new Sc({xdpi:Z.dpi[0]||Z.dpi,ydpi:Z.dpi[1]||Z.dpi,
bevelMm:Z.bw})}}console.warn("No DPDB device match.");return null};mc.prototype.ruleMatches_=function(t,z,A,O){if(!t.ua&&!t.res)return!1;t.ua&&"SM"===t.ua.substring(0,2)&&(t.ua=t.ua.substring(0,7));if(t.ua&&0>z.indexOf(t.ua))return!1;if(t.res){if(!t.res[0]||!t.res[1])return!1;z=t.res[0];t=t.res[1];if(Math.min(A,O)!=Math.min(z,t)||Math.max(A,O)!=Math.max(z,t))return!1}return!0};nc.prototype.set=function(t,z){this.sample=t;this.timestampS=z};nc.prototype.copy=function(t){this.set(t.sample,t.timestampS)};
bc.prototype.addAccelMeasurement=function(t,z){this.currentAccelMeasurement.set(t,z)};bc.prototype.addGyroMeasurement=function(t,z){this.currentGyroMeasurement.set(t,z);t=z-this.previousGyroMeasurement.timestampS;isNaN(t)||.001>=t||1<t||this.run_();this.previousGyroMeasurement.copy(this.currentGyroMeasurement)};bc.prototype.run_=function(){if(this.isOrientationInitialized){var t=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS);
this.gyroIntegralQ.multiply(t);this.filterQ.copy(this.previousFilterQ);this.filterQ.multiply(t);t=new x;t.copy(this.filterQ);t.inverse();this.estimatedGravity.set(0,0,-1);this.estimatedGravity.applyQuaternion(t);this.estimatedGravity.normalize();this.measuredGravity.copy(this.currentAccelMeasurement.sample);this.measuredGravity.normalize();t=new x;t.setFromUnitVectors(this.estimatedGravity,this.measuredGravity);t.inverse();if(this.isDebug){var z=console,A=z.log;if(1<t.w){console.warn("getQuaternionAngle: w > 1");
var O=0}else O=2*Math.acos(t.w);A.call(z,"Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",wc*O,this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1))}z=new x;z.copy(this.filterQ);z.multiply(t);this.filterQ.slerp(z,1-this.kFilter);this.previousFilterQ.copy(this.filterQ)}else this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),
this.previousFilterQ.copy(this.accelQ),this.isOrientationInitialized=!0};bc.prototype.getOrientation=function(){return this.filterQ};bc.prototype.accelToQuaternion_=function(t){var z=new C;z.copy(t);z.normalize();t=new x;t.setFromUnitVectors(new C(0,0,-1),z);t.inverse();return t};bc.prototype.gyroToQuaternionDelta_=function(t,z){var A=new x,O=new C;O.copy(t);O.normalize();A.setFromAxisAngle(O,t.length()*z);return A};Kc.prototype.getPrediction=function(t,z,A){if(!this.previousTimestampS)return this.previousQ.copy(t),
this.previousTimestampS=A,t;var O=new C;O.copy(z);O.normalize();z=z.length();if(z<20*vc)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(wc*z).toFixed(1)),this.outQ.copy(t),this.previousQ.copy(t),this.outQ;this.deltaQ.setFromAxisAngle(O,z*this.predictionTimeS);this.outQ.copy(this.previousQ);this.outQ.multiply(this.deltaQ);this.previousQ.copy(t);this.previousTimestampS=A;return this.outQ};Rb.prototype.getPosition=function(){return null};Rb.prototype.getOrientation=function(){var t=
void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||function(){var A=(new x).setFromAxisAngle(new C(0,0,-1),0),O=new x;-90===window.orientation?O.setFromAxisAngle(new C(0,1,0),Math.PI/-2):O.setFromAxisAngle(new C(0,1,0),Math.PI/2);return A.multiply(O)}();this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||function(){var A=new x;A.setFromAxisAngle(new C(1,0,0),-Math.PI/2);return A}();t=this._deviceOrientationQ;
var z=new x;z.copy(t);z.multiply(this.deviceOrientationFilterToWorldQ);z.multiply(this.resetQ);z.multiply(this.worldToScreenQ);z.multiplyQuaternions(this.deviceOrientationFixQ,z);this.yawOnly&&(z.x=0,z.z=0,z.normalize());this.orientationOut_[0]=z.x;this.orientationOut_[1]=z.y;this.orientationOut_[2]=z.z;this.orientationOut_[3]=z.w;return this.orientationOut_}t=this.filter.getOrientation();t=this.posePredictor.getPrediction(t,this.gyroscope,this.previousTimestampS);z=new x;z.copy(this.filterToWorldQ);
z.multiply(this.resetQ);z.multiply(t);z.multiply(this.worldToScreenQ);this.yawOnly&&(z.x=0,z.z=0,z.normalize());this.orientationOut_[0]=z.x;this.orientationOut_[1]=z.y;this.orientationOut_[2]=z.z;this.orientationOut_[3]=z.w;return this.orientationOut_};Rb.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation());this.resetQ.x=0;this.resetQ.y=0;this.resetQ.z*=-1;this.resetQ.normalize();Lb()&&this.resetQ.multiply(this.inverseWorldToScreenQ);this.resetQ.multiply(this.originalPoseAdjustQ)};
Rb.prototype.onDeviceOrientation_=function(t){this._deviceOrientationQ=this._deviceOrientationQ||new x;var z=t.alpha,A=t.beta;t=t.gamma;z=(z||0)*Math.PI/180;A=(A||0)*Math.PI/180;t=(t||0)*Math.PI/180;this._deviceOrientationQ.setFromEulerYXZ(A,z,-t)};Rb.prototype.onDeviceMotion_=function(t){this.updateDeviceMotion_(t)};Rb.prototype.updateDeviceMotion_=function(t){var z=t.accelerationIncludingGravity,A=t.rotationRate;t=t.timeStamp/1E3;var O=t-this.previousTimestampS;0>O?ff("fusion-pose-sensor:invalid:non-monotonic",
"Invalid timestamps detected: non-monotonic timestamp from devicemotion"):.001>=O||1<O?ff("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."):(this.accelerometer.set(-z.x,-z.y,-z.z),A&&(bg()?this.gyroscope.set(-A.beta,A.alpha,A.gamma):this.gyroscope.set(A.alpha,A.beta,A.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,t)),this.filter.addAccelMeasurement(this.accelerometer,
t));this.previousTimestampS=t};Rb.prototype.onOrientationChange_=function(){this.setScreenTransform_()};Rb.prototype.onMessage_=function(t){(t=t.data)&&t.type&&"devicemotion"===t.type.toLowerCase()&&this.updateDeviceMotion_(t.deviceMotionEvent)};Rb.prototype.setScreenTransform_=function(){this.worldToScreenQ.set(0,0,0,1);switch(window.orientation){case 90:this.worldToScreenQ.setFromAxisAngle(new C(0,0,1),-Math.PI/2);break;case -90:this.worldToScreenQ.setFromAxisAngle(new C(0,0,1),Math.PI/2)}this.inverseWorldToScreenQ.copy(this.worldToScreenQ);
this.inverseWorldToScreenQ.inverse()};Rb.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this);this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this);this.onMessageCallback_=this.onMessage_.bind(this);this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this);var t;if(t=Sb()){t=window.self!==window.top;var z=pa(document.referrer),A=pa(window.location.href);t=t&&z!==A}t&&window.addEventListener("message",this.onMessageCallback_);window.addEventListener("orientationchange",
this.onOrientationChangeCallback_);this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)};Rb.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_);window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_);window.removeEventListener("orientationchange",this.onOrientationChangeCallback_);window.removeEventListener("message",
this.onMessageCallback_)};var bi=new C(1,0,0),ci=new C(0,0,1),jf=new x;jf.setFromAxisAngle(bi,-Math.PI/2);jf.multiply((new x).setFromAxisAngle(ci,Math.PI/2));var Vh=function(){function t(z){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.config=z;this.fusionSensor=this.sensor=null;this._out=new Float32Array(4);this.api=null;this.errors=[];this._sensorQ=new x;this._outQ=new x;this._onSensorRead=this._onSensorRead.bind(this);this._onSensorError=this._onSensorError.bind(this);
this.init()}Wh(t,[{key:"init",value:function(){var z=null;try{z=new RelativeOrientationSensor({frequency:60,referenceFrame:"screen"}),z.addEventListener("error",this._onSensorError)}catch(A){this.errors.push(A),"SecurityError"===A.name?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):"ReferenceError"===A.name?this.useDeviceMotion():
console.error(A)}z&&(this.api="sensor",this.sensor=z,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion";this.fusionSensor=new Rb(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG);this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();
if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var z=this.sensor.quaternion;this._sensorQ.set(z[0],z[1],z[2],z[3]);z=this._outQ;z.copy(jf);z.multiply(this._sensorQ);this.config.YAW_ONLY&&(z.x=z.z=0,z.normalize());this._out[0]=z.x;this._out[1]=z.y;this._out[2]=z.z;this._out[3]=z.w;return this._out}},{key:"_onSensorError",value:function(z){this.errors.push(z.error);"NotAllowedError"===z.error.name?console.error("Permission to access sensor was denied"):
"NotReadableError"===z.error.name?console.error("Sensor could not be read"):console.error(z.error);this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]);return t}();cc.prototype.show=function(t){t||this.overlay.parentElement?t&&(this.overlay.parentElement&&this.overlay.parentElement!=t&&this.overlay.parentElement.removeChild(this.overlay),t.appendChild(this.overlay)):document.body.appendChild(this.overlay);this.overlay.style.display="block";t=this.overlay.querySelector("img").style;
Lb()?(t.width="20%",t.marginLeft="40%",t.marginTop="3%"):(t.width="50%",t.marginLeft="25%",t.marginTop="25%")};cc.prototype.hide=function(){this.overlay.style.display="none"};cc.prototype.showTemporarily=function(t,z){this.show(z);this.timer=setTimeout(this.hide.bind(this),t)};cc.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)};cc.prototype.update=function(){this.disableShowTemporarily();!Lb()&&$a()?this.show():this.hide()};cc.prototype.loadIcon_=function(){this.icon="data:image/svg+xml,"+
encodeURIComponent("<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>")};
pb.prototype.show=function(t){this.root=t;t.appendChild(this.dialog);this.dialog.querySelector("#"+this.selectedKey).checked=!0;this.dialog.style.display="block"};pb.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog);this.dialog.style.display="none"};pb.prototype.getCurrentViewer=function(){return bb.Viewers[this.selectedKey]};pb.prototype.getSelectedKey_=function(){var t=this.dialog.querySelector("input[name=field]:checked");return t?t.id:null};
pb.prototype.onChange=function(t){this.onChangeCallbacks_.push(t)};pb.prototype.fireOnChange_=function(t){for(var z=0;z<this.onChangeCallbacks_.length;z++)this.onChangeCallbacks_[z](t)};pb.prototype.onSave_=function(){if((this.selectedKey=this.getSelectedKey_())&&bb.Viewers[this.selectedKey]){this.fireOnChange_(bb.Viewers[this.selectedKey]);try{localStorage.setItem("WEBVR_CARDBOARD_VIEWER",this.selectedKey)}catch(t){console.error("Failed to save viewer profile: %s",t)}this.hide()}else console.error("ViewerSelector.onSave_: this should never happen!")};
pb.prototype.createDialog_=function(t){var z=document.createElement("div");z.classList.add("webvr-polyfill-viewer-selector");z.style.display="none";var A=document.createElement("div"),O=A.style;O.position="fixed";O.left=0;O.top=0;O.width="100%";O.height="100%";O.background="rgba(0, 0, 0, 0.3)";A.addEventListener("click",this.hide.bind(this));var la=document.createElement("div");O=la.style;O.boxSizing="border-box";O.position="fixed";O.top="24px";O.left="50%";O.marginLeft="-140px";O.width="280px";O.padding=
"24px";O.overflow="hidden";O.background="#fafafa";O.fontFamily="'Roboto', sans-serif";O.boxShadow="0px 5px 20px #666";la.appendChild(this.createH1_("Select your viewer"));for(var Z in t)la.appendChild(this.createChoice_(Z,t[Z].label));la.appendChild(this.createButton_("Save",this.onSave_.bind(this)));z.appendChild(A);z.appendChild(la);return z};pb.prototype.createH1_=function(t){var z=document.createElement("h1"),A=z.style;A.color="black";A.fontSize="20px";A.fontWeight="bold";A.marginTop=0;A.marginBottom=
"24px";z.innerHTML=t;return z};pb.prototype.createChoice_=function(t,z){var A=document.createElement("div");A.style.marginTop="8px";A.style.color="black";var O=document.createElement("input");O.style.fontSize="30px";O.setAttribute("id",t);O.setAttribute("type","radio");O.setAttribute("value",t);O.setAttribute("name","field");var la=document.createElement("label");la.style.marginLeft="4px";la.setAttribute("for",t);la.innerHTML=z;A.appendChild(O);A.appendChild(la);return A};pb.prototype.createButton_=
function(t,z){var A=document.createElement("button");A.innerHTML=t;t=A.style;t.float="right";t.textTransform="uppercase";t.color="#1094f7";t.fontSize="14px";t.letterSpacing=0;t.border=0;t.background="none";t.marginTop="16px";A.addEventListener("click",z);return A};var di="undefined"!==typeof window?window:"undefined"!==typeof ef?ef:"undefined"!==typeof self?self:{},Th=function(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t["default"]:t}(function(t,z){return z={exports:{}},
t(z,z.exports),z.exports}(function(t){(function(z,A){t.exports=A()})(di,function(){return function(z){function A(la){if(O[la])return O[la].exports;var Z=O[la]={i:la,l:!1,exports:{}};z[la].call(Z.exports,Z,Z.exports,A);Z.l=!0;return Z.exports}var O={};A.m=z;A.c=O;A.d=function(la,Z,ca){A.o(la,Z)||Object.defineProperty(la,Z,{configurable:!1,enumerable:!0,get:ca})};A.n=function(la){var Z=la&&la.__esModule?function(){return la["default"]}:function(){return la};A.d(Z,"a",Z);return Z};A.o=function(la,Z){return Object.prototype.hasOwnProperty.call(la,
Z)};A.p="";return A(A.s=0)}([function(z,A,O){var la=function(){function Ba(Na,Ka){for(var Ta=0;Ta<Ka.length;Ta++){var Xa=Ka[Ta];Xa.enumerable=Xa.enumerable||!1;Xa.configurable=!0;"value"in Xa&&(Xa.writable=!0);Object.defineProperty(Na,Xa.key,Xa)}}return function(Na,Ka,Ta){Ka&&Ba(Na.prototype,Ka);Ta&&Ba(Na,Ta);return Na}}(),Z=O(1),ca="undefined"!==typeof navigator&&10>parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined",
"3_2").replace("_",".").replace("_",""))&&!window.MSStream;A=function(){function Ba(){if(!(this instanceof Ba))throw new TypeError("Cannot call a class as a function");ca?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",Z),this.noSleepVideo.addEventListener("timeupdate",function(){.5<this.noSleepVideo.currentTime&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}la(Ba,[{key:"enable",
value:function(){ca?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/";window.setTimeout(window.stop,0)},15E3)):this.noSleepVideo.play()}},{key:"disable",value:function(){ca?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]);return Ba}();z.exports=A},function(z){z.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])})})),
Sh=1E3,ei=[0,0,.5,1],fi=[.5,0,.5,1],gi=window.requestAnimationFrame,hi=window.cancelAnimationFrame;Eb.prototype.getFrameData=function(t){return Zh(t,this._getPose(),this)};Eb.prototype.getPose=function(){aa("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData");return this._getPose()};Eb.prototype.resetPose=function(){aa("VRDisplay.prototype.resetPose");return this._resetPose()};Eb.prototype.getImmediatePose=function(){aa("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData");
return this._getPose()};Eb.prototype.requestAnimationFrame=function(t){return gi(t)};Eb.prototype.cancelAnimationFrame=function(t){return hi(t)};Eb.prototype.wrapForFullscreen=function(t){if(Sb())return t;this.fullscreenWrapper_||(this.fullscreenWrapper_=document.createElement("div"),this.fullscreenWrapper_.setAttribute("style",["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important; left: 0 !important; right: 0 !important; border: 0; margin: 0; padding: 0; z-index: 999999 !important; position: fixed"].join("; ")+
";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper"));if(this.fullscreenElement_==t)return this.fullscreenWrapper_;this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_));this.fullscreenElement_=t;(this.originalParent_=t.parentElement)||document.body.appendChild(t);this.fullscreenWrapper_.parentElement||(t=this.fullscreenElement_.parentElement,t.insertBefore(this.fullscreenWrapper_,
this.fullscreenElement_),t.removeChild(this.fullscreenElement_));this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild);this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");this.fullscreenElement_&&this.fullscreenElement_.setAttribute("style",["position: absolute; top: 0; left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0; margin: 0; padding: 0"].join("; ")+
";");return this.fullscreenWrapper_};Eb.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var t=this.fullscreenElement_;this.fullscreenElementCachedStyle_?t.setAttribute("style",this.fullscreenElementCachedStyle_):t.removeAttribute("style");this.fullscreenElementCachedStyle_=this.fullscreenElement_=null;var z=this.fullscreenWrapper_.parentElement;this.fullscreenWrapper_.removeChild(t);this.originalParent_===z?z.insertBefore(t,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(t);
z.removeChild(this.fullscreenWrapper_);return t}};Eb.prototype.requestPresent=function(t){var z=this.isPresenting,A=this;t instanceof Array||(aa("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),t=[t]);return new Promise(function(O,la){if(A.capabilities.canPresent)if(0==t.length||t.length>A.capabilities.maxLayers)la(Error("Invalid number of layers."));else{var Z=t[0];if(Z.source){var ca=Z.leftBounds||ei,Ba=Z.rightBounds||fi;if(z){var Na=A.layer_;
Na.source!==Z.source&&(Na.source=Z.source);for(Z=0;4>Z;Z++)Na.leftBounds[Z]=ca[Z],Na.rightBounds[Z]=Ba[Z];A.wrapForFullscreen(A.layer_.source);A.updatePresent_();O()}else{A.layer_={predistorted:Z.predistorted,source:Z.source,leftBounds:ca.slice(0),rightBounds:Ba.slice(0)};A.waitingForPresent_=!1;if(A.layer_&&A.layer_.source){var Ka=A.wrapForFullscreen(A.layer_.source);A.addFullscreenListeners_(Ka,function(){A.isPresenting=Ka===(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||
document.msFullscreenElement);A.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(Ta){console.error("screen.orientation.lock() failed due to",Ta.message)}),A.waitingForPresent_=!1,A.beginPresent_(),O()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),A.removeFullscreenWrapper(),A.disableWakeLock(),A.endPresent_(),A.removeFullscreenListeners_());A.fireVRDisplayPresentChange_()},function(){A.waitingForPresent_&&
(A.removeFullscreenWrapper(),A.removeFullscreenListeners_(),A.disableWakeLock(),A.waitingForPresent_=!1,A.isPresenting=!1,la(Error("Unable to present.")))});if(Kb(Ka))A.enableWakeLock(),A.waitingForPresent_=!0;else if(Sb()||gf())A.enableWakeLock(),A.isPresenting=!0,A.beginPresent_(),A.fireVRDisplayPresentChange_(),O()}A.waitingForPresent_||Sb()||(Bb(),la(Error("Unable to present.")))}}else O()}else la(Error("VRDisplay is not capable of presenting."))})};Eb.prototype.exitPresent=function(){var t=this.isPresenting,
z=this;this.isPresenting=!1;this.layer_=null;this.disableWakeLock();return new Promise(function(A,O){t?(!Bb()&&Sb()&&(z.endPresent_(),z.fireVRDisplayPresentChange_()),gf()&&(z.removeFullscreenWrapper(),z.removeFullscreenListeners_(),z.endPresent_(),z.fireVRDisplayPresentChange_()),A()):O(Error("Was not presenting to VRDisplay."))})};Eb.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]};Eb.prototype.fireVRDisplayPresentChange_=function(){var t=new CustomEvent("vrdisplaypresentchange",
{detail:{display:this}});window.dispatchEvent(t)};Eb.prototype.fireVRDisplayConnect_=function(){var t=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(t)};Eb.prototype.addFullscreenListeners_=function(t,z,A){this.removeFullscreenListeners_();this.fullscreenEventTarget_=t;this.fullscreenChangeHandler_=z;this.fullscreenErrorHandler_=A;z&&(document.fullscreenEnabled?t.addEventListener("fullscreenchange",z,!1):document.webkitFullscreenEnabled?t.addEventListener("webkitfullscreenchange",
z,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",z,!1):document.msFullscreenEnabled&&t.addEventListener("msfullscreenchange",z,!1));A&&(document.fullscreenEnabled?t.addEventListener("fullscreenerror",A,!1):document.webkitFullscreenEnabled?t.addEventListener("webkitfullscreenerror",A,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",A,!1):document.msFullscreenEnabled&&t.addEventListener("msfullscreenerror",A,!1))};Eb.prototype.removeFullscreenListeners_=
function(){if(this.fullscreenEventTarget_){var t=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var z=this.fullscreenChangeHandler_;t.removeEventListener("fullscreenchange",z,!1);t.removeEventListener("webkitfullscreenchange",z,!1);document.removeEventListener("mozfullscreenchange",z,!1);t.removeEventListener("msfullscreenchange",z,!1)}this.fullscreenErrorHandler_&&(z=this.fullscreenErrorHandler_,t.removeEventListener("fullscreenerror",z,!1),t.removeEventListener("webkitfullscreenerror",
z,!1),document.removeEventListener("mozfullscreenerror",z,!1),t.removeEventListener("msfullscreenerror",z,!1));this.fullscreenErrorHandler_=this.fullscreenChangeHandler_=this.fullscreenEventTarget_=null}};Eb.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()};Eb.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()};Eb.prototype.beginPresent_=function(){};Eb.prototype.endPresent_=function(){};Eb.prototype.submitFrame=function(){};Eb.prototype.getEyeParameters=
function(){return null};var Uh={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1};Nb.prototype=Object.create(Eb.prototype);Nb.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,
angularAcceleration:null}};Nb.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()};Nb.prototype._getFieldOfView=function(t){if("left"==t)t=this.deviceInfo_.getFieldOfViewLeftEye();else if("right"==t)t=this.deviceInfo_.getFieldOfViewRightEye();else return console.error("Invalid eye provided: %s",t),null;return t};Nb.prototype._getEyeOffset=function(t){if("left"==t)t=[.5*-this.deviceInfo_.viewer.interLensDistance,0,0];else if("right"==t)t=[.5*this.deviceInfo_.viewer.interLensDistance,
0,0];else return console.error("Invalid eye provided: %s",t),null;return t};Nb.prototype.getEyeParameters=function(t){var z=this._getEyeOffset(t),A=this._getFieldOfView(t);t={offset:z,renderWidth:.5*this.deviceInfo_.device.width*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};Object.defineProperty(t,"fieldOfView",{enumerable:!0,get:function(){aa("VRFieldOfView","VRFrameData's projection matrices");return A}});return t};Nb.prototype.onDeviceParamsUpdated_=function(t){this.config.DEBUG&&
console.log("DPDB reported that device params were updated.");this.deviceInfo_.updateDeviceParams(t);this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)};Nb.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)};Nb.prototype.beginPresent_=function(){var t=this.layer_.source.getContext("webgl");t||(t=this.layer_.source.getContext("experimental-webgl"));
t||(t=this.layer_.source.getContext("webgl2"));t&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(t.canvas.width=Cb()*this.bufferScale_,t.canvas.height=Mb()*this.bufferScale_,this.cardboardUI_=new Qb(t)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new Qb(t)),this.distorter_=new qb(t,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen(function(z){this.viewerSelector_.show(this.layer_.source.parentElement);
z.stopPropagation();z.preventDefault()}.bind(this),function(z){this.exitPresent();z.stopPropagation();z.preventDefault()}.bind(this)),this.rotateInstructions_&&(Lb()&&$a()?this.rotateInstructions_.showTemporarily(3E3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",
this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())};Nb.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null);this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null);this.rotateInstructions_&&this.rotateInstructions_.hide();this.viewerSelector_.hide();window.removeEventListener("orientationchange",this.orientationHandler);window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)};Nb.prototype.updatePresent_=
function(){this.endPresent_();this.beginPresent_()};Nb.prototype.submitFrame=function(){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var t=this.layer_.source.getContext("webgl");t||(t=this.layer_.source.getContext("experimental-webgl"));t||(t=this.layer_.source.getContext("webgl2"));t=t.canvas;if(t.width!=this.lastWidth||t.height!=this.lastHeight)this.cardboardUI_.onResize();this.lastWidth=t.width;this.lastHeight=t.height;this.cardboardUI_.render()}};
Nb.prototype.onOrientationChange_=function(){this.viewerSelector_.hide();this.rotateInstructions_&&this.rotateInstructions_.update();this.onResize_()};Nb.prototype.onResize_=function(){if(this.layer_){var t=this.layer_.source.getContext("webgl");t||(t=this.layer_.source.getContext("experimental-webgl"));t||(t=this.layer_.source.getContext("webgl2"));t.canvas.setAttribute("style","position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; border: 0; margin: 0; padding: 0px; box-sizing: content-box;");
ra(t.canvas)}};Nb.prototype.onViewerChanged_=function(t){this.deviceInfo_.setViewer(t);this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_);this.fireVRDisplayDeviceParamsChange_()};Nb.prototype.fireVRDisplayDeviceParamsChange_=function(){var t=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(t)};Nb.VRFrameData=function(){this.leftProjectionMatrix=new Float32Array(16);this.leftViewMatrix=new Float32Array(16);this.rightProjectionMatrix=
new Float32Array(16);this.rightViewMatrix=new Float32Array(16);this.pose=null};Nb.VRDisplay=Eb;return Nb})}));m.inherits(r,Y);r.prototype.onBaseLayerSet=function(){throw Error("Not implemented");};r.prototype.isSessionSupported=function(){throw Error("Not implemented");};r.prototype.isFeatureSupported=function(){throw Error("Not implemented");};r.prototype.requestSession=function(){return m.asyncExecutePromiseGeneratorProgram(function(){throw Error("Not implemented");})};r.prototype.requestAnimationFrame=
function(){throw Error("Not implemented");};r.prototype.onFrameStart=function(){throw Error("Not implemented");};r.prototype.onFrameEnd=function(){throw Error("Not implemented");};r.prototype.doesSessionSupportReferenceSpace=function(){throw Error("Not implemented");};r.prototype.requestStageBounds=function(){throw Error("Not implemented");};r.prototype.requestFrameOfReferenceTransform=function(){return m.asyncExecutePromiseGeneratorProgram(function(q){return q.return(void 0)})};r.prototype.cancelAnimationFrame=
function(){throw Error("Not implemented");};r.prototype.endSession=function(){throw Error("Not implemented");};r.prototype.getViewport=function(){throw Error("Not implemented");};r.prototype.getProjectionMatrix=function(){throw Error("Not implemented");};r.prototype.getBasePoseMatrix=function(){throw Error("Not implemented");};r.prototype.getBaseViewMatrix=function(){throw Error("Not implemented");};r.prototype.getInputSources=function(){throw Error("Not implemented");};r.prototype.getInputPose=function(){throw Error("Not implemented");
};r.prototype.onWindowResize=function(){this.onWindowResize()};var fg={mapping:"xr-standard",displayProfiles:{"Oculus Quest":["oculus-touch-v2","oculus-touch","generic-trigger-squeeze-thumbstick"]},profiles:["oculus-touch","generic-trigger-squeeze-thumbstick"],axes:{length:4,0:null,1:null,2:0,3:1},buttons:{length:7,0:1,1:2,2:null,3:0,4:3,5:4,6:null},gripTransform:{position:[0,-.02,.04,1],orientation:[.11*Math.PI,0,0,1]}},kf={mapping:"xr-standard",profiles:["microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],
buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[.11*Math.PI,0,0,1]}},ii={"Daydream Controller":{mapping:"",profiles:["google-daydream","generic-trigger-touchpad"],buttons:{length:3,0:null,1:null,2:0}},"Gear VR Controller":{mapping:"xr-standard",profiles:["samsung-gearvr","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[.11*Math.PI,0,0,1]}},"HTC Vive Focus Controller":{mapping:"xr-standard",profiles:["htc-vive-focus","generic-trigger-touchpad"],
buttons:{length:3,0:1,1:null,2:0}},"Oculus Go Controller":{mapping:"xr-standard",profiles:["oculus-go","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[.11*Math.PI,0,0,1]}},"Oculus Touch (Right)":fg,"Oculus Touch (Left)":fg,"OpenVR Gamepad":{mapping:"xr-standard",profiles:["htc-vive","generic-trigger-squeeze-touchpad"],displayProfiles:{"HTC Vive":["htc-vive","generic-trigger-squeeze-touchpad"],"HTC Vive DVT":["htc-vive","generic-trigger-squeeze-touchpad"],
"Valve Index":["valve-index","generic-trigger-squeeze-touchpad-thumbstick"]},buttons:{length:3,0:1,1:2,2:0},gripTransform:{position:[0,0,.05,1]},targetRayTransform:{orientation:[-.08*Math.PI,0,0,1]},userAgentOverrides:{Firefox:{axes:{invert:[1,3]}}}},"Spatial Controller (Spatial Interaction Source) 045E-065A":kf,"Spatial Controller (Spatial Interaction Source) 045E-065D":{mapping:"xr-standard",profiles:["samsung-odyssey","microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,
0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[.11*Math.PI,0,0,1]}},"Windows Mixed Reality (Right)":kf,"Windows Mixed Reality (Left)":kf},Zf=N(.155,-.465,-.15),ji=N(-.155,-.465,-.15),ki=N(0,0,-.25),li=N(0,0,.05),gg=N(-.08,.14,.08),hg=180/Math.PI;n.prototype.setHandedness=function(q){this.hand!=q&&(this.hand=q,this.headElbowOffset="left"==this.hand?ji:Zf)};n.prototype.update=function(q,x){this.time=mb();q&&(R(this.lastControllerQ,this.controllerQ),R(this.controllerQ,q));x&&(za(this.headPos,
x),T(this.headQ,x));q=this.getHeadYawOrientation_();x=this.quatAngle_(this.lastControllerQ,this.controllerQ);.61<x/((this.time-this.lastTime)/1E3)?Ma(this.rootQ,this.rootQ,q,Math.min(x/.175,1)):R(this.rootQ,q);q=N(0,0,-1);Ya(q,q,this.controllerQ);q=sa(q,[0,1,0]);q=this.clamp_((q-.12)/.87,0,1);var C=E(this.rootQ);Q(C,C);Ea(C,C,this.controllerQ);x=this.elbowPos;da(x,this.headPos);ua(x,x,this.headElbowOffset);var F=P(gg);ja(F,F,q);ua(x,x,F);F=this.quatAngle_(C,na())*hg;var aa=(1-Math.pow(F/180,4))*(.4+
.24*q);F=na();Ma(F,F,C,aa);aa=Q(na(),F);C=E(C);Ea(C,C,aa);aa=this.wristPos;da(aa,li);Ya(aa,aa,F);ua(aa,aa,ki);Ya(aa,aa,C);ua(aa,aa,x);x=P(gg);ja(x,x,q);ua(this.position,this.wristPos,x);Ya(this.position,this.position,this.rootQ);this.lastTime=this.time};n.prototype.getPosition=function(){return this.position};n.prototype.getHeadYawOrientation_=function(){var q=ma();Pa(q,this.headQ,"YXZ");var x=na(),C=q[1]*hg;q=.5*Math.PI/180;var F=0*q;C*=q;var aa=0*q;q=Math.sin(F);F=Math.cos(F);var pa=Math.sin(C);
C=Math.cos(C);var ra=Math.sin(aa);aa=Math.cos(aa);x[0]=q*C*aa-F*pa*ra;x[1]=F*pa*aa+q*C*ra;x[2]=F*C*ra-q*pa*aa;x[3]=F*C*aa+q*pa*ra;return x};n.prototype.clamp_=function(q,x,C){return Math.min(Math.max(q,x),C)};n.prototype.quatAngle_=function(q,x){var C=[0,0,-1],F=[0,0,-1];Ya(C,C,q);Ya(F,F,x);q=N(C[0],C[1],C[2]);F=N(F[0],F[1],F[2]);S(q,q);S(F,F);F=sa(q,F);F=1<F?0:-1>F?Math.PI:Math.acos(F);return F};var Ub=Symbol("@@webxr-polyfill/XRRemappedGamepad"),ig={pressed:!1,touched:!1,value:0};Object.freeze(ig);
l.prototype._update=function(){for(var q=this[Ub].gamepad,x=this[Ub].map,C=this[Ub].axes,F=0;F<C.length;++F)C[F]=x.axes&&F in x.axes?null===x.axes[F]?0:q.axes[x.axes[F]]:q.axes[F];if(x.axes&&x.axes.invert){F=m.makeIterator(x.axes.invert);for(var aa=F.next();!aa.done;aa=F.next())aa=aa.value,aa<C.length&&(C[aa]*=-1)}C=this[Ub].buttons;for(F=0;F<C.length;++F)C[F]=x.buttons&&F in x.buttons?null===x.buttons[F]?ig:q.buttons[x.buttons[F]]:q.buttons[F]};m.global.Object.defineProperties(l.prototype,{id:{configurable:!0,
enumerable:!0,get:function(){return""}},_profiles:{configurable:!0,enumerable:!0,get:function(){return this[Ub].profiles}},index:{configurable:!0,enumerable:!0,get:function(){return-1}},connected:{configurable:!0,enumerable:!0,get:function(){return this[Ub].gamepad.connected}},timestamp:{configurable:!0,enumerable:!0,get:function(){return this[Ub].gamepad.timestamp}},mapping:{configurable:!0,enumerable:!0,get:function(){return this[Ub].mapping}},axes:{configurable:!0,enumerable:!0,get:function(){return this[Ub].axes}},
buttons:{configurable:!0,enumerable:!0,get:function(){return this[Ub].buttons}},hapticActuators:{configurable:!0,enumerable:!0,get:function(){return this[Ub].gamepad.hapticActuators}}});h.prototype.updateFromGamepad=function(q){this.nativeGamepad!==q&&(this.gamepad=(this.nativeGamepad=q)?new l(q,this.display,ii[q.id]):null);this.handedness=""===q.hand?"none":q.hand;this.gamepad&&this.gamepad._update();q.pose?(this.targetRayMode="tracked-pointer",this.emulatedPosition=!q.pose.hasPosition):""===q.hand&&
(this.targetRayMode="gaze",this.emulatedPosition=!1)};h.prototype.updateBasePoseMatrix=function(){if(this.nativeGamepad&&this.nativeGamepad.pose){var q=this.nativeGamepad.pose,x=q.position,C=q.orientation;if(!x&&!C)return;x?(this.lastPosition[0]=x[0],this.lastPosition[1]=x[1],this.lastPosition[2]=x[2]):q.hasPosition?x=this.lastPosition:(this.armModel||(this.armModel=new n),this.armModel.setHandedness(this.nativeGamepad.hand),this.armModel.update(C,this.polyfill.getBasePoseMatrix()),x=this.armModel.getPosition());
ya(this.basePoseMatrix,C,x)}else q=this.basePoseMatrix,x=this.polyfill.getBasePoseMatrix(),q[0]=x[0],q[1]=x[1],q[2]=x[2],q[3]=x[3],q[4]=x[4],q[5]=x[5],q[6]=x[6],q[7]=x[7],q[8]=x[8],q[9]=x[9],q[10]=x[10],q[11]=x[11],q[12]=x[12],q[13]=x[13],q[14]=x[14],q[15]=x[15];return this.basePoseMatrix};h.prototype.getXRPose=function(q,x){this.updateBasePoseMatrix();switch(x){case "target-ray":q._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix);this.gamepad&&this.gamepad[Ub].targetRayTransform&&qa(this.outputMatrix,
this.outputMatrix,this.gamepad[Ub].targetRayTransform);break;case "grip":if(!this.nativeGamepad||!this.nativeGamepad.pose)return null;q._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix);this.gamepad&&this.gamepad[Ub].gripTransform&&qa(this.outputMatrix,this.outputMatrix,this.gamepad[Ub].gripTransform);break;default:return null}q._adjustForOriginOffset(this.outputMatrix);return new XRPose(new XRRigidTransform(this.outputMatrix),this.emulatedPosition)};m.global.Object.defineProperties(h.prototype,
{profiles:{configurable:!0,enumerable:!0,get:function(){return this.gamepad?this.gamepad._profiles:[]}}});var jg={highRefreshRate:!0},kg={oculus:1,openvr:1,"spatial controller (spatial interaction source)":1},Lh=0;m.inherits(g,r);g.prototype.onBaseLayerSet=function(q,x){var C=this,F=this.sessions.get(q),aa=x.context.canvas;if(F.immersive){q=this.display.getEyeParameters("left");var pa=this.display.getEyeParameters("right");aa.width=2*Math.max(q.renderWidth,pa.renderWidth);aa.height=Math.max(q.renderHeight,
pa.renderHeight);this.display.requestPresent([{source:aa,attributes:jg}]).then(function(){C.global.document.body.contains(aa)||(F.modifiedCanvasLayer=!0,C.global.document.body.appendChild(aa),aa.style.display="block",aa.style.position="absolute",aa.style.width=aa.style.height="1px",aa.style.top=aa.style.left="0px");F.baseLayer=x})}else F.baseLayer=x};g.prototype.isSessionSupported=function(q){return"immersive-ar"==q||"immersive-vr"==q&&!1===this.canPresent?!1:!0};g.prototype.isFeatureSupported=function(q){switch(q){case "viewer":return!0;
case "local":return!0;case "local-floor":return!0;case "bounded":return!1;case "unbounded":return!1;default:return!1}};g.prototype.requestSession=function(q,x){var C=this,F,aa,pa;return m.asyncExecutePromiseGeneratorProgram(function(ra){if(1==ra.nextAddress){if(!C.isSessionSupported(q))return ra.return(Promise.reject());F="immersive-vr"==q;if(!F)return ra.jumpTo(2);aa=C.global.document.createElement("canvas");aa.getContext("webgl");return ra.yield(C.display.requestPresent([{source:aa,attributes:jg}]),
2)}pa=new k(q,x,{renderContextType:C.HAS_BITMAP_SUPPORT?"bitmaprenderer":"2d"});C.sessions.set(pa.id,pa);F&&(C.immersiveSession=pa,C.dispatchEvent("@@webxr-polyfill/vr-present-start",pa.id));return ra.return(Promise.resolve(pa.id))})};g.prototype.requestAnimationFrame=function(q){return this.display.requestAnimationFrame(q)};g.prototype.getPrimaryButtonIndex=function(q){var x=0,C=q.id.toLowerCase(),F;for(F in kg)if(C.includes(F)){x=kg[F];break}return Math.min(x,q.buttons.length-1)};g.prototype.onFrameStart=
function(q,x){this.display.depthNear=x.depthNear;this.display.depthFar=x.depthFar;this.display.getFrameData(this.frame);q=this.sessions.get(q);if(q.immersive&&this.CAN_USE_GAMEPAD){var C=this.gamepadInputSources;this.gamepadInputSources={};for(var F=this.global.navigator.getGamepads(),aa=0;aa<F.length;++aa){var pa=F[aa];if(pa&&0<pa.displayId){var ra=C[aa];ra||(ra=new h(this,this.display,this.getPrimaryButtonIndex(pa)));ra.updateFromGamepad(pa);this.gamepadInputSources[aa]=ra;if(-1!=ra.primaryButtonIndex){var Ia=
pa.buttons[ra.primaryButtonIndex].pressed;Ia&&!ra.primaryActionPressed?this.dispatchEvent("@@webxr-polyfill/input-select-start",{sessionId:q.id,inputSource:ra.inputSource}):!Ia&&ra.primaryActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-select-end",{sessionId:q.id,inputSource:ra.inputSource});ra.primaryActionPressed=Ia}-1!=ra.primarySqueezeButtonIndex&&((pa=pa.buttons[ra.primarySqueezeButtonIndex].pressed)&&!ra.primarySqueezeActionPressed?this.dispatchEvent("@@webxr-polyfill/input-squeeze-start",
{sessionId:q.id,inputSource:ra.inputSource}):!pa&&ra.primarySqueezeActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-squeeze-end",{sessionId:q.id,inputSource:ra.inputSource}),ra.primarySqueezeActionPressed=pa)}}}!q.immersive&&q.baseLayer&&(q=q.baseLayer.context.canvas,V(this.frame.leftProjectionMatrix,x.inlineVerticalFieldOfView,q.width/q.height,x.depthNear,x.depthFar))};g.prototype.onFrameEnd=function(q){q=this.sessions.get(q);if(!q.ended&&q.baseLayer){if(q.outputContext&&(!q.immersive||
this.display.capabilities.hasExternalDisplay)){var x=q.baseLayer.context.canvas,C=q.immersive&&this.display.capabilities.hasExternalDisplay?x.width/2:x.width,F=x.height,aa=q.outputContext.canvas,pa=aa.width;aa=aa.height;var ra=q.renderContext;this.HAS_BITMAP_SUPPORT?x.transferToImageBitmap?ra.transferFromImageBitmap(x.transferToImageBitmap()):this.global.createImageBitmap(x,0,0,C,F,{resizeWidth:pa,resizeHeight:aa}).then(function(Ia){return ra.transferFromImageBitmap(Ia)}):ra.drawImage(x,0,0,C,F,0,
0,pa,aa)}q.immersive&&q.baseLayer&&this.display.submitFrame()}};g.prototype.cancelAnimationFrame=function(q){this.display.cancelAnimationFrame(q)};g.prototype.endSession=function(q){var x=this,C;return m.asyncExecutePromiseGeneratorProgram(function(F){C=x.sessions.get(q);if(C.ended)return F.return();if(C.immersive)return F.return(x.display.exitPresent());C.ended=!0;F.jumpToEnd()})};g.prototype.doesSessionSupportReferenceSpace=function(q,x){q=this.sessions.get(q);return q.ended?!1:q.enabledFeatures.has(x)};
g.prototype.requestStageBounds=function(){if(this.display.stageParameters){var q=this.display.stageParameters.sizeX,x=this.display.stageParameters.sizeZ,C=[];C.push(-q/2);C.push(-x/2);C.push(q/2);C.push(-x/2);C.push(q/2);C.push(x/2);C.push(-q/2);C.push(x/2);return C}return null};g.prototype.requestFrameOfReferenceTransform=function(q){var x=this;return m.asyncExecutePromiseGeneratorProgram(function(C){return("local-floor"===q||"bounded-floor"===q)&&x.display.stageParameters&&x.display.stageParameters.sittingToStandingTransform?
C.return(x.display.stageParameters.sittingToStandingTransform):C.return(null)})};g.prototype.getProjectionMatrix=function(q){if("left"===q)return this.frame.leftProjectionMatrix;if("right"===q)return this.frame.rightProjectionMatrix;if("none"===q)return this.frame.leftProjectionMatrix;throw Error("eye must be of type 'left' or 'right'");};g.prototype.getViewport=function(q,x,C,F){q=this.sessions.get(q);var aa=C.context.canvas;C=aa.width;aa=aa.height;if(!q.immersive)return F.x=F.y=0,F.width=C,F.height=
aa,!0;if("left"===x||"none"===x)F.x=0;else if("right"===x)F.x=C/2;else return!1;F.y=0;F.width=C/2;F.height=aa;return!0};g.prototype.getBasePoseMatrix=function(){var q=this.frame.pose,x=q.position;q=q.orientation;if(!x&&!q)return this.baseModelMatrix;x||(x=this.tempVec3,x[0]=x[1]=x[2]=0);ya(this.baseModelMatrix,q,x);return this.baseModelMatrix};g.prototype.getBaseViewMatrix=function(q){if("left"===q||"none"===q)return this.frame.leftViewMatrix;if("right"===q)return this.frame.rightViewMatrix;throw Error("eye must be of type 'left' or 'right'");
};g.prototype.getInputSources=function(){var q=[],x;for(x in this.gamepadInputSources)q.push(this.gamepadInputSources[x].inputSource);return q};g.prototype.getInputPose=function(q,x,C){if(!x)return null;for(var F in this.gamepadInputSources){var aa=this.gamepadInputSources[F];if(aa.inputSource===q)return aa.getXRPose(x,C)}return null};g.prototype.onWindowResize=function(){};g.prototype.onVRDisplayPresentChange=function(){var q=this;this.display.isPresenting||this.sessions.forEach(function(x){if(x.immersive&&
!x.ended){if(x.modifiedCanvasLayer){var C=x.baseLayer.context.canvas;document.body.removeChild(C);C.setAttribute("style","")}q.immersiveSession===x&&(q.immersiveSession=null);q.dispatchEvent("@@webxr-polyfill/vr-present-end",x.id)}})};m.global.Object.defineProperties(g.prototype,{depthNear:{configurable:!0,enumerable:!0,get:function(){return this.display.depthNear},set:function(q){this.display.depthNear=q}},depthFar:{configurable:!0,enumerable:!0,get:function(){return this.display.depthFar},set:function(q){this.display.depthFar=
q}}});m.inherits(f,g);var Jh=0;m.inherits(d,r);d.prototype.onBaseLayerSet=function(q,x){this.sessions.get(q).baseLayer=x};d.prototype.isSessionSupported=function(q){return"inline"==q};d.prototype.isFeatureSupported=function(q){switch(q){case "viewer":return!0;default:return!1}};d.prototype.requestSession=function(q,x){var C=this,F;return m.asyncExecutePromiseGeneratorProgram(function(aa){if(!C.isSessionSupported(q))return aa.return(Promise.reject());F=new e(q,x);C.sessions.set(F.id,F);return aa.return(Promise.resolve(F.id))})};
d.prototype.requestAnimationFrame=function(q){return window.requestAnimationFrame(q)};d.prototype.cancelAnimationFrame=function(q){window.cancelAnimationFrame(q)};d.prototype.onFrameStart=function(q,x){q=this.sessions.get(q);q.baseLayer&&(q=q.baseLayer.context.canvas,V(this.projectionMatrix,x.inlineVerticalFieldOfView,q.width/q.height,x.depthNear,x.depthFar))};d.prototype.onFrameEnd=function(){};d.prototype.endSession=function(q){var x=this,C;return m.asyncExecutePromiseGeneratorProgram(function(F){C=
x.sessions.get(q);C.ended=!0;F.jumpToEnd()})};d.prototype.doesSessionSupportReferenceSpace=function(q,x){q=this.sessions.get(q);return q.ended?!1:q.enabledFeatures.has(x)};d.prototype.requestStageBounds=function(){return null};d.prototype.requestFrameOfReferenceTransform=function(){return m.asyncExecutePromiseGeneratorProgram(function(q){return q.return(null)})};d.prototype.getProjectionMatrix=function(){return this.projectionMatrix};d.prototype.getViewport=function(q,x,C,F){this.sessions.get(q);
x=C.context.canvas;q=x.width;x=x.height;F.x=F.y=0;F.width=q;F.height=x;return!0};d.prototype.getBasePoseMatrix=function(){return this.identityMatrix};d.prototype.getBaseViewMatrix=function(){return this.identityMatrix};d.prototype.getInputSources=function(){return[]};d.prototype.getInputPose=function(){return null};d.prototype.onWindowResize=function(){};var Ih={global:db,webvr:!0,cardboard:!0,cardboardConfig:null,allowCardboardOnDesktop:!1},ke=["navigator","HTMLCanvasElement","WebGLRenderingContext"];
a.prototype._injectPolyfill=function(q){if(!ke.every(function(F){return!!q[F]}))throw Error("Global must have the following attributes : "+ke);for(var x=m.makeIterator(Object.keys(df)),C=x.next();!C.done;C=x.next())C=C.value,void 0!==q[C]?console.warn(C+" already defined on global."):q[C]=df[C];w(q.WebGLRenderingContext)&&(p(q.HTMLCanvasElement),q.OffscreenCanvas&&p(q.OffscreenCanvas),q.WebGL2RenderingContext&&w(q.WebGL2RenderingContext),window.isSecureContext||console.warn("WebXR Polyfill Warning:\nThis page is not running in a secure context (https:// or localhost)!\nThis means that although the page may be able to use the WebXR Polyfill it will\nnot be able to use native WebXR implementations, and as such will not be able to\naccess dedicated VR or AR hardware, and will not be able to take advantage of\nany performance improvements a native WebXR implementation may offer. Please\nhost this content on a secure origin for the best user experience.\n"));
this.injected=!0;this._patchNavigatorXR()};a.prototype._patchNavigatorXR=function(){var q=b(this.global,this.config);this.xr=new df.XRSystem(q);Object.defineProperty(this.global.navigator,"xr",{value:this.xr,configurable:!0})};a.prototype._injectCompatibilityShims=function(q){if(!ke.every(function(C){return!!q[C]}))throw Error("Global must have the following attributes : "+ke);if(q.navigator.xr&&"supportsSession"in q.navigator.xr&&!("isSessionSupported"in q.navigator.xr)){var x=q.navigator.xr.supportsSession;
q.navigator.xr.isSessionSupported=function(C){return x.call(this,C).then(function(){return!0}).catch(function(){return!1})};q.navigator.xr.supportsSession=function(C){console.warn("navigator.xr.supportsSession() is deprecated. Please call navigator.xr.isSessionSupported() instead and check the boolean value returned when the promise resolves.");return x.call(this,C)}}};return a}
"object"===typeof exports&&"undefined"!==typeof module?module.exports=lc():"function"===typeof define&&define.amd?define(lc):this.WebXRPolyfill=lc();function oc(a,b,c,d,e,f,g,k){this.id=a;this.name=b;this.parentTexture=c;this.textureCropper=d;this.extractedTexture=this.stdExt=this.rawExt=null;this.uvOffsetScale=new G.Vector4(e,f,g,k);this.isCutout=!1;this.importAutoScale=this.importGpuCompress=!0}
oc.prototype={addLoadedListener:function(a){this.parentTexture.addLoadedListener(a)},extractTexture:function(){console.assert(null!==this.textureCropper);console.assert(null===this.extractedTexture);this.extractedTexture=this.textureCropper.cropTextureToPoTTarget(this.parentTexture,this.uvOffsetScale)},get hasAlpha(){return this.parentTexture.hasAlpha},serialize:function(){return{id:this.id,name:this.name,atlasId:this.parentTexture.id,atlasOffset:[this.uvOffsetScale.x,this.uvOffsetScale.y],atlasScale:[this.uvOffsetScale.z,
this.uvOffsetScale.w],rawExt:this.rawExt,stdExt:this.stdExt,webFormats:[],alpha:this.hasAlpha,importGpuCompress:this.importGpuCompress,importAutoScale:this.importAutoScale}}};
WALK.Texture=function(a,b,c,d,e,f,g,k){this.webFormats=this.stdExt=this.rawExt=this.name=this.id=null;this.isCube=!1;this.image=void 0!==a?a:WALK.Texture.DEFAULT_IMAGE;this.height=this.width=null;this.mipmaps=[];this.wrapS=void 0!==b?b:GLC.CLAMP_TO_EDGE;this.wrapT=void 0!==c?c:GLC.CLAMP_TO_EDGE;this.magFilter=void 0!==d?d:GLC.LINEAR;this.minFilter=void 0!==e?e:GLC.LINEAR_MIPMAP_LINEAR;this.anisotropy=void 0!==k?k:1;this.isRgbm=this.isCutout=this.hasAlpha=this.isAnimated=!1;this.format=void 0!==f?
f:GLC.RGBA;this.type=void 0!==g?g:GLC.UNSIGNED_BYTE;this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this._textureCropper=this._atlasEntries=null;this._needsUpdate=!1;this.releaseOnLoadedToGpu=!0;this.loaded=!1;this._loadedListeners=[];this.__webglSlot=this.__webglTexture=null;this.importAutoScale=this.importGpuCompress=!0;this.passphrase=null};WALK.Texture.DEFAULT_IMAGE=void 0;
WALK.Texture.prototype={constructor:WALK.Texture,sleepAnimation:function(){console.assert(!1)},wakeAnimation:function(){console.assert(!1)},get needsUpdate(){return this._needsUpdate},set needsUpdate(a){this._needsUpdate=a},isAtlas:function(){return null!==this._atlasEntries},enableAtlas:function(a){console.assert(!this.isAtlas());this._atlasEntries={};this._textureCropper=a},getAtlasEntry:function(a,b,c,d,e,f){var g=this._atlasEntries[b];if(g)return g;console.assert(!this.loaded);g=new oc(a,b,this,
this._textureCropper,c,d,e,f);return this._atlasEntries[b]=g},forEachAtlasEntry:function(a){for(var b in this._atlasEntries)this._atlasEntries.hasOwnProperty(b)&&a(this._atlasEntries[b])},clone:function(a){void 0===a&&(a=new WALK.Texture);a.isCube=a.isCube;a.image=this.image;a.mipmaps=this.mipmaps.slice(0);a.wrapS=this.wrapS;a.wrapT=this.wrapT;a.magFilter=this.magFilter;a.minFilter=this.minFilter;a.anisotropy=this.anisotropy;a.isCutout=this.isCutout;a.isAnimated=this.isAnimated;a.hasAlpha=this.hasAlpha;
a.format=this.format;a.type=this.type;a.generateMipmaps=this.generateMipmaps;a.premultiplyAlpha=this.premultiplyAlpha;a.flipY=this.flipY;a.unpackAlignment=this.unpackAlignment;a.passphrase=this.passphrase;return a},serialize:function(){var a={id:this.id,name:this.name,stdExt:this.stdExt,webFormats:this.webFormats,alpha:this.hasAlpha,importGpuCompress:this.importGpuCompress,importAutoScale:this.importAutoScale};this.passphrase&&(a.passphrase=this.passphrase);this.rawExt&&(a.rawExt=this.rawExt);this.isRgbm&&
(a.rgbm=!0);return a},dispose:function(){this._loadedListeners=[];this.dispatchEvent({type:"dispose"})},addLoadedListener:function(a){this.loaded?a():this._loadedListeners.push(a)},notifyLoaded:function(){this.loaded=!0;for(var a=this._loadedListeners,b=0;b<a.length;b+=1)a[b]();a.length=0}};G.EventDispatcher.prototype.apply(WALK.Texture.prototype);WALK.CompressedTexture=function(a,b,c,d,e,f,g,k,h,l){WALK.Texture.call(this,null,f,g,k,h,d,e,l);this.image={width:b,height:c};this.mipmaps=a;this.generateMipmaps=this.flipY=!1};WALK.CompressedTexture.prototype=Object.create(WALK.Texture.prototype);WALK.CompressedTexture.prototype.constructor=WALK.CompressedTexture;WALK.CompressedTexture.prototype.clone=function(){var a=new WALK.CompressedTexture;WALK.Texture.prototype.clone.call(this,a);return a};WALK.DataTexture=function(a,b,c,d,e,f,g,k,h,l){WALK.Texture.call(this,null,f,g,k,h,d,e,l);this.image={data:a,width:b,height:c}};WALK.DataTexture.prototype=Object.create(WALK.Texture.prototype);WALK.DataTexture.prototype.constructor=WALK.DataTexture;WALK.DataTexture.prototype.clone=function(){var a=new WALK.DataTexture;WALK.Texture.prototype.clone.call(this,a);return a};WALK.VideoTexture=function(a,b,c,d,e,f,g,k,h){var l=this;WALK.Texture.call(this,a,b,c,d,e,f,g,k,h);this.generateMipmaps=!1;this.isAnimated=!0;this.releaseOnLoadedToGpu=!1;this._isPlaying=!0;this._pauseRequested=this._isSleeping=!1;this._videoSrc=null;this._pausedTime=0;this._interruptible=!0;this._resizedListeners=[];this._handlePaused=function(){l._pauseRequested?l._pauseRequested=!1:l._isSleeping=!0;!l._isPlaying&&l._interruptible&&(l.video.src="")};this._handleEnded=function(){l._isPlaying=!1;
l._isSleeping=!1};this._notifyResized=function(){l.width=l.video.videoWidth;l.height=l.video.videoHeight;for(var n=0;n<l._resizedListeners.length;n+=1)l._resizedListeners[n]()}};WALK.VideoTexture.prototype=Object.create(WALK.Texture.prototype);WALK.VideoTexture.prototype.constructor=WALK.VideoTexture;WALK.VideoTexture.prototype._srcAtPausedPosition=function(){return this._videoSrc+"#t="+this._pausedTime};WALK.VideoTexture.prototype._pauseVideo=function(){this._pausedTime=this.video.currentTime;this.video.pause()};
WALK.VideoTexture.prototype.rewind=function(){this._pausedTime=0;this.video.currentTime=0};
Object.defineProperty(WALK.VideoTexture.prototype,"video",{get:function(){return this.image},set:function(a){console.assert(void 0===this.image,"Video already attached to texture.");this.image=a;this._videoSrc=a.src;this._isPlaying=!a.paused&&!a.ended;a.addEventListener("pause",this._handlePaused);a.addEventListener("ended",this._handleEnded);a.addEventListener("resize",this._notifyResized);this._isSleeping&&this._isPlaying&&this._pauseVideo()}});
Object.defineProperty(WALK.VideoTexture.prototype,"muted",{get:function(){return this.video.muted},set:function(a){this.video.muted=a}});Object.defineProperty(WALK.VideoTexture.prototype,"loop",{get:function(){return this.video.loop},set:function(a){this.video.loop=a}});Object.defineProperty(WALK.VideoTexture.prototype,"isPlaying",{get:function(){return!this._isSleeping&&this._isPlaying}});
WALK.VideoTexture.prototype.play=function(){var a=this;if(!this._isPlaying)if(this._isSleeping)this._isPlaying=!0;else{var b=this.video;this._interruptible&&(b.src=this._srcAtPausedPosition());var c=b.play();c?(this._isPlaying=!0,c.catch(function(d){console.log("Can't play video texture: "+d);a._isPlaying=!1})):this._isPlaying=!b.paused&&!b.ended}};WALK.VideoTexture.prototype.pause=function(){this._isPlaying&&this.video&&(this._isPlaying=!1,this._isSleeping||(this._pauseRequested=!0,this._pauseVideo()))};
WALK.VideoTexture.prototype.sleepAnimation=function(){this._isSleeping||(this._isPlaying&&this.video&&this._pauseVideo(),this._isSleeping=!0)};WALK.VideoTexture.prototype.wakeAnimation=function(){this._isSleeping&&(this._isPlaying&&this.video&&(this._interruptible&&(this.video.src=this._srcAtPausedPosition()),this.video.play()),this._isSleeping=!1)};
WALK.VideoTexture.prototype.dispose=function(){WALK.Texture.prototype.dispose.call(this);this._isPlaying&&this.pause();var a=this.video;this.image=null;this._videoSrc="";this._isPlaying=!1;a.src="";a.removeEventListener("pause",this._handlePaused);a.removeEventListener("ended",this._handleEnded);a.removeEventListener("resize",this._notifyResized);this._resizedListeners.length=0};WALK.VideoTexture.prototype.addResizedListener=function(a){this._resizedListeners.push(a)};
WALK.VideoTexture.prototype.serialize=function(){var a=WALK.Texture.prototype.serialize.call(this);a.video=!0;return a};Object.defineProperty(WALK.VideoTexture.prototype,"needsUpdate",{get:function(){return this._needsUpdate||this.isPlaying&&this.video&&!0!==this.video.seeking&&this.video.readyState>=this.video.HAVE_CURRENT_DATA},set:function(a){this._needsUpdate=a}});WALK.WebGLRenderTarget=function(a,b,c){this.y=this.x=0;this.width=a;this.height=b;c=c||{};this.wrapS=void 0!==c.wrapS?c.wrapS:GLC.CLAMP_TO_EDGE;this.wrapT=void 0!==c.wrapT?c.wrapT:GLC.CLAMP_TO_EDGE;this.magFilter=void 0!==c.magFilter?c.magFilter:GLC.LINEAR;this.minFilter=void 0!==c.minFilter?c.minFilter:GLC.LINEAR_MIPMAP_LINEAR;this.anisotropy=void 0!==c.anisotropy?c.anisotropy:1;this.offset=new G.Vector2(0,0);this.repeat=new G.Vector2(1,1);this.format=void 0!==c.format?c.format:GLC.RGBA;this.type=
void 0!==c.type?c.type:GLC.UNSIGNED_BYTE;this.depthBuffer=void 0!==c.depthBuffer?c.depthBuffer:!0;this.stencilBuffer=void 0!==c.stencilBuffer?c.stencilBuffer:!0;this.generateMipmaps=c.generateMipmaps||!1;this.shareDepthFrom=void 0!==c.shareDepthFrom?c.shareDepthFrom:null;this.isCube=!1;this.loaded=!0;this.__webglSlot=this.__webglTexture=this.__webglRenderbuffer=this.__webglFramebuffer=null};WALK.WebGLRenderTarget.prototype={constructor:WALK.WebGLRenderTarget,dispose:function(){this.dispatchEvent({type:"dispose"})}};
G.EventDispatcher.prototype.apply(WALK.WebGLRenderTarget.prototype);WALK.WebGLRenderTargetVR=function(a){this.__webglFramebuffer=a;this.height=this.width=this.y=this.x=null;this.isCube=!1};WALK.WebGLRenderTargetVR.prototype={constructor:WALK.WebGLRenderTargetVR,dispose:function(){this.__webglFramebuffer=null;this.dispatchEvent({type:"dispose"})}};G.EventDispatcher.prototype.apply(WALK.WebGLRenderTargetVR.prototype);WALK.WebGLRenderTargetCube=function(a,b,c){WALK.WebGLRenderTarget.call(this,a,b,c);this.activeCubeFace=0;this.isCube=!0;this.__webglFramebuffer=[];this.__webglRenderbuffer=[]};WALK.WebGLRenderTargetCube.prototype=Object.create(WALK.WebGLRenderTarget.prototype);WALK.WebGLRenderTargetCube.prototype.constructor=WALK.WebGLRenderTargetCube;var pc=WALK.DEBUG;
WALK.CutoutTextureDetector=function(a){var b={format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1},c=[a.createRenderTarget(1024,1024,b),a.createRenderTarget(512,512,b)];b={uniforms:{map:{type:"t",value:null},mapUvStep:{type:"v2",value:null},mapUvOffsetScale:{type:"v4",value:null}},vertexShader:WALK.getShader("alpha_stats_vertex.glsl"),fragmentShader:WALK.getShader("alpha_stats_fragment.glsl")};var d=new G.ShaderPass(b,"map");d.material.depthTest=
!1;d.material.depthWrite=!1;var e=new G.Vector2,f=new G.Vector4;d.uniforms.mapUvStep.value=e;d.uniforms.mapUvOffsetScale.value=f;b={uniforms:{map:{type:"t",value:null},mapUvStep:{type:"v2",value:null},mapUvScale:{type:"v2",value:null}},vertexShader:WALK.getShader("alpha_stats_vertex.glsl"),fragmentShader:WALK.getShader("alpha_stats_combine_fragment.glsl")};var g=new G.ShaderPass(b,"map");g.material.depthTest=!1;g.material.depthWrite=!1;var k=new G.Vector2;g.uniforms.mapUvScale.value=k;g.uniforms.mapUvStep.value=
e;var h=new Uint8Array(4096),l=null;pc&&(l=new WALK.Timer);this.isCutoutTexture=function(n){var r=void 0!==n.parentTexture;if(r){var v=n.parentTexture;var p=n.uvOffsetScale.x;var w=n.uvOffsetScale.y;var u=n.uvOffsetScale.z;var y=n.uvOffsetScale.w}else v=n,p=w=0,u=y=1;if(!v.hasAlpha||v.video)n.isCutout=!1;else{pc&&l.reset();a.enableScissorTest(!0);var B=v.width*u,D=v.height*y;e.set(1/B,1/D);f.set(p,w,u,y);B=Math.max(Math.floor(B/2),1);D=Math.max(Math.floor(D/2),1);a.setRenderTarget(c[0]);a.setViewport(0,
0,B,D);a.setScissor(0,0,B,D);d.render(a,c[0],v);for(var H=1,K=c[0];1!==B&&1!==D;){e.set(1/K.width,1/K.height);k.set(B/K.width,D/K.height);B=Math.floor(B/2);D=Math.floor(D/2);var J=c[H];a.setRenderTarget(J);a.setViewport(0,0,B,D);a.setScissor(0,0,B,D);g.render(a,J,K);K=J;H=(H+1)%2}a.readPixels(B,D,h);K=H=0;B=Math.max(B,D);for(D=0;D<B;++D)H+=h[4*D],K+=h[4*D+1];H=100*H/(255*B);K=100*K/(255*B);n.isCutout=20>H||50<K;pc&&(B="",r&&(B+="From atlas: "+v.name+" ["+p+", "+w+", "+u+", "+y+"]\n"),console.log(n.name+
" "+v.width+"x"+v.height+"\n "+B+"Is cutout: "+n.isCutout+"\n Partialy transparent regions: "+H+"%\n Fully transparent pixels: "+K+"%\n Time: "+l.elapsedSec()));a.enableScissorTest(!1)}};this.dispose=function(){c[0].dispose();c[1].dispose();d.dispose();g.dispose()}};WALK.TextureCropper=function(a){var b=new G.ShaderPass({uniforms:{srcTexture:{type:"t",value:null},uvOffsetScale:{type:"v4",value:null}},vertexShader:WALK.getShader("crop_texture_vertex.glsl"),fragmentShader:WALK.getShader("crop_texture_fragment.glsl")},"srcTexture");b.material.depthTest=!1;b.material.depthWrite=!1;this.cropTextureToPoTTarget=function(c,d){var e=G.Math.nextPowerOfTwo(d.z*c.width),f=G.Math.nextPowerOfTwo(d.w*c.height);e=a.createRenderTarget(e,f,{wrapS:GLC.REPEAT,wrapT:GLC.REPEAT,magFilter:GLC.LINEAR,
minFilter:GLC.LINEAR_MIPMAP_LINEAR,format:GLC.RGBA,type:GLC.UNSIGNED_BYTE,depthBuffer:!1,stencilBuffer:!1,generateMipmaps:!0});b.uniforms.uvOffsetScale.value=d;b.render(a,e,c);a.deallocateRenderTargetRenderingBuffers(e);return e}};WALK.SHADERS={};WALK.SHADERS["aabb_query_fragment.glsl"]="//AUTO GENERATED\nvarIn vec3 vPositionW;\nuniform int axis;\nvec4 encodeFloat(in float x) {\nfloat xabs = abs(x);\nfloat r = floor(xabs);\nfloat g = fract(xabs);\nreturn vec4(r / 255.0, g, 0.0, 0.0);\n}\nvoid main() {\nvec3 viewW = cameraPosition - vPositionW;\nif (axis == 0) {\nfragColor = encodeFloat(viewW.x);\n} else if (axis == 1) {\nfragColor = encodeFloat(viewW.y);\n} else if (axis == 2) {\nfragColor = encodeFloat(viewW.z);\n}\n}\n";
WALK.SHADERS["aabb_query_vertex.glsl"]="//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nvarOut vec3 vPositionW;\nvoid main() {\nvec4 transformedPosition = transformPosition();\nvPositionW = (modelMatrix * transformedPosition).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * transformedPosition;\n}\n";
WALK.SHADERS["accumulate_fragment.glsl"]="//AUTO GENERATED\nuniform float weight;\nuniform sampler2D inputBuffer;\nvarIn vec2 vUv;\nvoid main() {\nvec3 inputColor = texture2D(inputBuffer, vUv).rgb;\nfragColor = vec4(inputColor, weight);\n}\n";WALK.SHADERS["accumulate_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["alpha_stats_combine_fragment.glsl"]="//AUTO GENERATED\nuniform sampler2D map;\nuniform vec2 mapUvStep;\nuniform vec2 mapUvScale;\nvarIn vec2 vUv;\nvoid main() {\nvec2 corner = vUv * mapUvScale- mapUvStep;\nvec2 uv = corner + 0.5 * mapUvStep;\nvec4 p0 = texture2D(map, uv);\nvec4 p1 = texture2D(map, uv + vec2(0.0, mapUvStep.y));\nvec4 p2 = texture2D(map, uv + vec2(mapUvStep.x, 0.0));\nvec4 p3 = texture2D(map, uv + vec2(mapUvStep.x, mapUvStep.y));\nfragColor = vec4((p0.r + p1.r + p2.r + p3.r) / 4.0,\n(p0.g + p1.g + p2.g + p3.g) / 4.0, 0.0, 1.0);\nreturn;\n}\n";
WALK.SHADERS["alpha_stats_fragment.glsl"]="//AUTO GENERATED\nuniform sampler2D map;\nuniform vec2 mapUvStep;\nuniform vec4 mapUvOffsetScale;\nvarIn vec2 vUv;\nvoid main() {\nvec2 corner = vUv * mapUvOffsetScale.zw + mapUvOffsetScale.xy - mapUvStep;\nvec2 uv = corner + 0.5 * mapUvStep;\nconst float bias = -1.0;\nfloat a0 = texture2D(map, uv, bias).a;\nfloat a1 = texture2D(map, uv + vec2(0.0, mapUvStep.y), bias).a;\nfloat a2 = texture2D(map, uv + vec2(mapUvStep.x, 0.0), bias).a;\nfloat a3 = texture2D(map, uv + vec2(mapUvStep.x, mapUvStep.y), bias).a;\nfloat fully_transparent_count = step(0.0, -a0) + step(0.0, -a1) +\nstep(0.0, -a2) + step(0.0, -a3);\nfloat partialy_transparent_count =\nstep(0.0, -abs(clamp(a0, 0.05, 0.95) - a0)) +\nstep(0.0, -abs(clamp(a1, 0.05, 0.95) - a1)) +\nstep(0.0, -abs(clamp(a2, 0.05, 0.95) - a2)) +\nstep(0.0, -abs(clamp(a3, 0.05, 0.95) - a3));\nfragColor = vec4(step(4.0, partialy_transparent_count),\nfully_transparent_count / 4.0,\n0.0, 1.0);\nreturn;\n}\n";
WALK.SHADERS["alpha_stats_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["anchor_sprite_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\nvec4 mvPosition = modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0);\nvec2 scale;\nscale.x = length(modelMatrix[0].xyz);\nscale.y = length(modelMatrix[1].xyz);\nvec2 alignedPosition = position.xy * scale;\nmvPosition.xy += alignedPosition;\ngl_Position = projectionMatrix * mvPosition;\n}\n";
WALK.SHADERS["anchor_vertex.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nvec3 sphericalDecode(in vec2 spNormal) {\nfloat theta = (spNormal.x / 254.0 + 0.5) * PI;\nfloat phi = spNormal.y * (PI / 127.0);\nfloat sinTheta = sin(theta);\nreturn vec3(sinTheta * cos(phi), sinTheta * sin(phi), cos(theta));\n}\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE)\nvarOut vec2 vUv;\n#endif\n#if defined(USE_BUMP_TEXTURE)\nvarOut vec3 vNormalV;\nvarOut vec3 vPositionV;\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvarOut vec3 vNormalW;\nvarOut vec3 vPositionW;\n#endif\nvoid main() {\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvec3 positionW = (modelMatrix * vec4(position, 1.0)).xyz;\nvec3 normal = sphericalDecode(sphericalNormal);\nvec3 normalW = mat3(modelMatrix[0].xyz,\nmodelMatrix[1].xyz,\nmodelMatrix[2].xyz) * normal;\nnormalW = normalize(normalW);\n#endif\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE)\nvec3 anchorCenterW = vec3(modelMatrix[3].xyz);\nvec3 cameraUpW = vec3(modelViewMatrix[0].y,\nmodelViewMatrix[1].y,\nmodelViewMatrix[2].y);\nvec3 forwardW = normalize(anchorCenterW - cameraPosition);\nvec3 rightW = cross(forwardW, cameraUpW);\nrightW.z = 0.0;\nrightW = normalize(rightW);\nvec3 upW = cross(rightW, forwardW);\nvUv = vec2(dot(normalW, rightW) * 0.5 + 0.5, dot(normalW, upW) * 0.5 + 0.5);\n#endif\nvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n#if defined(USE_BUMP_TEXTURE)\nvPositionV = -mvPosition.xyz;\nvNormalV = normalize(normalMatrix * normal);\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvNormalW = normalW;\nvPositionW = positionW;\n#endif\ngl_Position = projectionMatrix * mvPosition;\n}\n";
WALK.SHADERS["cap_fragment.glsl"]="//AUTO GENERATED\nuniform vec3 color;\nvoid main() {\nfragColor = vec4(color, 1.0);\n}\n";WALK.SHADERS["cap_vertex.glsl"]="//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nvoid main() {\nvec4 transformedPosition = transformPosition();\ngl_Position = projectionMatrix * modelViewMatrix * transformedPosition;\n}\n";
WALK.SHADERS["copy_opaque_fragment.glsl"]="//AUTO GENERATED\nuniform sampler2D tDiffuse;\nvarIn vec2 vUv;\nvoid main() {\nfragColor = vec4(texture2D(tDiffuse, vUv).rgb, 1.0);\n}\n";WALK.SHADERS["copy_opaque_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["crop_texture_fragment.glsl"]="//AUTO GENERATED\nuniform sampler2D srcTexture;\nuniform vec4 uvOffsetScale;\nvarIn vec2 vUv;\nvoid main() {\nfragColor = texture2D(srcTexture, uvOffsetScale.xy + vUv * uvOffsetScale.zw);\n}\n";
WALK.SHADERS["crop_texture_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["cubemap_filter_fragment.glsl"]="//AUTO GENERATED\nvec3 hdrDecode(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = rgbm.rgb * (rgbmScale * (1.0 - rgbm.a));\nreturn r * r;\n}\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nfloat rnd(vec2 uv) {\nreturn fract(sin(dot(uv, vec2(12.9898, 78.233) * 2.0)) * 43758.5453);\n}\nvec3 hemisphereSample_cos(vec2 uv, mat3 vecSpace, vec3 cubeDir, float gloss) {\nfloat phi = uv.y * 2.0 * PI;\nfloat cosTheta = sqrt(1.0 - uv.x);\nfloat sinTheta = sqrt(1.0 - cosTheta * cosTheta);\nvec3 sampleDir = vec3(cos(phi) * sinTheta, sin(phi) * sinTheta, cosTheta);\nreturn normalize(mix(vecSpace * sampleDir, cubeDir, gloss));\n}\nmat3 matrixFromVector(vec3 n) { // frisvad\nfloat a = 1.0 / (1.0 + n.z);\nfloat b = -n.x * n.y * a;\nvec3 b1 = vec3(1.0 - n.x * n.x * a, b, -n.x);\nvec3 b2 = vec3(b, 1.0 - n.y * n.y * a, -n.y);\nreturn mat3(b1, b2, n);\n}\nuniform samplerCube envMap;\nuniform float mipSize;\nuniform float face;\nuniform float gloss;\nvoid main(void) {\nvec2 st = 2.0 * floor(gl_FragCoord.xy) / (mipSize - 1.0) - 1.0;\nvec3 vec;\nif (face == 0.0) {\nvec = vec3(1, -st.y, -st.x);\n} else if (face == 1.0) {\nvec = vec3(-1, -st.y, st.x);\n} else if (face == 2.0) {\nvec = vec3(st.x, 1, st.y);\n} else if (face == 3.0) {\nvec = vec3(st.x, -1, -st.y);\n} else if (face == 4.0) {\nvec = vec3(st.x, -st.y, 1);\n} else {\nvec = vec3(-st.x, -st.y, -1);\n}\nmat3 vecSpace = matrixFromVector(normalize(vec));\nvec3 color = vec3(0.0);\nconst int samples = 200;\nvec3 vect;\nfor(int i = 0; i < samples; i++) {\nfloat sini = sin(float(i));\nfloat cosi = cos(float(i));\nfloat rand = rnd(vec2(sini, cosi));\nvect = hemisphereSample_cos(\nvec2(float(i) / float(samples), rand), vecSpace, vec, gloss);\ncolor += hdrDecode(textureCube(envMap, vect));\n}\ncolor /= float(samples);\nfragColor = hdrEncode(color);\n}\n";
WALK.SHADERS["cubemap_filter_vertex.glsl"]="//AUTO GENERATED\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["cube_to_equirect_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nuniform samplerCube panoramaCube;\nvarIn vec2 vUv;\nvoid main() {\nvec2 uv = vUv;\nfloat longitude = uv.x * 2. * PI;\nfloat latitude = uv.y * PI;\nvec3 dir = vec3(\nsin(longitude) * sin(latitude),\ncos(longitude) * sin(latitude),\ncos(latitude));\nfragColor = textureCube(panoramaCube, normalize(dir));\n}\n";
WALK.SHADERS["cube_to_equirect_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main()  {\nvUv = vec2(uv.x, uv.y - 1.0);\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["editor_light_fragment.glsl"]="//AUTO GENERATED\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 linearToGammaUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nuniform vec3 color;\nuniform vec3 highlight;\nuniform float highlightMix;\nvarIn vec3 vNormal;\nvarIn vec3 vViewPosition;\nvoid main() {\nvec3 lVector = normalize(vViewPosition.xyz);\nfloat pointDiffuse = max(dot(normalize(vNormal), lVector), 0.0);\nvec3 lightColor = color * pointDiffuse;\nlightColor = mix(lightColor, highlight, highlightMix);\nfragColor = vec4(min(linearToGamma(lightColor), 1.0), 1.0);\n}\n";
WALK.SHADERS["editor_light_vertex.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nvec3 sphericalDecode(in vec2 spNormal) {\nfloat theta = (spNormal.x / 254.0 + 0.5) * PI;\nfloat phi = spNormal.y * (PI / 127.0);\nfloat sinTheta = sin(theta);\nreturn vec3(sinTheta * cos(phi), sinTheta * sin(phi), cos(theta));\n}\nvarOut vec3 vNormal;\nvarOut vec3 vViewPosition;\nvoid main() {\nvec3 normal = sphericalDecode(sphericalNormal);\nvNormal = normalize(normalMatrix * normal);\nvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\nvViewPosition = -mvPosition.xyz;\ngl_Position = projectionMatrix * mvPosition;\n}\n";
WALK.SHADERS["equirect_sky_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nfloat _g2l(in float x) {\nreturn (x <= 0.04045) ? x / 12.92 : pow((x + 0.055) / 1.055, 2.4);\n}\nvec3 gammaToLinear(in vec3 rgb) {\nreturn vec3(_g2l(rgb.r), _g2l(rgb.g), _g2l(rgb.b));\n}\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 linearToGammaUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nvec3 hdrDecode(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = rgbm.rgb * (rgbmScale * (1.0 - rgbm.a));\nreturn r * r;\n}\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\nuniform sampler2D map;\nuniform float exposure;\nuniform float cameraGamma;\nvarIn vec2 vUv;\n#ifdef USE_COLORMAP\nvec3 colormap(in sampler2D lut, in vec3 color) {\nconst float resolution = 16.0;\nconst float maxValueIndex = resolution - 1.0;\nconst float sliceWidth = 1.0 / resolution;\nconst float slicePixelWidth = sliceWidth / resolution;\nconst float sliceMarginWidth = 0.5 * slicePixelWidth;\nconst float sliceInnerWidth = sliceWidth - slicePixelWidth;\nconst float slicePixelHeight = 1.0 / resolution;\nconst float sliceMarginHeight = 0.5 * slicePixelHeight;\nconst float sliceInnerHeight = 1.0 - slicePixelHeight;\nfloat bSlice0 = min(floor(color.b * maxValueIndex), maxValueIndex - 1.0);\nfloat bSlice1 = bSlice0 + 1.0;\nfloat bOffset = color.b * maxValueIndex - bSlice0;\nfloat rSlicePos = sliceMarginWidth + color.r * sliceInnerWidth;\nfloat gSlicePos = sliceMarginHeight + color.g * sliceInnerHeight;\nfloat rPos0 = rSlicePos + (bSlice0 * sliceWidth);\nfloat rPos1 = rSlicePos + (bSlice1 * sliceWidth);\nvec3 color0 = texture2D(lut, vec2(rPos0, gSlicePos)).rgb;\nvec3 color1 = texture2D(lut, vec2(rPos1, gSlicePos)).rgb;\nreturn mix(color0, color1, bOffset);\n}\nuniform sampler2D colorMap;\n#endif\nvoid main() {\n#ifdef USE_RGBM_MAP\nvec4 colorRgbm = texture2D(map, vUv);\nvec3 colorLinear = hdrDecode(colorRgbm);\n#else\nvec3 colorLinear = gammaToLinear(texture2D(map, vUv).xyz);\n#endif\n#ifdef HDR_OUTPUT\n#ifdef USE_RGBM_MAP\nfragColor = colorRgbm;\n#else\nfragColor = hdrEncode(10.0 * colorLinear);\n#endif\n#else\nvec3 colorExposed = pow(exposure * colorLinear, vec3(cameraGamma));\nvec3 colorGamma =  linearToGammaUnreal(colorExposed);\n#ifdef USE_COLORMAP\nfragColor = vec4(colormap(colorMap, colorGamma), 1.0);\n#else\nfragColor = vec4(colorGamma, 1.0);\n#endif\n#endif\n}\n";
WALK.SHADERS["equirect_sky_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["gaze_pointer_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nconst float pointRadius = 0.01;\nconst float pointBorder = 0.005;\nconst float timerRadius = 0.04;\nconst float timerBorder = 0.02;\nconst vec3 timerColor =  vec3(0.298, 0.619, 0.851);\nvarIn vec2 coords;\nuniform float circleSpan;\nvoid main() {\nfloat dist =  sqrt(dot(coords, coords));\nif (dist < pointRadius) {\nfloat a = 1.0 - smoothstep(pointRadius - pointBorder, pointRadius, dist);\nfragColor = vec4(1.0, 1.0, 1.0, a);\n} else if (-atan(coords.x, -coords.y) < circleSpan) {\nfloat a2 = smoothstep(timerRadius - timerBorder, timerRadius, dist) -\nsmoothstep(timerRadius, timerRadius + timerBorder, dist);\nfragColor = vec4(timerColor, a2);\n} else {\ndiscard;\n}\n}\n";
WALK.SHADERS["gaze_pointer_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 coords;\nvoid main() {\ncoords = vec2(position.x, position.y);\nvec4 outPosition = projectionMatrix *  modelViewMatrix * vec4(position, 1.0);\noutPosition.z = -0.1;\ngl_Position = outPosition;\n}\n";WALK.SHADERS["luma_fragment.glsl"]="//AUTO GENERATED\nvec3 hdrDecode(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = rgbm.rgb * (rgbmScale * (1.0 - rgbm.a));\nreturn r * r;\n}\n#ifdef USE_LIGHTMAP\nwebgl2centroid varIn vec2 vUv2;\nuniform sampler2D lightMap;\nvec3 getLightIntensity() {\nreturn hdrDecode(texture2D(lightMap, vUv2));\n}\n#else // NOT USE_LIGHTMAP\nvec3 getLightIntensity() {\nreturn vec3(1.0);\n}\n#endif\nuniform vec3 color;\nvoid main() {\nvec3 receivedLight = getLightIntensity();\nvec3 diffuseLight = receivedLight * color;\nfloat luma = 0.299 * diffuseLight.r +\n0.587 * diffuseLight.g +\n0.114 * diffuseLight.b;\nfragColor.r = fract(luma);\nfragColor.g = floor(luma) / 255.0;\n}\n";
WALK.SHADERS["minimap_add_alpha_fragment.glsl"]="//AUTO GENERATED\nuniform sampler2D tColor;\n#ifdef USE_ALPHA_FROM_COLOR\nuniform vec3 colorFill;\n#else\nuniform sampler2D tAlpha;\n#endif\nvarIn vec2 vUv;\nvoid main() {\nvec4 color = texture2D(tColor, vUv);\n#ifdef USE_ALPHA_FROM_COLOR\nfloat alphaFromColor = (color.r + color.g + color.b) / 3.0;\nfragColor = vec4(colorFill, alphaFromColor);\n#else\nfloat alpha = vec4(texture2D(tAlpha, vUv)).a;\nfragColor = vec4(color.rgb, alpha);\n#endif\n}\n";
WALK.SHADERS["minimap_add_alpha_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["mirror_fragment.glsl"]="//AUTO GENERATED\nuniform vec3 mirrorColor;\nuniform sampler2D mirrorSampler;\nvarIn vec4 mirrorCoord;\nfloat blendOverlay(float base, float blend) {\nreturn (base < 0.5 ? (2.0 * base * blend) :\n(1.0 - 2.0 * (1.0 - base) * (1.0 - blend)));\n}\nvoid main() {\nvec4 color = texture2DProj(mirrorSampler, mirrorCoord);\ncolor = vec4(blendOverlay(mirrorColor.r, color.r),\nblendOverlay(mirrorColor.g, color.g),\nblendOverlay(mirrorColor.b, color.b), 1.0);\nfragColor = color;\n}\n";
WALK.SHADERS["mirror_vertex.glsl"]="//AUTO GENERATED\nuniform mat4 textureMatrix;\nvarOut vec4 mirrorCoord;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\nvec4 worldPosition = modelMatrix * vec4(position, 1.0);\nmirrorCoord = textureMatrix * worldPosition;\ngl_Position = projectionMatrix * mvPosition;\n}\n";WALK.SHADERS["object_distance_vertex.glsl"]="//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nvarOut vec3 vPositionW;\nvoid main() {\nvec4 transformedPosition = transformPosition();\nvPositionW = (modelMatrix * transformedPosition).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * transformedPosition;\n}\n";
WALK.SHADERS["object_id_distance_fragment.glsl"]="//AUTO GENERATED\nuniform int objectId;\nvarIn vec3 vPositionW;\nvoid main(void) {\nfloat cameraDistance = min(distance(cameraPosition, vPositionW), 255.0);\nint x = objectId / 256;\nint y = objectId - 256 * x;\nfloat z = floor(cameraDistance);\nfloat a = fract(cameraDistance);\nfragColor = vec4(float(x) / 255.0, float(y) / 255.0,\nz / 255.0, a);\n}\n";WALK.SHADERS["object_id_fragment.glsl"]="//AUTO GENERATED\nuniform int objectId;\nvarIn vec3 vPositionW;\nvoid main(void) {\nint x = objectId / (256 * 256);\nint y = (objectId - 256 * 256 * x) / 256;\nint z = (objectId - 256 * 256 * x - 256 * y);\nfragColor = vec4(float(x) / 255.0, float(y) / 255.0,\nfloat(z) / 255.0, 0);\n}\n";
WALK.SHADERS["outline_fragment.glsl"]="//AUTO GENERATED\nuniform vec3 color;\nvoid main() {\nfragColor = vec4(color, 1.0);\n}\n";WALK.SHADERS["outline_vertex.glsl"]="//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nvec3 sphericalDecode(in vec2 spNormal) {\nfloat theta = (spNormal.x / 254.0 + 0.5) * PI;\nfloat phi = spNormal.y * (PI / 127.0);\nfloat sinTheta = sin(theta);\nreturn vec3(sinTheta * cos(phi), sinTheta * sin(phi), cos(theta));\n}\nuniform float thickness;\nvoid main() {\nvec3 n = sphericalDecode(sphericalNormal);\nvec3 normal = vec3(\nt0.x * n.x + t0.y * n.y + t0.z * n.z,\nt1.x * n.x + t1.y * n.y + t1.z * n.z,\nt2.x * n.x + t2.y * n.y + t2.z * n.z);\nvec4 transformedPosition = transformPosition();\nfloat distToCamera = cameraPosition.z - transformedPosition.z;\nvec4 movedPosition = vec4(\ntransformedPosition.x - distToCamera * thickness * normal.x,\ntransformedPosition.y - distToCamera * thickness * normal.y,\ntransformedPosition.z, transformedPosition.w);\ngl_Position = projectionMatrix * modelViewMatrix * movedPosition;\n}\n";
WALK.SHADERS["procedural_sky_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nuniform vec3 topColor;\nuniform vec3 bottomColor;\nuniform float sinBottomAngle;\nuniform float exponent;\nvarIn vec3 vWorldDirection;\n#ifdef HDR_OUTPUT\nfloat _g2l(in float x) {\nreturn (x <= 0.04045) ? x / 12.92 : pow((x + 0.055) / 1.055, 2.4);\n}\nvec3 gammaToLinear(in vec3 rgb) {\nreturn vec3(_g2l(rgb.r), _g2l(rgb.g), _g2l(rgb.b));\n}\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\n#endif\n#ifdef USE_COLORMAP\nvec3 colormap(in sampler2D lut, in vec3 color) {\nconst float resolution = 16.0;\nconst float maxValueIndex = resolution - 1.0;\nconst float sliceWidth = 1.0 / resolution;\nconst float slicePixelWidth = sliceWidth / resolution;\nconst float sliceMarginWidth = 0.5 * slicePixelWidth;\nconst float sliceInnerWidth = sliceWidth - slicePixelWidth;\nconst float slicePixelHeight = 1.0 / resolution;\nconst float sliceMarginHeight = 0.5 * slicePixelHeight;\nconst float sliceInnerHeight = 1.0 - slicePixelHeight;\nfloat bSlice0 = min(floor(color.b * maxValueIndex), maxValueIndex - 1.0);\nfloat bSlice1 = bSlice0 + 1.0;\nfloat bOffset = color.b * maxValueIndex - bSlice0;\nfloat rSlicePos = sliceMarginWidth + color.r * sliceInnerWidth;\nfloat gSlicePos = sliceMarginHeight + color.g * sliceInnerHeight;\nfloat rPos0 = rSlicePos + (bSlice0 * sliceWidth);\nfloat rPos1 = rSlicePos + (bSlice1 * sliceWidth);\nvec3 color0 = texture2D(lut, vec2(rPos0, gSlicePos)).rgb;\nvec3 color1 = texture2D(lut, vec2(rPos1, gSlicePos)).rgb;\nreturn mix(color0, color1, bOffset);\n}\nuniform sampler2D colorMap;\n#endif\nvoid main() {\nfloat sinDirection = normalize(vWorldDirection).z;\nfloat w = max(0.0, (sinDirection - sinBottomAngle) / (1.0 - sinBottomAngle));\nvec3 colorGamma = mix(bottomColor, topColor, pow(w, exponent));\n#ifdef HDR_OUTPUT\nvec3 colorLinear = gammaToLinear(colorGamma);\nfragColor = hdrEncode(10.0 * colorLinear);\n#else\n#ifdef USE_COLORMAP\nfragColor = vec4(colormap(colorMap, colorGamma), 1.0);\n#else\nfragColor = vec4(colorGamma, 1.0);\n#endif\n#endif\n}\n";
WALK.SHADERS["procedural_sky_vertex.glsl"]="//AUTO GENERATED\nvarOut vec3 vWorldDirection;\nvoid main() {\nvec3 positionW = (modelMatrix * vec4(position, 1.0)).xyz;\nvWorldDirection = positionW - cameraPosition;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["rotate_gizmo_material_fragment.glsl"]="//AUTO GENERATED\nuniform vec3 color;\nuniform float opacity;\nuniform vec3 gizmoPosition;\nuniform float sphereRadius;\nvarIn vec4 mPosition;\nvoid discardIfRayIntersectsSphere(vec3 r0, vec3 rd, vec3 s0, float sr) {\nfloat a = dot(rd, rd);\nvec3 s0_r0 = r0 - s0;\nfloat b = 2.0 * dot(rd, s0_r0);\nfloat c = dot(s0_r0, s0_r0) - (sr * sr);\nfloat delta = b * b - 4.0 * a * c;\nif (delta >= 0.0 && -b - sqrt(delta) > 0.0) {\ndiscard;\n}\n}\nvoid main() {\nvec4 outColor;\noutColor.rgb = color;\noutColor.a = opacity;\nvec3 toCamera = normalize(cameraPosition - gizmoPosition);\ndiscardIfRayIntersectsSphere(mPosition.xyz, toCamera, gizmoPosition, sphereRadius);\nfragColor = outColor;\n}\n";
WALK.SHADERS["rotate_gizmo_material_vertex.glsl"]="//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nvarOut vec4 mPosition;\nvoid main() {\nvec4 p = vec4(position, 1.0);\nmPosition = modelMatrix * p;\nvec4 mvPosition = modelViewMatrix * p;\ngl_Position = projectionMatrix * mvPosition;\n}\n";
WALK.SHADERS["standard_material_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nfloat _g2l(in float x) {\nreturn (x <= 0.04045) ? x / 12.92 : pow((x + 0.055) / 1.055, 2.4);\n}\nvec3 gammaToLinear(in vec3 rgb) {\nreturn vec3(_g2l(rgb.r), _g2l(rgb.g), _g2l(rgb.b));\n}\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 linearToGammaUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nvec3 hdrDecode(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = rgbm.rgb * (rgbmScale * (1.0 - rgbm.a));\nreturn r * r;\n}\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvarIn vec3 vNormalW;\nvarIn vec3 vPositionW;\n#endif\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE)\nvarIn vec2 vUv;\n#endif\n#if defined(USE_BUMP_TEXTURE)\nvarIn vec3 vPositionV;\nvarIn vec3 vNormalV;\nuniform float bumpScale;\nuniform sampler2D bumpTexture;\nvec2 dBumpdxy() {\nvec2 texdx = dFdx(vUv);\nvec2 texdy = dFdy(vUv);\nfloat Hll = bumpScale * texture2D(bumpTexture, vUv).x;\nfloat dBx = bumpScale * texture2D(bumpTexture, vUv + texdx).x - Hll;\nfloat dBy = bumpScale * texture2D(bumpTexture, vUv + texdy).x - Hll;\nreturn vec2(dBx, dBy);\n}\nvec3 perturbNormal(in vec3 surfPos, in vec3 surfNorm) {\nvec2 dBdxy = dBumpdxy();\nvec3 vSigmaX = dFdx(surfPos);\nvec3 vSigmaY = dFdy(surfPos);\nvec3 R1 = cross(vSigmaY, surfNorm);\nvec3 R2 = cross(surfNorm, vSigmaX);\nfloat fDet = dot(vSigmaX, R1);\nvec3 vGrad = sign(fDet) * (dBdxy.x * R1 + dBdxy.y * R2);\nreturn normalize(abs(fDet) * surfNorm - vGrad);\n}\n#endif\n#ifdef USE_BASE_COLOR_TEXTURE\nuniform sampler2D baseColorTexture;\nuniform vec4 baseColorAtlasUvMod;\nuniform float alphaDiscardThreshold;\n#ifdef USE_PARALLAX_CORRECTION\n#endif\n#else\nuniform vec3 baseColor;\n#endif\nuniform float opacity;\nuniform vec4 baseColorCorrection;\nvec3 getBaseColor(out float alpha) {\n#ifdef USE_BASE_COLOR_TEXTURE\n#ifdef USE_PARALLAX_CORRECTION\n#else\nvec2 uv = vUv;\n#endif\n#ifdef USE_BASE_COLOR_TEXTURE_ATLAS_REPEAT\nvec2 uvScaled = uv * baseColorAtlasUvMod.zw;\nvec2 dfdx = dFdx(uvScaled);\nvec2 dfdy = dFdy(uvScaled);\nuv = fract(uv) * baseColorAtlasUvMod.zw + baseColorAtlasUvMod.xy;\nvec4 baseColorGamma = texture2DGradEXT(baseColorTexture, uv, dfdx, dfdy);\nfloat textureAlpha = baseColorGamma.a;\n#else\nuv = uv * baseColorAtlasUvMod.zw + baseColorAtlasUvMod.xy;\n#ifdef USE_ALPHA_IN_LOWER_HALF\nvec4 baseColorGamma = texture2D(baseColorTexture,\nvec2(uv.x, .5 + .5 * uv.y));\nfloat textureAlpha = texture2D(baseColorTexture,\nvec2(uv.x, .5 * uv.y)).r;\n#else\nvec4 baseColorGamma = texture2D(baseColorTexture, uv);\nfloat textureAlpha = baseColorGamma.a;\n#endif\n#endif\nvec3 baseColor = gammaToLinear(baseColorGamma.rgb);\nalpha = opacity * textureAlpha;\n#else // NOT USE_BASE_COLOR_TEXTURE\nalpha = opacity;\n#endif\nvec3 baseColorCorrected = baseColorCorrection.a * baseColor +\nbaseColorCorrection.rgb;\nreturn clamp(baseColorCorrected, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));\n}\n#ifdef USE_LIGHTMAP\nwebgl2centroid varIn vec2 vUv2;\nuniform sampler2D lightMap;\nvec3 getLightIntensity() {\nreturn hdrDecode(texture2D(lightMap, vUv2));\n}\n#else // NOT USE_LIGHTMAP\nvec3 getLightIntensity() {\nreturn vec3(1.0);\n}\n#endif\n#ifdef USE_ROUGHNESS_TEXTURE\nuniform sampler2D roughnessTexture;\n#else\nuniform float roughness;\n#endif\n#ifdef USE_METALLIC_TEXTURE\nuniform sampler2D metallicTexture;\n#else\nuniform float metallic;\n#endif\nvec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity,\ninout float opacity);\n#if defined(USE_ENVMAP)\nconst float DLT = 0.001;\nuniform samplerCube envMap;\nuniform float envMipsCount;\n#ifdef HAVE_TEXTURE_LOD\n#else\nuniform samplerCube envMap2;\n#endif\nstruct Roughness {\nfloat envFresnel; // (1.0 - roughness)^2, used for Fresnel with env map\nfloat envMipLevel0;\nfloat envMipLevel1;\nfloat envMipMixFactor;\n};\nRoughness getRoughnessFactors() {\nRoughness r;\n#ifdef USE_ROUGHNESS_TEXTURE\nfloat roughness = texture2D(roughnessTexture, vUv).x;\n#endif // else roughness is a uniform\nfloat roughness2 = roughness * roughness;\nfloat maxMipLevel = envMipsCount - 1.0;\nfloat mipSelector = roughness * maxMipLevel;\nr.envMipLevel0 = floor(mipSelector);\nr.envMipLevel1 = min(r.envMipLevel0 + 1.0, maxMipLevel);\nr.envMipMixFactor = fract(mipSelector);\nr.envFresnel = (roughness2 - 2.0 * roughness + 1.0);\nreturn r;\n}\n#ifdef USE_ENVMAP_PROJECT\nuniform vec3 envBoxMin;\nuniform vec3 envBoxMax;\nuniform vec3 envMapPosW;\nconst vec3 infBox = vec3(1000.0);\nvec3 cubeMapProject(vec3 reflectionW) {\nvec3 firstPlaneIntersect = (envBoxMax - vPositionW) / reflectionW;\nvec3 secondPlaneIntersect = (envBoxMin - vPositionW) / reflectionW;\nvec3 furthestPlane = max(firstPlaneIntersect, secondPlaneIntersect);\nvec3 furthestPlaneNonNeg =\nstep(0.0, -furthestPlane) * infBox + abs(furthestPlane);\nfloat distance = min(min(furthestPlaneNonNeg.x, furthestPlaneNonNeg.y),\nfurthestPlaneNonNeg.z);\n/*if (furthestPlane.x > 0.0){\ndistance = furthestPlane.x;\n}\nif (furthestPlane.y > 0.0) {\ndistance = min(distance, furthestPlane.y);\n}\nif (furthestPlane.z > 0.0) {\ndistance = min(distance, furthestPlane.z);\n}*/\nvec3 intersectionPosW = vPositionW + reflectionW * distance;\nreturn intersectionPosW - envMapPosW;\n}\n#endif // USE_ENVMAP_PROJECT\nvec3 fixSeams(vec3 vec, float mipLevel) {\nfloat scale = 1.0 - exp2(mipLevel) / 128.0;\nfloat M = max(max(abs(vec.x), abs(vec.y)), abs(vec.z));\nif (abs(vec.x) != M) vec.x *= scale;\nif (abs(vec.y) != M) vec.y *= scale;\nif (abs(vec.z) != M) vec.z *= scale;\nreturn vec;\n}\nvec3 getEnvColor(in samplerCube envMap, in Roughness roughness,\nin vec3 reflectionW) {\nvec3 reflectionNormW = normalize(reflectionW);\n#ifdef USE_ENVMAP_PROJECT\nif (envBoxMin.x != envBoxMax.x) {\nreflectionNormW = cubeMapProject(reflectionNormW);\n}\n#endif\nvec3 reflectionNormFixedW = fixSeams(reflectionNormW,\nroughness.envMipLevel0);\n#ifdef HAVE_TEXTURE_LOD\nvec4 cubeColorRaw0 = textureCubeLodEXT(envMap, reflectionNormFixedW,\nroughness.envMipLevel0);\n#else\nvec4 cubeColorRaw0 = textureCube(envMap, reflectionNormFixedW);\n#endif\nvec3 cubeColor0 = hdrDecode(cubeColorRaw0);\n#ifdef HAVE_TEXTURE_LOD\nvec4 cubeColorRaw1 = textureCubeLodEXT(envMap, reflectionNormFixedW,\nroughness.envMipLevel1);\n#else\nvec4 cubeColorRaw1 = textureCube(envMap2, reflectionNormFixedW);\n#endif\nvec3 cubeColor1 = hdrDecode(cubeColorRaw1);\nreturn mix(cubeColor0, cubeColor1, roughness.envMipMixFactor);\n}\nvec3 fresnelSchlickEnv(in vec3 specularColor, in Roughness roughness,\nin float clampCosnv, inout float opacity) {\nfloat fresnel = 1.0 - clampCosnv;\nfloat fresnel2 = fresnel * fresnel;\nfresnel *= fresnel2 * fresnel2;\nfresnel *= roughness.envFresnel;\nopacity = opacity + (1.0 - opacity) * fresnel;\nreturn specularColor + (1.0 - specularColor) * fresnel;\n}\nvec3 getSpecularColor(in vec3 baseColor, float metalic) {\nconst float dielectricF0 = 0.04;\nreturn mix(vec3(dielectricF0), baseColor, metalic);\n}\nfloat getLuminance(in vec3 color) {\nreturn 0.2126 * color.r + 0.7152 * color.g + 0.0722 * color.b;\n}\nvec3 getNormalW() {\n#ifdef USE_BUMP_TEXTURE\nvec3 normalPerturbedV = perturbNormal(-vPositionV, normalize(vNormalV));\nreturn normalize(\ninverseTransformDirection(normalPerturbedV, viewMatrix));\n#else\nreturn normalize(vNormalW);\n#endif\n}\nvec3 addSpecular(in vec3 baseColor, in vec3 totalIntensity,\ninout float opacity) {\nvec3 totalSpec = vec3(0.0, 0.0, 0.0);\n#ifdef USE_METALLIC_TEXTURE\nfloat metallic = texture2D(metallicTexture, vUv).x;\n#endif // else metallic is a uniform\nvec3 diffuseIntensity = totalIntensity * (1.0 - mix(0.04, 1.0, metallic));\nvec3 viewW = normalize(cameraPosition - vPositionW);\nvec3 normalW = getNormalW();\nfloat clampCosnv = saturate(dot(normalW, viewW));\nvec3 reflectionW = reflect(-viewW, normalW);\nvec3 specularColor = getSpecularColor(baseColor, metallic);\nRoughness roughness = getRoughnessFactors();\nvec3 envColor = getEnvColor(envMap, roughness, reflectionW);\nvec3 fresnel = fresnelSchlickEnv(specularColor, roughness,\nclampCosnv, opacity);\ntotalSpec = envColor * fresnel;\nfloat luminance = getLuminance(totalIntensity);\nreturn (baseColor * diffuseIntensity +\ntotalSpec * mix(0.4, 1.0, luminance));\n}\n#else // NOT USE_ENVMAP\nvec3 addSpecular(vec3 baseColor, in vec3 lightIntensity, in float opacity) {\nreturn baseColor * lightIntensity;\n}\n#endif\n#ifdef USE_HIGHLIGTH\nuniform vec3 highlight;\nuniform float highlightMix;\n#endif\n#if defined(HDR_OUTPUT)\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\n#endif\n#ifdef USE_COLORMAP\nvec3 colormap(in sampler2D lut, in vec3 color) {\nconst float resolution = 16.0;\nconst float maxValueIndex = resolution - 1.0;\nconst float sliceWidth = 1.0 / resolution;\nconst float slicePixelWidth = sliceWidth / resolution;\nconst float sliceMarginWidth = 0.5 * slicePixelWidth;\nconst float sliceInnerWidth = sliceWidth - slicePixelWidth;\nconst float slicePixelHeight = 1.0 / resolution;\nconst float sliceMarginHeight = 0.5 * slicePixelHeight;\nconst float sliceInnerHeight = 1.0 - slicePixelHeight;\nfloat bSlice0 = min(floor(color.b * maxValueIndex), maxValueIndex - 1.0);\nfloat bSlice1 = bSlice0 + 1.0;\nfloat bOffset = color.b * maxValueIndex - bSlice0;\nfloat rSlicePos = sliceMarginWidth + color.r * sliceInnerWidth;\nfloat gSlicePos = sliceMarginHeight + color.g * sliceInnerHeight;\nfloat rPos0 = rSlicePos + (bSlice0 * sliceWidth);\nfloat rPos1 = rSlicePos + (bSlice1 * sliceWidth);\nvec3 color0 = texture2D(lut, vec2(rPos0, gSlicePos)).rgb;\nvec3 color1 = texture2D(lut, vec2(rPos1, gSlicePos)).rgb;\nreturn mix(color0, color1, bOffset);\n}\nuniform sampler2D colorMap;\n#endif\n#ifdef USE_CHROMA_KEY\nuniform vec3 chromaKeyColor;\nuniform vec3 chromaKeyDeltaCoeff;\nconst float k32 = sqrt(3.0) / 2.0;\nvec3 rgb2abi(vec3 color) {\nfloat r = color.r;\nfloat g = color.g;\nfloat b = color.b;\nreturn vec3(\nr - 0.5 * g - 0.5 * b,\nk32 * (g - b),\n0.3333 * (r + g + b));\n}\nconst float IPI2 = 0.5 / 3.1415926538;\nvec3 rgb2hci(vec3 color) {\nvec3 abi = rgb2abi(color);\nreturn vec3(\natan(abi.y, abi.x) * IPI2,\nlength(abi.xy),\nabi.z);\n}\nfloat chromaKeyShapeFn(vec3 delta, vec3 color, vec3 key) {\nvec3 diff = color - key;\nvec3 v = delta * vec3(\n0.5 - abs(abs(diff.x) - 0.5),\nabs(diff.y),\nabs(diff.z));\nfloat x = max(v.r, max(v.g, v.b));\nreturn x * x;\n}\nfloat chromaKeyEdgeFn(float a) {\nreturn clamp(.2/.5 * (a - 1.0), 0.0, 1.0);\n}\n#endif\nuniform float emissionStrength;\nuniform float exposure;\nuniform float cameraGamma;\nvoid main() {\nfloat alpha;\nvec3 baseColor = getBaseColor(alpha);\n#ifdef USE_CHROMA_KEY\nfloat dist = chromaKeyShapeFn(chromaKeyDeltaCoeff, rgb2hci(baseColor), rgb2hci(chromaKeyColor));\nalpha *= chromaKeyEdgeFn(dist);\n#endif\n#ifdef USE_BASE_COLOR_TEXTURE\nif (alpha < alphaDiscardThreshold) {\ndiscard;\n}\n#endif\nvec3 lightIntensity = getLightIntensity();\n#ifdef USE_HIGHLIGTH\nbaseColor = mix(baseColor, highlight, highlightMix);\nalpha = mix(alpha, 1.0, highlightMix);\n#endif\nvec3 diffuseSpecular = addSpecularHook(baseColor, lightIntensity, alpha);\n#ifdef USE_HEADLIGHT\nvec3 lightW = normalize(cameraPosition - vPositionW.xyz);\nfloat pointDiffuse = max(dot(normalize(vNormalW), lightW), 0.0);\ndiffuseSpecular *= pointDiffuse;\n#endif\nvec3 diffuseSpecularEmissive = diffuseSpecular + baseColor * emissionStrength;\n#ifdef HDR_OUTPUT\nif (alpha < 0.5) {\ndiscard;\n}\nfragColor = hdrEncode(diffuseSpecularEmissive);\n#else // no HDR_OUTPUT\nvec3 exposedColor = pow(exposure * diffuseSpecularEmissive.xyz,\nvec3(cameraGamma));\nvec3 gammaColor =  linearToGammaUnreal(exposedColor);\n#ifdef USE_COLORMAP\nfragColor = vec4(colormap(colorMap, min(gammaColor, 1.0)), alpha);\n#else\nfragColor = vec4(gammaColor, alpha);\n#endif\n#endif // no HDR_OUTPUT\n}\n";
WALK.SHADERS["standard_material_vertex.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nvec3 sphericalDecode(in vec2 spNormal) {\nfloat theta = (spNormal.x / 254.0 + 0.5) * PI;\nfloat phi = spNormal.y * (PI / 127.0);\nfloat sinTheta = sin(theta);\nreturn vec3(sinTheta * cos(phi), sinTheta * sin(phi), cos(theta));\n}\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE)\nvarOut vec2 vUv;\nuniform vec4 uvMod;\n#endif\n#ifdef USE_LIGHTMAP\nwebgl2centroid varOut vec2 vUv2;\n#endif\n#ifdef USE_BUMP_TEXTURE\nvarOut vec3 vPositionV;\nvarOut vec3 vNormalV;\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvarOut vec3 vNormalW;\nvarOut vec3 vPositionW;\n#endif\nvoid main() {\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE)\nvUv = uv * uvMod.zw + uvMod.xy;\n#endif\nvec4 transformedPosition = transformPosition();\nvec4 mvPosition = modelViewMatrix * transformedPosition;\n#ifdef USE_LIGHTMAP\nfloat zeroOrOne = min(uv2.x + uv2.y, 1.0);\nvUv2 = uv2 * uv2Mod.zw + uv2Mod.xy * zeroOrOne;\n#endif\n#if defined(USE_BUMP_TEXTURE) || defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvec3 n = sphericalDecode(sphericalNormal);\nvec3 normal = vec3(\nt0.x * n.x + t0.y * n.y + t0.z * n.z,\nt1.x * n.x + t1.y * n.y + t1.z * n.z,\nt2.x * n.x + t2.y * n.y + t2.z * n.z);\n#endif\n#if defined(USE_BUMP_TEXTURE)\nvPositionV = -mvPosition.xyz;\nvNormalV = normalize(normalMatrix * normal);\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvNormalW = mat3(modelMatrix[0].xyz,\nmodelMatrix[1].xyz,\nmodelMatrix[2].xyz) * normal;\nvNormalW = normalize(vNormalW);\nvPositionW = (modelMatrix * transformedPosition).xyz;\n#endif\ngl_Position = projectionMatrix * mvPosition;\n}\n";
WALK.SHADERS["static_render_fragment.glsl"]="//AUTO GENERATED\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 linearToGammaUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nuniform sampler2D staticRender;\nuniform vec2 sizeInv;\nvoid main() {\nvec3 colorLinear = texture2D(staticRender, gl_FragCoord.xy * sizeInv).rgb;\nfragColor = vec4(linearToGammaUnreal(colorLinear), 1.0);\n}\n";
WALK.SHADERS["static_render_vertex.glsl"]="//AUTO GENERATED\nvoid main() {\ngl_Position = modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["water.glsl"]="//AUTO GENERATED\n#ifdef USE_NORMAL_TEXTURE\nuniform float time;\nuniform float wavesScale;\nuniform float refractionFactor;\nuniform sampler2D normalTexture;\nvec4 getNoise(in vec2 uv) {\nvec2 uv0 = (uv / 103.0) + vec2(time / 17.0, time / 29.0);\nvec2 uv1 = uv / 107.0 - vec2(time / -19.0, time / 31.0);\nvec2 uv2 = uv / vec2(897.0, 983.0) + vec2(time / 101.0, time / 97.0);\nvec2 uv3 = uv / vec2(991.0, 877.0) - vec2(time / 109.0, time / -113.0);\nvec4 noise = texture2D(normalTexture, uv0) +\ntexture2D(normalTexture, uv1) +\ntexture2D(normalTexture, uv2) +\ntexture2D(normalTexture, uv3);\nreturn noise * 0.5 - 1.0;\n}\nvec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity,\ninout float opacity) {\nvec3 toEyeW = cameraPosition - vPositionW;\nvec3 viewW = normalize(toEyeW);\nvec4 noise = getNoise(vPositionW.xy * wavesScale);\nvec3 normalW = normalize(noise.xyz);\nfloat clampCosnv = saturate(dot(normalW, viewW));\nRoughness roughness;\nroughness.envMipLevel0 = 0.0;\nroughness.envMipLevel1 = 0.0;\nroughness.envMipMixFactor = 0.0;\nroughness.envFresnel = 1.0;\nconst float waterF0 = 0.02;\nvec3 specularColor = vec3(waterF0);\nvec3 reflectionW = reflect(-viewW, normalW);\nvec3 refractionW = refract(-viewW, normalW, 0.75);\nvec3 reflectedEnv = getEnvColor(envMap, roughness, normalize(reflectionW));\nvec3 refractedEnv = refractionFactor *\ngetEnvColor(envMap, roughness, normalize(refractionW));\nvec3 fresnel = fresnelSchlickEnv(specularColor, roughness,\nclampCosnv, opacity);\nvec3 totalSpec = reflectedEnv * fresnel + refractedEnv * (1.0 - fresnel);\nvec3 diffuseIntensity = totalIntensity * 0.98;\nfloat luminance = getLuminance(totalIntensity);\nreturn totalSpec * mix(0.4, 1.0, luminance) + baseColor * diffuseIntensity;\n}\n#else // NOT USE_NORMAL_TEXTURE\nvec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity,\ninout float opacity) {\nreturn baseColor * totalIntensity;\n}\n#endif\n";
WALK.SHADERS["wireframe_fragment.glsl"]="//AUTO GENERATED\nuniform vec3 lineColor;\nuniform float lineMaxAlpha;\nuniform vec3 highlight;\nuniform float highlightMix;\nvarIn vec3 vBaryCentric;\nfloat edgeFactor(){\nvec3 d = fwidth(vBaryCentric);\nvec3 r = smoothstep(vec3(0.0), d * 1.5, vBaryCentric);\nreturn min(min(r.x, r.y), r.z);\n}\nvoid main(void){\nfloat edge = edgeFactor();\nif (edge < 1.0) {\nfragColor = vec4(lineColor, (1.0 - edge) * lineMaxAlpha);\n} else {\nfragColor = vec4(highlight, highlightMix);\n}\n}\n";
WALK.SHADERS["wireframe_vertex.glsl"]="//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nattr float order;\nvarOut vec3 vBaryCentric;\nvoid main() {\nif (order == 0.0) {\nvBaryCentric = vec3(1.0, 0.0, 0.0);\n} else if (order == 1.0) {\nvBaryCentric = vec3(0.0, 1.0, 0.0);\n} else {\nvBaryCentric = vec3(0.0, 0.0, 1.0);\n}\nvec4 transformedPosition = transformPosition();\ngl_Position = projectionMatrix * modelViewMatrix * transformedPosition;\n}\n";WALK.Shader=function(a,b){this.id=a;this.code=b};var qc=0;WALK.InlineShader=function(a){WALK.Shader.call(this,"inline:"+qc,a);qc+=1};WALK.getShader=function(a){return new WALK.Shader(a,WALK.SHADERS[a])};var rc=0,sc=[0,0],tc=Object.freeze({uv:sc,uv2:sc,uv2Mod:[0,0,1/65535,1/65535],t0:[1,0,0,0],t1:[0,1,0,0],t2:[0,0,1,0]}),uc=Object.freeze("position sphericalNormal uv uv2 uv2Mod t0 t1 t2".split(" ")),xc=new WALK.InlineShader("");
WALK.BaseMaterial=function(a,b,c){c=void 0===c?xc:c;rc+=1;Object.defineProperty(this,"id",{value:rc});this.name="";this.side=G.FrontSide;this.doNotOverrideSide=!1;this.opacity=1;this.transparent=!1;this.transparentRenderOrder=0;this.blending=G.NoBlending;this.blendSrc=GLC.SRC_ALPHA;this.blendDst=GLC.ONE_MINUS_SRC_ALPHA;this.blendEquation=GLC.FUNC_ADD;this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null;this.colorWrite=this.depthWrite=this.depthTest=!0;this._hideFromLightProbes=!1;this._defines=
new Set;this._definesString=null;this._textureLodExtension=this._standardDerivativesExtension=!1;this.uniforms={};this.attributes=uc;this._vertexShaderBody=a;this._fragmentShaderBody=b;this._fragmentShaderHooks=c;this.defaultAttributeValues=tc;this.index0AttributeName=void 0;this._programNeedsUpdate=this.visible=!0;this.program=null};
WALK.BaseMaterial.prototype={constructor:WALK.BaseMaterial,get isAnimated(){return!1},get isPlaying(){return!1},update:function(){},rewind:function(){console.assert(!1)},play:function(){console.assert(!1)},pause:function(){console.assert(!1)},get hideFromLightProbes(){return this._hideFromLightProbes},set hideFromLightProbes(a){this._hideFromLightProbes=a},get programNeedsUpdate(){return this._programNeedsUpdate},set programNeedsUpdate(a){this._definesString=null;this._programNeedsUpdate=a},hasDefine:function(a){return this._defines.has(a)},
addDefine:function(a){this.hasDefine(a)||(this._defines.add(a),this.programNeedsUpdate=!0)},removeDefine:function(a){this.hasDefine(a)&&(this._defines.delete(a),this.programNeedsUpdate=!0)},condDefine:function(a,b){a?this.addDefine(b):this.removeDefine(b);return a},_getDefinesString:function(){if(null===this._definesString){for(var a=[],b=m.makeIterator(this._defines),c=b.next();!c.done;c=b.next())a.push("#define "+c.value);a.sort();this._definesString=a.join("\n")}return this._definesString},generateProgramId:function(){return[this._fragmentShaderBody.id,
this._fragmentShaderHooks.id,this._getDefinesString(),this._vertexShaderBody.id,this._standardDerivativesExtension?"+":"",this._textureLodExtension?"+":""].join("$")},enableStandardDerivativesExtension:function(){WALK.DETECTOR.gl.webgl2||this._standardDerivativesExtension||(this.programNeedsUpdate=this._standardDerivativesExtension=!0)},enableTextureLodExtension:function(){WALK.DETECTOR.gl.webgl2||this._textureLodExtension||(this.programNeedsUpdate=this._textureLodExtension=!0)},_getShaderHeader:function(){return WALK.DETECTOR.gl.webgl2?
"#version 300 es\n#define texture2D texture\n#define textureCube texture\n#define textureCubeLodEXT textureLod\n#define texture2DGradEXT textureGrad\n#define attr in\n#define varOut out\n#define varIn in\n#define webgl2centroid centroid\n":"\n#define attr attribute\n#define varOut varying\n#define varIn varying\n#define webgl2centroid\n"},generateVertexShader:function(){return[this._getShaderHeader(),"precision highp float;\nprecision highp int;",this._getDefinesString(),"uniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattr vec3 position;\nattr vec2 sphericalNormal;\nattr vec2 uv;\nattr vec2 uv2;\nattr vec4 uv2Mod;\nattr vec4 t0;\nattr vec4 t1;\nattr vec4 t2;",
this._vertexShaderBody.code].join("\n")},generateFragmentShader:function(){return[this._getShaderHeader(),this._standardDerivativesExtension?"#extension GL_OES_standard_derivatives : enable":"",this._textureLodExtension?"#extension GL_EXT_shader_texture_lod : require":"","precision "+WALK.DETECTOR.gl.fragmentPrecision+" float;","precision "+WALK.DETECTOR.gl.fragmentPrecision+" int;",this._getDefinesString(),"uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;",WALK.DETECTOR.gl.webgl2?"out vec4 fragColor;":
"#define fragColor gl_FragColor",this._fragmentShaderBody.code,this._fragmentShaderHooks.code].join("\n")},dispose:function(){this.dispatchEvent({type:"dispose"})},setUniform:function(a,b,c){this.uniforms[a]={type:b,value:c}},propertyFromUniform:function(a){Object.defineProperty(this,a,{get:function(){return this.uniforms[a].value},set:function(b){this.uniforms[a].value=b}})},hash:function(){console.assert(!1,"hash not implemented")},canMerge:function(){console.assert(!1,"canMerge not implemented")}};
G.EventDispatcher.prototype.apply(WALK.BaseMaterial.prototype);WALK.CompressedTextureLoader=function(){this._parser=null};
WALK.CompressedTextureLoader.prototype={constructor:WALK.CompressedTextureLoader,load:function(a,b,c,d){var e=this,f=[],g=new WALK.CompressedTexture;g.image=f;WALK.queueAjaxGet(a,b,!0,function(k){k=e._parser(k,!0);if(k.isCubemap)for(var h=k.mipmaps.length/k.mipmapCount,l=0;l<h;l+=1){f[l]={mipmaps:[]};for(var n=0;n<k.mipmapCount;n+=1)f[l].mipmaps.push(k.mipmaps[l*k.mipmapCount+n]),f[l].format=k.format,f[l].width=k.width,f[l].height=k.height}else g.image.width=k.width,g.image.height=k.height,g.mipmaps=
k.mipmaps;1===k.mipmapCount&&(g.minFilter=GLC.LINEAR);g.format=k.format;g.width=k.width;g.height=k.height;c&&c(g)},d);return g}};G.FXAAShader={uniforms:{tDiffuse:{type:"t",value:null},resolution:{type:"v2",value:new G.Vector2(1/1024,1/512)}},vertexShader:new WALK.InlineShader("void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"),fragmentShader:new WALK.InlineShader("uniform sampler2D tDiffuse;\nuniform vec2 resolution;\n#define FXAA_REDUCE_MIN   (1.0/128.0)\n#define FXAA_REDUCE_MUL   (1.0/8.0)\n#define FXAA_SPAN_MAX     8.0\nvoid main() {\nvec3 rgbNW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * resolution ).xyz;\nvec3 rgbNE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * resolution ).xyz;\nvec3 rgbSW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * resolution ).xyz;\nvec3 rgbSE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * resolution ).xyz;\nvec4 rgbaM  = texture2D( tDiffuse,  gl_FragCoord.xy  * resolution );\nvec3 rgbM  = rgbaM.xyz;\nvec3 luma = vec3( 0.299, 0.587, 0.114 );\nfloat lumaNW = dot( rgbNW, luma );\nfloat lumaNE = dot( rgbNE, luma );\nfloat lumaSW = dot( rgbSW, luma );\nfloat lumaSE = dot( rgbSE, luma );\nfloat lumaM  = dot( rgbM,  luma );\nfloat lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );\nfloat lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );\nvec2 dir;\ndir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\ndir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\nfloat dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );\nfloat rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );\ndir = min( vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX),\nmax( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\ndir * rcpDirMin)) * resolution;\nvec4 rgbA = (1.0/2.0) * (\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (1.0/3.0 - 0.5)) +\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (2.0/3.0 - 0.5)));\nvec4 rgbB = rgbA * (1.0/2.0) + (1.0/4.0) * (\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (0.0/3.0 - 0.5)) +\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (3.0/3.0 - 0.5)));\nfloat lumaB = dot(rgbB, vec4(luma, 0.0));\nif ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) ) {\nfragColor = rgbA;\n} else {\nfragColor = rgbB;\n}\n}")};G.EffectComposer=function(a){this.renderer=a;this.renderTarget2=this.renderTarget1=null;this.passes=[]};
G.EffectComposer.prototype={addPass:function(a){this.passes.push(a)},disposeTarget:function(){this.renderTarget1&&(this.renderTarget1.dispose(),this.renderTarget1=null);this.renderTarget2&&(this.renderTarget2.dispose(),this.renderTarget2=null)},configureTarget:function(a,b,c){this.disposeTarget();this.renderTarget1=this.renderer.createRenderTarget(a,b,c);this.renderTarget2=this.renderer.createRenderTarget(a,b,c)},render:function(){var a,b;return function(c){a=this.renderTarget1;b=this.renderTarget2;
var d,e=this.passes.length;for(d=0;d<e;d++){var f=this.passes[d];f.enabled&&(f.render(this.renderer,a,b,c),f.needsSwap&&d!=e-1&&(f=b,b=a,a=f))}}}()};G.ShaderPass=function(a,b){this.textureID=void 0!==b?b:"tDiffuse";this.material=new WALK.BaseMaterial(a.vertexShader,a.fragmentShader);this.material.uniforms=G.UniformsUtils.clone(a.uniforms);this.uniforms=this.material.uniforms;this.renderToScreen=!1;this.needsSwap=this.enabled=!0;this.clear=!1;this.camera=new G.OrthographicCamera(-1,1,1,-1,0,1);this.scene=new G.Scene;this.quad=new G.Mesh(new G.PlaneBufferGeometry(2,2),this.material);this.scene.add(this.quad)};
G.ShaderPass.prototype={render:function(a,b,c){var d=this.material.uniforms[this.textureID];d&&(d.value=c);this.renderToScreen?a.render(this.scene,this.camera):a.render(this.scene,this.camera,b,this.clear)},dispose:function(){this.material.dispose();this.quad.geometry.dispose()}};G.RenderPass=function(a,b,c){this.scene=a;this.camera=b;this.overrideMaterial=c;this.needsSwap=this.clear=this.enabled=!0};G.RenderPass.prototype={render:function(a,b){var c=this.scene.overrideMaterial;this.overrideMaterial&&(this.scene.overrideMaterial=this.overrideMaterial);a.render(this.scene,this.camera,b,this.clear);this.scene.overrideMaterial=c}};function yc(a){return!isNaN(a)&&isFinite(a)}function Cc(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1}
G.Octree=function(a){a=a||{};this.nodeCount=0;this.INDEX_INSIDE_CROSS=-1;this.INDEX_OUTSIDE_OFFSET=2;this.INDEX_OUTSIDE_POS_X=yc(a.INDEX_OUTSIDE_POS_X)?a.INDEX_OUTSIDE_POS_X:0;this.INDEX_OUTSIDE_NEG_X=yc(a.INDEX_OUTSIDE_NEG_X)?a.INDEX_OUTSIDE_NEG_X:1;this.INDEX_OUTSIDE_POS_Y=yc(a.INDEX_OUTSIDE_POS_Y)?a.INDEX_OUTSIDE_POS_Y:2;this.INDEX_OUTSIDE_NEG_Y=yc(a.INDEX_OUTSIDE_NEG_Y)?a.INDEX_OUTSIDE_NEG_Y:3;this.INDEX_OUTSIDE_POS_Z=yc(a.INDEX_OUTSIDE_POS_Z)?a.INDEX_OUTSIDE_POS_Z:4;this.INDEX_OUTSIDE_NEG_Z=
yc(a.INDEX_OUTSIDE_NEG_Z)?a.INDEX_OUTSIDE_NEG_Z:5;this.INDEX_OUTSIDE_MAP=[];this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_X]={index:this.INDEX_OUTSIDE_POS_X,count:0,x:1,y:0,z:0};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_X]={index:this.INDEX_OUTSIDE_NEG_X,count:0,x:-1,y:0,z:0};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Y]={index:this.INDEX_OUTSIDE_POS_Y,count:0,x:0,y:1,z:0};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Y]={index:this.INDEX_OUTSIDE_NEG_Y,count:0,x:0,y:-1,z:0};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Z]=
{index:this.INDEX_OUTSIDE_POS_Z,count:0,x:0,y:0,z:1};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Z]={index:this.INDEX_OUTSIDE_NEG_Z,count:0,x:0,y:0,z:-1};this.FLAG_POS_X=1<<this.INDEX_OUTSIDE_POS_X+1;this.FLAG_NEG_X=1<<this.INDEX_OUTSIDE_NEG_X+1;this.FLAG_POS_Y=1<<this.INDEX_OUTSIDE_POS_Y+1;this.FLAG_NEG_Y=1<<this.INDEX_OUTSIDE_NEG_Y+1;this.FLAG_POS_Z=1<<this.INDEX_OUTSIDE_POS_Z+1;this.FLAG_NEG_Z=1<<this.INDEX_OUTSIDE_NEG_Z+1;this.utilVec31Search=new G.Vector3;this.utilVec32Search=new G.Vector3;
if(this.scene=a.scene)this.visualGeometry=new G.BoxBufferGeometry(1,1,1),this.visualGeometry.addTriangleOrderAttribute(),this.visualMaterial=new WALK.WireframeMaterial(new G.Color(65280));this.depthMax=yc(a.depthMax)?a.depthMax:Infinity;this.objectsThreshold=yc(a.objectsThreshold)?a.objectsThreshold:8;this.overlapPct=yc(a.overlapPct)?a.overlapPct:.15;this.root=new G.OctreeNode({tree:this,parent:null,position:new G.Vector3})};
G.Octree.prototype={add:function(a,b,c){b||(b=a.geometry.boundingSphere.center,c=a.geometry.boundingSphere.radius);0!==c&&this.root.addObject(new G.OctreeObjectData(a,b,c))},search:function(a,b,c){var d,e=[];this.root.appendObjectsFromNode(e);0<b||(b=Number.MAX_VALUE);if(c instanceof G.Vector3){c=this.utilVec31Search.copy(c).normalize();var f=this.utilVec32Search.set(1,1,1).divide(c)}var g=0;for(d=this.root.nodesIndices.length;g<d;g++){var k=this.root.nodesByIndex[this.root.nodesIndices[g]];k.search(a,
b,c,f,e)}return e},setRoot:function(a){a instanceof G.OctreeNode&&(this.root=a,this.root.updateProperties())},getDepthEnd:function(){return this.root.getDepthEnd()},getNodeCountEnd:function(){return this.root.getNodeCountEnd()},getObjectCountEnd:function(){return this.root.getObjectCountEnd()},toConsole:function(){this.root.toConsole()}};G.OctreeObjectData=function(a,b,c){this.object=a;this.radius=c;this.position=b};var Dc=new G.Vector3,Ec=new G.Vector3;new G.Vector3;
G.OctreeNode=function(a){this.tree=a.tree;this.id=this.tree.nodeCount++;this.position=a.position;this.radius=0<a.radius?a.radius:1;this.indexOctant=a.indexOctant;this.depth=0;this.reset();this.setParent(a.parent);this.overlap=this.radius*this.tree.overlapPct;this.radiusOverlap=this.radius+this.overlap;this.left=this.position.x-this.radiusOverlap;this.right=this.position.x+this.radiusOverlap;this.bottom=this.position.y-this.radiusOverlap;this.top=this.position.y+this.radiusOverlap;this.back=this.position.z-
this.radiusOverlap;this.front=this.position.z+this.radiusOverlap;this.tree.scene&&(this.visual=new G.Mesh(this.tree.visualGeometry,this.tree.visualMaterial),this.visual.scale.set(2*this.radiusOverlap,2*this.radiusOverlap,2*this.radiusOverlap),this.visual.position.copy(this.position),this.tree.scene.add(this.visual),this.tree.scene.updateMatrixWorld())};
G.OctreeNode.prototype={setParent:function(a){a!==this&&this.parent!==a&&(this.parent=a,this.updateProperties())},updateProperties:function(){var a;this.parent instanceof G.OctreeNode?(this.tree=this.parent.tree,this.depth=this.parent.depth+1):this.depth=0;var b=0;for(a=this.nodesIndices.length;b<a;b++)this.nodesByIndex[this.nodesIndices[b]].updateProperties()},reset:function(a,b){var c,d=this.nodesIndices||[],e=this.nodesByIndex;this.objects=[];this.nodesIndices=[];this.nodesByIndex={};var f=0;for(c=
d.length;f<c;f++){var g=e[d[f]];g.setParent(void 0);!0===a&&g.reset(a,b)}!0===b&&this.visual&&this.visual.parent&&this.visual.parent.remove(this.visual)},addNode:function(a,b){a.indexOctant=b;-1===Cc(this.nodesIndices,b)&&this.nodesIndices.push(b);this.nodesByIndex[b]=a;a.parent!==this&&a.setParent(this)},removeNode:function(a){var b=Cc(this.nodesIndices,a);this.nodesIndices.splice(b,1);var c=c||this.nodesByIndex[a];delete this.nodesByIndex[a];c.parent===this&&c.setParent(void 0)},addObject:function(a){var b=
this.getOctantIndex(a);-1<b&&0<this.nodesIndices.length?(b=this.branch(b),b.addObject(a)):-1>b&&this.parent instanceof G.OctreeNode?this.parent.addObject(a):(b=Cc(this.objects,a),-1===b&&this.objects.push(a),a.node=this,this.checkGrow())},addObjectWithoutCheck:function(a){var b;var c=0;for(b=a.length;c<b;c++){var d=a[c];this.objects.push(d);d.node=this}},checkGrow:function(){this.objects.length>this.tree.objectsThreshold&&0<this.tree.objectsThreshold&&this.grow()},grow:function(){var a=[],b=[],c=
[],d=[],e=[],f;var g=0;for(f=this.objects.length;g<f;g++){var k=this.objects[g];var h=this.getOctantIndex(k);-1<h?(c.push(k),d.push(h)):-1>h?(a.push(k),b.push(h)):e.push(k)}0<c.length&&(e=e.concat(this.split(c,d)));0<a.length&&(e=e.concat(this.expand(a,b)));this.objects=e;this.checkMerge()},split:function(a,b){var c;if(this.depth<this.tree.depthMax){a=a||this.objects;b=b||[];var d=[];var e=0;for(c=a.length;e<c;e++){var f=a[e];var g=b[e];-1<g?(g=this.branch(g),g.addObject(f)):d.push(f)}a===this.objects&&
(this.objects=d)}else d=this.objects;return d},branch:function(a){if(this.nodesByIndex[a]instanceof G.OctreeNode)var b=this.nodesByIndex[a];else{b=.5*this.radiusOverlap;var c=b*this.tree.overlapPct;c=b-c;c=Dc.set(a&1?c:-c,a&2?c:-c,a&4?c:-c);c=(new G.Vector3).addVectors(this.position,c);b=new G.OctreeNode({tree:this.tree,parent:this,position:c,radius:b,indexOctant:a});this.addNode(b,a)}return b},expand:function(a,b){var c,d=this.tree.INDEX_OUTSIDE_MAP;if(this.tree.root.getDepthEnd()<this.tree.depthMax){a=
a||this.objects;b=b||[];var e=[];var f=[];var g=0;for(c=d.length;g<c;g++)d[g].count=0;g=0;for(c=a.length;g<c;g++){var k=a[g];var h=b[g];-1>h?(h=-h-this.tree.INDEX_OUTSIDE_OFFSET,h&this.tree.FLAG_POS_X?d[this.tree.INDEX_OUTSIDE_POS_X].count++:h&this.tree.FLAG_NEG_X&&d[this.tree.INDEX_OUTSIDE_NEG_X].count++,h&this.tree.FLAG_POS_Y?d[this.tree.INDEX_OUTSIDE_POS_Y].count++:h&this.tree.FLAG_NEG_Y&&d[this.tree.INDEX_OUTSIDE_NEG_Y].count++,h&this.tree.FLAG_POS_Z?d[this.tree.INDEX_OUTSIDE_POS_Z].count++:h&
this.tree.FLAG_NEG_Z&&d[this.tree.INDEX_OUTSIDE_NEG_Z].count++,f.push(k)):e.push(k)}if(0<f.length){var l=d.slice(0);l.sort(function(v,p){return p.count-v.count});h=l[0];g=h.index|1;k=l[1];d=l[2];b=(k.index|1)!==g?k:d;c=b.index|1;k=l[2];d=l[3];l=l[4];var n=k.index|1;var r=d.index|1;k=n!==g&&n!==c?k:r!==g&&r!==c?d:l;g=h.x+b.x+k.x;c=h.y+b.y+k.y;b=h.z+b.z+k.z;h=this.getOctantIndexFromPosition(g,c,b);b=this.getOctantIndexFromPosition(-g,-c,-b);c=this.overlap;k=this.radius;g=0<this.tree.overlapPct?c/(.5*
this.tree.overlapPct*(1+this.tree.overlapPct)):2*k;d=g*this.tree.overlapPct;c=g+d-(k+c);Ec.set(h&1?c:-c,h&2?c:-c,h&4?c:-c);h=(new G.Vector3).addVectors(this.position,Ec);h=new G.OctreeNode({tree:this.tree,position:h,radius:g});h.addNode(this,b);this.tree.setRoot(h);g=0;for(c=f.length;g<c;g++)this.tree.root.addObject(f[g])}a===this.objects&&(this.objects=e)}else e=a;return e},shrink:function(){this.checkMerge();this.tree.root.checkContract()},checkMerge:function(){for(var a=this,b;a.parent instanceof
G.OctreeNode&&a.getObjectCountEnd()<this.tree.objectsThreshold;)b=a,a=a.parent;a!==this&&a.merge(b)},merge:function(a){var b;a=a?"[object Array]"===Object.prototype.toString.call(a)!==!0?[a]:a:[];var c=0;for(b=a.length;c<b;c++){var d=a[c];this.addObjectWithoutCheck(d.getObjectsEnd());d.reset(!0,!0);this.removeNode(d.indexOctant,d)}this.checkMerge()},checkContract:function(){var a;if(0<this.nodesIndices.length){var b=0;var c=this.objects.length;var d=0;for(a=this.nodesIndices.length;d<a;d++){var e=
this.nodesByIndex[this.nodesIndices[d]];var f=e.getObjectCountEnd();c+=f;if(!1===g instanceof G.OctreeNode||f>b){var g=e;b=f}}c-b<this.tree.objectsThreshold&&g instanceof G.OctreeNode&&this.contract(g)}},contract:function(a){var b;var c=0;for(b=this.nodesIndices.length;c<b;c++){var d=this.nodesByIndex[this.nodesIndices[c]];d!==a&&(a.addObjectWithoutCheck(d.getObjectsEnd()),d.reset(!0,!0))}a.addObjectWithoutCheck(this.objects);this.reset(!1,!0);this.tree.setRoot(a);a.checkContract()},getOctantIndex:function(a){var b=
this.position,c=this.radiusOverlap,d=this.overlap,e=0;if(a instanceof G.OctreeObjectData){var f=a.radius;var g=a.position}else a instanceof G.OctreeNode&&(g=a.position,f=0);var k=g.x-b.x;var h=g.y-b.y;g=g.z-b.z;b=Math.abs(k);var l=Math.abs(h);var n=Math.abs(g);if(Math.max(b,l,n)+f>c)return b+f>c&&(e^=0<k?this.tree.FLAG_POS_X:this.tree.FLAG_NEG_X),l+f>c&&(e^=0<h?this.tree.FLAG_POS_Y:this.tree.FLAG_NEG_Y),n+f>c&&(e^=0<g?this.tree.FLAG_POS_Z:this.tree.FLAG_NEG_Z),a.indexOctant=-e-this.tree.INDEX_OUTSIDE_OFFSET,
a.indexOctant;if(k-f>-d)e|=1;else if(!(k+f<d))return a.indexOctant=this.tree.INDEX_INSIDE_CROSS,a.indexOctant;if(h-f>-d)e|=2;else if(!(h+f<d))return a.indexOctant=this.tree.INDEX_INSIDE_CROSS,a.indexOctant;if(g-f>-d)e|=4;else if(!(g+f<d))return a.indexOctant=this.tree.INDEX_INSIDE_CROSS,a.indexOctant;a.indexOctant=e;return a.indexOctant},getOctantIndexFromPosition:function(a,b,c){var d=0;0<a&&(d|=1);0<b&&(d|=2);0<c&&(d|=4);return d},appendObjectsFromNode:function(a){var b,c=this.objects;var d=0;for(b=
c.length;d<b;d+=1)a.push(c[d].object)},search:function(a,b,c,d,e){var f;if(!0===this.intersectRay(a,c,b,d)){this.appendObjectsFromNode(e);var g=0;for(f=this.nodesIndices.length;g<f;g++){var k=this.nodesByIndex[this.nodesIndices[g]];k.search(a,b,c,d,e)}}},intersectRay:function(a,b,c,d){b=(this.left-a.x)*d.x;var e=(this.right-a.x)*d.x,f=(this.bottom-a.y)*d.y,g=(this.top-a.y)*d.y,k=(this.back-a.z)*d.z;d=(this.front-a.z)*d.z;a=Math.min(Math.min(Math.max(b,e),Math.max(f,g)),Math.max(k,d));if(0>a)return!1;
b=Math.max(Math.max(Math.min(b,e),Math.min(f,g)),Math.min(k,d));return b>a||b>c?!1:!0},getDepthEnd:function(a){var b;if(0<this.nodesIndices.length){var c=0;for(b=this.nodesIndices.length;c<b;c++){var d=this.nodesByIndex[this.nodesIndices[c]];a=d.getDepthEnd(a)}}else a=!a||this.depth>a?this.depth:a;return a},getNodeCountEnd:function(){return this.tree.root.getNodeCountRecursive()+1},getNodeCountRecursive:function(){var a,b=this.nodesIndices.length;var c=0;for(a=this.nodesIndices.length;c<a;c++)b+=
this.nodesByIndex[this.nodesIndices[c]].getNodeCountRecursive();return b},getObjectsEnd:function(a){var b;a=(a||[]).concat(this.objects);var c=0;for(b=this.nodesIndices.length;c<b;c++){var d=this.nodesByIndex[this.nodesIndices[c]];a=d.getObjectsEnd(a)}return a},getObjectCountEnd:function(){var a,b=this.objects.length;var c=0;for(a=this.nodesIndices.length;c<a;c++)b+=this.nodesByIndex[this.nodesIndices[c]].getObjectCountEnd();return b},getObjectCountStart:function(){for(var a=this.objects.length,b=
this.parent;b instanceof G.OctreeNode;)a+=b.objects.length,b=b.parent;return a},toConsole:function(a){var b;a="string"===typeof a?a:"   ";console.log(this.parent?a+" octree NODE > ":" octree ROOT > ",this," // id: ",this.id," // indexOctant: ",this.indexOctant," // position: ",this.position.x,this.position.y,this.position.z," // radius: ",this.radius," // depth: ",this.depth);console.log(this.parent?a+" ":" ","+ objects ( ",this.objects.length," ) ",this.objects);console.log(this.parent?a+" ":" ",
"+ children ( ",this.nodesIndices.length," )",this.nodesIndices,this.nodesByIndex);var c=0;for(b=this.nodesIndices.length;c<b;c++){var d=this.nodesByIndex[this.nodesIndices[c]];d.toConsole(a+"   ")}}};G.PolyhedronBufferGeometry=function(a,b,c,d){function e(l){k.push(l.x,l.y,l.z)}function f(l,n){l*=3;n.x=a[l+0];n.y=a[l+1];n.z=a[l+2]}function g(l,n,r,v){0>v&&1===l.x&&(h[n]=l.x-1);0===r.x&&0===r.z&&(h[n]=v/2/Math.PI+.5)}G.BufferGeometry.call(this);this.type="PolyhedronBufferGeometry";this.parameters={vertices:a,indices:b,radius:c,detail:d};c=c||1;d=d||0;var k=[],h=[];(function(l){for(var n=new G.Vector3,r=new G.Vector3,v=new G.Vector3,p=0;p<b.length;p+=3){f(b[p+0],n);f(b[p+1],r);f(b[p+2],v);var w,
u,y=n,B=r,D=v,H=Math.pow(2,l),K=[];for(u=0;u<=H;u++){K[u]=[];var J=y.clone().lerp(D,u/H),W=B.clone().lerp(D,u/H),M=H-u;for(w=0;w<=M;w++)K[u][w]=0===w&&u===H?J:J.clone().lerp(W,w/M)}for(u=0;u<H;u++)for(w=0;w<2*(H-u)-1;w++)y=Math.floor(w/2),0===w%2?(e(K[u][y+1]),e(K[u+1][y]),e(K[u][y])):(e(K[u][y+1]),e(K[u+1][y+1]),e(K[u+1][y]))}})(d);(function(l){for(var n=new G.Vector3,r=0;r<k.length;r+=3)n.x=k[r+0],n.y=k[r+1],n.z=k[r+2],n.normalize().multiplyScalar(l),k[r+0]=n.x,k[r+1]=n.y,k[r+2]=n.z})(c);(function(){for(var l=
new G.Vector3,n=0;n<k.length;n+=3)l.x=k[n+0],l.y=k[n+1],l.z=k[n+2],h.push(Math.atan2(l.z,-l.x)/2/Math.PI+.5,1-(Math.atan2(-l.y,Math.sqrt(l.x*l.x+l.z*l.z))/Math.PI+.5));l=new G.Vector3;n=new G.Vector3;for(var r=new G.Vector3,v=new G.Vector3,p=new G.Vector2,w=new G.Vector2,u=new G.Vector2,y=0,B=0;y<k.length;y+=9,B+=6){l.set(k[y+0],k[y+1],k[y+2]);n.set(k[y+3],k[y+4],k[y+5]);r.set(k[y+6],k[y+7],k[y+8]);p.set(h[B+0],h[B+1]);w.set(h[B+2],h[B+3]);u.set(h[B+4],h[B+5]);v.copy(l).add(n).add(r).divideScalar(3);
var D=Math.atan2(v.z,-v.x);g(p,B+0,l,D);g(w,B+2,n,D);g(u,B+4,r,D)}for(l=0;l<h.length;l+=6)n=h[l+0],r=h[l+2],v=h[l+4],p=Math.min(n,r,v),.9<Math.max(n,r,v)&&.1>p&&(.2>n&&(h[l+0]+=1),.2>r&&(h[l+2]+=1),.2>v&&(h[l+4]+=1))})();this.addAttribute("position",new G.BufferAttribute(new Float32Array(k),3));this.addAttribute("normal",new G.BufferAttribute(new Float32Array(k.slice()),3));this.addAttribute("uv",new G.BufferAttribute(new Float32Array(h),2));0===d?this.computeVertexNormals():this.normalizeNormals()};
G.PolyhedronBufferGeometry.prototype=Object.create(G.BufferGeometry.prototype);G.PolyhedronBufferGeometry.prototype.constructor=G.PolyhedronBufferGeometry;G.IcosahedronBufferGeometry=function(a,b){var c=(1+Math.sqrt(5))/2;G.PolyhedronBufferGeometry.call(this,[-1,c,0,1,c,0,-1,-c,0,1,-c,0,0,-1,c,0,1,c,0,-1,-c,0,1,-c,c,0,-1,c,0,1,-c,0,-1,-c,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a,b);this.type="IcosahedronBufferGeometry";this.parameters={radius:a,detail:b}};G.IcosahedronBufferGeometry.prototype=Object.create(G.PolyhedronBufferGeometry.prototype);
G.IcosahedronBufferGeometry.prototype.constructor=G.IcosahedronBufferGeometry;var Fc=Math,Gc=Fc.abs,Hc=Fc.cos,Ic=Fc.sin,Lc=Fc.acos,Mc=Fc.atan2,Nc=Fc.sqrt,Oc=Fc.pow;function Pc(a){return 0>a?-Oc(-a,1/3):Oc(a,1/3)}
var Tc=Math.PI,Uc=2*Tc,Vc=Tc/2,Wc=Number.MAX_SAFE_INTEGER||9007199254740991,Xc=Number.MIN_SAFE_INTEGER||-9007199254740991,Yc={x:0,y:0,z:0},Zc={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,
.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,
.0123412297999872,.0123412297999872],arcfn:function(a,b){a=b(a);b=a.x*a.x+a.y*a.y;"undefined"!==typeof a.z&&(b+=a.z*a.z);return Nc(b)},compute:function(a,b,c){if(0===a)return b[0].t=0,b[0];var d=b.length-1;if(1===a)return b[d].t=1,b[d];var e=1-a,f=b;if(0===d)return b[0].t=a,b[0];if(1===d){var g={x:e*f[0].x+a*f[1].x,y:e*f[0].y+a*f[1].y,t:a};c&&(g.z=e*f[0].z+a*f[1].z);return g}if(4>d){var k=e*e,h=a*a;b=0;if(2===d){f=[f[0],f[1],f[2],Yc];g=k;var l=e*a*2;var n=h}else 3===d&&(g=k*e,l=k*a*3,n=e*h*3,b=a*
h);a={x:g*f[0].x+l*f[1].x+n*f[2].x+b*f[3].x,y:g*f[0].y+l*f[1].y+n*f[2].y+b*f[3].y,t:a};c&&(a.z=g*f[0].z+l*f[1].z+n*f[2].z+b*f[3].z);return a}for(c=JSON.parse(JSON.stringify(b));1<c.length;){for(f=0;f<c.length-1;f++)c[f]={x:c[f].x+(c[f+1].x-c[f].x)*a,y:c[f].y+(c[f+1].y-c[f].y)*a},"undefined"!==typeof c[f].z&&(c[f]=c[f].z+(c[f+1].z-c[f].z)*a);c.splice(c.length-1,1)}c[0].t=a;return c[0]},computeWithRatios:function(a,b,c,d){var e=1-a,f=c[0],g=c[1],k=c[2];c=c[3];f*=e;g*=a;if(2===b.length)return e=f+g,
{x:(f*b[0].x+g*b[1].x)/e,y:(f*b[0].y+g*b[1].y)/e,z:d?(f*b[0].z+g*b[1].z)/e:!1,t:a};f*=e;g*=2*e;k*=a*a;if(3===b.length)return e=f+g+k,{x:(f*b[0].x+g*b[1].x+k*b[2].x)/e,y:(f*b[0].y+g*b[1].y+k*b[2].y)/e,z:d?(f*b[0].z+g*b[1].z+k*b[2].z)/e:!1,t:a};f*=e;g*=1.5*e;k*=3*e;c*=a*a*a;if(4===b.length)return e=f+g+k+c,{x:(f*b[0].x+g*b[1].x+k*b[2].x+c*b[3].x)/e,y:(f*b[0].y+g*b[1].y+k*b[2].y+c*b[3].y)/e,z:d?(f*b[0].z+g*b[1].z+k*b[2].z+c*b[3].z)/e:!1,t:a}},derive:function(a,b){for(var c=[],d=a.length,e=d-1;1<d;d--,
e--){for(var f=[],g=0,k;g<e;g++)k={x:e*(a[g+1].x-a[g].x),y:e*(a[g+1].y-a[g].y)},b&&(k.z=e*(a[g+1].z-a[g].z)),f.push(k);c.push(f);a=f}return c},between:function(a,b,c){return b<=a&&a<=c||Zc.approximately(a,b)||Zc.approximately(a,c)},approximately:function(a,b,c){return Gc(a-b)<=(c||1E-6)},length:function(a){for(var b=Zc.Tvalues.length,c=0,d=0,e;d<b;d++)e=.5*Zc.Tvalues[d]+.5,c+=Zc.Cvalues[d]*Zc.arcfn(e,a);return.5*c},map:function(a,b,c,d,e){return d+(a-b)/(c-b)*(e-d)},lerp:function(a,b,c){var d={x:b.x+
a*(c.x-b.x),y:b.y+a*(c.y-b.y)};void 0!==b.z&&void 0!==c.z&&(d.z=b.z+a*(c.z-b.z));return d},pointToString:function(a){var b=a.x+"/"+a.y;"undefined"!==typeof a.z&&(b+="/"+a.z);return b},pointsToString:function(a){return"["+a.map(Zc.pointToString).join(", ")+"]"},copy:function(a){return JSON.parse(JSON.stringify(a))},angle:function(a,b,c){var d=b.x-a.x;b=b.y-a.y;var e=c.x-a.x;a=c.y-a.y;return Mc(d*a-b*e,d*e+b*a)},round:function(a,b){a=""+a;var c=a.indexOf(".");return parseFloat(a.substring(0,c+1+b))},
dist:function(a,b){var c=a.x-b.x;a=a.y-b.y;return Nc(c*c+a*a)},closest:function(a,b){var c=Oc(2,63),d,e;a.forEach(function(f,g){e=Zc.dist(b,f);e<c&&(c=e,d=g)});return{mdist:c,mpos:d}},abcratio:function(a,b){if(2!==b&&3!==b)return!1;if("undefined"===typeof a)a=.5;else if(0===a||1===a)return a;a=Oc(a,b)+Oc(1-a,b);return Gc((a-1)/a)},projectionratio:function(a,b){if(2!==b&&3!==b)return!1;if("undefined"===typeof a)a=.5;else if(0===a||1===a)return a;var c=Oc(1-a,b);a=Oc(a,b)+c;return c/a},lli8:function(a,
b,c,d,e,f,g,k){var h=(a-c)*(f-k)-(b-d)*(e-g);return 0==h?!1:{x:((a*d-b*c)*(e-g)-(a-c)*(e*k-f*g))/h,y:((a*d-b*c)*(f-k)-(b-d)*(e*k-f*g))/h}},lli4:function(a,b,c,d){return Zc.lli8(a.x,a.y,b.x,b.y,c.x,c.y,d.x,d.y)},lli:function(a,b){return Zc.lli4(a,a.c,b,b.c)},makeline:function(a,b){return new $c(a.x,a.y,(a.x+b.x)/2,(a.y+b.y)/2,b.x,b.y)},findbbox:function(a){var b=Wc,c=Wc,d=Xc,e=Xc;a.forEach(function(f){f=f.bbox();b>f.x.min&&(b=f.x.min);c>f.y.min&&(c=f.y.min);d<f.x.max&&(d=f.x.max);e<f.y.max&&(e=f.y.max)});
return{x:{min:b,mid:(b+d)/2,max:d,size:d-b},y:{min:c,mid:(c+e)/2,max:e,size:e-c}}},shapeintersections:function(a,b,c,d,e){if(!Zc.bboxoverlap(b,d))return[];var f=[],g=[c.startcap,c.forward,c.back,c.endcap];[a.startcap,a.forward,a.back,a.endcap].forEach(function(k){k.virtual||g.forEach(function(h){if(!h.virtual){var l=k.intersects(h,e);0<l.length&&(l.c1=k,l.c2=h,l.s1=a,l.s2=c,f.push(l))}})});return f},makeshape:function(a,b,c){var d=a.points.length,e=Zc.makeline(b.points[b.points.length-1],a.points[0]);
d=Zc.makeline(a.points[d-1],b.points[0]);var f={startcap:e,forward:a,back:b,endcap:d,bbox:Zc.findbbox([e,a,b,d]),intersections:function(g){return Zc.shapeintersections(f,f.bbox,g,g.bbox,c)}};return f},getminmax:function(a,b,c){if(!c)return{min:0,max:0};var d=Wc,e=Xc;-1===c.indexOf(0)&&(c=[0].concat(c));-1===c.indexOf(1)&&c.push(1);for(var f=0,g=c.length;f<g;f++){var k=c[f];k=a.get(k);k[b]<d&&(d=k[b]);k[b]>e&&(e=k[b])}return{min:d,mid:(d+e)/2,max:e,size:e-d}},align:function(a,b){var c=b.p1.x,d=b.p1.y,
e=-Mc(b.p2.y-d,b.p2.x-c);return a.map(function(f){return{x:(f.x-c)*Hc(e)-(f.y-d)*Ic(e),y:(f.x-c)*Ic(e)+(f.y-d)*Hc(e)}})},roots:function(a,b){function c(k){return 0<=k&&1>=k}b=b||{p1:{x:0,y:0},p2:{x:1,y:0}};var d=a.length-1;a=Zc.align(a,b);if(2===d){d=a[0].y;b=a[1].y;var e=a[2].y;a=d-2*b+e;return 0!==a?(e=-Nc(b*b-d*e),d=-d+b,[-(e+d)/a,-(-e+d)/a].filter(c)):b!==e&&0===a?[(2*b-e)/(2*b-2*e)].filter(c):[]}d=a[0].y;b=a[1].y;var f=a[2].y;e=-d+3*b-3*f+a[3].y;a=3*d-6*b+3*f;f=-3*d+3*b;if(Zc.approximately(e,
0)){if(Zc.approximately(a,0))return Zc.approximately(f,0)?[]:[-d/f].filter(c);d=Nc(f*f-4*a*d);a*=2;return[(d-f)/a,(-f-d)/a].filter(c)}a/=e;f/=e;b=(3*f-a*a)/3;var g=b/3;d=(2*a*a*a-9*a*f+d/e*27)/27;e=d/2;f=e*e+g*g*g;if(0>f)return b=-b/3,b=Nc(b*b*b),d=-d/(2*b),e=Lc(-1>d?-1:1<d?1:d),f=2*Pc(b),d=f*Hc(e/3)-a/3,b=f*Hc((e+Uc)/3)-a/3,a=f*Hc((e+2*Uc)/3)-a/3,[d,b,a].filter(c);if(0===f)return d=0>e?Pc(-e):-Pc(e),[2*d-a/3,-d-a/3].filter(c);b=Nc(f);d=Pc(-e+b);b=Pc(e+b);return[d-b-a/3].filter(c)},droots:function(a){if(3===
a.length){var b=a[0],c=a[1],d=a[2];a=b-2*c+d;return 0!==a?(d=-Nc(c*c-b*d),b=-b+c,[-(d+b)/a,-(-d+b)/a]):c!==d&&0===a?[(2*c-d)/(2*(c-d))]:[]}return 2===a.length&&(b=a[0],c=a[1],b!==c)?[b/(b-c)]:[]},curvature:function(a,b,c,d,e){var f=Zc.compute(a,b);var g=Zc.compute(a,c);var k=f.x*f.x+f.y*f.y;d?(g=Nc(Oc(f.y*g.z-g.y*f.z,2)+Oc(f.z*g.x-g.z*f.x,2)+Oc(f.x*g.y-g.x*f.y,2)),k=Oc(k+f.z*f.z,1.5)):(g=f.x*g.y-f.y*g.x,k=Oc(k,1.5));if(0===g||0===k)return{k:0,r:0};f=g/k;g=k/g;if(!e){e=Zc.curvature(a-.001,b,c,d,!0).k;
a=Zc.curvature(a+.001,b,c,d,!0).k;var h=(a-f+(f-e))/2;var l=(Gc(a-f)+Gc(f-e))/2}return{k:f,r:g,dk:h,adk:l}},inflections:function(a){if(4>a.length)return[];a=Zc.align(a,{p1:a[0],p2:a.slice(-1)[0]});var b=a[2].x*a[1].y,c=a[3].x*a[1].y,d=a[1].x*a[2].y;a=18*(-3*b+2*c+3*d-a[3].x*a[2].y);c=18*(3*b-c-3*d);b=18*(d-b);if(Zc.approximately(a,0))return!Zc.approximately(c,0)&&(a=-b/c,0<=a&&1>=a)?[a]:[];b=Math.sqrt(c*c-4*a*b);a*=2;return Zc.approximately(a,0)?[]:[(b-c)/a,-(c+b)/a].filter(function(e){return 0<=
e&&1>=e})},bboxoverlap:function(a,b){for(var c=["x","y"],d=c.length,e=0,f,g,k;e<d;e++)if(f=c[e],g=a[f].mid,k=b[f].mid,f=(a[f].size+b[f].size)/2,Gc(g-k)>=f)return!1;return!0},expandbox:function(a,b){b.x.min<a.x.min&&(a.x.min=b.x.min);b.y.min<a.y.min&&(a.y.min=b.y.min);b.z&&b.z.min<a.z.min&&(a.z.min=b.z.min);b.x.max>a.x.max&&(a.x.max=b.x.max);b.y.max>a.y.max&&(a.y.max=b.y.max);b.z&&b.z.max>a.z.max&&(a.z.max=b.z.max);a.x.mid=(a.x.min+a.x.max)/2;a.y.mid=(a.y.min+a.y.max)/2;a.z&&(a.z.mid=(a.z.min+a.z.max)/
2);a.x.size=a.x.max-a.x.min;a.y.size=a.y.max-a.y.min;a.z&&(a.z.size=a.z.max-a.z.min)},pairiteration:function(a,b,c){var d=a.bbox(),e=b.bbox(),f=c||.5;if(d.x.size+d.y.size<f&&e.x.size+e.y.size<f)return[(1E5*(a._t1+a._t2)/2|0)/1E5+"/"+(1E5*(b._t1+b._t2)/2|0)/1E5];a=a.split(.5);b=b.split(.5);b=[{left:a.left,right:b.left},{left:a.left,right:b.right},{left:a.right,right:b.right},{left:a.right,right:b.left}];b=b.filter(function(k){return Zc.bboxoverlap(k.left.bbox(),k.right.bbox())});var g=[];if(0===b.length)return g;
b.forEach(function(k){g=g.concat(Zc.pairiteration(k.left,k.right,f))});return g=g.filter(function(k,h){return g.indexOf(k)===h})},getccenter:function(a,b,c){var d=b.x-a.x,e=b.y-a.y,f=c.x-b.x,g=c.y-b.y,k=d*Hc(Vc)-e*Ic(Vc);d=d*Ic(Vc)+e*Hc(Vc);e=f*Hc(Vc)-g*Ic(Vc);f=f*Ic(Vc)+g*Hc(Vc);g=(a.x+b.x)/2;var h=(a.y+b.y)/2,l=(b.x+c.x)/2,n=(b.y+c.y)/2;k=Zc.lli8(g,h,g+k,h+d,l,n,l+e,n+f);d=Zc.dist(k,a);a=Mc(a.y-k.y,a.x-k.x);b=Mc(b.y-k.y,b.x-k.x);c=Mc(c.y-k.y,c.x-k.x);if(a<c){if(a>b||b>c)a+=Uc;a>c&&(b=c,c=a,a=b)}else c<
b&&b<a?(b=c,c=a,a=b):c+=Uc;k.s=a;k.e=c;k.r=d;return k},numberSort:function(a,b){return a-b}};function ad(a){this.curves=[];this._3d=!1;a&&(this.curves=a,this._3d=this.curves[0]._3d)}ad.prototype.valueOf=function(){return this.toString()};ad.prototype.toString=function(){return"["+this.curves.map(function(a){return Zc.pointsToString(a.points)}).join(", ")+"]"};ad.prototype.addCurve=function(a){this.curves.push(a);this._3d=this._3d||a._3d};
ad.prototype.length=function(){return this.curves.map(function(a){return a.length()}).reduce(function(a,b){return a+b})};ad.prototype.curve=function(a){return this.curves[a]};ad.prototype.bbox=function(){for(var a=this.curves,b=a[0].bbox(),c=1;c<a.length;c++)Zc.expandbox(b,a[c].bbox());return b};ad.prototype.offset=function(a){var b=[];this.curves.forEach(function(c){b.push.apply(b,m.arrayFromIterable(c.offset(a)))});return new ad(b)};
var bd=Math,cd=bd.abs,dd=bd.min,ed=bd.max,fd=bd.cos,gd=bd.sin,id=bd.acos,jd=bd.sqrt,kd=Math.PI;
function $c(a){var b=a&&a.forEach?a:Array.from(arguments).slice(),c=!1;if("object"===typeof b[0]){c=b.length;var d=[];b.forEach(function(l){["x","y","z"].forEach(function(n){"undefined"!==typeof l[n]&&d.push(l[n])})});b=d}var e=!1,f=b.length;if(c){if(4<c){if(1!==arguments.length)throw Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");e=!0}}else if(6!==f&&8!==f&&9!==f&&12!==f&&1!==arguments.length)throw Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");
e=this._3d=!e&&(9===f||12===f)||a&&a[0]&&"undefined"!==typeof a[0].z;c=this.points=[];for(var g=0,k=e?3:2;g<f;g+=k){var h={x:b[g],y:b[g+1]};e&&(h.z=b[g+2]);c.push(h)}b=this.order=c.length-1;f=this.dims=["x","y"];e&&f.push("z");this.dimlen=f.length;f=Zc.align(c,{p1:c[0],p2:c[b]});c=Zc.dist(c[0],c[b]);this._linear=f.reduce(function(l,n){return l+cd(n.y)},0)<c/50;this._lut=[];this._t1=0;this._t2=1;this.update()}
$c.quadraticFromPoints=function(a,b,c,d){"undefined"===typeof d&&(d=.5);if(0===d)return new $c(b,b,c);if(1===d)return new $c(a,b,b);b=$c.getABC(2,a,b,c,d);return new $c(a,b.A,c)};
$c.cubicFromPoints=function(a,b,c,d,e){"undefined"===typeof d&&(d=.5);var f=$c.getABC(3,a,b,c,d);"undefined"===typeof e&&(e=Zc.dist(b,f.C));var g=e*(1-d)/d,k=Zc.dist(a,c),h=(c.x-a.x)/k;k=(c.y-a.y)/k;f=f.A;return new $c(a,{x:a.x+(f.x+(b.x-e*h-f.x)/(1-d)-a.x)/d,y:a.y+(f.y+(b.y-e*k-f.y)/(1-d)-a.y)/d},{x:c.x+(f.x+(b.x+g*h-f.x)/d-c.x)/(1-d),y:c.y+(f.y+(b.y+g*k-f.y)/d-c.y)/(1-d)},c)};$c.getUtils=function(){return Zc};$c.prototype.getUtils=function(){return $c.getUtils()};$c.prototype.valueOf=function(){return this.toString()};
$c.prototype.toString=function(){return Zc.pointsToString(this.points)};$c.prototype.toSVG=function(){if(this._3d)return!1;for(var a=this.points,b=["M",a[0].x,a[0].y,2===this.order?"Q":"C"],c=1,d=a.length;c<d;c++)b.push(a[c].x),b.push(a[c].y);return b.join(" ")};$c.prototype.setRatios=function(a){if(a.length!==this.points.length)throw Error("incorrect number of ratio values");this.ratios=a;this._lut=[]};$c.prototype.verify=function(){var a=this.coordDigest();a!==this._print&&(this._print=a,this.update())};
$c.prototype.coordDigest=function(){return this.points.map(function(a,b){return""+b+a.x+a.y+(a.z?a.z:0)}).join("")};$c.prototype.update=function(){this._lut=[];this.dpoints=Zc.derive(this.points,this._3d);this.computedirection()};$c.prototype.computedirection=function(){var a=this.points;this.clockwise=0<Zc.angle(a[0],a[this.order],a[1])};$c.prototype.length=function(){return Zc.length(this.derivative.bind(this))};
$c.getABC=function(a,b,c,d,e){a=void 0===a?2:a;e=void 0===e?.5:e;var f=Zc.projectionratio(e,a),g=1-f;f={x:f*b.x+g*d.x,y:f*b.y+g*d.y};a=Zc.abcratio(e,a);return{A:{x:c.x+(c.x-f.x)/a,y:c.y+(c.y-f.y)/a},B:c,C:f,S:b,E:d}};$c.prototype.getABC=function(a,b){b=b||this.get(a);return $c.getABC(this.order,this.points[0],b,this.points[this.order],a)};
$c.prototype.getLUT=function(a){this.verify();a=a||100;if(this._lut.length===a)return this._lut;a++;this._lut=[];for(var b=0,c,d;b<a;b++)d=b/(a-1),c=this.compute(d),c.t=d,this._lut.push(c);return this._lut};$c.prototype.on=function(a,b){b=b||5;for(var c=this.getLUT(),d=[],e=0,f;e<c.length;e++)f=c[e],Zc.dist(f,a)<b&&d.push(f);return d.length?NaN/d.length:!1};
$c.prototype.project=function(a){var b=this.getLUT(),c=b.length-1,d=Zc.closest(b,a),e=d.mpos;b=(e+1)/c;var f=.1/c;d=d.mdist;e=c=(e-1)/c;for(d+=1;c<b+f;c+=f){var g=this.compute(c);g=Zc.dist(a,g);g<d&&(d=g,e=c)}e=0>e?0:1<e?1:e;g=this.compute(e);g.t=e;g.d=d;return g};$c.prototype.get=function(a){return this.compute(a)};$c.prototype.point=function(a){return this.points[a]};
$c.prototype.compute=function(a){return this.ratios?Zc.computeWithRatios(a,this.points,this.ratios,this._3d):Zc.compute(a,this.points,this._3d,this.ratios)};$c.prototype.raise=function(){for(var a=this.points,b=[a[0]],c=a.length,d=1,e,f;d<c;d++)e=a[d],f=a[d-1],b[d]={x:(c-d)/c*e.x+d/c*f.x,y:(c-d)/c*e.y+d/c*f.y};b[c]=a[c-1];return new $c(b)};$c.prototype.derivative=function(a){return Zc.compute(a,this.dpoints[0],this._3d)};$c.prototype.dderivative=function(a){return Zc.compute(a,this.dpoints[1],this._3d)};
$c.prototype.align=function(){var a=this.points;return new $c(Zc.align(a,{p1:a[0],p2:a[a.length-1]}))};$c.prototype.curvature=function(a){return Zc.curvature(a,this.dpoints[0],this.dpoints[1],this._3d)};$c.prototype.inflections=function(){return Zc.inflections(this.points)};$c.prototype.normal=function(a){return this._3d?this.__normal3(a):this.__normal2(a)};$c.prototype.__normal2=function(a){a=this.derivative(a);var b=jd(a.x*a.x+a.y*a.y);return{x:-a.y/b,y:a.x/b}};
$c.prototype.__normal3=function(a){var b=this.derivative(a);a=this.derivative(a+.01);var c=jd(b.x*b.x+b.y*b.y+b.z*b.z),d=jd(a.x*a.x+a.y*a.y+a.z*a.z);b.x/=c;b.y/=c;b.z/=c;a.x/=d;a.y/=d;a.z/=d;c=a.y*b.z-a.z*b.y;d=a.z*b.x-a.x*b.z;a=a.x*b.y-a.y*b.x;var e=jd(c*c+d*d+a*a);c/=e;d/=e;a/=e;a=[c*c,c*d-a,c*a+d,c*d+a,d*d,d*a-c,c*a-d,d*a+c,a*a];return{x:a[0]*b.x+a[1]*b.y+a[2]*b.z,y:a[3]*b.x+a[4]*b.y+a[5]*b.z,z:a[6]*b.x+a[7]*b.y+a[8]*b.z}};
$c.prototype.hull=function(a){var b=this.points,c=[],d=0;c[d++]=b[0];c[d++]=b[1];c[d++]=b[2];for(3===this.order&&(c[d++]=b[3]);1<b.length;){var e=[];for(var f=0,g,k=b.length-1;f<k;f++)g=Zc.lerp(a,b[f],b[f+1]),c[d++]=g,e.push(g);b=e}return c};
$c.prototype.split=function(a,b){if(0===a&&b)return this.split(b).left;if(1===b)return this.split(a).right;var c=this.hull(a);c={left:2===this.order?new $c([c[0],c[3],c[5]]):new $c([c[0],c[4],c[7],c[9]]),right:2===this.order?new $c([c[5],c[4],c[2]]):new $c([c[9],c[8],c[6],c[3]]),span:c};c.left._t1=Zc.map(0,0,1,this._t1,this._t2);c.left._t2=Zc.map(a,0,1,this._t1,this._t2);c.right._t1=Zc.map(a,0,1,this._t1,this._t2);c.right._t2=Zc.map(1,0,1,this._t1,this._t2);if(!b)return c;b=Zc.map(b,a,1,0,1);return c.right.split(b).left};
$c.prototype.extrema=function(){var a={},b=[];this.dims.forEach(function(c){function d(f){return f[c]}var e=this.dpoints[0].map(d);a[c]=Zc.droots(e);3===this.order&&(e=this.dpoints[1].map(d),a[c]=a[c].concat(Zc.droots(e)));a[c]=a[c].filter(function(f){return 0<=f&&1>=f});b=b.concat(a[c].sort(Zc.numberSort))}.bind(this));a.values=b.sort(Zc.numberSort).filter(function(c,d){return b.indexOf(c)===d});return a};
$c.prototype.bbox=function(){var a=this.extrema(),b={};this.dims.forEach(function(c){b[c]=Zc.getminmax(this,c,a[c])}.bind(this));return b};$c.prototype.overlaps=function(a){var b=this.bbox();a=a.bbox();return Zc.bboxoverlap(b,a)};
$c.prototype.offset=function(a,b){if("undefined"!==typeof b){var c=this.get(a),d=this.normal(a),e={c:c,n:d,x:c.x+d.x*b,y:c.y+d.y*b};this._3d&&(e.z=c.z+d.z*b);return e}if(this._linear){var f=this.normal(0);b=this.points.map(function(g){var k={x:g.x+a*f.x,y:g.y+a*f.y};g.z&&f.z&&(k.z=g.z+a*f.z);return k});return[new $c(b)]}return this.reduce().map(function(g){return g._linear?g.offset(a)[0]:g.scale(a)})};
$c.prototype.simple=function(){if(3===this.order){var a=Zc.angle(this.points[0],this.points[3],this.points[1]),b=Zc.angle(this.points[0],this.points[3],this.points[2]);if(0<a&&0>b||0>a&&0<b)return!1}a=this.normal(0);b=this.normal(1);var c=a.x*b.x+a.y*b.y;this._3d&&(c+=a.z*b.z);return cd(id(c))<kd/3};
$c.prototype.reduce=function(){var a,b=0,c=0,d=[],e=[],f=this.extrema().values;-1===f.indexOf(0)&&(f=[0].concat(f));-1===f.indexOf(1)&&f.push(1);b=f[0];for(a=1;a<f.length;a++){c=f[a];var g=this.split(b,c);g._t1=b;g._t2=c;d.push(g);b=c}d.forEach(function(k){for(c=b=0;1>=c;)for(c=b+.01;1.01>=c;c+=.01)if(g=k.split(b,c),!g.simple()){c-=.01;if(.01>cd(b-c))return[];g=k.split(b,c);g._t1=Zc.map(b,0,1,k._t1,k._t2);g._t2=Zc.map(c,0,1,k._t1,k._t2);e.push(g);b=c;break}1>b&&(g=k.split(b,1),g._t1=Zc.map(b,0,1,
k._t1,k._t2),g._t2=k._t2,e.push(g))});return e};$c.prototype.translate=function(a,b,c){c="number"===typeof c?c:b;var d=this.order,e=this.points.map(function(f,g){return(1-g/d)*b+g/d*c});return new $c(this.points.map(function(f,g){return{x:f.x+a.x*e[g],y:f.y+a.y*e[g]}}))};
$c.prototype.scale=function(a){var b=this,c=this.order,d=!1;"function"===typeof a&&(d=a);if(d&&2===c)return this.raise().scale(d);var e=this.clockwise,f=this.points;if(this._linear)return this.translate(this.normal(0),d?d(0):a,d?d(1):a);var g=d?d(0):a,k=d?d(1):a,h=[this.offset(0,10),this.offset(1,10)],l=[],n=Zc.lli4(h[0],h[0].c,h[1],h[1].c);if(!n)throw Error("cannot scale this curve. Try reducing it first.");[0,1].forEach(function(r){var v=l[r*c]=Zc.copy(f[r*c]);v.x+=(r?k:g)*h[r].n.x;v.y+=(r?k:g)*
h[r].n.y});if(!d)return[0,1].forEach(function(r){if(2!==c||!r){var v=l[r*c],p=b.derivative(r);l[r+1]=Zc.lli4(v,{x:v.x+p.x,y:v.y+p.y},n,f[r+1])}}),new $c(l);[0,1].forEach(function(r){if(2!==c||!r){var v=f[r+1],p=v.x-n.x,w=v.y-n.y,u=d?d((r+1)/c):a;d&&!e&&(u=-u);var y=jd(p*p+w*w);l[r+1]={x:v.x+p/y*u,y:v.y+w/y*u}}});return new $c(l)};
$c.prototype.outline=function(a,b,c,d){function e(D,H,K,J,W){return function(M){var ba=H-D;return Zc.map(M,0,1,D+J/K*ba,D+(J+W)/K*ba)}}b=void 0===b?a:b;if(this._linear){var f=this.normal(0),g=this.points[0],k=this.points[this.points.length-1];void 0===c&&(c=a,d=b);var h={x:g.x+f.x*a,y:g.y+f.y*a};var l={x:k.x+f.x*c,y:k.y+f.y*c};var n={x:(h.x+l.x)/2,y:(h.y+l.y)/2};var r=[h,n,l];h={x:g.x-f.x*b,y:g.y-f.y*b};l={x:k.x-f.x*d,y:k.y-f.y*d};n={x:(h.x+l.x)/2,y:(h.y+l.y)/2};f=[l,n,h];g=Zc.makeline(f[2],r[0]);
k=Zc.makeline(r[2],f[0]);r=[g,new $c(r),k,new $c(f)];return new ad(r)}f=this.reduce();r=f.length;var v=[],p=[],w,u=0,y=this.length(),B="undefined"!==typeof c&&"undefined"!==typeof d;f.forEach(function(D){var H=D.length();B?(v.push(D.scale(e(a,c,y,u,H))),p.push(D.scale(e(-b,-d,y,u,H)))):(v.push(D.scale(a)),p.push(D.scale(-b)));u+=H});p=p.map(function(D){w=D.points;D.points=w[3]?[w[3],w[2],w[1],w[0]]:[w[2],w[1],w[0]];return D}).reverse();f=v[r-1].points[v[r-1].points.length-1];g=p[0].points[0];r=Zc.makeline(p[r-
1].points[p[r-1].points.length-1],v[0].points[0]);f=Zc.makeline(f,g);r=[r].concat(v).concat([f]).concat(p);return new ad(r)};$c.prototype.outlineshapes=function(a,b,c){a=this.outline(a,b||a).curves;b=[];for(var d=1,e=a.length;d<e/2;d++){var f=Zc.makeshape(a[d],a[e-d],c);f.startcap.virtual=1<d;f.endcap.virtual=d<e/2-1;b.push(f)}return b};
$c.prototype.intersects=function(a,b){if(!a)return this.selfintersects(b);if(a.p1&&a.p2)return this.lineIntersects(a);a instanceof $c&&(a=a.reduce());return this.curveintersects(this.reduce(),a,b)};$c.prototype.lineIntersects=function(a){var b=this,c=dd(a.p1.x,a.p2.x),d=dd(a.p1.y,a.p2.y),e=ed(a.p1.x,a.p2.x),f=ed(a.p1.y,a.p2.y);return Zc.roots(this.points,a).filter(function(g){g=b.get(g);return Zc.between(g.x,c,e)&&Zc.between(g.y,d,f)})};
$c.prototype.selfintersects=function(a){for(var b=this.reduce(),c=b.length-2,d=[],e=0,f,g;e<c;e++)f=b.slice(e,e+1),g=b.slice(e+2),f=this.curveintersects(f,g,a),d.push.apply(d,m.arrayFromIterable(f));return d};$c.prototype.curveintersects=function(a,b,c){var d=[];a.forEach(function(f){b.forEach(function(g){f.overlaps(g)&&d.push({left:f,right:g})})});var e=[];d.forEach(function(f){f=Zc.pairiteration(f.left,f.right,c);0<f.length&&(e=e.concat(f))});return e};
$c.prototype.arcs=function(a){return this._iterate(a||.5,[])};$c.prototype._error=function(a,b,c,d){var e=(d-c)/4;c=this.get(c+e);d=this.get(d-e);b=Zc.dist(a,b);c=Zc.dist(a,c);a=Zc.dist(a,d);return cd(c-b)+cd(a-b)};
$c.prototype._iterate=function(a,b){var c=0;do{var d=0;var e=1;var f=this.get(c);var g=void 0;var k=!1;var h=1;do{var l=k;var n=g;var r=(c+e)/2;g=this.get(r);k=this.get(e);g=Zc.getccenter(f,g,k);g.interval={start:c,end:e};k=this._error(g,f,c,e)<=a;(l=l&&!k)||(h=e);if(k){if(1<=e){g.interval.end=h=1;n=g;1<e&&(c={x:g.x+g.r*fd(g.e),y:g.y+g.r*gd(g.e)},g.e+=Zc.angle({x:g.x,y:g.y},c,this.get(1)));break}e+=(e-c)/2}else e=r}while(!l&&100>d++);if(100<=d)break;n=n?n:g;b.push(n);c=h}while(1>e);return b};
m.global.Object.defineProperties($c,{PolyBezier:{configurable:!0,enumerable:!0,get:function(){return ad}}});WALK.ColorUtils={linearToGamma:function(a){return.0031308>=a?12.92*a:1.055*Math.pow(a,1/2.4)-.055},gammaToLinear:function(a){return.04045>=a?a/12.92:Math.pow((a+.055)/1.055,2.4)},hdrEncode:function(a,b){var c=Math.sqrt(a.r)/2.82842712,d=Math.sqrt(a.g)/2.82842712;a=Math.sqrt(a.b)/2.82842712;var e=Math.max(Math.max(c,d),a);e=G.Math.clamp(e,1/255,1);e=Math.ceil(255*e)/255;b.setRGB(c/e,d/e,a/e);return 1-e}};G.Color.prototype.copyGammaToLinear=void 0;G.Color.prototype.copyLinearToGamma=void 0;
G.Color.prototype.convertLinearToGamma=void 0;G.Color.prototype.convertGammaToLinear=function(){this.r=WALK.ColorUtils.gammaToLinear(this.r);this.g=WALK.ColorUtils.gammaToLinear(this.g);this.b=WALK.ColorUtils.gammaToLinear(this.b)};G.Color.prototype.roundChannels=function(){this.r=WALK.round(this.r,3);this.g=WALK.round(this.g,3);this.b=WALK.round(this.b,3);return this};WALK.Euler=function(a,b,c){G.Euler.call(this,b,c,a,"ZXY")};WALK.Euler.prototype=Object.create(G.Euler.prototype);WALK.Euler.prototype.constructor=WALK.Euler;Object.defineProperty(WALK.Euler.prototype,"yaw",{get:function(){return this.z},set:function(a){this.z=a}});Object.defineProperty(WALK.Euler.prototype,"pitch",{get:function(){return this.x},set:function(a){this.x=a}});Object.defineProperty(WALK.Euler.prototype,"roll",{get:function(){return this.y},set:function(a){this.y=a}});
Object.defineProperty(WALK.Euler.prototype,"yawDeg",{get:function(){return G.Math.radToDeg(this.yaw)},set:function(a){this.yaw=G.Math.degToRad(a)}});Object.defineProperty(WALK.Euler.prototype,"pitchDeg",{get:function(){return G.Math.radToDeg(this.pitch)},set:function(a){this.pitch=G.Math.degToRad(a)}});Object.defineProperty(WALK.Euler.prototype,"rollDeg",{get:function(){return G.Math.radToDeg(this.roll)},set:function(a){this.roll=G.Math.degToRad(a)}});
WALK.Euler.prototype.setFromDegTriple=function(a){var b=G.Math.degToRad(a[0]),c=G.Math.degToRad(a[1]);a=G.Math.degToRad(a[2]);this.set(c,a,b);return this};WALK.Euler.prototype.toDegTriple=function(){return[this.yawDeg,this.pitchDeg,this.rollDeg]};WALK.Euler.prototype.setFromDirection=function(a){this.set(Math.asin(a.z),0,Math.atan2(-a.x,a.y));return this};WALK.Euler.prototype.toQuaternion=function(){var a=new G.Quaternion;a.setFromEuler(this);return a};
WALK.Euler.prototype.toRotationMatrix=function(){var a=new G.Matrix4;a.makeRotationFromEuler(this);return a};var ld=new G.Sphere;WALK.Frustum=function(){this.planes=[new G.Plane,new G.Plane,new G.Plane,new G.Plane,new G.Plane,new G.Plane]};
WALK.Frustum.prototype={constructor:WALK.Frustum,setFromMatrix:function(a){var b=this.planes,c=a.elements;a=c[0];var d=c[1],e=c[2],f=c[3],g=c[4],k=c[5],h=c[6],l=c[7],n=c[8],r=c[9],v=c[10],p=c[11],w=c[12],u=c[13],y=c[14];c=c[15];b[0].setComponents(f-a,l-g,p-n,c-w).normalize();b[1].setComponents(f+a,l+g,p+n,c+w).normalize();b[2].setComponents(f+d,l+k,p+r,c+u).normalize();b[3].setComponents(f-d,l-k,p-r,c-u).normalize();b[4].setComponents(f-e,l-h,p-v,c-y).normalize();b[5].setComponents(f+e,l+h,p+v,c+
y).normalize();return this},intersectsObject:function(a){var b=a.geometry;null===b.boundingSphere&&b.computeBoundingSphere();a.matrixWorld?(ld.copy(b.boundingSphere),ld.applyMatrix4(a.matrixWorld),a=ld):a=b.boundingSphere;return this.intersectsSphere(a)},nearPlaneDistanceToCenter:function(a){var b=a.geometry,c=this.planes[5];a.matrixWorld?(ld.copy(b.boundingSphere),ld.applyMatrix4(a.matrixWorld),a=ld):a=b.boundingSphere;return c.distanceToPoint(a.center)},intersectsSphere:function(a){var b=this.planes,
c=a.center;a=-a.radius;for(var d=0;6>d;d+=1)if(b[d].distanceToPoint(c)<a)return!1;return!0},intersectsBox:function(){var a=new G.Vector3,b=new G.Vector3;return function(c){for(var d=this.planes,e=0;6>e;e+=1){var f=d[e];a.x=0<f.normal.x?c.min.x:c.max.x;b.x=0<f.normal.x?c.max.x:c.min.x;a.y=0<f.normal.y?c.min.y:c.max.y;b.y=0<f.normal.y?c.max.y:c.min.y;a.z=0<f.normal.z?c.min.z:c.max.z;b.z=0<f.normal.z?c.max.z:c.min.z;var g=f.distanceToPoint(a);f=f.distanceToPoint(b);if(0>g&&0>f)return!1}return!0}}(),
containsPoint:function(a){for(var b=this.planes,c=0;6>c;c+=1)if(0>b[c].distanceToPoint(a))return!1;return!0}};var md=new G.Vector3;
WALK.Math={toSnorm8:function(a){return Math.round(127*G.Math.clamp(a,-1,1))},minBytesToHold:function(a){return 127>=a?1:32767>=a?2:4},anyPositiveRootOfQuadraticEquation:function(a,b,c){c=b*b-4*a*c;if(0>c)return null;c=Math.sqrt(c);var d=(-b-c)/(2*a);if(0<d)return d;a=(-b+c)/(2*a);return 0<a?a:null},spheresUnion:function(a,b){if(b.empty())b.copy(a);else{var c=b.center.distanceTo(a.center);if(a.radius>b.radius){var d=a;a=b}else d=b;var e=(d.radius+a.radius+c)/2;e<=d.radius?b.copy(d):(c=(e-d.radius)/
c,console.assert(0<c),md.copy(a.center).sub(d.center).multiplyScalar(c),b.center.copy(d.center).add(md),b.radius=e)}}};WALK.DETECTOR=new function(){function a(h){function l(p){var w=r[p];if(void 0!==w)return w;switch(p){case "EXT_texture_filter_anisotropic":w=h.getExtension("EXT_texture_filter_anisotropic")||h.getExtension("MOZ_EXT_texture_filter_anisotropic")||h.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case "WEBGL_compressed_texture_s3tc":w=h.getExtension("WEBGL_compressed_texture_s3tc")||h.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||h.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");
break;case "WEBGL_compressed_texture_pvrtc":w=h.getExtension("WEBGL_compressed_texture_pvrtc")||h.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case "WEBGL_compressed_texture_etc1":w=h.getExtension("WEBGL_compressed_texture_etc1");break;default:w=h.getExtension(p)}return r[p]=w}function n(){var p=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return p?parseInt(p[2],10):!1}var r={};this.extension=l;this.webgl2="undefined"!==typeof WebGL2RenderingContext&&h instanceof WebGL2RenderingContext;
this.antialiasNative=h.getContextAttributes().antialias&&1<h.getParameter(h.SAMPLES);this.antialiasSamples=h.getParameter(h.SAMPLES);this.antialiasPostprocess=!f.mobile;this.floatTextures=this.webgl2||l("OES_texture_float");this.standardDerivatives=this.webgl2||l("OES_standard_derivatives");this.maxAnisotropy=function(){var p=l("EXT_texture_filter_anisotropic");return null!==p?h.getParameter(p.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}();this.indexUint=this.webgl2||l("OES_element_index_uint");this.instances=
this.webgl2||l("ANGLE_instanced_arrays");this.fragmentPrecision=void 0===h.getShaderPrecisionFormat||0<h.getShaderPrecisionFormat(h.FRAGMENT_SHADER,h.HIGH_FLOAT).precision?"highp":0<h.getShaderPrecisionFormat(h.FRAGMENT_SHADER,h.MEDIUM_FLOAT).precision?"mediump":"lowp";var v=4096>h.getParameter(h.MAX_TEXTURE_SIZE)?"Your graphics card does not have sufficient capabilities, texture sizes 4096x4096 need to be supported.":null;this.missingCapabilities=v;this.maxRenderBufferSize=h.getParameter(h.MAX_RENDERBUFFER_SIZE);
this.dxtTextures=function(){try{if(WALK.urlHashContains("nodxt"))return!1;for(var p=l("WEBGL_compressed_texture_s3tc"),w=h.getParameter(h.COMPRESSED_TEXTURE_FORMATS),u=!1,y=!1,B=0;B<w.length;B+=1)u=u||w[B]===p.COMPRESSED_RGB_S3TC_DXT1_EXT,y=y||w[B]===p.COMPRESSED_RGBA_S3TC_DXT5_EXT;return u&&y}catch(D){}return!1}();v=WALK.urlHashContains("nopvr")?!1:l("WEBGL_compressed_texture_pvrtc");this.pvrtcTextures=v;v=WALK.urlHashContains("noetc1")?!1:l("WEBGL_compressed_texture_etc1")&&f.mobile;this.etc1Textures=
v;this.astcTextures=!1;this.textureLod=this.webgl2||l("EXT_shader_texture_lod")&&(!f.firefox||!f.android);this.mirrorCubeMaps=!f.mobile||WALK.MOBILE_HI;this.disableTextureSlotReuse=f.mac||83===n();this.reportToConsole=function(){WALK.log("WebGL"+(this.webgl2?"2":"")+"; "+this.fragmentPrecision+" fragment precision.");this.dxtTextures||WALK.log("DXT textures not supported.");this.textureLod||WALK.log("Texture fetch level of detail not supported.");this.floatTextures||WALK.log("Float textures not supported.");
this.antialiasNative?WALK.log("Native anti-aliasing supported with "+this.antialiasSamples+" samples."):WALK.log("Native anti-aliasing not supported");this.disableTextureSlotReuse&&WALK.log("WebGL texture slot reuse disabled.");this.indexUint||WALK.log("Uint index not supported");this.instances||WALK.log("Instanced geometry not supported")}}function b(h){var l=document.createElement("a");l.href=h;return l.protocol+"//"+l.host}function c(h,l){h=h.toLowerCase();l=l.toLowerCase();return-1!==h.indexOf(l)}
function d(h){return navigator&&navigator.userAgent?c(navigator.userAgent,h):!1}function e(h,l){console.assert(void 0===f[h]);f[h]=l;void 0!==f.webp&&(k.forEach(function(n){return n()}),k.length=0)}var f=this;this.https="https:"===window.location.protocol;this.localhost="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname;this.canForceBrotliBuffers=!1;this.ipad=/iPad/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&1<navigator.maxTouchPoints;this.mobile=/mobile|ip(hone|od)|android|silk/i.test(navigator.userAgent)||
this.ipad||WALK.urlHashContains("mobile");this.ios=/iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||this.ipad;this.android=/Android/.test(navigator.userAgent);this.facebookApp=/FBAN|FBAV/.test(navigator.userAgent);this.whatsApp=/WhatsApp/.test(navigator.userAgent);this.inCrossOriginIframe=function(){var h=window.self!==window.top,l=b(document.referrer),n=b(window.location.href);return h&&l!==n}();this.firefox=d("firefox");this.opera=d("opera")||d("OPR/");var g;(g=d("msie"))||(g=navigator&&
navigator.appVersion?c(navigator.appVersion,"trident/"):!1);this.ie=g;this.edge=d("edge/");this.safari=d("safari/")&&!(d("chrome/")||d("chromium/"));this.mac=d("macintosh")&&!this.ipad;this.BASIS_DECODE_WORKERS=this.safari||this.ios?0:Math.min(4,navigator.hardwareConcurrency||4);this.gl=null;this.resetGlDetector=function(h){this.gl=new a(h)};this.webp=void 0;var k=[];(function(){var h=new Image;h.onload=function(){e("webp",0<h.width&&0<h.height)};h.onerror=function(){e("webp",!1)};h.src="data:image/webp;base64,UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA=="})();
this.onAsyncPropertiesDetected=function(h){void 0!==f.webp?h():k.push(h)}};WALK.Viewer=function(a,b,c){function d(){return null}function e(Q){c.isMaterialEditable(Q)||console.assert(!1,"Can't access material, call ViewerApi.setMaterialEditable('"+Q+"') before the scene is loaded.")}function f(){for(var Q=[],oa=m.makeIterator(E.materials),Aa=oa.next();!Aa.done;Aa=oa.next())Aa=Aa.value,c.isMaterialEditable(Aa.name)&&Q.push(Aa);return Q}function g(){for(var Q=[],oa=m.makeIterator(E.nodeConfigs),Aa=oa.next();!Aa.done;Aa=oa.next())Aa=Aa.value,c.isNodeTypeEditable(Aa.name)&&Q.push(Aa.name);
return Q}function k(Q){e(Q);for(var oa=m.makeIterator(E.materials),Aa=oa.next();!Aa.done;Aa=oa.next())if(Aa=Aa.value,Aa.name===Q)return Aa;return null}function h(){Ya.copy(Y.cameraWorldPosition());return Ya}function l(){Za.yaw=Y.getYawAngle();Za.pitch=Y.getPitchAngle();Za.roll=0;return Za}function n(){return E.boundingBox}function r(Q){var oa=[];e(Q);for(var Aa=m.makeIterator(E.gpuMeshes),Wa=Aa.next();!Wa.done;Wa=Aa.next())Wa=Wa.value,Wa.material.name===Q&&oa.push(Wa);return oa}function v(Q){return(Q=
E.findNodeConfig(Q))?Q.nodes.slice(0):[]}function p(Q,oa){oa.geometry.isUvs0Repeating&&Q.ensureTexturesRepeatable&&Q.ensureTexturesRepeatable();oa.material=Q;za.requestFrame()}function w(Q,oa){console.warn("setMaterialForNode() is deprecated, use setMaterialForMesh() instead");p(Q,oa)}function u(Q,oa,Aa){var Wa;(Wa="string"===typeof Q?E.findViewByName(Q):Q)?(!0===oa?oa=0:!1===oa&&(oa=void 0),fa.isRunning()&&(oa=0,fa.stop()),Aa?(X.activateSky(Wa),X.updateHiddenMeshes(Wa)):X.switchToView(Wa,oa)):console.error("Unknown view: "+
Q)}function y(Q){Q=void 0===Q?{}:Q;var oa=Q.isPanorama||!1,Aa=Q.width||(oa?4E3:window.innerWidth),Wa=Q.height||(oa?2E3:window.innerHeight);if(Q.toDataUrl)return qa.monoScreenToDataUrl(oa,Aa,Wa);qa.monoScreenToLocalImage(oa,Aa,Wa)}function B(Q){E.addAuxiliaryObject(Q);Q!==Q.colliderMesh&&R.uploadNewBuffers(Q.colliderMesh);ka.addDynamicObstacle(Q.colliderMesh)}function D(Q,oa){for(var Aa=[],Wa=1;Wa<arguments.length;++Wa)Aa[Wa-1]=arguments[Wa];try{return Q.apply(null,m.arrayFromIterable(Aa))}catch(Ra){console.error(Ra)}return!1}
function H(Q,oa){for(var Aa=[],Wa=1;Wa<arguments.length;++Wa)Aa[Wa-1]=arguments[Wa];if(Q){Wa=m.makeIterator(Q);for(var Ra=Wa.next();!Ra.done;Ra=Wa.next())D.apply(null,[Ra.value].concat(m.arrayFromIterable(Aa)))}}function K(){H(S.nextPageInteraction);S.nextPageInteraction.length=0}function J(Q,oa){Q=new WALK.Anchor(E,Q);sa.push(Q);Ca&&B(Q);S.anchorClicked[Q.colliderMesh.id]=oa;N=!0;za.requestFrame();return Q}function W(Q){delete S.anchorClicked[Q.colliderMesh.id];Ca&&(E.removeAuxiliaryObject(Q),ka.removeDynamicObstacle(Q.colliderMesh));
WALK.removeFromArray(Q,sa);Q.dispose();za.requestFrame()}function M(Q,oa){Q=new WALK.Avatar(E,Q,oa);Ga.push(Q);E.addAuxiliaryObject(Q,!0);oa=m.makeIterator(Q.colliders);for(var Aa=oa.next();!Aa.done;Aa=oa.next())ka.addDynamicObstacle(Aa.value);H(S.avatarListChanged);return Q}function ba(Q){for(var oa=m.makeIterator(Q.colliders),Aa=oa.next();!Aa.done;Aa=oa.next())ka.removeDynamicObstacle(Aa.value);E.removeAuxiliaryObject(Q);WALK.removeFromArray(Q,Ga);Q.dispose();H(S.avatarListChanged)}function ha(Q){return WALK.find(Ga,
function(oa){return oa.uuid===Q})}function ta(){for(var Q=m.makeIterator(E.getAnimatedMaterials()),oa=Q.next();!oa.done;oa=Q.next())oa.value.sleepAnimation()}function I(){for(var Q=m.makeIterator(E.getAnimatedMaterials()),oa=Q.next();!oa.done;oa=Q.next())oa.value.wakeAnimation();za.requestFrame()}function U(Q,oa){return T.getExtension(Q,oa)}function ia(Q,oa){var Aa=Q[oa];if(Aa)return Aa;Aa=[];return Q[oa]=Aa}var R,E=null,Y,X,fa,ka,qa,ya,za,T,V,ma,P,N=!1,da=!1,ua=null,ja=null,S={nextPageInteraction:[],
viewerConfigLoaded:[],sceneReadyToDisplay:[],sceneLoadComplete:[],anchorClicked:{},materialPickerClicked:{},materialPickerClosed:null,nodeTypeClicked:{},anyNodeTypeClicked:[],materialClicked:{},nodeTypeHoverChanged:{},materialHoverChanged:{},viewSwitchStarted:[],viewSwitchDone:[],vrChange:[],beforeRender:[],anchorsVisibilityChanged:[],apiUserStateChanged:{},anyApiUserStateChanged:[],meetingJoined:[],avatarListChanged:[]},sa=[],Ga=[],Ya=new G.Vector3,Za=new WALK.Euler;document.addEventListener("keydown",
K);document.addEventListener("mousedown",K);WALK.DETECTOR.ios?document.addEventListener("touchstart",K):document.addEventListener("touchend",K);var Ca=!0;Object.defineProperty(this,"anchorsVisible",{get:function(){return Ca},set:function(Q){Q!==Ca&&((Ca=Q)?sa.forEach(function(oa){return B(oa)}):sa.forEach(function(oa){E.removeAuxiliaryObject(oa);ka.removeDynamicObstacle(oa.colliderMesh)}),this.requestFrame(),H(S.anchorsVisibilityChanged,Ca))}});var na=function(){function Q(Oa,cb,hb){Aa.set(Oa.x,Oa.y,
db.z).sub(db);Oa=Aa.length();Oa>cb&&(Aa.normalize().multiplyScalar(Oa-cb),hb.add(Aa))}var oa=new G.Vector3,Aa=new G.Vector3,Wa=new G.Vector3,Ra=new WALK.View,Pa=new G.Sphere,db;return function(Oa){db=Y.cameraWorldPosition();var cb=Ra.position;cb.copy(db);Oa instanceof WALK.LightInstance&&"sun"===Oa.light.type?(WALK.sunRotationToPosition(E,Oa.rotation,oa),Oa=oa):Oa instanceof WALK.Node?(WALK.computeNodeBoundingSphere(Oa,Pa),Oa=Pa.center,Q(Oa,1+Pa.radius,cb)):(Oa=Oa.position,Q(Oa,1,cb));Wa.copy(Oa).sub(cb).normalize();
Ra.rotation.setFromDirection(Wa);X.switchToView(Ra)}}();this.openMaterialPicker=function(Q,oa,Aa,Wa,Ra){console.assert(!ua,"Only one material picker can be opened");ua=new WALK.MaterialPicker(Q,Wa,Ra,E,Y,ya,ma);ua.meshes.forEach(function(Pa){E.addAuxiliaryObject(Pa);ka.addDynamicObstacle(Pa);S.materialPickerClicked[Pa.id]=oa});S.materialPickerClosed=Aa};this.closeMaterialPicker=function(){ua&&(ua.meshes.forEach(function(Q){E.removeAuxiliaryObject(Q);ka.removeDynamicObstacle(Q);delete S.materialPickerClicked[Q.id]}),
ua.dispose(),ua=null,S.materialPickerClosed&&(S.materialPickerClosed(),S.materialPickerClosed=null))};window.addEventListener("resize",this.closeMaterialPicker.bind(this));this._vrChange=function(Q){H(S.vrChange,Q)};this.getNodeClicked=function(){return S.nodeTypeClicked;};this._update=function(Q){H(S.beforeRender,Q)};this._clickListener=function(Q,oa,Aa){function Wa(Pa,db){if(Pa){Pa=m.makeIterator(Pa);for(var Oa=Pa.next();!Oa.done;Oa=Pa.next())if(D(Oa.value,db,oa,Aa))return!0}return!1}if(!N)return!1;if(ua){var Ra=S.materialPickerClicked[Q.id];if(Ra)return D(Ra,
Q.material,ua.meshes.indexOf(Q)),!0;this.closeMaterialPicker();return!0}if(Ra=S.anchorClicked[Q.id])return D(Ra,Q.anchor,oa,Aa),!0;for(Ra=Q.node;Ra;Ra=Ra.parent)if(Wa(S.nodeTypeClicked[Ra.type],Q.node))return!0;return Q.node&&Wa(S.anyNodeTypeClicked,Q.node)?!0:Q.material?Wa(S.materialClicked[Q.material.name],Q.material):!1};this._createHoverListener=function(){var Q=S.nodeTypeHoverChanged,oa=S.materialHoverChanged,Aa=[];return 0===Object.keys(Q).length&&0===Object.keys(oa).length?null:function(Wa,
Ra){for(var Pa=Wa.node;Pa;Pa=Pa.parent)for(var db=m.makeIterator(Q[Pa.type]||Aa),Oa=db.next();!Oa.done;Oa=db.next())if(D(Oa.value,Pa,Ra))return!0;if(Wa.material)for(Pa=m.makeIterator(oa[Wa.material.name]||Aa),Oa=Pa.next();!Oa.done;Oa=Pa.next())if(D(Oa.value,Wa.material,Ra))return!0;return!1}};this._teleportStarted=function(Q){Q=Q.view;null!==Q&&H(S.viewSwitchStarted,Q.name,Q)};this._teleportDone=function(Q){Q=Q.view;null!==Q&&H(S.viewSwitchDone,Q.name,Q)};this._viewerConfigLoaded=function(Q){V=Q;
H(S.viewerConfigLoaded,V);S.viewerConfigLoaded=[]};this._sceneReadyToDisplay=function(Q,oa,Aa,Wa,Ra,Pa,db,Oa,cb,hb,ob,Da){R=Q;E=oa;Y=Aa;X=Wa;fa=Ra;ka=Pa;qa=db;ya=Oa;ma=cb;P=hb;za=ob;T=Da;this.getEditableMaterials=f;this.getEditableNodeTypes=g;this.findMaterial=k;this.findMeshesWithMaterial=r;this.findNodesOfType=v;this.getCameraPosition=h;this.getCameraRotation=l;this.getSceneBoundingBox=n;this.setMaterialForNode=w;this.setMaterialForMesh=p;this.switchToView=u;this.captureImage=y;this.addAnchor=J;
this.removeAnchor=W;this.addAvatar=M;this.removeAvatar=ba;this.findAvatar=ha;this.seeItem=na;this.sleepAnimatedMaterials=ta;this.wakeAnimatedMaterials=I;this.getExtension=U;H(S.sceneReadyToDisplay,E);S.sceneReadyToDisplay=[];X.addEventListener("teleportStarted",this._teleportStarted.bind(this));X.addEventListener("teleportDone",this._teleportDone.bind(this))};this._contextLost=function(){da=!1;V=E=X=fa=ka=qa=P=za=null;this.getExtension=this.wakeAnimatedMaterials=this.sleepAnimatedMaterials=this.findAvatar=
this.removeAnchor=this.addAvatar=this.addAnchor=this.captureImage=this.switchToView=this.setMaterialForMesh=this.setMaterialForNode=this.findNodesOfType=this.findMeshesWithMaterial=this.findMaterial=this.getEditableNodeTypes=this.getEditableMaterials=d};this._sceneLoadComplete=function(){H(S.sceneLoadComplete);S.sceneLoadComplete=[];da=!0;for(var Q=m.makeIterator(sa),oa=Q.next();!oa.done;oa=Q.next())oa.value.enableLightProbe()};this.openUrl=function(Q,oa){oa||a?window.open(Q):window.location.href=
Q};this.onNextPageInteraction=function(Q){S.nextPageInteraction.push(Q)};this.onViewerConfigLoaded=function(Q){V?Q(V):S.viewerConfigLoaded.push(Q)};this.isSceneReadyToDisplay=function(){return null!==E};this.onSceneReadyToDisplay=function(Q){E?Q(E):S.sceneReadyToDisplay.push(Q)};this.onSceneLoadComplete=function(Q){da?Q(E):S.sceneLoadComplete.push(Q)};this.requestFrame=function(){za&&za.requestFrame()};this.setNodeTypeEditable=function(Q){console.assert(null===E,"setNodeTypeEditable must be called before the scene is loaded");
c.setNodeTypeEditable(Q)};this.setMaterialEditable=function(Q){console.assert(null===E,"setMaterialEditable must be called before the scene is loaded");c.setMaterialEditable(Q)};this.setAllMaterialsEditable=function(){console.assert(null===E,"setAllMaterialsEditable must be called before the scene is loaded");c.setAllMaterialsEditable()};this.onNodeTypeClicked=function(Q,oa){"function"===typeof Q?S.anyNodeTypeClicked.push(Q):ia(S.nodeTypeClicked,Q).push(oa);N=!0};this.removeOnNodeTypeClicked=function(Q,
oa){"function"===typeof Q?WALK.removeFromArray(Q,S.anyNodeTypeClicked):WALK.removeFromArray(oa,S.nodeTypeClicked[Q])};this.onMaterialClicked=function(Q,oa){this.setMaterialEditable(Q);ia(S.materialClicked,Q).push(oa);N=!0};this.onNodeTypeHoverChanged=function(Q,oa){this.setNodeTypeEditable(Q);ia(S.nodeTypeHoverChanged,Q).push(oa)};this.onMaterialHoverChanged=function(Q,oa){this.setMaterialEditable(Q);ia(S.materialHoverChanged,Q).push(oa)};this.onViewSwitchStarted=function(Q){S.viewSwitchStarted.push(Q)};
this.onViewSwitchDone=function(Q){S.viewSwitchDone.push(Q)};this.onVrChange=function(Q){S.vrChange.push(Q)};this.onBeforeRender=function(Q){S.beforeRender.push(Q)};this.createTextureFromHtmlImage=function(Q,oa){function Aa(){Ra.needsUpdate=!0;Ra.width=Q.naturalWidth;Ra.height=Q.naturalHeight;G.Math.isPowerOfTwo(Ra.width)&&G.Math.isPowerOfTwo(Ra.height)||(Ra.minFilter=GLC.LINEAR);Ra.notifyLoaded()}function Wa(){Aa();Pa&&Pa();Q.onload=Pa}oa=void 0===oa?!1:oa;var Ra=new WALK.Texture;Ra.image=Q;Ra.wrapS=
Ra.wrapT=GLC.REPEAT;Ra.minFilter=GLC.LINEAR_MIPMAP_LINEAR;Ra.anisotropy=WALK.DEFAULT_ANISOTROPY;Ra.format=oa?GLC.RGBA:GLC.RGB;Ra.hasAlpha=oa;var Pa=null;Q.complete&&0!==Q.naturalHeight?Aa():(Pa=Q.onload,Q.onload=Wa);return Ra};this.createTextureFromHtmlVideo=function(Q){var oa=new WALK.VideoTexture;oa.video=Q;oa.minFilter=GLC.LINEAR;oa.anisotropy=WALK.DEFAULT_ANISOTROPY;oa.format=GLC.RGB;oa.generateMipmaps=!1;Q.setAttribute("playsinline","");Q.setAttribute("webkit-playsinline","");Q.crossOrigin="anonymous";
WALK.onVideoDataReady(Q,function(Aa){oa.width=Aa.videoWidth;oa.height=Aa.videoHeight;G.Math.isPowerOfTwo(oa.width)&&G.Math.isPowerOfTwo(oa.height)?(oa.wrapS=GLC.REPEAT,oa.wrapT=GLC.REPEAT):(oa.wrapS=GLC.CLAMP_TO_EDGE,oa.wrapT=GLC.CLAMP_TO_EDGE);oa.notifyLoaded()});return oa};this.createStreamTextureFromHtmlVideo=function(Q){Q=this.createTextureFromHtmlVideo(Q);Q._interruptible=!1;return Q};this.addAnchor=function(){console.assert(!1,"Can't add anchors until the scene is ready to display")};this.removeAnchor=
function(){console.assert(!1,"Can't remove anchors until the scene is ready to display")};this.addAvatar=function(){console.assert(!1,"Can't add avatars until the scene is ready to display")};this.removeAvatar=function(){console.assert(!1,"Can't remove avatars until the scene is ready to display")};this.findAvatar=function(){console.assert(!1,"Can't find avatars until the scene is ready to display")};this.sleepAnimatedMaterials=function(){console.assert(!1,"Can't sleep animated materials until the scene is ready to display")};
this.wakeAnimatedMaterials=function(){console.assert(!1,"Can't wake animated materials until the scene is ready to display")};this.getExtension=function(){console.assert(!1,"Can't get extension until the scene is ready to display")};this.onAnchorsVisibilityChanged=function(Q){S.anchorsVisibilityChanged.push(Q)};this.removeAnchorsVisibilityChangedListener=function(Q){S.anchorsVisibilityChanged=S.anchorsVisibilityChanged.filter(function(oa){return oa!==Q})};this.seeItem=this.captureImage=this.switchToView=
this.setMaterialForNode=this.getSceneBoundingBox=this.getCameraRotation=this.getCameraPosition=this.findNodesOfType=this.findMeshesWithMaterial=this.findMaterial=this.getEditableNodeTypes=this.getEditableMaterials=d;this.getViewerAssetUrl=function(Q){return WALK.getViewerAssetUrl(Q)};this.addMenuButton=function(Q){return b.addExtraButton(Q)};this.removeMenuButton=function(Q){b.removeExtraButton(Q)};this.getMenuButtonIcon=function(Q){return b.getExtraButonIcon(Q)};Object.defineProperty(this,"menuVisible",
{get:function(){return b.visible},set:function(Q){b.visible=Q}});this.onMenuVisibilityChanged=function(Q){b.addEventListener("visibilityChanged",function(){Q()})};Object.defineProperty(this,"helpVisible",{get:function(){return b.helpVisible},set:function(Q){b.helpVisible=Q}});this.play=function(){WALK.play()};var Ea={};this.apiUserChangeState=function(Q,oa){WALK.deepEqual(Ea[Q],oa)||(Ea[Q]=WALK.readOnlyCopy(oa),oa=WALK.cloneObject(oa),H(S.apiUserStateChanged[Q],Q,oa),H(S.anyApiUserStateChanged,Q,
oa))};this.onApiUserStateChanged=function(Q,oa){"function"===typeof Q?S.anyApiUserStateChanged.push(Q):ia(S.apiUserStateChanged,Q).push(oa)};this.removeOnApiUserStateChanged=function(Q,oa){"function"===typeof Q?WALK.removeFromArray(Q,S.anyApiUserStateChanged):WALK.removeFromArray(oa,S.apiUserStateChanged[Q])};this.getApiUserState=function(Q){if(void 0===Q)return WALK.cloneObject(Ea);Q=Ea[Q];return void 0===Q?void 0:WALK.cloneObject(Q)};this._meetingJoined=function(Q){console.assert(null===ja);ja=
Q;H(S.meetingJoined,ja)};this._onMeetingJoined=function(Q){S.meetingJoined.push(Q);null!==ja&&Q(ja)};this._removeOnMeetingJoined=function(Q){WALK.removeFromArray(Q,S.meetingJoined)};this._onAvatarListChanged=function(Q){S.avatarListChanged.push(Q)};this._removeOnAvatarListChanged=function(Q){WALK.removeFromArray(Q,S.avatarListChanged)};this._createPointerEventHelper=function(Q){return new WALK.PointerEventHelper(P,Q)};this._disableControls=function(){Y.disable()};this._enableControls=function(){Y.enable()};
var Ma=new WALK.RayIntersection;this._findIntersectionAtPosition=function(Q,oa){ka.findIntersectionAtPosition(Q,oa,!0,Ma);return Ma};this.getWalkMaxSpeed=function(){console.assert(E,"getWalkMaxSpeed must be called after the scene is loaded");return E.camera.moveMaxSpeed};this.setWalkMaxSpeed=function(Q){console.assert(E,"setWalkMaxSpeed must be called after the scene is loaded");E.camera.moveMaxSpeed=Q};this.openPopup=function(Q,oa,Aa){oa=void 0===oa?{}:oa;return WALK.openPopup(Q,oa,Aa)};this.enableMinimap=
function(){console.assert(E,"enableMinimap must be called after the scene is loaded");E.minimapConfig.enabled=!0};this.disableMinimap=function(){console.assert(E,"disableMinimap must be called after the scene is loaded");E.minimapConfig.enabled=!1};this.isMinimapEnabled=function(){console.assert(E,"isMinimapEnabled must be called after the scene is loaded");return E.minimapConfig.enabled}};function nd(a){for(var b=0,c=0;c<a.length;c+=1)a[c].id>=b&&(b=a[c].id+1);return b}function od(a,b){for(var c=0;c<a.length;c+=1)if(a[c].name===b)return!1;return!0}function pd(a,b){for(var c=a,d=2;!od(b,c);d+=1)c=a+d.toString();return c}
WALK.EditorHooks=function(a,b,c,d,e,f,g,k,h,l){function n(){WALK.USER_MSG.info("Failed to load texture")}var r={geometryFacesCnt:a.nodes.reduce(function(u,y){return u+y.facesInSubtree()},0),objectsCnt:function(){var u=0;a.visitAllNodes(function(y){y.mesh&&u++});return u}()},v=new WALK.TextureLoader(WALK.ASSETS_URL,WALK.DETECTOR,function(u){null===u.isCutout&&l.isCutoutTexture(u);k.requestFrame()},n,n,!0,!1),p=new WALK.SkyLoader(v),w=e.transformControls;this.getExtensionManager=function(){return f};
this.getCameraPosition=function(){var u=c.cameraWorldPosition();return[u.x,u.y,u.z]};this.getCameraRotation=function(){return[G.Math.radToDeg(c.getYawAngle()),G.Math.radToDeg(c.getPitchAngle())]};this.getCamera=function(){return a.camera};this.getSceneStats=function(){return r};this.getMaterials=function(){return a.sortedMaterials()};this.getLights=function(){return a.lights};this.getLightProbes=function(){return a.lightProbes};this.getCameraVolumes=function(){return a.cameraVolumes};this.getNodes=
function(){return a.nodes};this.getMinimap=function(){return h};this.getMinimapConfig=function(){return a.minimapConfig};this.setLevelSelectedCallback=function(u){h.addEventListener("minimapLevelSelected",function(y){null!==y.level&&u(y.level)})};this.getBoundingBox=function(){return a.boundingBox};this.addLight=function(u,y,B){u=new WALK.Light({name:pd(u,a.lights),type:y,doNotImport:!0});u.addInstance(B);a.addLight(u)};this.removeLight=function(u){a.removeLight(u)};this.renameLight=function(u,y){y=
y.trim()||"light";u.name="";u.name=pd(y,a.lights)};this.addLightInstance=function(u,y,B){u.addInstance(y,B)};this.removeLightInstance=function(u,y){u.removeInstance(y)};this.addLightProbe=function(u){var y=nd(a.lightProbes);u=new WALK.LightProbe({id:y,position:u});u.enableBoundingBox();a.addLightProbe(u);1===a.lightProbes.length&&a.enableLightProbesForMaterials()};this.removeLightProbe=function(u){a.removeLightProbe(u);0===a.lightProbes.length&&a.disableLightProbesForMaterials()};this.getCameraVolumeTypes=
function(){return WALK.CameraVolume.CameraVolumeTypes};this.addCameraVolume=function(u,y){var B=(new G.Vector3).fromArray(this.getCameraPosition()),D=this.getCameraRotation();D=(new G.Vector3(0,3,0)).applyEuler(new WALK.Euler(D[0]/180*Math.PI,D[1]/180*Math.PI,0));var H=nd(a.cameraVolumes);a.addCameraVolume(new WALK.CameraVolume({id:H,name:y||u+H,type:u,position:B.add(D).toArray(),rotation:[0,0,0],scale:[1,1,1],exposure:a.camera.defaultExposure,gamma:a.camera.defaultGamma}))};this.removeCameraVolume=
function(u){a.removeCameraVolume(u)};this.shiftCameraVolume=function(u,y){a.shiftCameraVolume(u,y)};this.getViews=function(){return a.views.filter(function(u){return!u.internal})};this.markScreenshotArea=function(u){g.markArea(u)};this.unmarkScreenshotArea=function(){g.unmarkArea()};this.monoScreenToBuffer=function(u,y,B){return g.monoScreenToBuffer(u,y,B)};this.stereoPanoramaToBuffer=function(u,y,B,D){return g.stereoPanoramaToBuffer(u,y,B,D)};this.addViewFromCamera=function(u,y){var B=[];console.assert("fps"===
y||"top"===y||"orbit"===y);var D=c.cameraWorldPosition(),H=c.orbit;B[0]=G.Math.radToDeg(c.getYawAngle());B[1]=G.Math.radToDeg(c.getPitchAngle());u={id:nd(a.views),name:pd(u.trim()||"view",a.views),rotation:B};"fps"===y?(u.mode="fps",u.sky=WALK.EDITOR_CONTROLLED_SKY_NAME,u.position=D.toArray()):"top"===y?(u.mode="orbit",u.sky=WALK.DEFAULT_SKY_NAME,u.panPrimary=!0,u.noPitchRotate=!0,u.rotation[1]=-90,u.minUpAngle=0,u.maxUpAngle=Math.PI/2,H.isEnabled()?(u.target=[H.target.x,H.target.y,a.boundingBox.min.z],
u.distance=H.getCameraDistance(),u.minDistance=H.getMinDistance(),u.maxDistance=H.getMaxDistance()):(u.target=[D.x,D.y,a.boundingBox.min.z],u.distance=Math.max(D.z-a.boundingBox.min.z,1))):(u.mode="orbit",u.sky=WALK.DEFAULT_SKY_NAME,u.panPrimary=!1,u.noPitchRotate=!1,H.isEnabled()?(u.target=H.target.toArray(),u.distance=H.getCameraDistance(),u.minDistance=H.getMinDistance(),u.maxDistance=H.getMaxDistance(),u.minUpAngle=-H.getMaxPitchAngle(),u.maxUpAngle=-H.getMinPitchAngle()):(y=a.boundingBox.center(),
u.target=y.toArray(),y.sub(D),u.distance=y.length(),y.normalize(),u.rotation=[G.Math.radToDeg(Math.atan2(-y.x,y.y)),G.Math.radToDeg(Math.asin(y.z))],u.minUpAngle=0,u.maxUpAngle=Math.PI/2));D=new WALK.View(u);a.addView(D);return D};this.cloneView=function(u){var y=[G.Math.radToDeg(u.rotation.yaw),G.Math.radToDeg(u.rotation.pitch)],B=u.serialize();B.id=nd(a.views);B.name=pd(u.name.trim()||"view",a.views);B.rotation=y;"fps"===u.mode?B.position=u.position.toArray():B.target=u.target.toArray();var D=new WALK.View(B);
a.addView(D);a.nodeConfigs.forEach(function(H){H.hideInViews&&H.isOnHideInViews(u.id)&&H.addToHideInViews(D.id)});return D};this.resetViewFromCamera=function(u){var y=c.cameraWorldPosition();"fps"===u.mode?u.position.copy(y):(u.target.copy(c.orbit.target),u.distance=y.distanceTo(u.target));"fps"!==u.mode&&u.isTop()||(u.rotation.pitch=c.getPitchAngle());u.setYaw(c.getYawAngle())};this.removeView=function(u){a.removeView(u)};this.shiftView=function(u,y){a.shiftView(u,y)};this.activateSkyForView=function(u){d.activateSky(u)};
this.switchToView=function(u){d.switchToView(u);WALK.focusWalkCanvas()};this.renameView=function(u,y){y=y.trim()||"view";u.name="";u.setName(pd(y,a.views))};this.updateHiddenMeshes=function(u){d.updateHiddenMeshes(u)};this.getSky=function(){return a.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME)};this.loadTexture=function(u,y){u=v.load(WALK.LOAD_PRIORITY.CORE_RESOURCE,u,!0,!0,WALK.DEFAULT_ANISOTROPY);"baseColorTexture"===y&&(u.isCutout=null);return u};this.materialTextureUpdated=function(u,y){var B=
new Set,D="";u.textureNeedsUv0(y)&&a.visitMeshesWithMaterial(u,function(H){0===H.geometry.vertexCnt||H.uv0InBuffers()||B.has(H.node.type)||(B.add(H.node.type),5<B.size||(""!==D&&(D+=", "),D+="'"+H.node.type+"'"))});return 0<B.size&&"Texture "+y+" won't be correctly mapped. The following objects lack base color UV mapping coming from the 3D modeling tool: "+D+(5<B.size?" (plus "+(B.size-5)+" more).":".")};this.changeSkyTexture=function(u){var y=a.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME);y.isEquirect?
p.loadSkyTexture(y,u):(a.removeSkyMesh(y),p.loadSingleSky({name:WALK.EDITOR_CONTROLLED_SKY_NAME,type:"equirect",texture:u},a));a.adjustSkiesAndCameraFarToSpanWholeScene()};this.removeSkyTexture=function(){var u=a.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME);u.isEquirect&&(a.removeSkyMesh(u),p.loadSingleSky({name:WALK.EDITOR_CONTROLLED_SKY_NAME,type:"procedural"},a));a.adjustSkiesAndCameraFarToSpanWholeScene()};this.getColorMapName=function(){return a.camera.colorMap?a.camera.colorMap.name:null};this.loadColorMap=
function(u){u=v.load(WALK.LOAD_PRIORITY.CORE_RESOURCE,u,!1,!1,WALK.NO_ANISOTROPY);u.flipY=!1;return u};this.getSceneJson=function(){return a.serialize()};this.getCoverJson=function(){var u=b.cover;u.extensions=f.getConfig();return u};this.disableSelection=function(){e.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.OFF)};this.enableMaterialSelection=function(){e.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.MATERIAL)};this.enableLightSelection=function(){e.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.LIGHT)};
this.enableLightProbeSelection=function(){e.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.LIGHT_PROBE)};this.enableExtensionSelection=function(){e.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.EXTENSION)};this.enablePositionSelection=function(u){e.setDistanceToObject(u);e.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.POSITION)};this.enableNodeSelection=function(){e.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.NODE)};this.enableCameraVolumeSelection=function(){e.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME)};
this.selectMaterial=function(u){e.selectMaterial(u)};this.replaceMaterial=function(u,y){u=a.replaceMaterial(u,y);u.isAnimated&&u.play();return u};this.selectLights=function(u,y){e.selectLights(u,y)};this.selectLightInstances=function(u,y,B){e.selectLightInstances(u,y,B)};this.selectLightProbe=function(u){e.selectLightProbe(u,!1)};this.selectCameraVolume=function(u){e.selectEditorCameraVolume(u)};this.selectExtension=function(u){e.selectExtension(u,!1)};this.selectNodes=function(u,y,B,D,H){e.selectNodes(u,
y,B,D,H)};this.setMaterialClickedCallback=function(u){e.setMaterialClickedCallback(u)};this.setLightInstanceClickedCallback=function(u){e.setLightInstanceClickedCallback(u)};this.setLightProbeClickedCallback=function(u){e.setLightProbeClickedCallback(u)};this.setNodeClickedCallback=function(u){e.setNodeClickedCallback(u)};this.setExtensionClickedCallback=function(u){e.setExtensionClickedCallback(u)};this.setPositionClickedCallback=function(u){e.setPositionClickedCallback(u)};this.setItemModifiedCallback=
function(u){w.setItemModifiedCallback(u)};this.setViewSelectedCallback=function(u){d.addEventListener("teleportStarted",function(y){null!==y.view&&u(y.view)})};this.coverModified=function(u){b.updateCover(u)};this.autoTourModified=function(){b.refresh()};this.hasLightMap=function(){return a.hasLightMap()};this.getAutoTour=function(){return a.autoTour};this.getDisableProgressiveLoader=function(){return a.disableProgressiveLoader};this.setDisableProgressiveLoader=function(u){a.disableProgressiveLoader=
u};this.getSceneScaleHtmlWarning=function(){var u=a.boundingBox;return!u.empty()&&(u=u.size(),200<u.x||200<u.y||200<u.z)?"The scene has unusually large dimensions: <strong>"+Math.round(u.x)+"m x "+Math.round(u.y)+"m x "+Math.round(u.z)+'m</strong>.</br></br>Shapespark assumes real-world scale, 1 meter in the scene should correspond to 1 meter in the real world. If the scale of the scene is invalid, either re-scale the model or change the scale in the import dialog, otherwise you can disable this message.</br></br>For more information consult <a href="/assets/help.html#importing-the-scene">Importing the scene</a> section of the help.':
null};this.getTransformMode=function(){return w.mode};this.setTransformMode=function(u){w.setTransformMode(u)};this.getSupportedTransformModes=function(){return w.supportedModes};this.seeItem=function(u){WALK.getViewer().seeItem(u)}};WALK.SceneLoadConfig=function(){this.onSceneLoaded=null;this.enableCollisions=!0;this.forcedInitialCameraRotation=this.forcedInitialCameraPosition=null;this.sendCoverToServer=!1};function qd(){var a=new G.BufferGeometry,b=new Float32Array(288);a.addAttribute("position",new G.BufferAttribute(b,3));var c=0;[[[-1,-1,-1],[-1,-.6,-1],[-.6,-1,-1]],[[-1,-1,-1],[-1,-1,-.6],[-1,-.6,-1]],[[-1,-1,-1],[-.6,-1,-1],[-1,-1,-.6]],[[-.6,-1,-1],[-1,-.6,-1],[-1,-1,-.6]],[[-1,-1,1],[-.6,-1,1],[-1,-.6,1]],[[-1,-1,1],[-1,-.6,1],[-1,-1,.6]],[[-1,-1,1],[-1,-1,.6],[-.6,-1,1]],[[-.6,-1,1],[-1,-1,.6],[-1,-.6,1]],[[1,-1,-1],[.6,-1,-1],[1,-.6,-1]],[[1,-1,-1],[1,-.6,-1],[1,-1,-.6]],[[1,-1,-1],[1,-1,-.6],
[.6,-1,-1]],[[.6,-1,-1],[1,-1,-.6],[1,-.6,-1]],[[-1,1,-1],[-.6,1,-1],[-1,.6,-1]],[[-1,1,-1],[-1,.6,-1],[-1,1,-.6]],[[-1,1,-1],[-1,1,-.6],[-.6,1,-1]],[[-.6,1,-1],[-1,1,-.6],[-1,.6,-1]],[[1,1,1],[.6,1,1],[1,.6,1]],[[1,1,1],[1,.6,1],[1,1,.6]],[[1,1,1],[1,1,.6],[.6,1,1]],[[.6,1,1],[1,1,.6],[1,.6,1]],[[1,-1,1],[1,-.6,1],[.6,-1,1]],[[1,-1,1],[1,-1,.6],[1,-.6,1]],[[1,-1,1],[.6,-1,1],[1,-1,.6]],[[.6,-1,1],[1,-.6,1],[1,-1,.6]],[[1,1,-1],[1,.6,-1],[.6,1,-1]],[[1,1,-1],[1,1,-.6],[1,.6,-1]],[[1,1,-1],[.6,1,-1],
[1,1,-.6]],[[.6,1,-1],[1,.6,-1],[1,1,-.6]],[[-1,1,1],[-1,.6,1],[-.6,1,1]],[[-1,1,1],[-1,1,.6],[-1,.6,1]],[[-1,1,1],[-.6,1,1],[-1,1,.6]],[[-.6,1,1],[-1,.6,1],[-1,1,.6]]].forEach(function(d){for(var e=0;3>e;e+=1)for(var f=0;3>f;f+=1)b[c]=d[e][f],c+=1});a.computeVertexNormals();a.convertNormalsToSpherical();return a}function rd(){var a=new WALK.StandardMaterial;a.disableLightProbe=!0;a.headLight=!0;a.baseColor=WALK.EDITOR_SELECTION_COLOR;a.setUniforms();return a}
function sd(){function a(h,l){g.push([[h.x,h.y,h.z],[l.x,h.y,h.z],[h.x,l.y,h.z]]);g.push([[h.x,l.y,h.z],[l.x,h.y,h.z],[l.x,l.y,h.z]])}function b(h,l){g.push([[h.x,h.y,h.z],[h.x,l.y,h.z],[h.x,h.y,l.z]]);g.push([[h.x,h.y,l.z],[h.x,l.y,h.z],[h.x,l.y,l.z]])}function c(h,l){g.push([[h.x,h.y,h.z],[l.x,h.y,h.z],[h.x,h.y,l.z]]);g.push([[h.x,h.y,l.z],[l.x,h.y,h.z],[l.x,h.y,l.z]])}function d(h,l,n){var r=Math.min(h.x,l.x),v=Math.min(h.y,l.y),p=Math.min(h.z,l.z),w=Math.max(h.x,l.x),u=Math.max(h.y,l.y);h=Math.max(h.z,
l.z);"XY"!==n&&(a({x:w,y:v,z:p},{x:r,y:u,z:p}),a({x:r,y:v,z:h},{x:w,y:u,z:h}));"YZ"!==n&&(b({x:r,y:u,z:p},{x:r,y:v,z:h}),b({x:w,y:v,z:p},{x:w,y:u,z:h}));"XZ"!==n&&(c({x:w,y:u,z:p},{x:r,y:u,z:h}),c({x:r,y:v,z:p},{x:w,y:v,z:h}))}var e=new G.BufferGeometry,f=new Float32Array(864);e.addAttribute("position",new G.BufferAttribute(f,3));var g=[];d({x:-.876,y:.876,z:.876},{x:.876,y:.866,z:.866},"YZ");d({x:-.876,y:.876,z:-.866},{x:.876,y:.866,z:-.876},"YZ");d({x:-.876,y:-.876,z:-.876},{x:.876,y:-.866,z:-.866},
"YZ");d({x:-.876,y:-.876,z:.876},{x:.876,y:-.866,z:.866},"YZ");d({x:.876,y:.876,z:.876},{x:.866,y:-.876,z:.866},"XZ");d({x:.876,y:.876,z:-.876},{x:.866,y:-.876,z:-.866},"XZ");d({x:-.876,y:.876,z:-.876},{x:-.866,y:-.876,z:-.866},"XZ");d({x:-.876,y:.876,z:.876},{x:-.866,y:-.876,z:.866},"XZ");d({x:.876,y:.876,z:.876},{x:.866,y:.866,z:-.876},"XY");d({x:.876,y:-.876,z:.876},{x:.866,y:-.866,z:-.876},"XY");d({x:-.876,y:.876,z:.876},{x:-.866,y:.866,z:-.876},"XY");d({x:-.876,y:-.876,z:.876},{x:-.866,y:-.866,
z:-.876},"XY");var k=0;g.forEach(function(h){for(var l=0;3>l;l+=1)for(var n=0;3>n;n+=1)f[k]=h[l][n],k+=1});e.computeVertexNormals();e.convertNormalsToSpherical();return e}
WALK.LightControls=function(a,b){function c(J){if("spot"===J.type){var W=G.Math.degToRad(J.angle);J=1*Math.cos(W/2);W=new G.CylinderBufferGeometry(0,1*Math.sin(W/2),J,32,1);w.makeTranslation(0,-J/2,0);p.makeRotationZ(Math.PI);u.multiplyMatrices(p,w);W.applyMatrix(u);W.convertNormalsToSpherical()}else W="area"===J.type?B:y;return W}function d(J,W,M){var ba=new WALK.LightMaterial(J);M=new G.Mesh(M,ba);M.visibilityId=null;var ha=new G.Mesh(D,K);M.add(ha);var ta=new G.Mesh(H,K);W===r.selectedLightInstance||
r.subSelectedLightInstances.includes(W)||(ta.visible=!1);M.add(ta);if("sun"!==J.type){var I=W.rotation.toQuaternion().multiply(M.quaternion);M.setRotationFromQuaternion(I);M.position.copy(W.position);"area"===J.type?(ba.side=G.DoubleSide,M.scale.set(J.width,1,J.height),ba=Math.max(J.width,J.height)/2,ha.scale.set(ba/J.width,ba,ba/J.height),ta.scale.set(ba/J.width,ba,ba/J.height)):M.scale.set(J.size,J.size,J.size)}else J=a.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME).radius,J=1*Math.PI*J*1.5/360,WALK.sunRotationToPosition(a,
W.rotation,M.position),M.scale.set(J,J,J);M.userData.lightInstance=W;M.updateMatrixWorld();r.lightInstanceMeshes.push(M);v&&a.addAuxiliaryObject(M)}function e(J){var W=c(J);J.forEachLightInstance(function(M){d(J,M,W)})}function f(J){for(var W=0;W<r.lightInstanceMeshes.length;W+=1){var M=r.lightInstanceMeshes[W];if(M.userData.lightInstance===J)return M}return null}function g(J){for(var W=[],M=0;M<r.lightInstanceMeshes.length;M+=1){var ba=r.lightInstanceMeshes[M];ba.userData.lightInstance.light===J?
(v&&a.removeAuxiliaryObject(ba),ba.geometry!==y&&ba.geometry!==B&&ba.geometry.dispose(),ba.material.dispose()):W.push(ba)}r.lightInstanceMeshes=W}function k(J){J=J.target;g(J);e(J)}function h(J){J=J.instance;var W=J.light;var M=W.instances[0]!==J?f(W.instances[0]).geometry:c(W);d(W,J,M);b.requestFrame()}function l(J){J=J.instance.light;g(J);e(J);b.requestFrame()}function n(J){e(J);J.addEventListener("updated",k);J.addEventListener("instanceAdded",h);J.addEventListener("instanceRemoved",l)}var r=this,
v=!1,p=new G.Matrix4,w=new G.Matrix4,u=new G.Matrix4,y=new G.SphereBufferGeometry(1,32,16);y.convertNormalsToSpherical();var B=new G.PlaneBufferGeometry(1,1);p.makeRotationX(-Math.PI/2);B.applyMatrix(p);B.convertNormalsToSpherical();var D=qd(),H=sd(),K=rd();this.selectedLightInstance=null;this.subSelectedLightInstances=[];this.lightInstanceMeshes=[];this.getLightInstanceMaterial=function(J){return f(J).material};this.showLights=function(){if(!v){v=!0;for(var J=0;J<this.lightInstanceMeshes.length;J+=
1)a.addAuxiliaryObject(this.lightInstanceMeshes[J])}};this.showSelectionMesh=function(J,W){this.lightInstanceMeshes.forEach(function(M){M.children[0].visible=M.userData.lightInstance.light===J||W.includes(M.userData.lightInstance.light)})};this.showInstancesSelectionMesh=function(J,W){this.selectedLightInstance=J;this.subSelectedLightInstances=W;this.lightInstanceMeshes.forEach(function(M){M.children[1].visible=M.userData.lightInstance===J||W.includes(M.userData.lightInstance)})};this.hideLights=
function(){if(v){v=!1;for(var J=0;J<this.lightInstanceMeshes.length;J+=1)a.removeAuxiliaryObject(this.lightInstanceMeshes[J])}};a.lights.forEach(n);a.addEventListener("lightAdded",function(J){n(J.light);b.requestFrame()});a.addEventListener("lightRemoved",function(J){g(J.light);b.requestFrame()})};WALK.LightProbeControls=function(a,b){function c(u,y){y.position.addVectors(u.boxMin,u.boxMax).multiplyScalar(.5).sub(u.position);y.scale.subVectors(u.boxMax,u.boxMin);y.scale.subScalar(.005)}function d(u){var y=new WALK.StandardMaterial;y.hideFromLightProbes=!0;y.disableLightProbe=!1;y.highlight=WALK.EDITOR_SELECTION_COLOR;y.metallic=1;y.roughness=0;y.setUniforms();y=new G.Mesh(v,y);y.visibilityId=null;y.lightProbe=u;y.position.copy(u.position);var B=new G.Mesh(w,p);B.visible=!1;y.add(B);u.isBoundingBoxEnabled()&&
c(u,B);y.updateMatrixWorld(!0);y.visible=n;l.lightProbeMeshes.push(y);a.addAuxiliaryObject(y)}function e(u){for(var y=0;y<l.lightProbeMeshes.length;y+=1)if(l.lightProbeMeshes[y].lightProbe===u)return y;console.assert(!1);return null}function f(u){u=u.target;var y=l.lightProbeMeshes[e(u)];y.position.copy(u.position);var B=y.children[0];u.isBoundingBoxEnabled()?(c(u,B),B.visible=!0):B.visible=!1;y.updateMatrixWorld()}function g(u){u=u.lightProbe;d(u);u.addEventListener("positionUpdated",f);u.addEventListener("boundsUpdated",
f)}function k(u){u=e(u.lightProbe);var y=l.lightProbeMeshes[u];a.removeAuxiliaryObject(y);y.material.dispose();l.lightProbeMeshes.splice(u,1)}function h(u){for(var y=0;y<l.lightProbeMeshes.length;y+=1){var B=l.lightProbeMeshes[y];if(B.lightProbe===u)return B}return null}var l=this,n=!1,r=null;this.lightProbeMeshes=[];var v=new G.SphereBufferGeometry(.2,32,16);v.convertNormalsToSpherical();var p=WALK.createBoundingBoxMaterial(),w=new G.BoxBufferGeometry(1,1,1);w.addTriangleOrderAttribute();w.convertNormalsToSpherical();
this.getLightProbeMaterial=function(u){return(u=h(u))?u.material:null};this.showLightProbeBoundingBox=function(u){r&&(r.visible=!1,r=null);u.isBoundingBoxEnabled()&&(r=h(u).children[0],r.visible=!0)};this.showLightProbes=function(){if(!n){n=!0;for(var u=0;u<this.lightProbeMeshes.length;u+=1)this.lightProbeMeshes[u].visible=!0}b.requestFrame()};this.hideLightProbes=function(){if(n){n=!1;for(var u=0;u<this.lightProbeMeshes.length;u+=1)this.lightProbeMeshes[u].visible=!1}b.requestFrame()};(function(){for(var u=
0;u<a.lightProbes.length;u+=1){var y=a.lightProbes[u];d(y);y.addEventListener("positionUpdated",f);y.addEventListener("boundsUpdated",f)}a.addEventListener("lightProbeAdded",g);a.addEventListener("lightProbeRemoved",k)})()};WALK.CameraVolumeControls=function(a,b){function c(){}function d(k){function h(){n.position.copy(k.position);n.rotation.copy(k.rotation);n.scale.copy(k.scale);n.updateMatrixWorld()}var l=WALK.createBoundingBoxMaterial(),n=new G.Mesh(k.getVolumeGeometry(),l);n.visible=!1;n.visibilityId=null;f.add(n);e.set(k,n);h(k);k.addEventListener("updated",h)}var e=new Map,f=new G.Object3D;f.visible=!1;a.addAuxiliaryObject(f);this.setHighlightedCameraVolume=function(k){c();var h=e.get(k);h.visible=!0;c=function(){return h.visible=
!1};return h.material};this.setControlsVisible=function(k){f.visible=k;b.requestFrame()};a.addEventListener("cameraVolumeAdded",function(k){d(k.cameraVolume);b.requestFrame()});a.addEventListener("cameraVolumeRemoved",function(k){k=k.cameraVolume;var h=e.get(k);f.remove(h);h.material.dispose();e.delete(k);b.requestFrame()});for(var g=0;g<a.cameraVolumes.length;g+=1)d(a.cameraVolumes[g])};/*
 Copyright (C) 2019-present Shapespark
*/
WALK.sunRotationToPosition=function(a,b,c){a=a.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME);c.set(0,-a.radius,0);c.applyEuler(b);c.add(a.position)};WALK.computeNodeBoundingSphere=function(a,b){b.radius=0;a.visitSubtree(function(c){c.mesh&&WALK.Math.spheresUnion(c.mesh.geometry.boundingSphere,b)})};var td={MAIN:0,AUXILIARY:1,SECONDARY:2,NONE:-1},ud={SHIFT:1,CTRL_EQUIVALENT:2,ALT_EQUIVALENT:4};WALK.hasShiftKeyModifier=function(a){return a&ud.SHIFT};WALK.hasCtrlEquivalentKeyModifier=function(a){return a&ud.CTRL_EQUIVALENT};WALK.hasAltEquivalentModifier=function(a){return a&ud.ALT_EQUIVALENT};
WALK.PointerEventDispatcher=function(a,b){function c(y){if(void 0===y.button)return td.MAIN;switch(y.button){case 0:return td.MAIN;case 1:return td.AUXILIARY;case 2:return td.SECONDARY}return td.NONE}function d(y,B,D){if(!D)for(D=0;D<y.changedTouches.length;D++){var H=y.changedTouches[D];if(H.identifier===B)return H}for(D=0;D<y.touches.length;D++)if(H=y.touches[D],H.identifier===B)return H;return null}function e(y,B){if(0!==y.length){var D=void 0!==B.touches;if(!D&&(document.pointerLockElement||document.mozPointerLockElement||
document.webkitPointerLockElement))w.clipX=0,w.clipY=0;else{if(D){var H=d(B,p);console.assert(null!==H);D=H.clientX;H=H.clientY}else D=B.clientX,H=B.clientY;w.clipX=D/window.innerWidth*2-1;w.clipY=2*-(H/window.innerHeight)+1}D=w;for(H=0;H<y.length;H++){var K=y[H].callback,J=D.clipX,W=D.clipY,M=0;if(B.ctrlKey&&!WALK.DETECTOR.mac||B.metaKey&&WALK.DETECTOR.mac)M|=ud.CTRL_EQUIVALENT;B.altKey&&(M|=ud.ALT_EQUIVALENT);B.shiftKey&&(M|=ud.SHIFT);if(K(J,W,M))break}}}function f(y){c(y)!==td.MAIN||v||(v=!0,void 0!==
y.touches&&(console.assert(0<y.changedTouches.length),p=y.changedTouches[0].identifier),e(l,y))}function g(y){if(c(y)===td.MAIN){var B=void 0!==y.touches;B&&d(y,p,!0)||!v||(v=!1,e(n,y),B&&(p=-1))}}function k(y){void 0!==y.touches&&-1===p||e(r,y)}function h(y,B,D){var H=y.filter(function(J){return J.callback===B});console.assert(0===H.length,"Do not add the same callback twice!");D={callback:B,priority:D};for(H=H=0;H<y.length;H+=1){var K=y[H];if(D.priority<=K.priority){if(D.priority===K.priority){console.error("Adding two listeners with the same priority is not allowed!");
return}break}}y.splice(H,0,D)}var l=[],n=[],r=[],v=!1,p=-1,w={clipX:0,clipY:0};this.addPointerDownListener=function(y,B){h(l,y,B)};this.removePointerDownListener=function(y){l=l.filter(function(B){return B.callback!==y})};this.addPointerUpListener=function(y,B){h(n,y,B)};this.removePointerUpListener=function(y){n=n.filter(function(B){return B.callback!==y})};this.addPointerMoveListener=function(y,B){h(r,y,B)};this.removePointerMoveListener=function(y){r=r.filter(function(B){return B.callback!==y})};
var u=!1;this.isEnabled=function(){return u};this.enable=function(){u||(a.addEventListener("mousedown",f,!1),a.addEventListener("touchstart",f,!1),a.addEventListener("mouseup",g,!1),a.addEventListener("touchend",g,!1),a.addEventListener("mousemove",k,!1),a.addEventListener("touchmove",k,!1),window.addEventListener("mouseup",g,!1),b&&window.top.addEventListener("mouseup",g,!1),u=!0)};this.disable=function(){u&&(a.removeEventListener("mousedown",f,!1),a.removeEventListener("touchstart",f,!1),a.removeEventListener("mouseup",
g,!1),a.removeEventListener("touchend",g,!1),a.removeEventListener("mousemove",k,!1),a.removeEventListener("touchmove",k,!1),window.removeEventListener("mouseup",g,!1),b&&window.top.removeEventListener("mouseup",g,!1),u=!1)};this.enable()};WALK.PointerEventHelper=function(a,b){function c(){return!1}function d(w,u){var y=g.callbacks.onPointerDown(w,u);k=!0;h=w;l=u;return y}function e(w,u,y){var B=g.callbacks.onPointerUp(w,u);if(k){var D=Date.now();B=null!==v&&.03>=Math.abs(n-h)&&.03>=Math.abs(r-l)&&500>=Math.abs(v-D)&&g.callbacks.onDoubleClick!==c?g.callbacks.onDoubleClick(w,u)||B:g.callbacks.onClick(w,u,y)||B;v=D;n=w;r=u}return B}function f(w,u){var y=g.callbacks.onPointerMove(w,u);!k||.03>=Math.abs(w-h)&&.03>=Math.abs(u-l)||(k=!1,
v=null);return y}var g=this,k=!1,h=null,l=null,n=null,r=null,v=null;this.callbacks={onClick:c,onDoubleClick:c,onPointerDown:c,onPointerUp:c,onPointerMove:c};var p=!1;this.isEnabled=function(){return p};this.enable=function(){p||(a.addPointerDownListener(d,b),a.addPointerUpListener(e,b),a.addPointerMoveListener(f,b),p=!0)};this.disable=function(){p&&(a.removePointerDownListener(d),a.removePointerUpListener(e),a.removePointerMoveListener(f),p=!1)};this.enable()};WALK.TRANSFORM_MODE={TRANSLATE:0,ROTATE:1,SCALE:2};var Hd=new G.Color(16777215),Id=new G.Color(16711680),Jd=new G.Color(65280),Kd=new G.Color(255),Ld={NONE:0,X:1,Y:2,Z:4,ALL:7},Md=new G.Vector3(0,0,1),Nd=new G.Vector3(1,0,0),Od=new G.Vector3(0,1,0);function Pd(a){var b=new G.Box3;a instanceof G.Object3D&&a.traverse(function(c){c instanceof G.Mesh&&(c.geometry.boundingBox||c.geometry.computeBoundingBox(),b.union(c.geometry.boundingBox))});return b}
function Qd(a,b){var c=Pd(a);a=c.size();a=new G.BoxBufferGeometry(a.x,a.y,a.z);c=c.center();var d=new G.Matrix4;d.makeTranslation(c.x,c.y,c.z);a.applyMatrix(d);a.computeBoundingBox();b=new G.Mesh(a,b);b.visible=!1;b.visibilityId=null;return b}function Rd(a,b){var c=new WALK.StandardMaterial;c.hideFromLightProbes=!0;c.baseColor.copy(a);c.opacity=b;c.specularOff=1;c.depthTest=!1;c.depthWrite=!1;return c}
function Sd(a,b,c){G.Object3D.call(this);this.add(a);this.add(b);this.material=c;this.collider=b;this.defaultOpacity=c.opacity;this.hoveredOpacity=.99;this.notUsedOpacity=.3;this.usedAxes=Ld.NONE}Sd.prototype=Object.create(G.Object3D.prototype);Sd.prototype.constructor=Sd;
function Td(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];console.assert(0<b.length,"Part must have at least one element!");var d=new G.Object3D;b.forEach(function(e){return d.add(e)});b=Qd(d,Rd(Hd,.6));return new Sd(d,b,d.children[0].material)}
function Ud(){function a(k){k=Rd(k,.6);k.depthTest=!0;return new G.Mesh(b,k)}G.Object3D.call(this);var b=new G.CylinderBufferGeometry(.005,.005,1E3,4,1,!1),c=a(Id);c.rotation.set(0,0,Math.PI/2);var d=a(Jd),e=a(Kd);e.rotation.set(Math.PI/2,0,0);this.add(c);this.add(d);this.add(e);var f=[!1,!1,!1];this.show=function(k){f[0]=(Ld.X&k)===Ld.X;f[1]=(Ld.Y&k)===Ld.Y;f[2]=(Ld.Z&k)===Ld.Z;c.visible=f[0];d.visible=f[1];e.visible=f[2]};var g=new G.Vector3;this.update=function(k){g.copy(k);g.sub(this.position);
g.normalize();c.visible=f[0]&&.998>Math.abs(Nd.dot(g));d.visible=f[1]&&.998>Math.abs(Od.dot(g));e.visible=f[2]&&.998>Math.abs(Md.dot(g))}}Ud.prototype=Object.create(G.Object3D.prototype);Ud.prototype.constructor=Ud;
function Vd(){function a(){var f=Rd(Hd,.99);return new G.Mesh(b,f)}G.Object3D.call(this);var b=new G.SphereBufferGeometry(.012,10,10),c=a(),d=a(),e=a();this.add(c);this.add(d);this.add(e);this.show=function(f){c.visible=(Ld.X&f)===Ld.X;d.visible=(Ld.Y&f)===Ld.Y;e.visible=(Ld.Z&f)===Ld.Z};this.update=function(f){c.position.set(f.x,0,0);c.updateMatrixWorld();d.position.set(0,f.y,0);d.updateMatrixWorld();e.position.set(0,0,f.z);e.updateMatrixWorld()}}Vd.prototype=Object.create(G.Object3D.prototype);
Vd.prototype.constructor=Vd;
function Wd(){function a(k){k=Rd(k,.2);k.depthTest=!0;k.side=G.DoubleSide;return Td(new G.Mesh(b,k))}G.Object3D.call(this);var b=new G.PlaneBufferGeometry(1E3,1E3,1,1),c=a(Hd);this.add(c);var d=new G.Object3D;this.add(d);var e=a(Kd);e.rotation.set(0,0,0);var f=a(Jd);f.rotation.set(Math.PI/2,0,0);var g=a(Id);g.rotation.set(0,Math.PI/2,0);d.add(e);d.add(f);d.add(g);this.setLocalRotation=function(k){k?d.rotation.copy(k):d.rotation.set(0,0,0)};this.update=function(k){c.rotation.setFromRotationMatrix(k.matrixWorld);c.updateMatrixWorld()};
this.cameraPlane=c;this.findPlaneIntersectionPoint=function(){function k(n){switch(n){case Ld.X:return g;case Ld.Y:return f;case Ld.Z:return e;case Ld.X|Ld.Y:return e;case Ld.X|Ld.Z:return f;case Ld.Y|Ld.Z:return g;case Ld.ALL:return c;default:throw"Impossible";}}var h=new G.Vector3,l=new G.Vector3;return function(n,r,v,p){var w=k(n);w.getWorldPosition(h).sub(r);w.getWorldDirection(l);if(n===Ld.X||n===Ld.Y||n===Ld.Z){n=l.dot(l);w=l.dot(v);var u=v.dot(v),y=l.dot(h),B=v.dot(h);u=n*u-w*w;n=1E-5>Math.abs(u)?
Infinity:(n*B-w*y)/u}else n=l.dot(v),n=1E-5>Math.abs(n)?Infinity:l.dot(h)/n;if(Infinity===n)return!1;p.copy(v).multiplyScalar(n).add(r);return!0}}();this.show=function(k){c.visible=k===Ld.ALL?!0:!1;e.visible=(Ld.X|Ld.Y)===k;f.visible=(Ld.X|Ld.Z)===k;g.visible=(Ld.Y|Ld.Z)===k}}Wd.prototype=Object.create(G.Object3D.prototype);Wd.prototype.constructor=Wd;function Xd(a,b,c){var d=a.material;d.opacity=b===a.collider?a.hoveredOpacity:c&&null!==b?a.notUsedOpacity:a.defaultOpacity;d.setUniforms()}
function Yd(){function a(p){for(var w=new Uint8Array(4096),u=Math.floor(255*p.r),y=Math.floor(255*p.g),B=Math.floor(255*p.b),D=0,H=0;32>H;H++)for(var K=0;32>K;K++)w[D]=u,w[D+1]=y,w[D+2]=B,w[D+3]=0===H||0===K||31===H||31===K?220:150,D+=4;w=new WALK.DataTexture(w,32,32,G.RGBAFormat);w.hasAlpha=!0;w.needsUpdate=!0;w.loaded=!0;u=new WALK.StandardMaterial;u.hideFromLightProbes=!0;u.specularOff=1;u.disableLightProbe=!0;u.depthTest=!1;u.depthWrite=!1;u.transparent=!0;u.baseColor=p;u.side=G.DoubleSide;u.baseColorTexture=
w;u.opacity=.6;u.configureTransparency();u.setUniforms();return Td(new G.Mesh(d.squareGeometry,u))}function b(p){p=Rd(p,.6);return Td(new G.Mesh(d.lineGeometry,p),new G.Mesh(d.arrowHeadGeometry,p))}var c=this;G.Object3D.call(this);var d=function(){var p=new G.Matrix4,w=new G.SphereBufferGeometry(.1,16,16),u=new G.PlaneBufferGeometry(.23,.23,1,1);p.makeTranslation(.45,.45,0);u.applyMatrix(p);u.addTriangleOrderAttribute();var y=new G.CylinderBufferGeometry(.015,.015,1,4,1,!1);p.makeTranslation(0,.65,
0);y.applyMatrix(p);var B=new G.CylinderBufferGeometry(0,.05,.2,10,1,!1);p.makeTranslation(0,1.25,0);B.applyMatrix(p);return{pickerGeometry:w,squareGeometry:u,lineGeometry:y,arrowHeadGeometry:B}}(),e=function(){var p=Rd(Hd,.6);return Td(new G.Mesh(d.pickerGeometry,p))}(),f=b(Id);f.rotation.set(0,0,-Math.PI/2);var g=b(Jd),k=b(Kd);k.rotation.set(Math.PI/2,0,0);var h=a(Kd),l=a(Jd);l.rotation.set(Math.PI/2,0,0);var n=a(Id);n.rotation.set(0,-Math.PI/2,0);e.usedAxes=Ld.ALL;f.usedAxes=Ld.X;g.usedAxes=Ld.Y;
k.usedAxes=Ld.Z;h.usedAxes=Ld.X|Ld.Y;l.usedAxes=Ld.X|Ld.Z;n.usedAxes=Ld.Y|Ld.Z;var r=[e,f,g,k,h,l,n];r.forEach(function(p){return c.add(p)});var v=new Map(r.map(function(p){return[p.collider,p]}));this.colliders=[].concat(m.arrayFromIterable(v.keys()));this.highlight=function(p,w){r.forEach(function(u){return Xd(u,p,w)})};this.usedAxes=function(p){return v.get(p).usedAxes}}Yd.prototype=Object.create(G.Object3D.prototype);Yd.prototype.constructor=Yd;
function Zd(){function a(r){var v=new G.TorusBufferGeometry(r,.012,6,64);r=new G.TorusBufferGeometry(r,.038,6,64);return{torusGeometry:v,colliderGeometry:r}}function b(r,v){r=new WALK.RotateGizmoMaterial(r,.6);var p=new G.Object3D;p.add(new G.Mesh(v.torusGeometry,r));v=new G.Mesh(v.colliderGeometry,r);v.visible=!1;v.visibilityId=null;return new Sd(p,v,r)}var c=this;G.Object3D.call(this);var d=a(.9),e=b(Id,d);e.rotation.set(0,Math.PI/2,0);var f=b(Jd,d);f.rotation.set(Math.PI/2,0,0);d=b(Kd,d);var g=
a(1.12),k=b(Hd,g),h=function(r,v){r=Rd(r,0);var p=new G.SphereBufferGeometry(v,32,32);v=new G.Object3D;v.add(new G.Mesh(p,r));p=new G.Mesh(p,r);p.visible=!1;p.visibilityId=null;r=new Sd(v,p,r);r.defaultOpacity=0;r.hoveredOpacity=.2;r.notUsedOpacity=0;return r}(Hd,.848),l=[e,f,d,k,h];l.forEach(function(r){return c.add(r)});var n=new Map(l.map(function(r){return[r.collider,r]}));this.colliders=[].concat(m.arrayFromIterable(n.keys()));this.update=function(r){var v=this;l.filter(function(p){return p!==
h}).forEach(function(p){p=p.material;p.gizmoPosition.copy(v.position);p.sphereRadius=.86*v.scale.x});k.rotation.setFromRotationMatrix(r.matrixWorld);k.updateMatrixWorld()};e.usedAxes=Ld.X;f.usedAxes=Ld.Y;d.usedAxes=Ld.Z;k.usedAxes=Ld.ALL;h.usedAxes=Ld.NONE;this.highlight=function(r,v){l.forEach(function(p){return Xd(p,r,v)})};this.usedAxes=function(r){return n.get(r).usedAxes}}Zd.prototype=Object.create(G.Object3D.prototype);Zd.prototype.constructor=Zd;
function $d(){function a(p){for(var w=new Uint8Array(4096),u=Math.floor(255*p.r),y=Math.floor(255*p.g),B=Math.floor(255*p.b),D=0,H=0;32>H;H++)for(var K=0;32>K;K++)w[D]=u,w[D+1]=y,w[D+2]=B,w[D+3]=0===H||0===K||31===H||31===K?220:150,D+=4;w=new WALK.DataTexture(w,32,32,G.RGBAFormat);w.hasAlpha=!0;w.needsUpdate=!0;w.loaded=!0;u=new WALK.StandardMaterial;u.hideFromLightProbes=!0;u.specularOff=1;u.disableLightProbe=!0;u.depthTest=!1;u.depthWrite=!1;u.transparent=!0;u.baseColor=p;u.side=G.DoubleSide;u.baseColorTexture=
w;u.opacity=.6;u.configureTransparency();u.setUniforms();return Td(new G.Mesh(d.squareGeometry,u))}function b(p){p=Rd(p,.6);return Td(new G.Mesh(d.lineGeometry,p),new G.Mesh(d.cubeGeometry,p))}var c=this;G.Object3D.call(this);var d=function(){var p=new G.Matrix4,w=new G.BoxBufferGeometry(.3,.3,.3),u=new G.PlaneBufferGeometry(.23,.23,1,1);p.makeTranslation(.45,.45,0);u.applyMatrix(p);u.addTriangleOrderAttribute();var y=new G.CylinderBufferGeometry(.015,.015,1,4,1,!1);p.makeTranslation(0,.65,0);y.applyMatrix(p);
var B=new G.BoxBufferGeometry(.1,.1,.1);p.makeTranslation(0,1.1,0);B.applyMatrix(p);return{pickerGeometry:w,squareGeometry:u,lineGeometry:y,cubeGeometry:B}}(),e=function(){var p=Rd(Hd,.6);return Td(new G.Mesh(d.pickerGeometry,p))}(),f=b(Id);f.rotation.set(0,0,-Math.PI/2);var g=b(Jd),k=b(Kd);k.rotation.set(Math.PI/2,0,0);var h=a(Kd),l=a(Jd);l.rotation.set(Math.PI/2,0,0);var n=a(Id);n.rotation.set(0,-Math.PI/2,0);e.usedAxes=Ld.ALL;f.usedAxes=Ld.X;g.usedAxes=Ld.Y;k.usedAxes=Ld.Z;h.usedAxes=Ld.X|Ld.Y;
l.usedAxes=Ld.X|Ld.Z;n.usedAxes=Ld.Y|Ld.Z;var r=[e,f,g,k,h,l,n];r.forEach(function(p){return c.add(p)});var v=new Map(r.map(function(p){return[p.collider,p]}));this.colliders=[].concat(m.arrayFromIterable(v.keys()));this.highlight=function(p,w){r.forEach(function(u){return Xd(u,p,w)})};this.usedAxes=function(p){return v.get(p).usedAxes}}$d.prototype=Object.create(G.Object3D.prototype);$d.prototype.constructor=$d;
WALK.TransformGizmo=function(a,b,c,d){function e(E){k.oldPosition.copy(E);k.newPosition.copy(E);h.position.copy(E);l.position.copy(E);n.position.copy(E);r.position.copy(E);v.position.copy(E);p.position.copy(E)}function f(E){k.oldRotation.copy(E);k.newRotation.copy(E);D===WALK.TRANSFORM_MODE.SCALE?(h.rotation.copy(E),l.setLocalRotation(E),p.rotation.copy(k.oldRotation)):(h.rotation.set(0,0,0),l.setLocalRotation(null))}function g(){H?D===WALK.TRANSFORM_MODE.TRANSLATE?(a.addAuxiliaryObject(h),a.addAuxiliaryObject(l),
a.addAuxiliaryObject(n),a.addAuxiliaryObject(r),a.removeAuxiliaryObject(v),a.removeAuxiliaryObject(p)):D===WALK.TRANSFORM_MODE.ROTATE?(a.addAuxiliaryObject(h),a.removeAuxiliaryObject(r),a.addAuxiliaryObject(v),a.removeAuxiliaryObject(p)):(a.addAuxiliaryObject(h),a.addAuxiliaryObject(l),a.removeAuxiliaryObject(r),a.removeAuxiliaryObject(v),a.addAuxiliaryObject(p)):(a.removeAuxiliaryObject(h),a.removeAuxiliaryObject(l),a.removeAuxiliaryObject(n),a.removeAuxiliaryObject(r),a.removeAuxiliaryObject(v),
a.removeAuxiliaryObject(p))}var k=this;this.subTargetsInfo=this.target=null;var h=new Ud;h.show(Ld.ALL);var l=new Wd;l.show(Ld.NONE);var n=new Vd;n.show(Ld.NONE);var r=new Yd,v=new Zd,p=new $d,w=!1;Object.defineProperty(this,"transforming",{get:function(){return w}});var u=new G.Vector3(0,0,0),y=0,B=new G.Vector3;this.oldPosition=new G.Vector3(0,0,0);this.newPosition=new G.Vector3(0,0,0);this.oldRotation=new G.Euler(0,0,0);this.newRotation=new G.Euler(0,0,0);this.oldScale=new G.Vector3(1,1,1);this.newScale=
new G.Vector3(1,1,1);Object.defineProperty(this,"position",{get:function(){return h.position}});Object.defineProperty(this,"rotation",{get:function(){return k.oldRotation}});var D=!1;Object.defineProperty(this,"scale",{get:function(){return k.oldScale}});var H=!1;Object.defineProperty(this,"mode",{get:function(){return D},set:function(E){D!==E&&(D=E,g(),d.requestFrame())}});Object.defineProperty(this,"visible",{get:function(){return H},set:function(E){H!==E&&(H=E,g())}});this.mode=WALK.TRANSFORM_MODE.TRANSLATE;
var K=Infinity,J=Infinity,W=new G.Vector3(0,0,0),M=null,ba=!1,ha=Ld.ALL,ta=function(){var E=new G.Vector3,Y=new G.Vector3,X=new G.Quaternion;return function(fa,ka,qa){E.set(ka,qa,1).unproject(a.camera);E.sub(c).normalize();if(!l.findPlaneIntersectionPoint(fa,c,E,Y))return null;Y.sub(h.position);Y.applyQuaternion(X.setFromEuler(h.rotation).inverse());fa&Ld.X||(Y.x=0);fa&Ld.Y||(Y.y=0);fa&Ld.Z||(Y.z=0);return Y}}(),I=function(){var E=new G.Vector3,Y=new G.Vector3,X=new G.Vector3;return function(fa,ka){var qa=
l.cameraPlane;E.set(0,0,-1);E.transformDirection(qa.matrixWorld);Y.set(-1,0,0);Y.transformDirection(qa.matrixWorld);fa=ta(Ld.ALL,fa,ka).normalize();X.copy(Y).cross(fa);return Math.sign(E.dot(X))*Math.acos(Y.dot(fa))}}(),U=new G.Vector3;this.rotationSpeed=5;var ia=function(){var E=new G.Vector2(0,0),Y=new G.Quaternion,X=new G.Euler,fa=new G.Quaternion,ka=new G.Quaternion,qa=new G.Vector3,ya=new G.Vector3,za=new G.Vector3;return function(T,V){Y.setFromEuler(k.oldRotation);Y.normalize();E.set(K-T,J-
V);E.multiplyScalar(k.rotationSpeed);if(ha===Ld.NONE)return T=l.cameraPlane,qa.copy(Nd),qa.transformDirection(T.matrixWorld),ya.set(0,1,0),ya.transformDirection(T.matrixWorld),ka.setFromAxisAngle(qa,E.y),fa.setFromAxisAngle(ya,-E.x),fa.multiply(ka),fa.multiply(Y),fa.normalize(),X.setFromQuaternion(fa,"ZXY"),X;if(ha===Ld.ALL){var ma=l.cameraPlane;za.set(0,0,-1);za.transformDirection(ma.matrixWorld);ma=za;T=I(T,V);T-=y}else{ha!==Ld.Z&&E.multiplyScalar((ha===Ld.X?-1:1)*Math.sign((ha===Ld.X?Od:Nd).dot(U)));
a:{switch(ha){case Ld.X:ma=Nd;break a;case Ld.Y:ma=Od;break a;case Ld.Z:ma=Md;break a}console.error("Unable to get direction for this value!");ma=void 0}T=ha===Ld.Z?-E.x:E.y}fa.setFromAxisAngle(ma,T);fa.multiply(Y);fa.normalize();X.setFromQuaternion(fa,"ZXY");return X}}(),R=function(){var E={hoveredCollider:null,hasAnythingChanged:!1};return function(Y,X,fa){var ka=D===WALK.TRANSFORM_MODE.TRANSLATE?r:D===WALK.TRANSFORM_MODE.ROTATE?v:p;Y=b.findMeshFromListAtPosition(ka.colliders,Y,X,!0);X=!1;if(Y!==
M||ba!==fa)M=Y,ka.highlight(Y,fa),X=!0;E.hoveredCollider=Y;E.hasAnythingChanged=X;return E}}();this.onCanvasPointerMove=function(E,Y){if(this.transforming){if(this.mode===WALK.TRANSFORM_MODE.TRANSLATE){var X=ta(ha,E,Y);X&&this.newPosition.copy(X.sub(u).add(h.position));W.copy(this.newPosition);W.sub(h.position);W.divide(h.scale);n.update(W);if(E!==K||Y!==J)r.visible=!1,n.show(ha),h.show(ha)}else if(this.mode===WALK.TRANSFORM_MODE.ROTATE){if(h.show(ha),this.newRotation.copy(ia(E,Y)),E!==K||Y!==J)v.visible=
!1}else{h.show(ha);if(X=ta(ha,E,Y))X.addScalar(1).divide(B),this.newScale.copy(X);if(E!==K||Y!==J)p.visible=!1}d.requestFrame();return!0}R(E,Y,ba).hasAnythingChanged&&d.requestFrame();return!1};this.onCanvasPointerDown=function(E,Y){var X=R(E,Y,!0);ba=!0;if(null!==X.hoveredCollider)return w=!0,ha=(D===WALK.TRANSFORM_MODE.TRANSLATE?r:D===WALK.TRANSFORM_MODE.ROTATE?v:p).usedAxes(X.hoveredCollider),K=E,J=Y,this.mode===WALK.TRANSFORM_MODE.TRANSLATE?(l.show(ha),this.newPosition.copy(this.oldPosition),
u.copy(ta(ha,E,Y))):this.mode===WALK.TRANSFORM_MODE.ROTATE?ha===Ld.ALL&&(this.newRotation.copy(this.oldRotation),y=I(E,Y)):(l.show(ha===Ld.ALL?Ld.NONE:ha),this.newScale.copy(this.oldScale),E=ta(ha,E,Y),B.copy(E).addScalar(1).divide(this.oldScale)),!0;ha=Ld.ALL;w=!1;X.hasAnythingChanged&&d.requestFrame();return!1};this.onCanvasPointerUp=function(E,Y){if(this.transforming){e(this.newPosition);f(this.newRotation);var X=this.newScale;k.oldScale.copy(X);k.newScale.copy(X);l.show(Ld.NONE);n.show(Ld.NONE);
ha=Ld.ALL;h.show(ha);this.mode===WALK.TRANSFORM_MODE.TRANSLATE?r.visible=!0:this.mode===WALK.TRANSFORM_MODE.ROTATE?v.visible=!0:p.visible=!0}X=this.transforming;w=!1;this.update();R(E,Y,!1).hasAnythingChanged&&d.requestFrame();ba=!1;return X};this.update=function(){if(!this.transforming&&(void 0!==this.target.position&&e(this.target.position),void 0!==this.target.rotation&&f(this.target.rotation),void 0!==this.target.scale)){var E=this.target.scale;k.oldScale.copy(E);k.newScale.copy(E)}U.copy(c);
U.sub(h.position);U.normalize();E=.18*h.position.distanceTo(c)*a.camera.fov/90;h.scale.set(E,E,E);l.scale.set(E,E,E);n.scale.set(E,E,E);r.scale.set(E,E,E);v.scale.set(E,E,E);p.scale.set(E,E,E);v.update(a.camera);l.update(a.camera);h.update(c);h.updateMatrixWorld();l.updateMatrixWorld();n.updateMatrixWorld();r.updateMatrixWorld();v.updateMatrixWorld();p.updateMatrixWorld()}};WALK.SubTargetData=function(a,b){this.isSupported=function(c){return b[c]};this.offsetPosition=function(c){c=a.position.clone().add(c);a.setPosition(c.x,c.y,c.z)};this.offsetRotation=function(c){a.setRotation(a.rotation.z+c.z,a.rotation.x+c.x,a.rotation.y+c.y)};this.offsetScale=function(c){c=a.scale.clone().add(c);a.setScale(c.x,c.y,c.z)};Object.defineProperty(this,"target",{get:function(){return a}})};
WALK.TransformControls=function(a,b,c,d,e){function f(){}function g(p){e.isEnabled()!==p&&(p?e.enable():e.disable())}var k=this,h=!1,l=new WALK.TransformGizmo(c,d,e.cameraWorldPosition(),b);l.mode=WALK.TRANSFORM_MODE.TRANSLATE;var n={itemModified:f},r=[];Object.defineProperty(this,"supportedModes",{get:function(){return r}});Object.defineProperty(this,"mode",{get:function(){return l.mode}});this.setItemModifiedCallback=function(p){console.assert(n.itemModified===f);n.itemModified=p};var v=new WALK.PointerEventHelper(a,
WALK.POINTER_PRIORITY.TRANSFORM_CONTROLS);v.callbacks.onPointerDown=function(p,w){p=l.onCanvasPointerDown(p,w);g(!l.transforming);return p};v.callbacks.onPointerUp=function(p,w){p=l.onCanvasPointerUp(p,w);g(!l.transforming);return p};v.callbacks.onPointerMove=function(p,w){p=l.onCanvasPointerMove(p,w);if(l.transforming)if(l.mode===WALK.TRANSFORM_MODE.TRANSLATE){w=l.newPosition;var u=w.clone().sub(k.target.position);k.target.setPosition(w.x,w.y,w.z);n.itemModified(k.target);k.subTargetsData&&k.subTargetsData.forEach(function(D){D.isSupported(l.mode)&&
(D.offsetPosition(u),n.itemModified(D.target))})}else if(l.mode===WALK.TRANSFORM_MODE.ROTATE){w=l.newRotation;var y={x:w.x-k.target.rotation.x,y:w.y-k.target.rotation.y,z:w.z-k.target.rotation.z};k.target.setRotation(k.target.rotation.z+y.z,k.target.rotation.x+y.x,k.target.rotation.y+y.y);n.itemModified(k.target);k.subTargetsData&&k.subTargetsData.forEach(function(D){D.isSupported(l.mode)&&(D.offsetRotation(y),n.itemModified(D.target))})}else{w=l.newScale;var B=w.clone().sub(k.target.scale);k.target.setScale(w.x,
w.y,w.z);n.itemModified(k.target);k.subTargetsData&&k.subTargetsData.forEach(function(D){D.isSupported(l.mode)&&(D.offsetScale(B),n.itemModified(D.target))})}return p};v.disable();Object.defineProperty(this,"target",{get:function(){return l.target}});Object.defineProperty(this,"subTargetsData",{get:function(){return l.subTargetsData}});this.setTransformMode=function(p){l.mode=p};this.update=function(){h&&l.update()};this.enable=function(p,w,u){h=!0;l.target=p;l.subTargetsData=u;null!==p&&(l.update(),
l.visible=!0);r=w;-1===w.indexOf(l.mode)&&(l.mode=w[0]);v.enable()};this.disable=function(){h=!1;r=[];l.visible=!1;v.disable()}};function ae(a){var b=new G.Color,c=null,d=!1;this.set=function(e,f){console.assert(!d);d=!0;b.copy(a.getClearColor());c=a.getClearAlpha();a.setClearColor(e,f)};this.restore=function(){console.assert(d);d=!1;a.setClearColor(b,c)}};function be(a){var b,c,d,e;this.set=function(f,g,k){console.assert(void 0===b&&void 0===c&&void 0===d&&void 0===e);b=a.autoClear;c=a.autoClearColor;d=a.autoClearDepth;e=a.autoClearStencil;a.autoClear=f||g||k;a.autoClearColor=f;a.autoClearDepth=g;a.autoClearStencil=k};this.restore=function(){console.assert(void 0!==b&&void 0!==c&&void 0!==d&&void 0!==e);a.autoClear=b;a.autoClearColor=c;a.autoClearDepth=d;a.autoClearStencil=e;e=d=c=b=void 0}};function ce(a,b){this._nodesPrimary=a;this._nodesSecondary=b}ce.prototype.constructor=ce;Object.defineProperty(ce.prototype,"highlightMix",{set:function(a){this._nodesPrimary.forEach(function(b){b.highlightMix=a});this._nodesSecondary.forEach(function(b){b.highlightMix=a})}});Object.defineProperty(ce.prototype,"selected",{set:function(a){this._nodesPrimary.forEach(function(b){b.selected=a});this._nodesSecondary.forEach(function(b){b.selectedSecondary=a})}});
WALK.EditorSelector=function(a,b,c,d,e,f,g,k,h){function l(){}function n(){B.highlightMix=.8*Math.pow(D/y.selectionTimeSec,2)}function r(R){null!==B&&(B.highlightMix=0);null!==R&&(B=R,D=y.selectionTimeSec,n());k.requestFrame()}function v(R){var E=R.geometry;E&&void 0===E.getAttribute("order")&&R.visible&&(R.visible=!1,ia.push(R))}function p(){for(var R=m.makeIterator(ia),E=R.next();!E.done;E=R.next())E.value.visible=!0}function w(){ba.set(!0,!1,!1);ha.set(ta);b.gpuMeshes.forEach(function(R){R.geometry.addTriangleOrderAttribute();
R.highlightMix=0;R.selected=!1;c.uploadNewBuffers(R)});ia.length=0;b.threeScene.traverse(v);b.threeScene.overrideMaterial=I;b.skyMeshes.forEach(function(R){R.visible=!1})}function u(){ba.restore();ha.restore();p();b.threeScene.overrideMaterial=null;b.gpuMeshes.forEach(function(R){R.highlightMix=null;R.selected=null;R.selectedSecondary=!1});H=null;b.skyMeshes.forEach(function(R){R.visible=!0})}var y=this,B=null,D=0,H=null,K=0,J=new WALK.RayIntersection,W=new WALK.TransformControls(a,k,b,d,h),M={materialClicked:l,
lightInstanceClicked:l,lightProbeClicked:l,nodeClicked:l,extensionClicked:l,positionClicked:l},ba=new be(c),ha=new ae(c),ta=new G.Color(16777215),I=new WALK.WireframeMaterial(new G.Color(0));I.highlight=I.meshSelectedLineColor;var U;this.selectionTimeSec=1;this.selectMaterial=function(R){console.assert(U===WALK.EditorSelector.SELECTION_MODE.MATERIAL);r(R)};this.selectLights=function(R,E){console.assert(U===WALK.EditorSelector.SELECTION_MODE.LIGHT);e.showSelectionMesh(R,E);k.requestFrame()};this.selectLightInstances=
function(R,E,Y){function X(ka){return ka.map(function(qa){var ya=WALK.SubTargetData,za=[];switch(qa.light.type){case "point":za[WALK.TRANSFORM_MODE.TRANSLATE]=!0;break;case "sun":za[WALK.TRANSFORM_MODE.ROTATE]=!0;break;default:za[WALK.TRANSFORM_MODE.TRANSLATE]=!0,za[WALK.TRANSFORM_MODE.ROTATE]=!0}return new ya(qa,za)})}e.showInstancesSelectionMesh(R,E);console.assert(U===WALK.EditorSelector.SELECTION_MODE.LIGHT);if(R){var fa=R.light.type;W.enable(R,"point"===fa?[WALK.TRANSFORM_MODE.TRANSLATE]:"sun"===
fa?[WALK.TRANSFORM_MODE.ROTATE]:[WALK.TRANSFORM_MODE.TRANSLATE,WALK.TRANSFORM_MODE.ROTATE],X(E))}else W.disable();Y?(R=e.getLightInstanceMaterial(Y),r(R)):k.requestFrame()};this.selectLightProbe=function(R){var E=null;console.assert(U===WALK.EditorSelector.SELECTION_MODE.LIGHT_PROBE);R?(f.showLightProbeBoundingBox(R),E=f.getLightProbeMaterial(R),W.enable(R,[WALK.TRANSFORM_MODE.TRANSLATE])):W.disable();r(E)};this.selectEditorCameraVolume=function(R){console.assert(U===WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME);
R?(r(g.setHighlightedCameraVolume(R)),W.enable(R,[WALK.TRANSFORM_MODE.TRANSLATE,WALK.TRANSFORM_MODE.ROTATE,WALK.TRANSFORM_MODE.SCALE])):(r(null),W.disable())};this.selectExtension=function(R){var E=null;console.assert(U===WALK.EditorSelector.SELECTION_MODE.EXTENSION);R&&0<R.triggers.length&&(R=R.triggers[0].mesh)&&(E=R.material);r(E)};this.selectNodes=function(R,E,Y,X,fa){console.assert(U===WALK.EditorSelector.SELECTION_MODE.NODE);H&&(H.selected=!1);R||E.length?(R=[R].concat(Y),E=E.concat(X),H=new ce(R,
E),H.selected=!0):H=null;fa&&(fa=new ce([fa],fa.config.nodes),r(fa))};this.update=function(R){W.update();null!==B&&(D-=R,0<D?n():(B.highlightMix=0,B=null),k.requestFrame())};var ia=[];this.setDistanceToObject=function(R){K=R};this.setSelectionMode=function(R){if(R!==U){U===WALK.EditorSelector.SELECTION_MODE.NODE&&u();U===WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME&&g.setControlsVisible(!1);switch(R){case WALK.EditorSelector.SELECTION_MODE.OFF:case WALK.EditorSelector.SELECTION_MODE.MATERIAL:case WALK.EditorSelector.SELECTION_MODE.EXTENSION:case WALK.EditorSelector.SELECTION_MODE.POSITION:case WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME:e.hideLights();
f.hideLightProbes();break;case WALK.EditorSelector.SELECTION_MODE.LIGHT:e.showLights();f.hideLightProbes();break;case WALK.EditorSelector.SELECTION_MODE.LIGHT_PROBE:e.hideLights();f.showLightProbes();break;case WALK.EditorSelector.SELECTION_MODE.NODE:e.hideLights(),f.hideLightProbes(),w()}R===WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME&&g.setControlsVisible(!0);W.disable();if(R===WALK.EditorSelector.SELECTION_MODE.MATERIAL||R===WALK.EditorSelector.SELECTION_MODE.EXTENSION)for(var E=m.makeIterator(b.getAnimatedMaterials()),
Y=E.next();!Y.done;Y=E.next())Y.value.play();else for(E=m.makeIterator(b.getAnimatedMaterials()),Y=E.next();!Y.done;Y=E.next())Y.value.pause();U=R}};this.setMaterialClickedCallback=function(R){console.assert(M.materialClicked===l);M.materialClicked=R};this.setLightInstanceClickedCallback=function(R){console.assert(M.lightInstanceClicked===l);M.lightInstanceClicked=R};this.setLightProbeClickedCallback=function(R){console.assert(M.lightProbeClicked===l);M.lightProbeClicked=R};this.setNodeClickedCallback=
function(R){console.assert(M.nodeClicked===l);M.nodeClicked=R};this.setExtensionClickedCallback=function(R){console.assert(M.extensionClicked===l);M.extensionClicked=R};this.setPositionClickedCallback=function(R){console.assert(M.positionClicked===l);M.positionClicked=R};(function(){var R=new WALK.PointerEventHelper(a,WALK.POINTER_PRIORITY.EDITOR_SELECTOR);R.callbacks.onClick=function(E,Y,X){if(U===WALK.EditorSelector.SELECTION_MODE.OFF)return!1;var fa=!1;switch(U){case WALK.EditorSelector.SELECTION_MODE.MATERIAL:E=
d.findObstacleMeshAtPosition(E,Y,!1);E=null!==E?E.material:null;null!==E&&(fa=M.materialClicked(E,X));break;case WALK.EditorSelector.SELECTION_MODE.LIGHT:E=d.findMeshFromListAtPosition(e.lightInstanceMeshes,E,Y);E=null!==E?E.userData.lightInstance:null;null!==E&&(fa=M.lightInstanceClicked(E,X));break;case WALK.EditorSelector.SELECTION_MODE.LIGHT_PROBE:E=d.findMeshFromListAtPosition(f.lightProbeMeshes,E,Y);E=null!==E?E.lightProbe:null;null!==E&&(fa=M.lightProbeClicked(E,X));break;case WALK.EditorSelector.SELECTION_MODE.NODE:E=
d.findObstacleMeshAtPosition(E,Y,!1);(E=null!==E?E.node:null)&&(fa=M.nodeClicked(E,X));break;case WALK.EditorSelector.SELECTION_MODE.EXTENSION:E=d.findIntersectionAtPosition(E,Y,!1,J)?J.object.anchor||null:null;E&&E.extension&&(fa=M.extensionClicked(E.extension,E,X));break;case WALK.EditorSelector.SELECTION_MODE.POSITION:E=d.findIntersectionAtPosition(E,Y,!1,J)&&!J.object.anchor?d.movePointTowardsTheCamera(J.point,K):null,E&&(fa=M.positionClicked(E,X))}return fa};R.callbacks.onDoubleClick=function(){return!1}})();
Object.defineProperty(this,"transformControls",{get:function(){return W}});this.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.OFF)};WALK.EditorSelector.SELECTION_MODE={OFF:0,MATERIAL:1,LIGHT:2,LIGHT_PROBE:3,NODE:4,EXTENSION:6,POSITION:7,CAMERA_VOLUME:8};function de(){var a={uniforms:{inputBuffer:{type:"t",value:null},weight:{type:"f",value:1}},vertexShader:WALK.getShader("accumulate_vertex.glsl"),fragmentShader:WALK.getShader("accumulate_fragment.glsl")};G.ShaderPass.call(this,a,"inputBuffer");this.material.depthTest=!1;this.material.depthWrite=!1;this.material.blending=G.CustomBlending;this.material.blendEquation=GLC.FUNC_ADD;this.material.blendDst=GLC.ONE_MINUS_SRC_ALPHA;this.material.blendSrc=GLC.SRC_ALPHA}de.prototype=Object.create(G.ShaderPass.prototype);
de.prototype.constructor=WALK.AccumulatePass;function ee(a,b,c,d,e){var f=a/b,g=Math.tan(.5*G.Math.degToRad(e.fov));g=e.near*g/e.zoom;var k=-g,h=k*f;f*=g;a=(f-h)/a;b=(g-k)/b;e.projectionMatrix.makeFrustum(h-c*a,f-c*a,k-d*b,g-d*b,e.near,e.far)}function fe(a,b,c,d,e){var f=e.top,g=e.bottom,k=e.left,h=e.right;a=(h-k)/a;b=(g-f)/b;e.projectionMatrix.makeOrthographic(k-c*a,h-c*a,f-d*b,g-d*b,e.near,e.far)}
function ge(){var a={uniforms:{tDiffuse:{type:"t",value:null}},vertexShader:WALK.getShader("copy_opaque_vertex.glsl"),fragmentShader:WALK.getShader("copy_opaque_fragment.glsl")};a=new G.ShaderPass(a);a.renderToScreen=!0;return a}
function he(a,b,c){void 0===c&&(c=b.camera);var d,e,f=0,g=[[.375,.4375],[.625,.0625],[.875,.1875],[.125,.0625],[.375,.6875],[.875,.4375],[.625,.5625],[.375,.9375],[.625,.3125],[.125,.5625],[.125,.8125],[.375,.1875],[.875,.9375],[.875,.6875],[.125,.3125],[.625,.8125]],k=new de,h=ge(),l=new be(a);if(c instanceof G.PerspectiveCamera)var n=ee;else c instanceof G.OrthographicCamera?n=fe:(console.error("Unsupported camera type"),n=void 0);var r=n;this.reset=function(){f=0};this.renderSample=function(v,
p){console.assert(f<g.length);l.set(!0,!0,!1);r(e.width,e.height,g[f][0]-.5,g[f][1]-.5,c);v?a.renderMeshes(v,p,c,d,!0):(console.assert(!1===(void 0!==p&&void 0===v),"Passing overrideMaterial without passing meshes is not implemented"),a.render(b.threeScene,c,d,!0));l.restore();l.set(!1,!1,!1);k.uniforms.weight.value=1/(f+1);k.render(a,e,d);l.restore();c.updateProjectionMatrix();f+=1};this.renderedSamplesCount=function(){return f};this.allSamplesRendered=function(){return f===g.length};this.renderAllSamples=
function(v,p){for(;!this.allSamplesRendered();)this.renderSample(v,p)};this.renderAccumulatedSamplesToScreen=function(){l.set(!0,!0,!1);h.render(a,void 0,e);l.restore()};this.copyAccumulatedSamplesToBuffer=function(){var v=e.width,p=e.height,w=new Uint8Array(v*p*4);a.readPixels(v,p,w);return w};this.setTargets=function(v,p){console.assert(v.width===p.width&&v.height===p.height);d=v;e=p};this.dispose=function(){k.material.dispose()}};function le(a){return a.split("\n").map(function(b,c){return c+1+": "+b}).join("\n")}function me(a,b,c){b=a.createShader(b);a.shaderSource(b,c);a.compileShader(b);var d=!1===a.getShaderParameter(b,a.COMPILE_STATUS);d&&console.error("Shader failed to compile.");if(d||WALK.LOG_INFO)a=a.getShaderInfoLog(b),""!==a&&console.warn("Shader info log: ",a,le(c));return b};var ne="viewMatrix modelViewMatrix projectionMatrix normalMatrix modelMatrix cameraPosition".split(" "),oe=0;
function pe(a,b){var c=b.index0AttributeName,d=a.createProgram(),e=me(a,a.VERTEX_SHADER,b.generateVertexShader()),f=me(a,a.FRAGMENT_SHADER,b.generateFragmentShader());a.attachShader(d,e);a.attachShader(d,f);void 0!==c&&a.bindAttribLocation(d,0,c);a.linkProgram(d);c=a.getProgramInfoLog(d).trim();!1===a.getProgramParameter(d,a.LINK_STATUS)&&console.error("Shader link error: "+a.getError(),"validate status: ",a.getProgramParameter(d,a.VALIDATE_STATUS));""!==c&&"\x00"!==c&&console.warn("program info log: "+
c);a.deleteShader(e);a.deleteShader(f);e={};f=0;for(c=ne.length;f<c;f++){var g=ne[f];e[g]=a.getUniformLocation(d,g)}this.transformUniformCache=e;e=b.uniforms;f={i:[],f:[],v2:[],v3:[],c:[],v4:[],m4:[],t:[]};var k;for(h in e)e.hasOwnProperty(h)&&(c=a.getUniformLocation(d,h))&&(g=e[h].type,console.assert(f.hasOwnProperty(g)),"i"===g||"f"===g||"t"===g?k=null:"v2"===g?k=[null,null]:"v3"===g||"c"===g?k=[null,null,null]:"v4"===g?k=[null,null,null,null]:"m4"===g?k=null:console.assert(!1),f[g].push({id:h,
value:k,location:c}));this.materialUniformCache=f;b=b.attributes;k={};var h=0;for(e=b.length;h<e;h++)f=b[h],k[f]=a.getAttribLocation(d,f);this.attributes=k;this.attributesKeys=Object.keys(this.attributes);this.id=oe++;this.usedTimes=1;this.program=d;return this}
function qe(a){var b=new Map;this.assignProgramToMaterial=function(c){console.assert(c instanceof WALK.BaseMaterial);var d=c.generateProgramId(),e=b[d];e?e.usedTimes++:(e=new pe(a,c),b[d]=e);c.program&&this.resetProgramAssignment(c);c.program=e};this.resetProgramAssignment=function(c){var d=c.program;c.program=null;--d.usedTimes;if(0===d.usedTimes){for(var e in b)if(b.hasOwnProperty(e)&&b[e]===d){delete b[e];break}a.deleteProgram(d.program)}}};function re(a){var b=Array(16).fill(0),c=Array(16).fill(null),d=b.map(function(){return 0}),e=null,f=null,g=null,k=null,h=null,l=null,n=null,r=null,v=null,p=null,w=null,u=null,y=null,B=null,D=null,H=null;this.resetAttributeStates=function(){for(var K=0,J=b.length;K<J;K++)b[K]=0};this.disableAttributeStates=function(){for(var K=0,J=b.length;K<J;K++)a.disableVertexAttribArray(K),b[K]=0};this.enableAttributeArray=function(K){2!==b[K]&&(a.enableVertexAttribArray(K),b[K]=2)};this.disableAttributeArray=
function(K,J){1!==b[K]&&(a.disableVertexAttribArray(K),b[K]=1);c[K]!==J&&(2===J.length?a.vertexAttrib2fv(K,J):3===J.length?a.vertexAttrib3fv(K,J):4===J.length&&a.vertexAttrib4fv(K,J),c[K]=J)};this.resetAttributeDivisors=function(){for(var K=0,J=d.length;K<J;K++)d[K]&&(a.vertexAttribDivisor(K,0),d[K]=0)};this.setAttributeDivisor=function(K,J){a.vertexAttribDivisor(K,J);d[K]=J};this.setBlending=function(K){var J=K.blending;J!==e&&(J===G.NoBlending?a.disable(a.BLEND):J===G.AdditiveBlending?(a.enable(a.BLEND),
a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE)):J===G.SubtractiveBlending?(a.enable(a.BLEND),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.ONE_MINUS_SRC_COLOR)):J===G.MultiplyBlending?(a.enable(a.BLEND),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.SRC_COLOR)):J===G.CustomBlending?a.enable(a.BLEND):(a.enable(a.BLEND),a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)),e=J);if(J===G.CustomBlending){J=K.blendEquation;
var W=K.blendEquationAlpha||J,M=K.blendSrc,ba=K.blendDst,ha=K.blendSrcAlpha||M;K=K.blendDstAlpha||ba;if(J!==f||W!==h)a.blendEquationSeparate(J,W),f=J,h=W;if(M!==g||ba!==k||ha!==l||K!==n)a.blendFuncSeparate(M,ba,ha,K),g=M,k=ba,l=ha,n=K}else n=l=h=k=g=f=null};this.setDepthTest=function(K){r!==K&&(K?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),r=K)};this.setDepthWrite=function(K){v!==K&&(a.depthMask(K),v=K)};this.setColorWrite=function(K){p!==K&&(a.colorMask(K,K,K,K),p=K)};this.setDoubleSided=function(K){w!==
K&&(K?a.disable(a.CULL_FACE):a.enable(a.CULL_FACE),w=K)};this.setFlipSided=function(K){u!==K&&(K?a.frontFace(a.CW):a.frontFace(a.CCW),u=K)};this.setViewport=function(K,J,W,M){if(y!==K||B!==J||D!==W||H!==M)a.viewport(K,J,W,M),y=K,B=J,D=W,H=M}};function se(){this.texture=null;this.locked=!1;this.usedCount=0}function te(a){for(var b=[],c=0;c<a;c+=1)b[c]=new se;return b}
function ue(a){var b=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),c=te(b);this.setSlot=function(d,e){var f=d.__webglSlot;if(null!==f){var g=c[f];g.usedCount+=1;g.locked=g.locked||e;return!1}for(var k=Infinity,h=0;h<b;h+=1)g=c[h],!g.locked&&g.usedCount<k&&(k=g.usedCount,f=h);null===f&&(console.warn("Not enough texture units"),f=0);g=c[f];g.texture&&(g.texture.__webglSlot=null);g.texture=d;g.usedCount=1;g.locked=e;d.__webglSlot=f;return!0};this.unlockAllSlots=function(){for(var d=0;d<b;d+=1)c[d].locked=
!1};this.freeSlot=function(d){if(null!==d.__webglSlot){var e=c[d.__webglSlot];d.__webglSlot=null;e.texture=null;e.locked=!1;e.usedCount=0}}}function ve(a){var b=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),c=0;this.setSlot=function(d,e){c===b&&(console.warn("Not enough texture units"),c=0);d.__webglSlot=c;e&&(c+=1);return!0};this.unlockAllSlots=function(){c=0};this.freeSlot=function(d){d.__webglSlot=null}};function we(a,b){a.drawArraysInstanced=function(c){for(var d=[],e=0;e<arguments.length;++e)d[e-0]=arguments[e];return b.drawArraysInstancedANGLE.apply(b,m.arrayFromIterable(d))};a.drawElementsInstanced=function(c){for(var d=[],e=0;e<arguments.length;++e)d[e-0]=arguments[e];return b.drawElementsInstancedANGLE.apply(b,m.arrayFromIterable(d))};a.vertexAttribDivisor=function(c){for(var d=[],e=0;e<arguments.length;++e)d[e-0]=arguments[e];return b.vertexAttribDivisorANGLE.apply(b,m.arrayFromIterable(d))}}
function xe(a,b){for(var c={HALF_FLOAT_OES:"OES_texture_half_float",COMPRESSED_RGB_S3TC_DXT1_EXT:"WEBGL_compressed_texture_s3tc",COMPRESSED_RGBA_S3TC_DXT1_EXT:"WEBGL_compressed_texture_s3tc",COMPRESSED_RGBA_S3TC_DXT3_EXT:"WEBGL_compressed_texture_s3tc",COMPRESSED_RGBA_S3TC_DXT5_EXT:"WEBGL_compressed_texture_s3tc",COMPRESSED_RGB_PVRTC_4BPPV1_IMG:"WEBGL_compressed_texture_pvrtc",COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:"WEBGL_compressed_texture_pvrtc",COMPRESSED_RGB_PVRTC_2BPPV1_IMG:"WEBGL_compressed_texture_pvrtc",
COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:"WEBGL_compressed_texture_pvrtc",COMPRESSED_RGB_ETC1_WEBGL:"WEBGL_compressed_texture_etc1",COMPRESSED_RGBA_ASTC_4x4_KHR:"WEBGL_compressed_texture_astc"},d=m.makeIterator(Object.entries(GLC)),e=d.next();!e.done;e=d.next()){var f=m.makeIterator(e.value);e=f.next().value;f=f.next().value;var g=c[e];void 0!==g?(g=b.gl.extension(g))&&console.assert(g[e]===f):console.assert(a[e]===f)}}function ye(a){return WALK.DETECTOR.gl.disableTextureSlotReuse?new ve(a):new ue(a)}
function ze(a,b){window.__SHAPESPARK_PLUGIN_UI.webGLRenderer=this;function c(T,V){if(!WALK.DETECTOR.gl.webgl2)return T;if(V===GLC.FLOAT){if(T===GLC.RGB)return b.RGB32F;console.assert("Missing mapping")}return T}function d(){ia=!!WALK.DETECTOR.gl.instances;ha=ba=null;ta=-1;U=I=null;!WALK.DETECTOR.gl.webgl2&&ia&&we(b,WALK.DETECTOR.gl.instances);R=new re(b);E=new qe(b);b.clearColor(0,0,0,1);b.clearDepth(1);b.clearStencil(0);b.enable(b.DEPTH_TEST);b.depthFunc(b.LEQUAL);b.frontFace(b.CCW);b.cullFace(b.BACK);b.enable(b.CULL_FACE);b.enable(b.BLEND);b.blendEquation(b.FUNC_ADD);
b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);R.setViewport(0,0,a.width,a.height);b.clearColor(H.r,H.g,H.b,K);WALK.DETECTOR.ie||b.pixelStorei(b.UNPACK_COLORSPACE_CONVERSION_WEBGL,b.NONE)}function e(T){T=T.target;T.removeEventListener("dispose",e);delete T.__webglInit;T=T.attributes;for(var V in T)if(T.hasOwnProperty(V)){var ma=T[V];void 0!==ma.buffer&&(b.deleteBuffer(ma.buffer),delete ma.buffer)}R.disableAttributeStates();I=null}function f(T){T=T.target;T.removeEventListener("dispose",f);ka.freeSlot(T);
T.__webglTexture&&(b.deleteTexture(T.__webglTexture),T.__webglTexture=null)}function g(T){T=T.target;T.removeEventListener("dispose",g);ka.freeSlot(T);b.deleteTexture(T.__webglTexture);T.__webglTexture=null;T.__webglFramebuffer&&M.deallocateRenderTargetRenderingBuffers(T)}function k(T){T=T.target;T.removeEventListener("dispose",k);E.resetProgramAssignment(T)}function h(T,V,ma){var P=ma.attributes,N=V.attributes;V=V.attributesKeys;ma=16*(ma.instanceId||0);for(var da=0,ua=V.length;da<ua;da++){var ja=
V[da],S=N[ja];if(0<=S){var sa=P[ja];if(void 0!==sa){ja=sa.itemSize;var Ga=sa.glType;b.bindBuffer(b.ARRAY_BUFFER,sa.buffer);sa=sa.divisor||0;R.enableAttributeArray(S);b.vertexAttribPointer(S,ja,Ga,!1,0,ma*sa);ia&&R.setAttributeDivisor(S,sa)}else R.disableAttributeArray(S,T.defaultAttributeValues[ja])}}}function l(T,V){var ma=WALK.DETECTOR;b.texParameteri(T,b.TEXTURE_WRAP_S,V.wrapS);b.texParameteri(T,b.TEXTURE_WRAP_T,V.wrapT);b.texParameteri(T,b.TEXTURE_MAG_FILTER,V.magFilter);b.texParameteri(T,b.TEXTURE_MIN_FILTER,
V.minFilter);var P=ma.gl.extension("EXT_texture_filter_anisotropic");P&&1<V.anisotropy&&b.texParameterf(T,P.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(V.anisotropy,ma.gl.maxAnisotropy))}function n(T,V){var ma=T.material,P=V.material,N=ma.program,da=P.program;return N&&da&&N.id!==da.id?N.id-da.id:ma.id-P.id||T.id-V.id}function r(T,V){var ma=T.material.transparentRenderOrder-V.material.transparentRenderOrder;return ma?ma:V.cameraDistance-T.cameraDistance||T.id-V.id}function v(T,V,ma){if(ma||!1!==T.visible){T instanceof
G.Mesh&&(!1===T.frustumCulled||!0===Y.intersectsObject(T))&&((V||T.material).transparent?(!0===M.sortObjects&&(T.cameraDistance=Y.nearPlaneDistanceToCenter(T)),W.push(T)):J.push(T));for(var P=0,N=T.children.length;P<N;P++)v(T.children[P],V,ma)}}function p(T){R.setDoubleSided(T.side===G.DoubleSide);R.setFlipSided(T.side===G.BackSide)}function w(T){T.__webglTexture||(T.addEventListener("dispose",f),T.__webglTexture=b.createTexture());b.activeTexture(b.TEXTURE0+T.__webglSlot);b.bindTexture(b.TEXTURE_2D,
T.__webglTexture);b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,T.flipY);b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,T.premultiplyAlpha);b.pixelStorei(b.UNPACK_ALIGNMENT,T.unpackAlignment);var V=T.image,ma=G.Math.isPowerOfTwo(V.width)&&G.Math.isPowerOfTwo(V.height),P=T.format,N=T.type,da=c(P,N);l(b.TEXTURE_2D,T);var ua=T.mipmaps;if(T instanceof WALK.DataTexture)if(0<ua.length&&ma){for(var ja=0,S=ua.length;ja<S;ja++)V=ua[ja],b.texImage2D(b.TEXTURE_2D,ja,da,V.width,V.height,0,P,N,V.data),T.releaseOnLoadedToGpu&&
(V.data=null);T.generateMipmaps=!1}else b.texImage2D(b.TEXTURE_2D,0,da,V.width,V.height,0,P,N,V.data),T.releaseOnLoadedToGpu&&(V.data=null);else if(T instanceof WALK.CompressedTexture)for(ja=0,S=ua.length;ja<S;ja++)V=ua[ja],T.format!==GLC.RGBA&&T.format!==GLC.RGB?b.compressedTexImage2D(b.TEXTURE_2D,ja,da,V.width,V.height,0,V.data):b.texImage2D(b.TEXTURE_2D,ja,da,V.width,V.height,0,P,N,V.data),T.releaseOnLoadedToGpu&&(V.data=null);else if(0<ua.length&&ma){ja=0;for(S=ua.length;ja<S;ja++)V=ua[ja],b.texImage2D(b.TEXTURE_2D,
ja,da,P,N,V);T.releaseOnLoadedToGpu&&(T.mipmaps=null);T.generateMipmaps=!1}else b.texImage2D(b.TEXTURE_2D,0,da,P,N,T.image),T.releaseOnLoadedToGpu&&(T.image=null);T.generateMipmaps&&ma&&b.generateMipmap(b.TEXTURE_2D);T.needsUpdate=!1}function u(T){R.setBlending(T);R.setDepthTest(T.depthTest);R.setDepthWrite(T.depthWrite);R.setColorWrite(T.colorWrite)}function y(T,V,ma){if(ma){var P=ma;u(P);p(P)}for(var N=0,da=T.length;N<da;N+=1){var ua=T[N],ja=ua.geometry,S=ua.material;try{ma?ma.doNotOverrideSide&&
S&&p(S):(P=S,u(P),p(P));var sa=S=void 0,Ga=void 0,Ya=void 0,Za=void 0,Ca=P;if(!1!==Ca.visible&&0!==ja.vertexCnt){var na=V,Ea=Ca;console.assert(Ea instanceof WALK.BaseMaterial);Ea.programNeedsUpdate&&(E.assignProgramToMaterial(Ea),Ea.addEventListener("dispose",k),Ea.programNeedsUpdate=!1);console.assert(!Ea.morphTargets);var Ma=!1,Q=!1,oa=Ea.program,Aa=oa.transformUniformCache,Wa=Ea.uniforms;oa.id!==ba&&(b.useProgram(oa.program),ba=oa.id,Q=Ma=!0);Ea.id!==ta&&(ta=Ea.id,Q=!0);Ma&&(b.uniformMatrix4fv(Aa.projectionMatrix,
!1,na.projectionMatrix.elements),null!==Aa.cameraPosition&&(fa.setFromMatrixPosition(na.matrixWorld),b.uniform3f(Aa.cameraPosition,fa.x,fa.y,fa.z)),null!==Aa.viewMatrix&&b.uniformMatrix4fv(Aa.viewMatrix,!1,na.matrixWorldInverse.elements));if(Ma||ua.matrixWorld!==U){U=ua.matrixWorld;Ma=void 0;var Ra=Aa;ua.matrixWorld?(ya.multiplyMatrices(na.matrixWorldInverse,ua.matrixWorld),Ma=ya):Ma=na.matrixWorldInverse;b.uniformMatrix4fv(Ra.modelViewMatrix,!1,Ma.elements);Ra.normalMatrix&&(za.getNormalMatrix(Ma),
b.uniformMatrix3fv(Ra.normalMatrix,!1,za.elements));null!==Ra.modelMatrix&&(ua.matrixWorld?b.uniformMatrix4fv(Ra.modelMatrix,!1,ua.matrixWorld.elements):b.uniformMatrix4fv(Ra.modelMatrix,!1,qa))}Ea.refreshPerObjectUniforms&&Ea.refreshPerObjectUniforms(ua,Wa)&&(Q=!0);if(Q){var Pa=Ra=na=Ma=Q=Ea=void 0,db=void 0,Oa=void 0,cb=void 0,hb=void 0,ob=void 0,Da=void 0,L=void 0,ea=oa,va=Wa;L=ea.materialUniformCache.i;na=0;for(Ma=L.length;na<Ma;na+=1)Da=L[na],ob=Da.id,hb=va[ob].value,Da.value!==hb&&(b.uniform1i(Da.location,
hb),Da.value=hb);L=ea.materialUniformCache.f;na=0;for(Ma=L.length;na<Ma;na+=1)Da=L[na],ob=Da.id,hb=va[ob].value,Da.value!==hb&&(b.uniform1f(Da.location,hb),Da.value=hb);L=ea.materialUniformCache.v2;na=0;for(Ma=L.length;na<Ma;na+=1)if(Da=L[na],ob=Da.id,hb=va[ob].value,cb=hb.x,Oa=hb.y,Da.value[0]!==cb||Da.value[1]!==Oa)b.uniform2f(Da.location,cb,Oa),Da.value[0]=cb,Da.value[1]=Oa;L=ea.materialUniformCache.v3;na=0;for(Ma=L.length;na<Ma;na+=1)if(Da=L[na],ob=Da.id,hb=va[ob].value,cb=hb.x,Oa=hb.y,db=hb.z,
Da.value[0]!==cb||Da.value[1]!==Oa||Da.value[2]!==db)b.uniform3f(Da.location,cb,Oa,db),Da.value[0]=cb,Da.value[1]=Oa,Da.value[2]=db;L=ea.materialUniformCache.c;na=0;for(Ma=L.length;na<Ma;na+=1)if(Da=L[na],ob=Da.id,hb=va[ob].value,cb=hb.r,Oa=hb.g,db=hb.b,Da.value[0]!==cb||Da.value[1]!==Oa||Da.value[2]!==db)b.uniform3f(Da.location,cb,Oa,db),Da.value[0]=cb,Da.value[1]=Oa,Da.value[2]=db;L=ea.materialUniformCache.v4;na=0;for(Ma=L.length;na<Ma;na+=1)if(Da=L[na],ob=Da.id,hb=va[ob].value,cb=hb.x,Oa=hb.y,
db=hb.z,Pa=hb.w,Da.value[0]!==cb||Da.value[1]!==Oa||Da.value[2]!==db||Da.value[3]!==Pa)b.uniform4f(Da.location,cb,Oa,db,Pa),Da.value[0]=cb,Da.value[1]=Oa,Da.value[2]=db,Da.value[3]=Pa;L=ea.materialUniformCache.m4;na=0;for(Ma=L.length;na<Ma;na+=1)Da=L[na],ob=Da.id,b.uniformMatrix4fv(location,!1,va[ob].value.elements);L=ea.materialUniformCache.t;na=0;for(Ma=L.length;na<Ma;na+=1)if(Da=L[na],ob=Da.id,Ra=va[ob].value,Ra&&(Q=ka.setSlot(Ra,!0),Ea=Ra.__webglSlot,Da.value!==Ea&&(b.uniform1i(Da.location,Ea),Da.value=
Ea),Q||Ra.needsUpdate))if(Ra.isCube){if(Pa=Ra,b.activeTexture(b.TEXTURE0+Pa.__webglSlot),b.bindTexture(b.TEXTURE_CUBE_MAP,Pa.__webglTexture),Pa.needsUpdate){b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,Pa.flipY);var wa=Pa instanceof WALK.CompressedTexture,Ja=Pa.image,Sa=Pa.format,Ua=Pa.type,fb=c(Sa,Ua);l(b.TEXTURE_CUBE_MAP,Pa);for(db=0;6>db;db++)if(wa){var mb=Ja[db].mipmaps;Oa=0;for(var yb=mb.length;Oa<yb;Oa++){var jb=mb[Oa];Pa.format!==GLC.RGBA&&Pa.format!==GLC.RGB?b.compressedTexImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+
db,Oa,fb,jb.width,jb.height,0,jb.data):b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+db,Oa,fb,jb.width,jb.height,0,Sa,Ua,jb.data);Pa.releaseOnLoadedToGpu&&(jb.data=null)}}else b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+db,0,fb,Sa,Ua,Ja[db]),Pa.releaseOnLoadedToGpu&&(Ja[db]=null);Pa.generateMipmaps&&b.generateMipmap(b.TEXTURE_CUBE_MAP);Pa.needsUpdate=!1}}else Pa=Ra,Pa.needsUpdate?w(Pa):(b.activeTexture(b.TEXTURE0+Pa.__webglSlot),b.bindTexture(b.TEXTURE_2D,Pa.__webglTexture));ka.unlockAllSlots()}var ub=
oa;Ea=!1;if(ja.id!==I||ub.id!==ba)I=ja.id,Ea=!0;console.assert(ua instanceof G.Mesh);var Gb=b.TRIANGLES,zb=ja.attributes.index;if(zb){var Hb=zb.glType;Za=ja.indexUint?4:2;Ea&&(h(Ca,ub,ja),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,zb.buffer));void 0!==ja.indexOffset?(Ya=ja.indexCnt,Ga=Za*ja.indexOffset):(Ya=zb.length,Ga=0);ja.isInstanced?b.drawElementsInstanced(Gb,Ya,Hb,Ga,ja.instanceCount):b.drawElements(Gb,Ya,Hb,Ga)}else{Ea&&h(Ca,ub,ja);var ie=ja.attributes.position;void 0!==ja.vertexOffset?(sa=ja.vertexCnt,
S=ja.vertexOffset):(sa=ie.length/ie.itemSize,S=0);ja.isInstanced?b.drawArraysInstanced(Gb,S,sa,ja.instanceCount):b.drawArrays(Gb,S,sa)}ia&&R.resetAttributeDivisors()}}catch(Rc){console.error("Failed to render material "+(P?P.name:"null")+": "+Rc.stack)}}}function B(T,V){b.bindRenderbuffer(b.RENDERBUFFER,T);V.depthBuffer?(b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_STENCIL,V.width,V.height),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.RENDERBUFFER,T)):b.renderbufferStorage(b.RENDERBUFFER,
b.RGBA4,V.width,V.height)}function D(T,V){V.addEventListener("dispose",g);V.__webglTexture=b.createTexture();var ma=V.format,P=V.type,N=c(ma,P);ka.setSlot(V,!1);b.activeTexture(b.TEXTURE0+V.__webglSlot);if(T){b.bindTexture(b.TEXTURE_CUBE_MAP,V.__webglTexture);l(b.TEXTURE_CUBE_MAP,V);for(T=0;6>T;T++){V.__webglFramebuffer[T]=b.createFramebuffer();V.__webglRenderbuffer[T]=b.createRenderbuffer();b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+T,0,N,V.width,V.height,0,ma,P,null);var da=b.TEXTURE_CUBE_MAP_POSITIVE_X+
T,ua=V.__webglTexture;b.bindFramebuffer(b.FRAMEBUFFER,V.__webglFramebuffer[T]);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,da,ua,0);B(V.__webglRenderbuffer[T],V)}V.generateMipmaps&&b.generateMipmap(b.TEXTURE_CUBE_MAP)}else V.__webglFramebuffer=b.createFramebuffer(),V.__webglRenderbuffer=V.shareDepthFrom?V.shareDepthFrom.__webglRenderbuffer:b.createRenderbuffer(),b.bindTexture(b.TEXTURE_2D,V.__webglTexture),l(b.TEXTURE_2D,V),b.texImage2D(b.TEXTURE_2D,0,N,V.width,V.height,0,ma,P,null),
ma=b.TEXTURE_2D,P=V.__webglTexture,b.bindFramebuffer(b.FRAMEBUFFER,V.__webglFramebuffer),b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,ma,P,0),V.shareDepthFrom?V.depthBuffer&&b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.RENDERBUFFER,V.__webglRenderbuffer):B(V.__webglRenderbuffer,V),V.generateMipmaps&&b.generateMipmap(b.TEXTURE_2D);b.bindRenderbuffer(b.RENDERBUFFER,null);b.bindFramebuffer(b.FRAMEBUFFER,null)}var H=new G.Color(0),K=0,J=[],W=[];this.domElement=a;this.sortObjects=
this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;var M=this,ba,ha,ta,I,U,ia,R,E,Y=new WALK.Frustum,X=new G.Matrix4,fa=new G.Vector3;d();xe(b,WALK.DETECTOR);this.webGLContextRestored=function(){d()};this.context=b;this.state=R;var ka=ye(b),qa=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setCanvasSize=function(T,V){a.width=T;a.height=V;null===ha&&this.setViewport(0,0,T,V)};this.setViewport=function(T,V,ma,P){R.setViewport(T,V,ma,P)};this.setScissor=function(T,
V,ma,P){b.scissor(T,V,ma,P)};this.enableScissorTest=function(T){T?b.enable(b.SCISSOR_TEST):b.disable(b.SCISSOR_TEST)};this.setClearColor=function(T,V){H.copy(T);K=void 0!==V?V:1;b.clearColor(H.r,H.g,H.b,K)};this.getClearColor=function(){return H};this.getClearAlpha=function(){return K};this.clear=function(T,V,ma){var P=0;T&&(P|=b.COLOR_BUFFER_BIT);V&&(P|=b.DEPTH_BUFFER_BIT);ma&&(P|=b.STENCIL_BUFFER_BIT);b.clear(P)};this.clearColor=function(){b.clear(b.COLOR_BUFFER_BIT)};this.clearDepth=function(){b.clear(b.DEPTH_BUFFER_BIT)};
this.clearStencil=function(){b.clear(b.STENCIL_BUFFER_BIT)};this.deallocateRenderTargetRenderingBuffers=function(T){if(T.isCube)for(var V=0;6>V;V++)b.deleteFramebuffer(T.__webglFramebuffer[V]),b.deleteRenderbuffer(T.__webglRenderbuffer[V]);else b.deleteFramebuffer(T.__webglFramebuffer),b.deleteRenderbuffer(T.__webglRenderbuffer);T.__webglFramebuffer=null;T.__webglRenderbuffer=null};var ya=new G.Matrix4,za=new G.Matrix3;this.setRenderTarget=function(T){if(T){var V=T.isCube?T.__webglFramebuffer[T.activeCubeFace]:
T.__webglFramebuffer;var ma=T.x;var P=T.y;var N=T.width;T=T.height}else V=null,P=ma=0,N=a.width,T=a.height;V!==ha&&(b.bindFramebuffer(b.FRAMEBUFFER,V),ha=V);R.setViewport(ma,P,N,T)};this.render=function(T,V,ma,P){this.renderMeshes(T.children,T.overrideMaterial,V,ma,P)};this.renderMeshes=function(T,V,ma,P,N,da){I=null;ta=-1;U=ba=null;ma.matrixWorldInverse.getInverse(ma.matrixWorld);X.multiplyMatrices(ma.projectionMatrix,ma.matrixWorldInverse);Y.setFromMatrix(X);J.length=0;W.length=0;da=void 0===da?
!1:da;for(var ua=0;ua<T.length;ua+=1)v(T[ua],V,da);!0===M.sortObjects&&(J.sort(n),W.sort(r));this.setRenderTarget(P);(this.autoClear||N)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);y(J,ma,V);y(W,ma,V);P&&P.generateMipmaps&&(T=ka.setSlot(P,!1),b.activeTexture(b.TEXTURE0+P.__webglSlot),P.isCube?(T&&b.bindTexture(b.TEXTURE_CUBE_MAP,P.__webglTexture),b.generateMipmap(b.TEXTURE_CUBE_MAP)):(T&&b.bindTexture(b.TEXTURE_2D,P.__webglTexture),b.generateMipmap(b.TEXTURE_2D)));R.setDepthTest(!0);
R.setDepthWrite(!0);R.setColorWrite(!0);R.resetAttributeStates()};this.uploadNewBuffers=function(T){var V=T.geometry;T=V.attributes;var ma=V.attributesKeys;void 0===V.__webglInit&&(V.__webglInit=!0,V.addEventListener("dispose",e));console.assert(V instanceof G.BufferGeometry);V=0;for(var P=ma.length;V<P;V+=1){var N=ma[V],da=T[N];N="index"===N?b.ELEMENT_ARRAY_BUFFER:b.ARRAY_BUFFER;if(da.buffer)!0===da.needsUpdate&&console.assert(!1);else{da.buffer=b.createBuffer();b.bindBuffer(N,da.buffer);var ua=
da.array;WALK.DETECTOR.ios&&N===b.ARRAY_BUFFER&&console.assert(0===da.itemSize*ua.BYTES_PER_ELEMENT%4);b.bufferData(N,ua,b.STATIC_DRAW);ua instanceof Float32Array?da.glType=b.FLOAT:ua instanceof Int8Array?da.glType=b.BYTE:ua instanceof Int16Array?da.glType=b.SHORT:ua instanceof Uint16Array?da.glType=b.UNSIGNED_SHORT:ua instanceof Uint32Array?da.glType=b.UNSIGNED_INT:console.assert(!1);da.releaseOnLoadedToGpu&&(da.array=null);da.needsUpdate=!1}}};this.uploadTexture=function(T){ka.setSlot(T,!1);w(T)};
this.copyBufferToCubeFaceMip=function(T,V,ma,P,N){ka.setSlot(N,!1);b.activeTexture(b.TEXTURE0+N.__webglSlot);b.bindTexture(b.TEXTURE_CUBE_MAP,N.__webglTexture);b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+ma,T,b.RGBA,V,V,0,b.RGBA,b.UNSIGNED_BYTE,P)};this.createCubeTexture=function(T,V){var ma=new WALK.Texture;ma.isCube=!0;ma.minFilter=V?GLC.LINEAR_MIPMAP_NEAREST:GLC.LINEAR;ma.generateMipmaps=!1;ma.needsUpdate=!1;ma.addEventListener("dispose",f);ma.__webglTexture=b.createTexture();ka.setSlot(ma,!1);
b.activeTexture(b.TEXTURE0+ma.__webglSlot);b.bindTexture(b.TEXTURE_CUBE_MAP,ma.__webglTexture);b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,!1);b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_MAG_FILTER,b.LINEAR);V?b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_MIN_FILTER,b.LINEAR_MIPMAP_NEAREST):b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_MIN_FILTER,b.LINEAR);for(var P=0;6>
P;P+=1)b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+P,0,b.RGBA,T,T,0,b.RGBA,b.UNSIGNED_BYTE,null);V&&b.generateMipmap(b.TEXTURE_CUBE_MAP);return ma};this.createFrameBufferRenderTarget=function(T){return new WALK.WebGLRenderTargetVR(T)};this.createRenderTarget=function(T,V,ma){T=new WALK.WebGLRenderTarget(T,V,ma);D(!1,T);return T};this.createRenderTargetCube=function(T,V,ma){T=new WALK.WebGLRenderTargetCube(T,V,ma);D(!0,T);return T};this.readPixels=function(T,V,ma){b.readPixels(0,0,T,V,b.RGBA,b.UNSIGNED_BYTE,
ma)}};var Ae={minFilter:GLC.LINEAR,magFilter:GLC.LINEAR,format:GLC.RGBA,stencilBuffer:!1,generateMipmaps:!1};
function Be(a,b){void 0===b.alpha&&(b.alpha=!0);void 0===b.depth&&(b.depth=!0);void 0===b.stencil&&(b.stencil=!1);void 0===b.premultipliedAlpha&&(b.premultipliedAlpha=!0);void 0===b.antialias&&(b.antialias=!0);void 0===b.preserveDrawingBuffer&&(b.preserveDrawingBuffer=!1);try{var c=(WALK.FORCE_WEBGL1?null:a.getContext("webgl2",b))||a.getContext("webgl",b)||a.getContext("experimental-webgl",b)}catch(d){c=null}b=c;if(!b)return null;WALK.DETECTOR.resetGlDetector(b);WALK.DETECTOR.gl.reportToConsole();
return new ze(a,b)}function Ce(a){if(a=Be(a,{antialias:!WALK.FORCE_FXAA}))a.autoClear=!0,a.autoClearColor=!1,a.autoClearDepth=!0,a.autoClearStencil=!1,a.sortObjects=!0;return a}
function De(a,b,c,d){var e=null,f,g,k=c.camera,h=c.threeScene,l=function(){var n=new WALK.Frustum,r=new G.Matrix4;return function(v){if(0!==c.mirrors.length){v.matrixWorldInverse.getInverse(v.matrixWorld);r.multiplyMatrices(v.projectionMatrix,v.matrixWorldInverse);n.setFromMatrix(r);for(var p=0;p<c.mirrors.length;p+=1){var w=c.mirrors[p];w.updateCameraPosition(v,n);w.inFrustum()&&w.render(a)}}}}();this.resize=function(n){if(!n){var r=window.innerWidth;var v=window.innerHeight;var p=r*window.devicePixelRatio;
var w=v*window.devicePixelRatio;k.aspect=p/w;k.updateProjectionMatrix();a.setCanvasSize(p,w);a.domElement.style.width=r+"px";a.domElement.style.height=v+"px";f&&(f.configureTarget(p,w,Ae),g.setTargets(f.renderTarget1,f.renderTarget2));e&&e.uniforms.resolution.value.set(1/p,1/w)}r=w;n?(n=p/2,p=70):(n=p,p=k.fov);v=n/r;for(w=0;w<c.mirrors.length;w+=1)c.mirrors[w].configure(n,r,v,p)};this.renderIdle=function(n,r){0===r&&(d.adaptExposure(),g&&g.reset());if(d.exposureNeedsUpdate())return this.renderToScreen(n,
!1),!0;if(!g)return!1;g.renderSample();4<=g.renderedSamplesCount()&&g.renderAccumulatedSamplesToScreen();return!g.allSamplesRendered()};this.renderToScreen=function(n,r){d.update(n);r?b.render(h,k.matrixWorld,l):(l(k),e?f.render(n):a.render(h,k))};this.enableAutoExposure=function(){d.enableAutoExposure()};this.disableAutoExposure=function(){d.disableAutoExposure()};(function(){if(WALK.DETECTOR.gl.antialiasPostprocess){f=new G.EffectComposer(a);if(!WALK.DETECTOR.gl.antialiasNative){WALK.log("using FXAA");
a.autoClear=!1;e=new G.ShaderPass(G.FXAAShader);e.clear=!1;e.renderToScreen=!0;e.material.depthTest=!1;e.material.depthWrite=!1;e.uniforms.resolution.value.set(1/window.innerWidth,1/window.innerHeight);var n=new G.RenderPass(h,k);f.addPass(n);f.addPass(e)}g=new he(a,c)}})()};function Ee(){WALK.BaseMaterial.call(this,WALK.getShader("static_render_vertex.glsl"),WALK.getShader("static_render_fragment.glsl"));this.uniforms={staticRender:{type:"t",value:null},sizeInv:{type:"v2",value:new G.Vector2}}}Ee.prototype=Object.create(WALK.BaseMaterial.prototype);Ee.prototype.constructor=Ee;function Fe(a){a=Be(a,{antialias:!1});a.autoClear=!1;a.autoUpdateObjects=!1;a.sortObjects=!1;return a}
WALK.StaticRenderViewer=function(a){var b=Fe(a),c=new Ee,d=new G.OrthographicCamera(-1,1,1,-1,0,1),e=new G.Scene;a=new G.Mesh(new G.PlaneBufferGeometry(2,2),c);b.uploadNewBuffers(a);e.add(a);this.update=function(f){var g=new Float32Array(f,0,f.byteLength/4);f=g[0];var k=g[1];g=g.subarray(2);console.assert(f*k===g.length/3);g=new WALK.DataTexture(g,f,k,GLC.RGB,GLC.FLOAT);g.minFilter=GLC.NEAREST;g.magFilter=GLC.NEAREST;g.generateMipmaps=!1;g.flipY=!1;g.needsUpdate=!0;c.uniforms.staticRender.value=g;
c.uniforms.sizeInv.value.set(1/f,1/k);b.setCanvasSize(f,k);b.render(e,d);g.dispose()}};WALK.VRManager=function(a,b,c,d,e,f,g){function k(){return WALK.DETECTOR.ios&&void 0!==DeviceMotionEvent&&"function"===typeof DeviceMotionEvent.requestPermission&&void 0!==DeviceOrientationEvent&&"function"===typeof DeviceOrientationEvent.requestPermission?new Promise(function(M,ba){Promise.all([DeviceMotionEvent.requestPermission(),DeviceOrientationEvent.requestPermission()]).then(function(ha){"granted"===ha[0]&&"granted"===ha[1]?M():ba()},function(){ba()})}):Promise.resolve()}function h(){v=null;
K.dispose();w=p=y=K=null;b.removeAllXrGamepads();g(!1);if(H){var M=H;H=null;M()}}function l(M){for(var ba=m.makeIterator(M.removed),ha=ba.next();!ha.done;ha=ba.next())ha=ha.value,ha.gamepad&&b.removeXrGamepad(ha.gamepad);M=m.makeIterator(M.added);for(ha=M.next();!ha.done;ha=M.next())ba=ha.value,ba.gamepad&&b.addXrGamepad(ba.gamepad,ba.handedness)}var n=navigator.xr,r=c?!c.nativeWebXR:!1,v,p,w,u=!1,y,B,D,H=null,K,J=new G.Matrix4,W=WALK.CAMERA_MIN_FAR;this.setCameraFar=function(M){W=M;v&&(y.depthFar=
W,v.updateRenderState(y))};this.render=function(M,ba,ha){D.set(!1,!0,!1);B.matrixWorld=ba;ba=B.projectionMatrix;for(var ta=w.views,I=0;I<ta.length;++I){var U=ta[I];J.fromArray(U.transform.inverse.matrix);ba.fromArray(w.transform.matrix);J.multiply(ba);ba.fromArray(U.projectionMatrix);ba.multiply(J);ha(B);a.enableScissorTest(!0);U=y.baseLayer.getViewport(U);a.setScissor(U.x,U.y,U.width,U.height);K.x=U.x;K.y=U.y;K.width=U.width;K.height=U.height;a.render(M,B,K);a.enableScissorTest(!1)}D.restore()};
this.enableVr=function(M){n?u?(f(!0),k().then(function(){return M.makeXRCompatible().then(function(){return navigator.xr.requestSession("immersive-vr",{requiredFeatures:["local-floor"]})}).then(function(ba){v=ba;return v.requestReferenceSpace("local-floor")}).then(function(ba){p=ba;ba=new XRWebGLLayer(v,M);K=a.createFrameBufferRenderTarget(ba.framebuffer);y={baseLayer:ba};B||(B=new G.PerspectiveCamera,D=new be(a));y.depthNear=WALK.CAMERA_WALK_NEAR;y.depthFar=W;v.updateRenderState(y);v.addEventListener("end",
h);r||v.addEventListener("inputsourceschange",l);f(!1);g(!0)}).catch(function(){f(!1);WALK.USER_MSG.info("Failed to enable VR mode")})}).catch(function(){f(!1);WALK.USER_MSG.info("Permissions necessary for VR mode not granted")})):WALK.USER_MSG.info("VR device not connected"):WALK.USER_MSG.info('You need a <a href="https://mozvr.com/#start" target="_blank">VR ready browser</a>.')};this.disableVr=function(){v.end().then(function(){WALK.USER_MSG.hideInfo()},function(){WALK.USER_MSG.info("Failed to exit VR mode")})};
this.vrEnabled=function(){return!!p};this.requestAnimationFrame=function(){function M(ba,ha){w=ha.getViewerPose(p);H&&(ha=H,H=null,ha(ba))}return function(ba){H=ba;v.requestAnimationFrame(M)}}();this.update=function(){var M=new WALK.Euler,ba=new G.Vector3;return function(){if(w){var ha=w.transform;if(null!==ha.orientation){M.setFromQuaternion(ha.orientation,"YXZ");var ta=M.y;M.y=-M.z;M.z=ta;ha=ha.position;e(M,ha&&ba.set(ha.x,-ha.z,ha.y,ha.w))}}}}();(WALK.DETECTOR.https||WALK.DETECTOR.localhost)&&
n?(c=function(){navigator.xr.isSessionSupported("immersive-vr").then(function(M){u=M;d(M)})},c(),navigator.xr.addEventListener("devicechange",c,!1)):d(!1)};WALK.RaycasterConfig=function(a,b,c){this.ray=new G.Ray(a,b);this.far=c||Infinity;this.ignoreVisibility=this.onlyGroundCollisions=this.respectColliderSettings=!1};WALK.RayIntersection=function(){this.distance=Infinity;this.point=new G.Vector3;this.object=null};
WALK.GpuRaycaster=function(a,b){function c(r,v){if(!v.ignoreVisibility&&!r.visible)return!1;var p=r.node||n;if(p.disableCollisions&&v.respectColliderSettings||!p.ground&&v.onlyGroundCollisions)return!1;p=v.ray;if(r.matrixWorld)return!0;var w=r.geometry.boundingSphere;if(w.distanceToPoint(p.origin)>v.far||!1===p.isIntersectionSphere(w))return!1;r=r.geometry.boundingBox;return r.distanceToPoint(p.origin)>v.far||!p.isIntersectionBox(r)?!1:!0}var d=a.createRenderTarget(1,1,{format:GLC.RGBA,magFilter:GLC.NEAREST,
minFilter:GLC.NEAREST,stencilBuffer:!1,depthBuffer:!0,generateMipmaps:!1}),e=new Uint8Array(4),f=new be(a),g=new ae(a),k=new G.Color(16777215),h=new WALK.ObjectDistanceMaterial(!1),l=new G.PerspectiveCamera(1,1,b.near,b.far),n={disableCollisions:!1,ground:!1};this.closestIntersection=function(r,v,p){for(var w=[],u=0;u<r.length;u+=1){var y=r[u];console.assert(null===y.visibilityId);c(y,v)&&(y.visibilityId=w.length,w.push(y))}if(0===w.length)return!1;l.position.set(0,0,0);l.lookAt(v.ray.direction);
l.position.copy(v.ray.origin);l.updateMatrixWorld();f.set(!0,!0,!1);g.set(k);r=a.sortObjects;a.sortObjects=!1;a.renderMeshes(w,h,l,d,!1,v.ignoreVisibility);a.sortObjects=r;g.restore();f.restore();a.readPixels(1,1,e);a.setRenderTarget(null);r=256*e[0]+e[1];u=e[2]+e[3]/255;for(y=0;y<w.length;y+=1)w[y].visibilityId=null;if(65535===r||u>v.far)return!1;console.assert(r<w.length);p.object=w[r];p.distance=u;p.point.copy(v.ray.direction).multiplyScalar(u).add(v.ray.origin);return!0}};WALK.movePointTowards=function(){var a=new G.Vector3;return function(b,c,d){a.copy(b);a.sub(c).normalize();a.multiplyScalar(d);return b.sub(a)}}();
WALK.Collider=function(a,b,c){var d=this,e=new G.Octree({scene:null,depthMax:Infinity,objectsThreshold:8,overlapPct:.15}),f=c.cameraWorldPosition(),g=b.camera,k=[];this.addStaticObstacle=function(r,v,p){e.add(r,v,p)};this.addDynamicObstacle=function(r){k.push(r)};this.removeDynamicObstacle=function(r){WALK.removeFromArray(r,k)};var h=function(){var r=new WALK.GpuRaycaster(a,g);return function(v,p){for(var w=e.search(v.ray.origin,v.far,v.ray.direction),u=0;u<k.length;u+=1)w.push(k[u]);return r.closestIntersection(w,
v,p)?!0:!1}}(),l=function(){var r=new WALK.RayIntersection;return function(v){return h(v,r)?r.distance:Infinity}}(),n=function(){var r=new WALK.RaycasterConfig;r.ray.direction.set(0,0,-1);r.respectColliderSettings=!0;r.onlyGroundCollisions=g.autoClimb;return function(v,p){r.ray.origin.copy(v);r.far=p;v=l(r);return g.autoClimb||1<=v?v:Infinity}}();this.distanceToGround=function(r){return n(f,r)};this.distanceFrom=function(n){return l(n)};this.findIntersectionBelow=function(){var r=new WALK.RaycasterConfig;r.ray.direction.set(0,0,-1);r.respectColliderSettings=
!1;return function(v,p,w){r.ray.origin.copy(v);r.far=p;return h(r,w)}}();this.distanceToCeiling=function(){var r=new WALK.RaycasterConfig(f);r.ray.direction.set(0,0,1);r.respectColliderSettings=!0;return function(v){r.far=v;return l(r)}}();this.distanceToCeilingFrom=function(){var r=new WALK.RaycasterConfig;r.ray.direction.set(0,0,1);r.respectColliderSettings=!0;return function(v,p){r.ray.origin.copy(v);r.far=p;return l(r)}}();this.cameraHeightFromPoint=function(r){r=n(r,WALK.MAX_GROUND_SEARCH_DEPTH);
return Infinity===r?null:r};this.adjustPointToMatchCameraHeight=function(r){var v=g.fixedHeight||WALK.CAMERA_FIXED_HEIGHT||c.cameraHeight;if(null===v)return!1;var p=n(r,WALK.MAX_GROUND_SEARCH_DEPTH);if(Infinity===p)return!1;v-=p;if(.01>Math.abs(v)||0<v&&Infinity!==this.distanceToCeilingFrom(r,v+WALK.MIN_DISTANCE_TO_CEILING))return!1;r.z+=v;return!0};this.findIntersectionAtPosition=function(){var r=new WALK.RaycasterConfig(f),v=r.ray.direction;return function(p,w,u,y){v.set(p,w,1).unproject(c.camera());
v.sub(f).normalize();r.respectColliderSettings=u;return h(r,y)}}();this.findObstacleMeshAtPosition=function(){var r=new WALK.RayIntersection;return function(v,p,w){return this.findIntersectionAtPosition(v,p,w,r)?r.object:null}}();this.findMeshFromListAtPosition=function(){var r=new WALK.RaycasterConfig(f),v=new WALK.RayIntersection,p=new WALK.GpuRaycaster(a,g),w=r.ray.direction;return function(u,y,B,D,H){r.ignoreVisibility=void 0===D?!1:D;D=void 0===H?v:H;w.set(y,B,1).unproject(g);w.sub(f).normalize();
return p.closestIntersection(u,r,D)?D.object:null}}();this.clickedPointToMoveTarget=function(){function r(B){var D=p.x-y.x;var H=p.y-y.y;D=Math.sqrt(D*D+H*H);v.far=D+WALK.CLICK_MOVE_MIN_DISTANCE_TO_OBSTACLE;w.x=y.x-p.x;w.y=y.y-p.y;if(!(.01>Math.abs(w.x)&&.01>Math.abs(w.y)))if(w.z=0,w.normalize(),h(v,u)){if(H=u.distance-WALK.CLICK_MOVE_MIN_DISTANCE_TO_OBSTACLE,0<H&&(B.x=p.x+w.x*H,B.y=p.y+w.y*H,B.z=p.z),H=Math.min(u.distance-.01,D),p.x+=w.x*H,p.y+=w.y*H,d.adjustPointToMatchCameraHeight(p))return r(B)}else B.x=
y.x,B.y=y.y,B.z=p.z}var v=new WALK.RaycasterConfig;v.respectColliderSettings=!0;var p=v.ray.origin,w=v.ray.direction,u=new WALK.RayIntersection,y=new G.Vector3;return function(B){p.copy(f);y.copy(B);B.copy(f);r(B);d.adjustPointToMatchCameraHeight(B)}}();this.movePointTowardsTheCamera=function(r,v){return WALK.movePointTowards(r,f,v)};this.handleCollisions=function(){function r(B){c.applyCameraYaw(p);p.normalize();var D=w.start.distanceTo(f),H=w.end.distanceTo(f);if(y-.02<D+H&&D+H<y+.02&&H>=B&&u.equals(p))return!1;
D=l(v);Infinity===D&&(D=v.far);u.copy(p);w.start.copy(f);w.end.copy(p).multiplyScalar(D).add(f);y=w.distance();return D<B}var v=new WALK.RaycasterConfig(f),p=v.ray.direction,w=new G.Line3,u=new G.Vector3,y=0;v.respectColliderSettings=!0;v.far=5;console.assert(v.far>WALK.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE);return function(B){B=c.maxFrameMoveLinearDistance(B)+WALK.KEY_MOVE_MIN_DISTANCE_TO_OBSTACLE;c.movesForward()&&(p.set(0,1,0),r(B)&&c.stopForward());c.movesBackward()&&(p.set(0,-1,0),r(B)&&c.stopBackward());
c.movesLeft()&&(p.set(-1,0,0),r(B)&&c.stopLeft());c.movesRight()&&(p.set(1,0,0),r(B)&&c.stopRight());c.movesDown()&&(p.set(0,0,-1),r(B)&&c.stopDown());c.movesUp()&&(p.set(0,0,1),r(B)&&c.stopUp())}}()};WALK.OrbitControls=function(a,b,c,d){function e(N,da){p.collider&&p.mouseZoomToPointer&&p.collider.findIntersectionAtPosition(N/window.innerWidth*2-1,2*-(da/window.innerHeight)+1,!0,u)?ta.copy(u.point):ta.copy(p.target)}function f(){var N=b.getYawAngle(),da=b.getPitchAngle(),ua=b.cameraWorldPosition();p.autoRotate&&ma===V.NONE&&p.rotateLeft(2*Math.PI/60/60*p.autoRotateSpeed);var ja=p.getMinYawAngle(),S=p.getMaxYawAngle();Math.abs(S-ja)>=2*Math.PI-1E-6?N+=R:ja===S?N=ja:(ja>S&&(S+=2*Math.PI,N<ja&&(N+=
2*Math.PI)),N=0>R?Math.min(Math.max(N+R,ja),S):Math.max(Math.min(N+R,S),ja));da=G.Math.clamp(da+E,p.getMinPitchAngle(),p.getMaxPitchAngle());I.copy(p.target).sub(ua);S=I.length();ja=G.Math.clamp(S*Y,p.getMinDistance(),p.getMaxDistance());S=ja/S;U.copy(ta).sub(ua);ia.copy(ta).sub(p.target).multiplyScalar(1-S);p.target.add(ia);p.target.add(X);WALK.OrbitControls.computeCameraPosition(ua,p.target,N,da,ja);b.cameraPositionUpdated();b.setYawAngle(N);b.setPitchAngle(da);N=WALK.OrbitControls.computeCameraNear(ja);
1E-6<Math.abs(N-a.near)&&(a.near=N,a.updateProjectionMatrix());E=R=0;Y=1;X.set(0,0,0);d.requestFrame()}function g(){za=T=qa=ya=ka=0;P&&(P(),P=!1)}function k(N){if(!1!==w){N.preventDefault();var da=c===document?c.body:c;if(ma===V.ROTATE){if(!0===p.noRotate)return;B.set(N.clientX,N.clientY);D.subVectors(B,y);p.rotateLeft(D.x/da.clientWidth*p.mouseRotateSpeed);!1===p.noPitchRotate&&p.rotateUp(D.y/da.clientHeight*p.mouseRotateSpeed);y.copy(B)}else if(ma===V.DOLLY){if(!0===p.noZoom)return;ba.set(N.clientX,
N.clientY);ha.subVectors(ba,M);0<ha.y?p.dollyIn():0>ha.y&&p.dollyOut();M.copy(ba)}else if(ma===V.PAN){if(!0===p.noPan)return;K.set(N.clientX,N.clientY);J.subVectors(K,H);p.pan(J.x/da.clientHeight,J.y/da.clientWidth);H.copy(K)}ma!==V.NONE&&f()}}function h(){!1!==w&&P&&(P(),P=!1)}function l(N){if(!1!==w&&!0!==p.noZoom&&ma===V.NONE){N.preventDefault();var da=0;void 0!==N.wheelDelta?da=N.wheelDelta:void 0!==N.detail&&(da=-N.detail);e(N.clientX,N.clientY);0<da?p.dollyOut():0>da&&p.dollyIn();f()}}function n(N,
da,ua){return!0===ua?da:N===da?0:N}function r(N,da){var ua=!1,ja=N.keyCode;if(!1!==w){if(!0===fa&&!1===p.noPan)if(38===ja||87===ja)T=n(T,1,da),ua=!0;else if(40===ja||83===ja)T=n(T,-1,da),ua=!0;else if(37===ja||65===ja)za=n(za,1,da),ua=!0;else{if(39===ja||68===ja)za=n(za,-1,da),ua=!0}else if(!1===fa&&!1===p.noRotate)if((38===ja||87===ja)&&!1===p.noPitchRotate)ya=n(ya,1,da),ua=!0;else if((40===ja||83===ja)&&!1===p.noPitchRotate)ya=n(ya,-1,da),ua=!0;else if(37===ja||65===ja)qa=n(qa,1,da),ua=!0;else if(39===
ja||68===ja)qa=n(qa,-1,da),ua=!0;switch(ja){case p.dollyKeys.IN1:case p.dollyKeys.IN2:case p.dollyKeys.IN3:!1===p.noZoom&&(ka=n(ka,1,da),ua=!0);break;case p.dollyKeys.OUT1:case p.dollyKeys.OUT2:case p.dollyKeys.OUT3:!1===p.noZoom&&(ka=n(ka,-1,da),ua=!0)}ua&&(N.preventDefault(),d.requestFrame())}}function v(N){return p.noPan?!1:fa&&1===N.length?!0:fa||2!==N.length?!1:Math.abs(N[0].clientY-N[1].clientY)<=WALK.MAX_TWO_POINTERS_IN_LINE_DIFF}this.collider=null;this.target=new G.Vector3;this.noZoom=!1;
this.mouseZoomToPointer=!0;this.mouseZoomSpeed=.97;this.keyZoomSpeed=.7;this.minZoom=0;this.maxZoom=Infinity;this.noPitchRotate=this.noRotate=!1;this.mouseRotateSpeed=2*Math.PI;this.keyYawRotateSpeed=WALK.CAMERA_ARROWS_TURN_SPEED;this.keyPitchRotateSpeed=WALK.CAMERA_ARROWS_TURN_SPEED/2;this.autoRotate=!1;this.autoRotateSpeed=2;this.getMinPitchAngle=function(){return-Math.PI/2};this.getMaxPitchAngle=function(){return Math.PI/2};this.getMinYawAngle=function(){return-Math.PI};this.getMaxYawAngle=function(){return Math.PI};
this.getMinDistance=function(){return 0};this.getMaxDistance=function(){return Infinity};this.noPan=!1;this.keyPanSpeed=.25;this.dollyKeys={IN1:61,IN2:187,IN3:69,OUT1:173,OUT2:189,OUT3:81};this.primaryMouseButton=G.MOUSE.LEFT;this.secondaryMouseButton=G.MOUSE.RIGHT;this.mouseButtons={ROTATE:this.primaryMouseButton,ZOOM:G.MOUSE.MIDDLE,PAN:this.secondaryMouseButton};var p=this,w=!1,u=new WALK.RayIntersection,y=new G.Vector2,B=new G.Vector2,D=new G.Vector2,H=new G.Vector2,K=new G.Vector2,J=new G.Vector2,
W=new G.Vector3,M=new G.Vector2,ba=new G.Vector2,ha=new G.Vector2,ta=new G.Vector3,I=new G.Vector3,U=new G.Vector3,ia=new G.Vector3,R=0,E=0,Y=1,X=new G.Vector3,fa=!1,ka=0,qa=0,ya=0,za=0,T=0,V={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},ma=V.NONE,P=!1;this.enable=function(){w=!0;f()};this.disable=function(){w=!1;g()};this.isEnabled=function(){return w};this.setPanPrimary=function(N){fa=N;!0===fa?(this.mouseButtons.PAN=this.primaryMouseButton,this.mouseButtons.ROTATE=this.secondaryMouseButton):
(this.mouseButtons.ROTATE=this.primaryMouseButton,this.mouseButtons.PAN=this.secondaryMouseButton)};this.getCameraDistance=function(){var N=new G.Vector3;return function(){N.copy(b.cameraWorldPosition()).sub(this.target);return N.length()}}();this.rotateLeft=function(N){void 0===N&&(N=2*Math.PI/60/60*p.autoRotateSpeed);R-=N};this.rotateUp=function(N){void 0===N&&(N=2*Math.PI/60/60*p.autoRotateSpeed);E-=N};this.panLeft=function(N){var da=a.matrixWorld.elements;W.set(da[0],da[1],da[2]);W.multiplyScalar(-N);
X.add(W)};this.panUp=function(N){var da=a.matrixWorld.elements;W.set(da[4],da[5],da[6]);W.multiplyScalar(N);X.add(W)};this.pan=function(N,da){if(a instanceof G.PerspectiveCamera){var ua=b.cameraWorldPosition().clone().sub(p.target).length();ua*=Math.tan(a.fov/2*Math.PI/180);p.panLeft(2*N*ua);p.panUp(2*da*ua)}else a instanceof G.OrthographicCamera&&(p.panLeft(N*(a.right-a.left)),p.panUp(da*(a.top-a.bottom)))};this.dollyIn=function(N){void 0===N&&(N=this.mouseZoomSpeed);a instanceof G.PerspectiveCamera?
Y/=N:a instanceof G.OrthographicCamera&&(a.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,a.zoom*N)),a.updateProjectionMatrix())};this.dollyOut=function(N){void 0===N&&(N=this.mouseZoomSpeed);a instanceof G.PerspectiveCamera?Y*=N:a instanceof G.OrthographicCamera&&(a.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,a.zoom/N)),a.updateProjectionMatrix())};this.update=function(N){if(w&&N){var da=!1;0!==qa&&(p.rotateLeft(qa*p.keyYawRotateSpeed*N),da=!0);0!==ya&&(p.rotateUp(ya*p.keyPitchRotateSpeed*
N),da=!0);if(0!==za||0!==T)p.pan(za*p.keyPanSpeed*N,T*p.keyPanSpeed*N),da=!0;0!==ka&&(N=Math.pow(p.keyZoomSpeed,N),-1===ka?p.dollyIn(N):p.dollyOut(N),da=!0);da&&f()}};c.addEventListener("mousedown",function(N){if(!1!==w){c.focus();N.preventDefault();if(N.button===p.mouseButtons.ROTATE){if(!0===p.noRotate)return;ma=V.ROTATE;y.set(N.clientX,N.clientY)}else if(N.button===p.mouseButtons.ZOOM){if(!0===p.noZoom)return;ma=V.DOLLY;M.set(N.clientX,N.clientY);e(N.clientX,N.clientY)}else if(N.button===p.mouseButtons.PAN){if(!0===
p.noPan)return;ma=V.PAN;H.set(N.clientX,N.clientY)}ma!==V.NONE&&(document.addEventListener("mousemove",k,!1),document.addEventListener("mouseup",h,!1),P=function(){document.removeEventListener("mousemove",k,!1);document.removeEventListener("mouseup",h,!1);ma=V.NONE})}},!1);c.addEventListener("mousewheel",l,!1);c.addEventListener("DOMMouseScroll",l,!1);c.addEventListener("touchstart",function(N){if(!1!==w){var da=N.touches.length;N.preventDefault();if(v(N.touches))ma=V.TOUCH_PAN,H.set(N.touches[0].clientX,
N.touches[0].clientY);else if(p.noRotate||fa||1!==da)if(p.noZoom||2!==da)ma=V.NONE;else{ma=V.TOUCH_DOLLY;da=N.touches[0].clientX-N.touches[1].clientX;var ua=N.touches[0].clientY-N.touches[1].clientY;M.set(0,Math.sqrt(da*da+ua*ua));e(N.touches[0].clientX-da/2,N.touches[0].clientY-ua/2)}else ma=V.TOUCH_ROTATE,y.set(N.touches[0].clientX,N.touches[0].clientY)}},!1);c.addEventListener("touchend",function(){!1!==w&&(ma=V.NONE)},!1);c.addEventListener("touchmove",function(N){if(!1!==w){var da=N.touches.length;
N.preventDefault();var ua=c===document?c.body:c;v(N.touches)&&ma===V.TOUCH_PAN?(K.set(N.touches[0].clientX,N.touches[0].clientY),J.subVectors(K,H),p.pan(J.x/ua.clientHeight,J.y/ua.clientWidth),H.copy(K),f()):p.noRotate||fa||1!==da||ma!==V.TOUCH_ROTATE?p.noZoom||2!==da||ma!==V.TOUCH_DOLLY?ma=V.NONE:(da=N.touches[0].clientX-N.touches[1].clientX,N=N.touches[0].clientY-N.touches[1].clientY,ba.set(0,Math.sqrt(da*da+N*N)),ha.subVectors(ba,M),0<ha.y?p.dollyOut():0>ha.y&&p.dollyIn(),M.copy(ba),f()):(B.set(N.touches[0].clientX,
N.touches[0].clientY),D.subVectors(B,y),p.rotateLeft(D.x/ua.clientWidth*p.mouseRotateSpeed),p.rotateUp(D.y/ua.clientHeight*p.mouseRotateSpeed),y.copy(B),f())}},!1);c.addEventListener("blur",function(){g()},!1);c.addEventListener("keydown",function(N){WALK.isModifierPressed(N)||r(N,!0)},!1);c.addEventListener("keyup",function(N){r(N,!1)},!1);a instanceof G.PerspectiveCamera||a instanceof G.OrthographicCamera||console.warn("WARNING: OrbitControls.js requires perspective or orthographic camers")};
WALK.OrbitControls.prototype.constructor=WALK.OrbitControls;WALK.OrbitControls.computeCameraPosition=function(){var a=new G.Vector3;return function(b,c,d,e,f){d-=Math.PI/2;e+=Math.PI/2;a.x=f*Math.sin(e)*Math.cos(d);a.y=f*Math.sin(e)*Math.sin(d);a.z=f*Math.cos(e);b.copy(c).add(a)}}();WALK.OrbitControls.computeCameraNear=function(a){return a*WALK.CAMERA_ORBIT_NEAR_FROM_1M};WALK.Controls=function(a,b,c,d){function e(S){this.activeDirection=0;this.activeSource=B;this.speed=0;this.moves=function(){return this.activeDirection||this.speed};this.movesInDirection=function(sa){return this.activeDirection===sa||Math.sign(this.speed)===sa};this.activateDirectionFromSource=function(sa,Ga){this.activeDirection=sa;this.activeSource=Ga};this.deactivateDirectionFromSource=function(sa,Ga){this.activeDirection===sa&&this.activeSource===Ga&&(this.activeDirection=0,this.activeSource=
Ga)};this.deactivateSource=function(sa){this.activeSource===sa&&(this.activeDirection=0,this.activeSource=B)};this.stopInDirection=function(sa){this.activeDirection===sa&&(this.activeDirection=0,this.activeSource=B);Math.sign(this.speed)===sa&&(this.speed=0)};this.update=function(sa,Ga){if(!this.moves())return 0;var Ya=Math.sign(this.speed),Za=this.activeDirection||-Ya;Za=Ga*Za*(Ya===Za?sa/WALK.CAMERA_FULL_ACCELERATION_TIME:sa/WALK.CAMERA_FULL_DECELERATION_TIME);Ga*=this.speed+Za/2;this.speed=G.Math.clamp(this.speed+
Za,-sa,sa);this.activeDirection||Math.sign(this.speed)===Ya||(this.speed=0);return G.Math.clamp(Ga,-S,S)}}function f(){V.rotation.z=WALK.normalizeRotation(N.z+P.z)}function g(){f();T.rotation.x=WALK.normalizeRotation(N.x+P.x);za.rotation.y=N.y;V.updateMatrixWorld(!0)}function k(S){return Math.abs(S[0].y-S[1].y)<=WALK.MAX_TWO_POINTERS_IN_LINE_DIFF}function h(S){I[0].copy(ta[0]);I[1].copy(ta[1]);S.touches?(ta[0].set(S.touches[0].clientX,S.touches[0].clientY),2===S.touches.length?ta[1].set(S.touches[1].clientX,
S.touches[1].clientY):ta[1].set(0,0)):(ta[0].set(S.clientX,S.clientY),ta[1].set(0,0))}function l(S){if(u)if(S.preventDefault(),h(S),X){if(X!==Y){if(X===ia){var sa=fa[0].distanceTo(fa[1]);S=ta[0].distanceTo(ta[1]);10<=Math.abs(S-sa)?(X=R,sa=!0):k(ta)&&k(fa)&&10<=Math.abs(ta[0].y-fa[0].y)?(X=E,sa=!0):sa=!1;if(!sa)return}X===R?(sa=I[1].distanceTo(I[0]),sa=ta[1].distanceTo(ta[0])-sa,0<Math.abs(sa)&&(ka=Date.now(),M.activateDirectionFromSource(Math.sign(sa),H)),d.requestFrame()):X===E&&k(ta)&&(sa=ta[0].y-
I[0].y,0<Math.abs(sa)&&(qa=Date.now(),ba.activateDirectionFromSource(Math.sign(sa),H)),d.requestFrame())}}else if(!w.mousePressLook||ya||!X&&S.touches){sa=S.movementX||S.mozMovementX||S.webkitMovementX;void 0===sa&&(sa=ta[0].x-I[0].x);var Ga=S.movementY||S.mozMovementY||S.webkitMovementY;void 0===Ga&&(Ga=ta[0].y-I[0].y);S=w.flipMouseLook||!X&&S.touches?1:-1;ja.x+=S*sa*WALK.CAMERA_LOOK_SPEED;w.mouseControlsPitch&&(ja.y+=S*Ga*WALK.CAMERA_LOOK_SPEED);d.requestFrame()}}function n(S){u&&(b.focus(),S.preventDefault(),
h(S),ya=!0,d.requestFrame())}function r(S){u&&(S.preventDefault(),ya=!1)}function v(S){var sa=0,Ga;(Ga=!u)||(Ga=void 0!==document.hasFocus?document.hasFocus():document.activeElement===b,Ga=!Ga);Ga||(S||(S=window.event),S.preventDefault(),S.wheelDelta?sa=S.wheelDelta/120:S.detail&&(sa=-S.detail/3),U+=sa*WALK.CAMERA_SCROLL_SPEED,U=0<=U?Math.min(U,.5):Math.max(U,-.5),d.requestFrame())}function p(){w.stopForward();w.stopBackward();w.stopLeft();w.stopRight();w.stopUp();w.stopDown();ha.stopInDirection(1);
ha.stopInDirection(-1)}var w=this,u=!0,y=Math.PI/12,B=Symbol("MOVE_SOURCE_NONE"),D=Symbol("MOVE_SOURCE_KEY"),H=Symbol("MOVE_SOURCE_GESTURE"),K=Symbol("MOVE_SOURCE_GAMEPAD"),J=1,W=new e(WALK.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE),M=new e(WALK.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE),ba=new e(WALK.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE),ha=new e(y),ta=[new G.Vector2(0,0),new G.Vector2(0,0)],I=[new G.Vector2(0,0),new G.Vector2(0,0)],U=0,ia=Symbol("GESTURE_RECOGNITION"),R=Symbol("GESTURE_PINCH"),E=Symbol("GESTURE_TWO_POINTER_DRAG"),
Y=Symbol("GESTURE_IGNORE"),X=null,fa=[new G.Vector2(0,0),new G.Vector2(0,0)],ka=0,qa=0,ya=!1,za=new G.Object3D,T=new G.Object3D,V=new G.Object3D,ma=!1,P=new G.Vector3(0,0,0),N=new G.Euler(0,0,0),da=new G.Vector2,ua=new G.Vector2,ja=new G.Vector2;za.add(a);T.add(za);V.add(T);this.flipMouseLook=this.mousePressLook=!1;this.restrictVerticalAngle=this.mouseControlsPitch=!0;this.verticalAngleMin=-Math.PI/2;this.verticalAngleMax=Math.PI/3;this.arrowsTurn=!0;this.orbit=new WALK.OrbitControls(a,this,b,d);
this.cameraHeight=null;this.isFpsEnabled=function(){return u};this.isOrbitEnabled=function(){return this.orbit.isEnabled()};this.orbitModeEnable=function(){u=!1;this.orbit.enable()};this.camera=function(){return a};this.applyCameraYaw=function(S){S.applyEuler(V.rotation)};this.cameraWorldPosition=function(){return V.position};this.cameraPositionUpdated=function(){var S={type:"positionChanged",target:null},sa=null,Ga=null,Ya=null;return function(){V.updateMatrixWorld(!0);var Za=V.position;if(sa!==
Za.x||Ga!==Za.y||Ya!==Za.z)sa=Za.x,Ga=Za.y,Ya=Za.z,a.dispatchEvent(S)}}();this.resetRollAngle=function(){0!==za.rotation.y&&(N.y=0,g())};this.getPitchAngle=function(){return T.rotation.x};this.setPitchAngle=function(S){S!==T.rotation.x&&(P.x=S,N.x=0,g())};this.resetPitchAngle=function(){this.setPitchAngle(0)};this.getYawAngle=function(){return V.rotation.z};this.setYawAngle=function(S){S!==V.rotation.z&&(P.z=S,N.z=0,g())};this.resetYawAngle=function(){this.setYawAngle(0)};this.isHandlingGesture=function(){return null!==
X};this.hmdReset=function(){ma=!0;this.resetPitchAngle()};this.onHmdUpdate=function(){var S=new G.Vector3,sa=new G.Vector3,Ga=new G.Vector3,Ya=new G.Vector3,Za=new G.Vector3;return function(Ca,na){u&&(N.copy(Ca),ma?P.z-=N.z:na&&(Ya.subVectors(na,Ga),S.set(Math.cos(P.z),Math.sin(P.z),0),sa.set(-Math.sin(P.z),Math.cos(P.z),0),Za.copy(S.multiplyScalar(Ya.x)),Za.add(sa.multiplyScalar(Ya.y)),Za.z=Ya.z,V.position.add(Za)),na&&Ga.copy(na),ma=!1,g())}}();this.maxFrameMoveLinearDistance=function(S){return Math.min(S*
a.moveMaxSpeed*J,WALK.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE)};this.movesForward=function(){return M.movesInDirection(1)||0<U};this.stopForward=function(){0<U&&(U=0);M.stopInDirection(1)};this.movesBackward=function(){return M.movesInDirection(-1)||0>U};this.stopBackward=function(){0>U&&(U=0);M.stopInDirection(-1)};this.movesLeft=function(){return W.movesInDirection(-1)};this.stopLeft=function(){W.stopInDirection(-1)};this.movesRight=function(){return W.movesInDirection(1)};this.stopRight=function(){W.stopInDirection(1)};
this.movesUp=function(){return ba.movesInDirection(1)};this.stopUp=function(){ba.stopInDirection(1)};this.movesDown=function(){return ba.movesInDirection(-1)};this.stopDown=function(){ba.stopInDirection(-1)};this.enable=function(){this.orbit.disable();u=!0;ya=0};this.disable=function(){this.orbit.disable();u=!1;p()};this.update=function(S){if(u){1E-4<ua.distanceTo(ja)?(ua.lerp(ja,Math.min(S/WALK.CAMERA_LOOK_SMOOTHING,1)),P.z+=ua.x-da.x,P.x+=ua.y-da.y,w.restrictVerticalAngle&&(P.x>w.verticalAngleMax?
P.x=w.verticalAngleMax:P.x<w.verticalAngleMin&&(P.x=w.verticalAngleMin)),g(),da.copy(ua),d.requestFrame()):(da.set(0,0),ua.set(0,0),ja.set(0,0));M.activeSource===H&&100<Date.now()-ka&&M.deactivateSource(H);ba.activeSource===H&&100<Date.now()-qa&&ba.deactivateSource(H);var sa=W.update(a.moveMaxSpeed*J,S),Ga=M.update(a.moveMaxSpeed*J,S),Ya=ba.update(a.moveMaxSpeed*J,S);var Za=0;Ga?U=0:(U&&(Ga=w.maxFrameMoveLinearDistance(S),Za=G.Math.clamp(U,-Ga,Ga),U-=Za),Ga=Za);V.translateX(sa);V.translateY(Ga);V.translateZ(Ya);
S=ha.update(WALK.CAMERA_ARROWS_TURN_SPEED,S);P.z+=S;f();(W.moves()||M.moves()||ba.moves()||ha.moves()||U)&&d.requestFrame();this.cameraPositionUpdated()}else this.orbit.update(S)};a.rotation.set(0,0,0);a.up.set(0,0,1);a.lookAt(new G.Vector3(0,1,0));b.setAttribute("tabindex",-1);b.addEventListener("contextmenu",function(S){S.preventDefault()},!1);b.addEventListener("mousedown",n,!1);b.addEventListener("touchstart",function(S){u&&(S.preventDefault(),h(S),2===S.touches.length?(X=ia,fa[0].copy(ta[0]),
fa[1].copy(ta[1])):2<S.touches.length&&(X=Y))},!1);b.addEventListener("mousemove",l,!1);b.addEventListener("touchmove",l,!1);b.addEventListener("mouseup",r,!1);b.addEventListener("touchend",function(S){u&&(S.preventDefault(),X=0===S.touches.length?null:Y)},!1);b.addEventListener("keydown",function(S){var sa=!0;if(u&&!WALK.isModifierPressed(S)){J=S.shiftKey?WALK.CAMERA_MOVE_MAX_SPEED_SHIFT_FACTOR:1;switch(S.keyCode){case 38:case 32:case 87:M.activateDirectionFromSource(1,D);break;case 37:w.arrowsTurn?
ha.activateDirectionFromSource(1,D):W.activateDirectionFromSource(-1,D);break;case 65:W.activateDirectionFromSource(-1,D);break;case 40:case 83:M.activateDirectionFromSource(-1,D);break;case 39:w.arrowsTurn?ha.activateDirectionFromSource(-1,D):W.activateDirectionFromSource(1,D);break;case 68:W.activateDirectionFromSource(1,D);break;case 33:case 69:ba.activateDirectionFromSource(1,D);break;case 34:case 81:ba.activateDirectionFromSource(-1,D);break;default:sa=!1}sa&&(S.preventDefault(),d.requestFrame())}},
!1);b.addEventListener("keyup",function(S){var sa=!0;if(u){J=S.shiftKey?WALK.CAMERA_MOVE_MAX_SPEED_SHIFT_FACTOR:1;switch(S.keyCode){case 38:case 32:case 87:M.deactivateDirectionFromSource(1,D);break;case 37:case 65:ha.deactivateDirectionFromSource(1,D);W.deactivateDirectionFromSource(-1,D);break;case 40:case 83:M.deactivateDirectionFromSource(-1,D);break;case 39:case 68:ha.deactivateDirectionFromSource(-1,D);W.deactivateDirectionFromSource(1,D);break;case 33:case 69:ba.deactivateDirectionFromSource(1,
D);break;case 34:case 81:ba.deactivateDirectionFromSource(-1,D);break;default:sa=!1}sa&&S.preventDefault()}},!1);b.addEventListener("mouseout",function(S){r(S)},!1);b.addEventListener("mouseenter",function(S){0<S.buttons&&n(S)},!1);b.addEventListener("DOMMouseScroll",v,!1);b.addEventListener("mousewheel",v,!1);b.addEventListener("blur",function(){p()},!1);c.addEventListener("actionActivated",function(S){if(u)switch(S.action){case WALK.GAMEPAD_ACTION.BACKWARD:M.activateDirectionFromSource(-1,K);break;
case WALK.GAMEPAD_ACTION.FORWARD:M.activateDirectionFromSource(1,K);break;case WALK.GAMEPAD_ACTION.LEFT:w.arrowsTurn?ha.activateDirectionFromSource(1,K):W.activateDirectionFromSource(-1,K);break;case WALK.GAMEPAD_ACTION.RIGHT:w.arrowsTurn?ha.activateDirectionFromSource(-1,K):W.activateDirectionFromSource(1,K);break;case WALK.GAMEPAD_ACTION.DOWN:ba.activateDirectionFromSource(-1,K);break;case WALK.GAMEPAD_ACTION.UP:ba.activateDirectionFromSource(1,K)}});c.addEventListener("actionDeactivated",function(S){if(u)switch(S.action){case WALK.GAMEPAD_ACTION.BACKWARD:M.deactivateDirectionFromSource(-1,
K);break;case WALK.GAMEPAD_ACTION.FORWARD:M.deactivateDirectionFromSource(1,K);break;case WALK.GAMEPAD_ACTION.LEFT:W.deactivateDirectionFromSource(-1,K);ha.deactivateDirectionFromSource(1,K);break;case WALK.GAMEPAD_ACTION.RIGHT:W.deactivateDirectionFromSource(1,K);ha.deactivateDirectionFromSource(-1,K);break;case WALK.GAMEPAD_ACTION.DOWN:ba.deactivateDirectionFromSource(-1,K);break;case WALK.GAMEPAD_ACTION.UP:ba.deactivateDirectionFromSource(1,K)}});this.isEnabled=function(){return u}};function Ge(){var a=new WALK.StandardMaterial;a.baseColor.setRGB(.298,.619,.851);a.highlight=(new G.Color).setRGB(.033,.125,.445);a.setUniforms();return a}
function He(a){var b=new G.CylinderBufferGeometry(.05,.05,.011,32),c=new G.CylinderBufferGeometry(.05,.03,.011,32,1,!1),d=new G.CylinderBufferGeometry(0,.05,.2,32,1,!0);WALK.EDIT_MODE&&(b.addTriangleOrderAttribute(),c.addTriangleOrderAttribute(),d.addTriangleOrderAttribute());var e=new G.Matrix4;e.makeRotationX(Math.PI/2);b.applyMatrix(e);b.convertNormalsToSpherical();b=new G.Mesh(b,a);b.position.z+=.0055;e.makeTranslation(0,-(.1+.0055),0);c.applyMatrix(e);c.convertNormalsToSpherical();c=new G.Mesh(c,
a);d.convertNormalsToSpherical();a=new G.Mesh(d,a);a.add(c);a.rotateX(-Math.PI/2);a.position.z=.158;d=new G.Object3D;d.add(b);d.add(a);return d}
function Ie(a){var b=Ge(),c=He(b),d=c.children[0],e=!1,f=1;this.hide=function(){e&&(a.removeAuxiliaryObject(c),e=!1)};this.isVisible=function(){return e};this.showTargetAtPosition=function(g,k,h,l){e||(a.addAuxiliaryObject(c),e=!0);d.visible=l;c.position.set(g,k,h);c.updateMatrixWorld()};this.update=function(g){b.highlightMix+=g*f;1<=b.highlightMix&&(b.highlightMix=1,f=-1);0>=b.highlightMix&&(b.highlightMix=0,f=1)}}
WALK.ClickNavigator=function(a,b,c,d){function e(){d.teleportingToPoint&&d.cancelSwitchToPoint()}function f(){!c.mousePressLook&&d.teleportingToPoint&&d.cancelSwitchToPoint()}var g=new Ie(a),k=new WALK.RayIntersection;d.addEventListener("teleportDone",function(){g.hide()});this.onMeshClicked=function(h,l){if(!c.isOrbitEnabled()&&!c.isHandlingGesture()&&0!==c.camera().moveMaxSpeed){b.clickedPointToMoveTarget(l);h=l.x;var n=l.y,r=l.z,v=!1;if(b.findIntersectionBelow(l,4,k)){r=k.point.z;var p=k.object.geometry.boundingBox;
p&&r>p.max.z-.01&&(v=!0)}else r-=c.cameraHeight||1.6;WALK.CLICK_MOVE_SHOW_TARGET_INDICATOR&&g.showTargetAtPosition(h,n,r,v);d.switchToPoint(l)}};this.update=function(h){g.isVisible()&&g.update(h)};this.dispose=function(){document.removeEventListener("keydown",e,!1);document.removeEventListener("mousedown",e,!1);document.removeEventListener("mousemove",f,!1);document.removeEventListener("touchstart",e,!1);document.removeEventListener("DOMMouseScroll",e,!1);document.removeEventListener("mousewheel",
e,!1)};document.addEventListener("keydown",e,!1);document.addEventListener("mousedown",e,!1);document.addEventListener("mousemove",f,!1);document.addEventListener("touchstart",e,!1);document.addEventListener("DOMMouseScroll",e,!1);document.addEventListener("mousewheel",e,!1)};WALK.StepsClimber=function(a,b,c){var d,e,f=b.cameraWorldPosition(),g=new G.Vector3;this.updateCameraHeight=function(k){if(d){var h=f.z-g.z;null!==b.cameraHeight&&(b.cameraHeight+=h);f.x!==g.x||f.y!==g.y?e=a.distanceToGround(WALK.MAX_GROUND_SEARCH_DEPTH):Infinity!==e&&(e+=h);Infinity!==e&&(null===b.cameraHeight&&(b.cameraHeight=e),h=b.cameraHeight,e<h-.005||e>h+.005)&&(h=b.cameraHeight,k=Math.min(Math.max(Math.sqrt(Math.pow(f.x-g.x,2)+Math.pow(f.y-g.y,2))/k*1.5,WALK.CAMERA_DEFAULT_MOVE_MAX_SPEED)*
k,Math.abs(e-h)),e>h&&(k=-k),0>k||Infinity===a.distanceToCeiling(k+WALK.MIN_DISTANCE_TO_CEILING))&&(f.z+=k,e+=k,c.requestFrame());g.copy(f)}};this.enable=function(){d=!0;e=a.distanceToGround(WALK.MAX_GROUND_SEARCH_DEPTH);b.cameraHeight=Infinity!==e?e:null;g.copy(f)};this.disable=function(){d=!1};this.isEnabled=function(){return d};this.enable()};WALK.VRHeightController=function(a,b){var c=a.cameraWorldPosition(),d,e,f;this.onHmdPositionUpdate=function(g){d&&!f&&1<g.z&&(a.cameraHeight=g.z,b.adjustPointToMatchCameraHeight(c),a.cameraPositionUpdated(),e=c.z,f=!0)};this.onTeleportDone=function(){d&&(e=c.z)};this.updateCameraHeight=function(){d&&(a.cameraHeight+=c.z-e,e=c.z)};this.enable=function(){d=!0;a.cameraHeight=b.cameraHeightFromPoint(c);null===a.cameraHeight&&(a.cameraHeight=WALK.FALLBACK_CAMERA_HEIGHT);e=c.z;f=!1};this.disable=function(){d=
!1;a.cameraHeight=null}};var Je=1/180;function Ke(a){var b=null;this.activateSky=function(c){if(b){if(b.name===c)return;a.removeAuxiliaryObject(b)}var d=a.findSkyMesh(c);(c=d.material.map)&&!c.loaded?(this.activateSky(WALK.DEFAULT_SKY_NAME),b=d,c.addLoadedListener(function(){b===d&&(a.addAuxiliaryObject(d),d.updateMatrixWorld(!0))})):(a.addAuxiliaryObject(d),d.updateMatrixWorld(!0),b=d)};this.activeSkyName=function(){return b.name}}
function Le(a,b,c){this.position=a||new G.Vector3;this.rotation=b||new G.Vector2;this.fov=c||0}
WALK.Teleport=function(a,b,c,d,e){function f(){u=[];for(var E=0;E<a.views.length;E+=1)u[a.views[E].id]=[];for(E=0;E<a.gpuMeshes.length;E+=1){var Y=a.gpuMeshes[E],X=Y.hideInViews;if(X)for(var fa=0;fa<X.length;fa+=1)u[X[fa]]?u[X[fa]].push(Y):console.warn("Invalid view id in hideInViews list: '"+X[E]+"'")}}function g(E){for(var Y=0;Y<E.length;Y+=1){var X=E[Y];X.visible=!1;y.push(X)}}function k(){for(var E=0;E<y.length;E+=1)y[E].visible=!0;y.length=0}function h(E){k();g(E)}function l(){w.fov=H.fov;p.copy(H.position);
b.setYawAngle(H.rotation.x);b.setPitchAngle(H.rotation.y);b.cameraPositionUpdated();D=null}function n(){return[new G.Vector2(R().position.x,R().position.y),new G.Vector2(H.position.x,H.position.y)]}var r=this,v=new Ke(a),p=b.cameraWorldPosition(),w=a.camera,u,y=[],B=new WALK.CameraPath(a,e),D=null,H=new Le,K=new G.Vector3,J,W,M,ba=!1,ha={type:"teleportStarted",target:this,view:null},ta={type:"teleportDone",target:this,view:null},I=null;this.lastDestinationView=null;var U=this.teleportingToPoint=this.teleportingToView=
!1,ia=!1,R=function(){var E=new Le(b.cameraWorldPosition());return function(){E.rotation.set(WALK.normalizeRotation(b.getYawAngle()),WALK.normalizeRotation(b.getPitchAngle()));E.fov=w.fov;return E}}();this.update=function(E){if(r.teleportingToView||r.teleportingToPoint){E=Math.min(E,.067);E=Math.max(E,Je);var Y=!0;null!==D&&(this.teleportingToPoint&&(H.position.z=p.z),D.update(E,p)?Y=!1:l());Y&&(this.teleportingToView&&("orbit"!==M.mode||ba?(E=b.camera(),E.near=WALK.CAMERA_WALK_NEAR,E.updateProjectionMatrix(),
b.enable()):(b.orbit.minDistance=J,b.orbit.maxDistance=W,b.orbit.setPanPrimary(M.panPrimary||!1),b.orbit.noPan=M.noPan||!1,b.orbit.noRotate=M.noRotate||!1,b.orbit.noPitchRotate=M.noPitchRotate||!1,b.orbit.getMinPitchAngle=function(){return-M.maxUpAngle},b.orbit.getMaxPitchAngle=function(){return-M.minUpAngle},b.orbit.getMinYawAngle=function(){return M.minSideAngle},b.orbit.getMaxYawAngle=function(){return M.maxSideAngle},b.orbit.getMinDistance=function(){return M.minDistance},b.orbit.getMaxDistance=
function(){return M.maxDistance},b.orbit.target.copy(K),b.orbitModeEnable()),v.activateSky(M.sky),h(u[M.id]||[])),this.teleportingToView=this.teleportingToPoint=!1,ta.view=M,this.dispatchEvent(ta));d.requestFrame()}};this.cancelSwitchToPoint=function(){console.assert(this.teleportingToPoint);this.teleportingToPoint=!1;ta.view=null;this.dispatchEvent(ta)};this.switchToPoint=function(E){if(E.x!==p.x||E.y!==p.y)M=null,this.teleportingToPoint=!0,this.teleportingToView=!1,ha.view=null,this.dispatchEvent(ha),
U?H.position.set(E.x,E.y,E.z):H.position.set(E.x,E.y,p.z),E=WALK.yawRotationToPoint(p,E),E=WALK.normalizeRotation(E),H.rotation.set(E,0),H.fov=w.defaultFov,U?(l(),this.update(Je)):(D=new WALK.TeleportMovement(w,b,n(),R().position.z,R().rotation,w.fov,void 0,H.rotation,H.fov,WALK.TELEPORT_TO_POINT_MAX_TIME,WALK.TELEPORT_TO_POINT_ACCELERATION,!1),d.requestFrame())};this.switchToView=function(E,Y){var X="orbit"!==E.mode;var fa=r.lastDestinationView?"orbit"!==r.lastDestinationView.mode:!0;X=w.autoPath&&
X&&fa;E.hideFromMenu||(I=E);this.lastDestinationView=M=E;this.teleportingToView=!0;this.teleportingToPoint=!1;ha.view=M;this.dispatchEvent(ha);b.disable();b.resetRollAngle();g(u[M.id]||[]);void 0!==M.rotation?H.rotation.set(M.rotation.yaw,M.rotation.pitch):H.rotation.set(0,0);H.fov=M.fov||w.defaultFov;"orbit"===M.mode?(void 0!==M.target?K.set(M.target.x,M.target.y,M.target.z):K.set(0,0,0),J=M.minDistance,W=M.maxDistance,E=G.Math.clamp(M.distance||10,J,W),WALK.OrbitControls.computeCameraPosition(H.position,
K,H.rotation.x,H.rotation.y,E),w.near=WALK.OrbitControls.computeCameraNear(E),w.updateProjectionMatrix()):void 0!==M.position?(H.position.set(M.position.x,M.position.y,M.position.z),(ia||null!==w.fixedHeight||null!==WALK.CAMERA_FIXED_HEIGHT)&&c.adjustPointToMatchCameraHeight(H.position)):H.position.set(0,0,0);if(void 0===Y&&0===WALK.TELEPORT_TO_VIEW_MAX_TIME||0===Y||U)l(),this.update(Je);else{M.sky!==v.activeSkyName()&&v.activateSky(WALK.DEFAULT_SKY_NAME);E=X?B.findPath(R(),H):[];fa=0<E.length;E=
(X=X&&fa)?E:n();fa=X?WALK.TELEPORT_PATH_ACCELERATION:WALK.TELEPORT_TO_VIEW_ACCELERATION;void 0===Y&&(Y=X?WALK.TELEPORT_PATH_MAX_TIME:WALK.TELEPORT_TO_VIEW_MAX_TIME);if(void 0===M.rotation){var ka=WALK.yawRotationToPoint(E[E.length-2],E[E.length-1]);ka=WALK.normalizeRotation(ka);H.rotation.set(ka,0)}D=new WALK.TeleportMovement(w,b,E,R().position.z,R().rotation,w.fov,H.position.z,H.rotation,H.fov,Y,fa,X);d.requestFrame()}};this._switchToAdjacentVisibleView=function(E,Y){var X=a.visibleViews();if(0!==
X.length)if(null===I)this.switchToView(X[0],Y);else{var fa=X.indexOf(I);-1===fa&&this.switchToView(X[0],Y);this.switchToView(X[(fa+X.length+E)%X.length],Y)}};this.switchToPreviousVisibleView=function(E){this._switchToAdjacentVisibleView(-1,E)};this.switchToNextVisibleView=function(E){this._switchToAdjacentVisibleView(1,E)};this.updateHiddenMeshes=function(E){f();E?h(u[E.id]||[]):k();d.requestFrame()};this.activateSky=function(E){v.activateSky(E.sky);d.requestFrame()};this.executeWithViewVisibilitySettings=
function(E,Y){var X=y.slice();h(u[E.id]||[]);v.activateSky(E.sky);Y();v.activateSky(this.lastDestinationView.sky);h(X)};this.onVrChange=function(E){ia=U=ba=E;this.lastDestinationView&&"orbit"===this.lastDestinationView.mode&&this.switchToView(this.lastDestinationView,0)};f();a.addEventListener("viewAdded",f);a.addEventListener("viewRemoved",f);a.addEventListener("skyMeshAdded",function(E){v.activateSky(E.skyMesh.name);d.requestFrame()});a.addEventListener("skyMeshRemoved",function(E){v.activeSkyName()===
E.skyMesh.name&&(v.activateSky(WALK.DEFAULT_SKY_NAME),d.requestFrame())})};G.EventDispatcher.prototype.apply(WALK.Teleport.prototype);WALK.AutoTour=function(a,b){function c(){d&&b.switchToNextVisibleView(4)}var d=!1,e={type:"tourStarted"},f={type:"tourStopped"};b.addEventListener("teleportDone",function(){d&&setTimeout(c,WALK.AUTO_TOUR_IN_VIEW_STILL_TIME_MS)});this.isRunning=function(){return d};this.start=function(){console.assert(!d);d=!0;this.dispatchEvent(e);c()};this.stop=function(){console.assert(d);d=!1;b.switchToView(b.lastDestinationView,0);this.dispatchEvent(f)}};G.EventDispatcher.prototype.apply(WALK.AutoTour.prototype);WALK.GAMEPAD_ACTION={TRIGGER:0,BACKWARD:1,FORWARD:2,LEFT:3,RIGHT:4,DOWN:5,UP:6,PREVIOUS:7,NEXT:8};
var Me=[{gamepadIdPattern:/^Spatial Controller \(Spatial Interaction Source\).*$/,axisMapping:new Map([[2,[WALK.GAMEPAD_ACTION.PREVIOUS,WALK.GAMEPAD_ACTION.NEXT]],[3,[WALK.GAMEPAD_ACTION.UP,WALK.GAMEPAD_ACTION.DOWN]],[0,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[1,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[1,WALK.GAMEPAD_ACTION.TRIGGER]])},{gamepadIdPattern:/Oculus Touch \(Left\)/,axisMapping:new Map([[0,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],
[1,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[1,WALK.GAMEPAD_ACTION.TRIGGER],[3,WALK.GAMEPAD_ACTION.DOWN],[4,WALK.GAMEPAD_ACTION.UP]])},{gamepadIdPattern:/Oculus Touch \(Right\)/,axisMapping:new Map([[0,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[1,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[1,WALK.GAMEPAD_ACTION.TRIGGER],[3,WALK.GAMEPAD_ACTION.NEXT],[4,WALK.GAMEPAD_ACTION.PREVIOUS]])},{gamepadIdPattern:/OpenVR (Gamepad|Controller)/,
axisMapping:new Map([[0,[WALK.GAMEPAD_ACTION.PREVIOUS,WALK.GAMEPAD_ACTION.NEXT]],[1,[WALK.GAMEPAD_ACTION.DOWN,WALK.GAMEPAD_ACTION.UP]]]),buttonMapping:new Map([[1,WALK.GAMEPAD_ACTION.TRIGGER]])},{gamepadIdPattern:/.*/,gamepadLayoutMappingId:"standard",axisMapping:new Map([[0,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[1,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]],[2,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[3,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),
buttonMapping:new Map([[0,WALK.GAMEPAD_ACTION.DOWN],[1,WALK.GAMEPAD_ACTION.NEXT],[2,WALK.GAMEPAD_ACTION.PREVIOUS],[3,WALK.GAMEPAD_ACTION.UP],[4,WALK.GAMEPAD_ACTION.TRIGGER],[5,WALK.GAMEPAD_ACTION.TRIGGER]])},{gamepadIdPattern:/.*/,axisMapping:new Map([[0,[WALK.GAMEPAD_ACTION.PREVIOUS,WALK.GAMEPAD_ACTION.NEXT]],[1,[WALK.GAMEPAD_ACTION.UP,WALK.GAMEPAD_ACTION.DOWN]]]),buttonMapping:new Map([[0,WALK.GAMEPAD_ACTION.TRIGGER],[1,WALK.GAMEPAD_ACTION.TRIGGER],[2,WALK.GAMEPAD_ACTION.TRIGGER],[3,WALK.GAMEPAD_ACTION.TRIGGER]])}],
Ne={axisMapping:new Map([[2,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[3,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[0,WALK.GAMEPAD_ACTION.TRIGGER],[4,WALK.GAMEPAD_ACTION.DOWN],[5,WALK.GAMEPAD_ACTION.UP]])},Oe={axisMapping:new Map([[2,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[3,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[0,WALK.GAMEPAD_ACTION.TRIGGER],[4,WALK.GAMEPAD_ACTION.NEXT],[5,WALK.GAMEPAD_ACTION.PREVIOUS]])};
function Pe(a){return-.7>=a?0:.7<=a?1:-1}function Qe(a,b){if("xr-standard"===a.mapping)return"left"===(a.hand?a.hand:b)?Ne:Oe;b=m.makeIterator(Me);for(var c=b.next();!c.done;c=b.next()){c=c.value;var d=a;var e=c;d=e.gamepadIdPattern.test(d.id)?void 0!==e.gamepadLayoutMappingId?d.mapping===e.gamepadLayoutMappingId:!0:!1;if(d)return c}console.error("No matching action mapping for gamepad found",a.id);return null}
function Re(a,b){b=Qe(a,b);this.axisMapping=b.axisMapping;this.buttonMapping=b.buttonMapping;this.axisPosition=a.axes.map(Pe);this.buttonPressed=a.buttons.map(function(c){return c.pressed})}
WALK.GamepadManager=function(){function a(h){var l=h.gamepad;h=new Re(h.gamepad);c.set(l.index,h)}function b(h){c.delete(h.gamepad.index)}var c=new Map,d=new Map,e=new Set,f=new Set,g={type:"actionActivated",action:null},k={type:"actionDeactivated",action:null};this.hasGamepads=function(){return 0<c.size||0<d.size};this.update=function(){function h(v,p){for(var w=0;w<p.axes.length;++w){var u=Pe(p.axes[w]),y=v.axisPosition[w];if(u!==y){var B=v.axisMapping.get(w);void 0!==B&&(-1!==y&&f.add(B[y]),-1!==
u&&e.add(B[u]))}v.axisPosition[w]=u}for(w=0;w<p.buttons.length;++w)u=p.buttons[w].pressed,y=v.buttonPressed[w],u!==y&&(B=v.buttonMapping.get(w),void 0!==B&&(y?f.add(B):e.add(B))),v.buttonPressed[w]=u}if(this.hasGamepads()){e.clear();f.clear();var l=navigator.getGamepads?navigator.getGamepads():[];l=m.makeIterator(l);for(var n=l.next();!n.done;n=l.next())if(n=n.value){var r=c.get(n.index);h(r,n)}l=m.makeIterator(d);for(n=l.next();!n.done;n=l.next())r=m.makeIterator(n.value),n=r.next().value,r=r.next().value,
h(r,n);n=m.makeIterator(f);for(l=n.next();!l.done;l=n.next())k.action=l.value,this.dispatchEvent(k);n=m.makeIterator(e);for(l=n.next();!l.done;l=n.next())g.action=l.value,this.dispatchEvent(g)}};this.addXrGamepad=function(h,l){l=new Re(h,l);d.set(h,l)};this.removeXrGamepad=function(h){d.delete(h)};this.removeAllXrGamepads=function(){d.clear()};(function(){if(navigator.getGamepads){window.addEventListener("gamepadconnected",a);window.addEventListener("gamepaddisconnected",b);for(var h=m.makeIterator(navigator.getGamepads()),
l=h.next();!l.done;l=h.next())if(l=l.value){var n=new Re(l);c.set(l.index,n)}}})()};G.EventDispatcher.prototype.apply(WALK.GamepadManager.prototype);/*
 Copyright (C) 2020-present Shapespark
*/
WALK.GazeModeObserver=function(){var a=this,b=!1,c={type:"modeDisabled"},d={type:"modeEnabled"};this.enableMode=function(){b=!0;a.dispatchEvent(d)};this.disableMode=function(){b=!1;a.dispatchEvent(c)};this.modeIsEnabled=function(){return b}};G.EventDispatcher.prototype.apply(WALK.GazeModeObserver.prototype);/*
 Copyright (C) 2017-present Shapespark
*/
console.assert(WALK.GAZE_POINTER_SHOW_LOADING_AFTER_S<=WALK.GAZE_POINTER_ACTIVATE_AFTER_S);var Se=Math.PI/60;function Te(){var a=new G.BufferGeometry,b=new Float32Array(18);a.addAttribute("position",new G.BufferAttribute(b,3));b[0]=.05;b[1]=-.05;b[2]=-2;b[3]=.05;b[4]=.05;b[5]=-2;b[6]=-.05;b[7]=-.05;b[8]=-2;b[9]=.05;b[10]=.05;b[11]=-2;b[12]=-.05;b[13]=.05;b[14]=-2;b[15]=-.05;b[16]=-.05;b[17]=-2;a.computeBoundingSphere();return a}
WALK.GazePointer=function(a,b,c,d){function e(){if(!g)f();else if(!r){var w=new WALK.GazePointerMaterial,u=new G.Mesh(Te(),w);a.addAuxiliaryObject(u);u.frustumCulled=!1;u.matrixWorld=b.camera().matrixWorld;r={setVisible:function(y){u.visible=y;c()},setCircleSpan:function(y){w.circleSpan=y;c()}};f()}r&&r.setVisible(g)}function f(){k=h=null;l=0;n=!1;r&&r.setCircleSpan(0)}var g=d.modeIsEnabled(),k,h,l,n,r=null,v=null,p=null;this.setGazeHandlers=function(w,u){v=w;p=u};d.addEventListener("modeDisabled",
function(){g=!1;e()});d.addEventListener("modeEnabled",function(){g=!0;e()});this.reset=function(){null!==k&&f()};this.update=function(w){if(g){var u=b.getPitchAngle(),y=b.getYawAngle();null===k?(k=u,h=y):Math.abs(k-u)>Se||Math.abs(h-y)>Se?f():(l+=w,l>=WALK.GAZE_POINTER_SHOW_LOADING_AFTER_S&&(n?(r.setCircleSpan(Math.min((l-WALK.GAZE_POINTER_SHOW_LOADING_AFTER_S)/(WALK.GAZE_POINTER_ACTIVATE_AFTER_S-WALK.GAZE_POINTER_SHOW_LOADING_AFTER_S),1)),l>=WALK.GAZE_POINTER_ACTIVATE_AFTER_S&&(p&&p(),f())):v&&
v()?n=!0:f()))}};e()};/*
 Copyright (C) 2018-present Shapespark
*/
WALK.HashChangeTeleport=function(a,b){function c(){var d=WALK.urlHashGetArgument("view");d&&(d=a.findViewByName(d))&&(b.switchToView(d),window.location.hash=WALK.urlHashRemoveArgument("view"))}window.addEventListener("hashchange",c,!1);this.dispose=function(){window.removeEventListener("hashchange",c,!1)}};function Ue(a,b){function c(v){var p=[];this.start=function(){var w=performance.now();p.push({start:w,end:w,delta:0})};this.end=function(){var w=performance.now();void 0!==p[p.length-1]&&(p[p.length-1].end=w,p[p.length-1].delta=p[p.length-1].end-p[p.length-1].start)};this.stats=function(){var w=p[p.length-1].delta,u=p.reduce(function(D,H){return D.delta<H.delta?D:H}).delta,y=p.reduce(function(D,H){return D.delta>H.delta?D:H}).delta,B=e(p,"delta")/p.length;return{name:v,last:d(w),best:d(u),worst:d(y),
average:d(B)}}}function d(v){return parseFloat(v.toFixed(4))}function e(v,p){return v.reduce(function(w,u){return w+u[p]},0)}function f(v,p,w,u){var y=2*v.x;v=2*v.y;u=2*(void 0===u?1:u);n.lineWidth=2*(void 0===w?1:w);n.strokeStyle=void 0===p?"black":p;n.beginPath();n.arc(y,v,u,0,2*Math.PI);n.stroke()}function g(v){v.forEach(function(p){var w=255*p.distanceToObstacle;w=0===p.distanceToObstacle?"black":"rgb(255,"+w+","+w+")";var u=0,y=!0;w=void 0===w?"black":w;y=void 0===y?!1:y;var B=2*p.x-1;p=2*p.y-
1;n.lineWidth=2*(void 0===u?1:u);n.strokeStyle=w;n.fillStyle=w;n.beginPath();n.rect(B,p,2,2);n.stroke();y&&n.fill()})}function k(v){v.forEach(function(p){p=new G.Vector2(p.x,p.y);f(p,"green",.5,.5)})}function h(v){v.forEach(function(p,w){p=new G.Vector2(p.x,p.y);if(0<w){w=new G.Vector2(v[w-1].x,v[w-1].y);var u="blue",y=1;n.lineWidth=2*(void 0===y?1:y);n.strokeStyle=void 0===u?"black":u;n.beginPath();n.moveTo(2*w.x,2*w.y);n.lineTo(2*p.x,2*p.y);n.stroke()}f(p,"blue",1,1)})}console.warn("Camera path debug mode");
var l=document.createElement("canvas"),n=l.getContext("2d");l.width=2*a;l.height=2*b;l.style.position="absolute";l.style.left="0";l.style.top="0";l.style.maxWidth="100%";document.body.appendChild(l);var r={};this.render=function(v,p,w){n.clearRect(0,0,2*a,2*b);g(v);k(p);h(w)};this.timeStart=function(v){void 0===r[v]&&(r[v]=new c(v));r[v].start()};this.timeEnd=function(v){void 0!==r[v]&&r[v].end()};this.logTime=function(){var v=[];Object.values(r).forEach(function(w){v.push(w.stats())});var p={name:"TOTAL",
last:d(e(v,"last")),best:d(e(v,"best")),worst:d(e(v,"worst")),average:d(e(v,"average"))};v.push(p);console.table(v)}}
function Ve(a){function b(e){for(var f=d[e];0<e;){var g=Math.floor((e-1)/2),k=d[g];if(f[a]<=k[a])d[g]=f,d[e]=k,e=g;else break}}function c(e){for(var f=d[e];;){var g=2*e+1,k=2*e+2,h=void 0,l=null;g<d.length&&(h=d[g],f[a]>h[a]&&(l=g));k<d.length&&(g=d[k],null===l&&f[a]>g[a]||null!==l&&h[a]>g[a])&&(l=k);if(null!==l)d[e]=d[l],d[l]=f,e=l;else break}}a=void 0===a?"score":a;var d=[];this.extract=function(){var e=d[0],f=d.pop();0<d.length&&(d[0]=f,c(0));return e};this.insert=function(e){d.push(e);b(d.length-
1)};this.update=function(e){var f=d.indexOf(e);0!==f&&(e[a]<d[Math.floor((f-1)/2)]?b(f):c(f))};this.size=function(){return d.length}}function We(a,b,c,d){this.id=a;this.x=b;this.y=c;this.distanceToObstacle=d;this.parent=null;this.score=0}
We.prototype={distanceTo:function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))},distanceMeasured:function(){return void 0!==this.distanceToObstacle},isObstacle:function(){return 0===this.distanceToObstacle},visited:function(){return null!==this.parent},visit:function(a,b){this.parent=a;this.score=b}};
function Xe(a,b,c,d){var e=[-1,1,-b,b],f=a.canvasRange,g=a.collisionRange,k=[];(function(h){for(var l=new Ve("distanceToObstacle"),n=0;n<=h.data.length;n+=4){var r=255===h.data[n-1],v=Math.floor(n/(4*b));v=new We(n/4,n/4-v*b,v,r?0:void 0);k.push(v);r&&l.insert(v)}for(h={};0<l.size();)h.$jscomp$loop$prop$current$183=l.extract(),e.forEach(function(p){return function(w){w=p.$jscomp$loop$prop$current$183.id+w;1>p.$jscomp$loop$prop$current$183.distanceToObstacle&&void 0!==k[w]&&!1===k[w].distanceMeasured()&&
(k[w].distanceToObstacle=Math.min(1,p.$jscomp$loop$prop$current$183.distanceToObstacle+1/d),l.insert(k[w]))}}(h)),h={$jscomp$loop$prop$current$183:h.$jscomp$loop$prop$current$183}})(a.collisionImageData);this.forEachNeighbour=function(h,l){var n=h.x+h.y*b;e.forEach(function(r){var v;if(v=void 0!==k[n+r])if(v=k[n+r],0!==h.x&&h.x!==b-1)v=!0;else{var p=h.x+v.x!==b-2;v=1===h.x+v.x&&!p}v&&l(k[n+r])})};this.hasObstacleAt=function(h,l){return k[Math.round(h)+Math.round(l)*b].isObstacle()};this.getNodeAtScenePosition=
function(h){var l=Math.round(G.Math.mapLinear(h.position.x,g.x.min,g.x.max,f.x.min,f.x.max));h=Math.round(G.Math.mapLinear(h.position.y,g.y.min,g.y.max,f.y.min,f.y.max));return k[l+h*b]};this.getScenePointFromNode=function(h){var l=G.Math.mapLinear(h.x,f.x.min,f.x.max,g.x.min,g.x.max);h=G.Math.mapLinear(h.y,f.y.min,f.y.max,g.y.min,g.y.max);return new G.Vector2(l,h)};this.resetNodeMap=function(){k.forEach(function(h){h.parent=null;h.score=0})};this.getNodeMap=function(){return k}}
WALK.CameraPath=function(a,b){function c(l,n){var r=f.getNodeAtScenePosition(l);n=f.getNodeAtScenePosition(n);if(!r||!n)return[];var v=new Ve;v.insert(r);l=[];for(var p={};0<v.size();){p.$jscomp$loop$prop$current$185=v.extract();if(p.$jscomp$loop$prop$current$185===n){for(n=p.$jscomp$loop$prop$current$185;n;n=n.parent)n&&l.push(n);l.reverse();break}f.forEachNeighbour(p.$jscomp$loop$prop$current$185,function(w){return function(u){if(!u.isObstacle()){var y=w.$jscomp$loop$prop$current$185.score+1/(u.distanceToObstacle?
u.distanceToObstacle:1),B=u.visited()||u===r;if(!B||y<u.score)u.visit(w.$jscomp$loop$prop$current$185,y),B?v.update(u):v.insert(u)}}}(p));p={$jscomp$loop$prop$current$185:p.$jscomp$loop$prop$current$185}}return l}function d(l,n,r,v){var p;a:{for(p=l+1;p<n.length;p++){b:{var w=n[l],u=n[p],y=w.x<u.x?w:u,B=w.x<u.x?u:w,D=w.y<u.y?w:u,H=w.y<u.y?u:w;var K=y.x===B.x?null:(B.y-y.y)/(B.x-y.x);var J=null===K?y.x:y.y-K*y.x;if(Math.abs(w.y-u.y)>Math.abs(w.x-u.x))for(y=D.y;y<=H.y;y+=.2){if(f.hasObstacleAt(null===
K?D.x:(y-J)/K,y)){K=!0;break b}}else for(D=y.x;D<=B.x;D+=.2)if(f.hasObstacleAt(D,null===K?y.y:K*D+J)){K=!0;break b}K=!1}if(K)break a}p=-1}-1===p?r.push(n[n.length-1]):(l=p-l,l=l>v?p-v:p-Math.floor(l/2),r.push(n[l]),d(l,n,r,v))}var e=null,f=null;a=b.calculateRenderSize(200,a.collisionBoundingBox);var g=a.width,k=a.height,h=WALK.DEBUG_CAMERA_PATH?new Ue(g,k):null;this.findPath=function(l,n){h&&h.timeStart("Graph");var r=n.position.z.toFixed(4);if(r!==e){var v={outlineThickness:2,outlineColor:new G.Color(0,
0,0),slicePlaneHeight:n.position.z};v=b.getCollisionData(v,g,k);f=new Xe(v,g,k,7);e=r}else f.resetNodeMap();h&&h.timeEnd("Graph");h&&h.timeStart("Raw path");r=c(l,n);h&&h.timeEnd("Raw path");v=[];var p=[];if(2<=r.length){h&&h.timeStart("Refine path");var w=v.push,u=w.apply,y=m,B=y.arrayFromIterable,D=[r[0]];d(0,r,D,5);u.call(w,v,B.call(y,D));h&&h.timeEnd("Refine path");h&&h.timeStart("Calculate points");w=p.push;u=w.apply;y=m;B=y.arrayFromIterable;D=[];D.push(new G.Vector2(l.position.x,l.position.y));
for(l=1;l<v.length-1;l++)D.push(f.getScenePointFromNode(v[l]));D.push(new G.Vector2(n.position.x,n.position.y));u.call(w,p,B.call(y,D));h&&h.timeEnd("Calculate points")}h&&(h.render(f.getNodeMap(),r,v),h.logTime());return p}};var Ye=Math.PI/3,Ze=2*WALK.CAMERA_DEFAULT_MOVE_MAX_SPEED;function $e(a){return-(Math.cos(Math.PI*a)-1)/2}function lf(a){this.distance=a;this.time=this.velocity=0;this.setVelocityFromCornerAngle=function(b){this.velocity=G.Math.mapLinear(Math.max(Ye,b),Ye,Math.PI,1,Ze)}}function mf(a,b,c){this.endTime=function(){return b.time};this.getDistance=function(d){d-=a.time;return a.distance+(a.velocity*d+.5*c*Math.pow(d,2))};this.isTimeWithinEquation=function(d){return d>=a.time&&d<=b.time}}
function nf(a,b,c,d,e,f){this.endTime=function(){return b.time};this.getDistance=function(g){g-=a.time;return g<d?a.distance+(a.velocity*g+.5*f*Math.pow(g,2)):a.distance+e+(c*(g-d)-.5*f*Math.pow(g-d,2))};this.isTimeWithinEquation=function(g){return g>=a.time&&g<=b.time}}
function of(a,b,c){this.endDistance=b;this.getPoint=function(d){d=G.Math.mapLinear(d,a,b,0,1);return c.get(d)};this.getRotation=function(d){d=G.Math.mapLinear(d,a,b,0,1);d=c.normal(d);return Math.atan2(d.y,d.x)-Math.PI};this.isDistanceWithinCurve=function(d){return d>=a&&d<=b}}
function pf(a,b,c){var d=a.velocity,e=b.velocity,f=b.distance-a.distance,g=Math.sqrt(.5*Math.pow(d,2)+.5*Math.pow(e,2)+f*c);if(g>d&&g>e){var k=.5*(Math.pow(g,2)-Math.pow(d,2))/c;console.assert(.001>Math.abs(f-k-.5*(Math.pow(g,2)-Math.pow(e,2))/c));d=(g-d)/c;b.time=a.time+d+(g-e)/c;return new nf(a,b,g,d,k,c)}if(g<=e)return e=Math.sqrt(Math.pow(d,2)+2*f*c),console.assert(.001>Math.abs(f-.5*(Math.pow(e,2)-Math.pow(d,2))/c)),b.time=a.time+(e-d)/c,b.velocity=e,new mf(a,b,c);c=2*f/(d+e);console.assert(.001>
Math.abs(f-(d*c+.5*(e-d)*c)));b.time=a.time+c;return new mf(a,b,(e-d)/c)}var qf=function(){var a=new G.Vector2,b=new G.Vector2;return function(c,d,e){a.subVectors(d,c);b.subVectors(e,d);return Math.asin((a.x*b.y-a.y*b.x)/(a.length()*b.length()))}}();function rf(a){return new G.Vector2(a.x,a.y)}function sf(a,b){return new $c([a,a.clone().lerp(b,1/3),a.clone().lerp(b,2/3),b])}
function tf(a,b,c,d){var e=b.distanceTo(a),f=b.distanceTo(c),g=Math.min(f,e);e=g/e;f=g/f;g=.5>d/g?d/g:.5;d=b.clone().lerp(a,g*e);a=b.clone().lerp(a,g/3*e);e=b.clone().lerp(c,g/3*f);b=b.clone().lerp(c,g*f);return new $c([d,a,e,b])}
WALK.TeleportMovement=function(a,b,c,d,e,f,g,k,h,l,n,r){function v(X){return R.find(function(fa){return fa.isDistanceWithinCurve(X)})}function p(){for(var X=[],fa=1;fa<c.length-1;fa++){var ka=c[fa-1],qa=c[fa],ya=c[fa+1],za=qf(ka,qa,ya),T=G.Math.mapLinear(Math.max(Ye,za),Ye,Math.PI,2,6);ka=tf(ka,qa,ya,T);X.push({bezier:ka,angle:za})}fa=[];fa.push(new lf(0));ka=c[0];for(qa=za=0;qa<X.length;qa++){var V=X[qa-1];ya=X[qa];T=X[qa+1];void 0!==V&&(ka=rf(V.bezier.points[3]));V=rf(ya.bezier.points[0]);V=sf(ka,
V);if(0<V.length()){var ma=za,P=za+V.length();ma=new of(ma,P,V);R.push(ma);za+=V.length()}V=ya.bezier.length()/2;ma=new of(za,za+2*V,ya.bezier);R.push(ma);za+=V;ma=Math.abs(ya.angle);ma>Ye&&(P=new lf(za),P.setVelocityFromCornerAngle(ma),fa.push(P));za+=V;void 0===T&&(ka=rf(ya.bezier.points[3]))}X=sf(ka,c[c.length-1]);ka=za+X.length();ka=new of(za,ka,X);R.push(ka);za+=X.length();fa.push(new lf(za));for(X=1;X<fa.length;X++)ka=pf(fa[X-1],fa[X],n),E.push(ka);ha=function(N){return M.getPoint(N)};M=R[0];
ba=E[0];J=za;X=E[E.length-1].endTime();K=Math.max(1.5,Math.min(X,l));W=E[E.length-1].endTime()/K}function w(){if(5<J){var X=v(1.25),fa=WALK.normalizeRotation(X.getRotation(1.25)-e.x),ka=J-3.75;X=v(ka);var qa=WALK.normalizeRotation(k.x-X.getRotation(ka));I=function(P){return 1.25>P?(P=$e(P/1.25),e.x+P*fa):P>ka?(P=1-$e((P-ka)/(J-ka)),k.x-P*qa):M.getRotation(P)}}else{var ya=WALK.normalizeRotation(k.x-e.x);I=function(P){P=$e(P/J);return e.x+P*ya}}if(5<J){var za=WALK.normalizeRotation(0-e.y),T=J-3.25,
V=WALK.normalizeRotation(k.y);U=function(P){return 1.75>P?(P=$e(P/1.75),e.y+P*za):P>T?$e((P-T)/(J-T))*V:0}}else{var ma=WALK.normalizeRotation(k.y-e.y);U=function(P){P=$e(P/J);return e.y+P*ma}}}function u(){var X=WALK.normalizeRotation(k.x-e.x);I=function(ka){return e.x+$e(ka/K)*X};var fa=WALK.normalizeRotation(k.y-e.y);U=function(ka){return e.y+$e(ka/K)*fa}}function y(){var X=3<J?3:J;ta=function(fa){return fa<X?(fa=$e(fa/X),G.Math.mapLinear(fa,0,1,d,g)):g}}function B(){ta=function(X){X=$e(X/K);return G.Math.mapLinear(X,
0,1,d,g)}}function D(){var X=H*W;X>ba.endTime()&&(ba=E.find(function(fa){return fa.isTimeWithinEquation(X)}));return ba.getDistance(X)}var H=0,K=1.5,J=0,W=1,M=null,ba=null,ha=null,ta=null,I=null,U=null,ia=null,R=[],E=[],Y=.001<c[0].distanceTo(c[c.length-1]);Y&&p();r&&Y?(w(),y()):(u(),void 0!==g&&(!Y&&.001<Math.abs(g-d)&&(J=Math.abs(g-d),K=Math.max(1.5,Math.min(Math.sqrt(J/n),l))),B()),u());void 0!==h&&(ia=function(X){X=$e(X/K);return G.Math.mapLinear(X,0,1,f,h)});this.update=function(X,fa){H+=X;if(H<
K){r&&Y?(X=D(),X>M.endDistance&&(M=v(X))):X=H;if(ha){var ka=ha(D());fa.setX(ka.x);fa.setY(ka.y)}ta&&(ka=ta(X),fa.setZ(ka));ia&&(a.fov=ia(H),a.updateProjectionMatrix());b.setYawAngle(I(X));b.setPitchAngle(U(X));b.cameraPositionUpdated();return!0}return!1}};var uf=WALK.getShader("standard_material_vertex.glsl"),vf=WALK.getShader("standard_material_fragment.glsl"),wf=new WALK.InlineShader("vec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity,\n                     inout float opacity) {\n  return addSpecular(baseColor, totalIntensity, opacity);\n}"),xf=new G.Color,yf=new G.Vector3(0,0,0),zf=new G.Vector4(0,0,1,1);WALK.ParallaxModes={basic:"USE_BASIC_PARALLAX",steep:"USE_STEEP_PARALLAX",occlusion:"USE_OCLUSION_PARALLAX",relief:"USE_RELIEF_PARALLAX"};
WALK.StandardMaterial=function(){var a=this;WALK.BaseMaterial.call(this,uf,vf,this.fragmentShaderHooks());this.type="standard";this.merged=!1;this._opacity=1;Object.defineProperty(this,"opacity",{get:function(){return this._opacity},set:function(c){this._opacity=.99<c?1:c;this.configureTransparency();this.setUniforms();this._updated()}});this.baseColor=new G.Color(16777215);this._baseColorTexture=null;this._baseColorTextureCorrection=this.planarReflector=!1;this._baseColorTextureContrast=0;this.baseColorTextureHslOffset=
{h:0,s:0,l:0};this._baseColorCorrectionUniform=new G.Vector4;this._emissive=this.lightMapped=!1;this._roughness=this._emissionStrength=1;this._metallic=0;this._lastUsedLightProbeId=this.cubeCameraIndex=null;this._haveTextureLod=WALK.DETECTOR.gl.textureLod;this._mipLevel1=this._mipLevel0=null;this.disableLightProbeTmp=this.disableLightProbe=!1;this._envMapProject=!0;this._hdrOutput=!1;this._bumpScale=.001;this.parallaxCorrection=!1;this.parallaxMode="basic";this.parallaxScale=-.03;this.parallaxMinLayers=
10;this.parallaxMaxLayers=15;this.colorMap=null;this.cameraExposure=0;this.cameraGamma=1;this.headLight=!1;this._uvOffsetScale=null;this._repeatableTexturesRequired=!1;this.highlight=WALK.EDIT_MODE?WALK.EDITOR_SELECTION_COLOR:null;this._specularOff=this._highlightMix=0;this.doNotImport={baseColor:!1,opacity:!1};var b={type:"updated",target:this};this._updated=function(){return a.dispatchEvent(b)};this._alphaInLowerHalf=!1;this._chromaKeyEnabled=void 0;this.chromaKeyColor=(new G.Color).setRGB(0,.94,
0);this._chromaKeyDelta=new G.Vector3(.1,.1,.1);this._chromaKeyDeltaCoeff=new G.Vector3};WALK.StandardMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.StandardMaterial.prototype.constructor=WALK.StandardMaterial;WALK.StandardMaterial.prototype.addTextureProperty=function(a){var b="_"+a;Object.defineProperty(this,a,{get:function(){return this[b]||null},set:function(c){var d=this;(this[b]=c)?c.addLoadedListener(function(){d.setUniforms();d._updated();d=c=null}):(d.setUniforms(),d._updated())}})};
WALK.StandardMaterial.prototype.addTextureProperty("roughnessTexture");WALK.StandardMaterial.prototype.addTextureProperty("metallicTexture");WALK.StandardMaterial.prototype.addTextureProperty("bumpTexture");WALK.StandardMaterial.prototype.fragmentShaderHooks=function(){return wf};WALK.StandardMaterial.prototype._useChromaKey=function(){return!(!this.isAnimated||!this.chromaKeyEnabled)};WALK.StandardMaterial.prototype._useAlphaInLowerHalf=function(){return!(!this.isAnimated||!this.alphaInLowerHalf)};
WALK.StandardMaterial.prototype._useBaseColorTextureAsCutout=function(){var a=this._baseColorTexture;return 1===this.opacity&&(a&&a.isCutout||this._useAlphaInLowerHalf()||this._useChromaKey())};
WALK.StandardMaterial.prototype.configureTransparency=function(){var a=this._baseColorTexture;a=a&&(a.hasAlpha||this._useAlphaInLowerHalf()||this._useChromaKey());this.transparent=1>this.opacity||a;a=this._useBaseColorTextureAsCutout();this.transparent?(this.blending=G.NormalBlending,this.transparentRenderOrder=a?0:1):this.blending=G.NoBlending;this.depthWrite=!this.transparent||a};
Object.defineProperty(WALK.StandardMaterial.prototype,"alphaInLowerHalf",{get:function(){return this._alphaInLowerHalf},set:function(a){this._alphaInLowerHalf=a;this.configureTransparency();this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"chromaKeyEnabled",{get:function(){return!!this._chromaKeyEnabled},set:function(a){this._chromaKeyEnabled=!!a;this.configureTransparency();this.setUniforms();this._updated()}});
WALK.StandardMaterial.prototype.setChromaKeyColorRGB=function(a,b,c){this.chromaKeyColor.setRGB(a,b,c);this.setUniforms();this._updated()};WALK.StandardMaterial.prototype.getChromaKeyDeltaComponent=function(a){return this._chromaKeyDelta.getComponent(a)};WALK.StandardMaterial.prototype.setChromaKeyDeltaComponent=function(a,b){this._chromaKeyDelta.setComponent(a,b);this.setUniforms();this._updated()};
Object.defineProperty(WALK.StandardMaterial.prototype,"isAnimated",{get:function(){var a=this.baseColorTexture;return a&&a.isAnimated}});Object.defineProperty(WALK.StandardMaterial.prototype,"isPlaying",{get:function(){var a=this.baseColorTexture;return a&&a.isAnimated&&a.isPlaying}});WALK.StandardMaterial.prototype.rewind=function(){this.baseColorTexture.rewind()};
WALK.StandardMaterial.prototype.play=function(){console.assert(this.isAnimated);var a=this.baseColorTexture.isPlaying;this.baseColorTexture.play();this.baseColorTexture.isPlaying!==a&&this._updated()};WALK.StandardMaterial.prototype.pause=function(){console.assert(this.isAnimated);var a=this.baseColorTexture.isPlaying;this.baseColorTexture.pause();this.baseColorTexture.isPlaying!==a&&this._updated()};WALK.StandardMaterial.prototype.sleepAnimation=function(){console.assert(this.isAnimated);this.baseColorTexture.sleepAnimation()};
WALK.StandardMaterial.prototype.wakeAnimation=function(){console.assert(this.isAnimated);this.baseColorTexture.wakeAnimation()};Object.defineProperty(WALK.StandardMaterial.prototype,"doubleSided",{get:function(){return this.side===G.DoubleSide},set:function(a){this.side=a?G.DoubleSide:G.FrontSide;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"envMapMirror",{get:function(){return 0===this.roughness&&!this.roughnessTexture}});
Object.defineProperty(WALK.StandardMaterial.prototype,"hdrOutput",{get:function(){return this._hdrOutput},set:function(a){a!==this._hdrOutput&&(this._hdrOutput=a,this.setUniforms())}});Object.defineProperty(WALK.StandardMaterial.prototype,"specularOff",{get:function(){return this._specularOff},set:function(a){a!==this._specularOff&&(this._specularOff=a,this.setUniforms())}});
Object.defineProperty(WALK.StandardMaterial.prototype,"highlightMix",{get:function(){return this._highlightMix},set:function(a){a!==this._highlightMix&&(this._highlightMix=a,this.uniforms.highlightMix.value=a)}});Object.defineProperty(WALK.StandardMaterial.prototype,"cameraExposure",{get:function(){return this._cameraExposure},set:function(a){this._cameraExposure=a;this.setUniform("exposure","f",Math.pow(2,a))}});
Object.defineProperty(WALK.StandardMaterial.prototype,"cameraGamma",{get:function(){return this.uniforms.cameraGamma.value},set:function(a){this.setUniform("cameraGamma","f",a)}});
Object.defineProperty(WALK.StandardMaterial.prototype,"baseColorTexture",{get:function(){return this._baseColorTexture},set:function(a){var b=this;(this._baseColorTexture=a)?a.addLoadedListener(function(){b.configureTransparency();b._repeatableTexturesRequired&&b.ensureTexturesRepeatable();b.setUniforms();b._updated();b=a=null}):(b.setUniforms(),b._updated())}});
Object.defineProperty(WALK.StandardMaterial.prototype,"baseColorTextureCorrection",{get:function(){return this._baseColorTextureCorrection},set:function(a){this._baseColorTextureCorrection=a;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"baseColorTextureContrast",{get:function(){return this._baseColorTextureContrast},set:function(a){this._baseColorTextureContrast=a;this.setUniforms();this._updated()}});
WALK.StandardMaterial.prototype.setBaseColorTextureHslOffset=function(a,b,c){this.baseColorTextureHslOffset.h=a;this.baseColorTextureHslOffset.s=b;this.baseColorTextureHslOffset.l=c;this.setUniforms();this._updated()};Object.defineProperty(WALK.StandardMaterial.prototype,"emissive",{get:function(){return this._emissive},set:function(a){this._emissive=a;this.setUniforms();this._updated()}});
Object.defineProperty(WALK.StandardMaterial.prototype,"emissionStrength",{get:function(){return this._emissionStrength},set:function(a){this._emissionStrength=a;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"roughness",{get:function(){return this._roughness},set:function(a){this._roughness=a;this.setUniforms();this._updated()}});
Object.defineProperty(WALK.StandardMaterial.prototype,"metallic",{get:function(){return this._metallic},set:function(a){this._metallic=a;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"envMapProject",{get:function(){return this._envMapProject},set:function(a){this._envMapProject=a;this.setUniforms();this._updated()}});
Object.defineProperty(WALK.StandardMaterial.prototype,"bumpScale",{get:function(){return this._bumpScale},set:function(a){this._bumpScale=a;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"uvOffsetAndScaleEnabled",{get:function(){return null!==this._uvOffsetScale},set:function(a){a?this.setUvOffsetAndScale(zf):(this._uvOffsetScale=null,this.setUniforms(),this._updated())}});
WALK.StandardMaterial.prototype.setDoNotImport=function(a,b){this.doNotImport[a]=b;this.setUniforms();this._updated()};WALK.StandardMaterial.prototype.isLightProbeDisabled=function(){return this.disableLightProbe||this.disableLightProbeTmp||this.specularOff||1===this.roughness&&!this._roughnessTexture||this.transparent&&this.doubleSided};
WALK.StandardMaterial.prototype._setLightProbeUniforms=function(){this.setUniform("envMap","t",null);if(!this.condDefine(this._haveTextureLod,"HAVE_TEXTURE_LOD")){var a=WALK.LIGHT_PROBE_MIPS_COUNT-1;this._mipLevel0=Math.floor(this.roughness*a);this._mipLevel1=Math.min(this._mipLevel0+1,a);this.setUniform("envMap2","t",null)}this.envMapMirror?this.setUniform("envMipsCount","f",1):this.setUniform("envMipsCount","f",0);this.condDefine(this.envMapProject,"USE_ENVMAP_PROJECT")&&(this.setUniform("envMapPosW",
"v3",yf),this.setUniform("envBoxMin","v3",yf),this.setUniform("envBoxMax","v3",yf));this._lastUsedLightProbeId=null};WALK.StandardMaterial.prototype.getUvOffsetAndScale=function(a){return a.copy(this._uvOffsetScale||zf)};WALK.StandardMaterial.prototype._uvOffsetAndScaleModified=function(){this.ensureTexturesRepeatable();this._updated()};
WALK.StandardMaterial.prototype.setUvOffsetAndScale=function(a,b,c,d){this._uvOffsetScale||(this._uvOffsetScale=new G.Vector4,this.setUniforms());a instanceof G.Vector4?this._uvOffsetScale.copy(a):this._uvOffsetScale.set(a,b,c,d);this._uvOffsetAndScaleModified()};WALK.StandardMaterial.prototype.getUvOffsetAndScaleByProperty=function(a){return this._uvOffsetScale[a]};
WALK.StandardMaterial.prototype.setUvOffsetAndScaleByProperty=function(a,b){switch(a){case "x":this._uvOffsetScale.setX(b);break;case "y":this._uvOffsetScale.setY(b);break;case "z":this._uvOffsetScale.setZ(b);break;case "w":this._uvOffsetScale.setW(b)}this._uvOffsetAndScaleModified()};
WALK.StandardMaterial.prototype.ensureTexturesRepeatable=function(){this._repeatableTexturesRequired=!0;var a=this.baseColorTexture;a&&a.parentTexture&&a.parentTexture.loaded&&(this._haveTextureLod&&WALK.DETECTOR.gl.standardDerivatives?(this.enableStandardDerivativesExtension(),this.enableTextureLodExtension(),this.addDefine("USE_BASE_COLOR_TEXTURE_ATLAS_REPEAT")):this._baseColorTexture.extractedTexture||(a.extractTexture(),this.setUniforms()))};
WALK.StandardMaterial.prototype.setUniforms=function(){this.setUniform("opacity","f",this.opacity);var a=!this.isLightProbeDisabled(),b=!1,c=this.roughnessTexture;this.condDefine(c&&c.loaded&&a,"USE_ROUGHNESS_TEXTURE")?(this.setUniform("roughnessTexture","t",c),b=!0):this.setUniform("roughness","f",this.roughness);c=this.metallicTexture;this.condDefine(c&&c.loaded&&a,"USE_METALLIC_TEXTURE")?(this.setUniform("metallicTexture","t",c),b=!0):this.setUniform("metallic","f",this.metallic);this.setUniform("emissionStrength",
"f",this.emissive?this.emissionStrength:0);this._baseColorTexture&&this.baseColorTextureCorrection?(xf.set(this.baseColor),xf.offsetHSL(this.baseColorTextureHslOffset.h,this.baseColorTextureHslOffset.s,this.baseColorTextureHslOffset.l),c=Math.max(1+this.baseColorTextureContrast,0),this._baseColorCorrectionUniform.set(c*(xf.r-this.baseColor.r-.5)+.5,c*(xf.g-this.baseColor.g-.5)+.5,c*(xf.b-this.baseColor.b-.5)+.5,c)):this._baseColorCorrectionUniform.set(0,0,0,1);this.setUniform("baseColorCorrection",
"v4",this._baseColorCorrectionUniform);c=null;if(this._baseColorTexture)if(this._baseColorTexture.parentTexture&&!this._baseColorTexture.extractedTexture){c=this._baseColorTexture.parentTexture;var d=this._baseColorTexture.uvOffsetScale}else c=this._baseColorTexture.extractedTexture||this._baseColorTexture,d=zf;this.condDefine(c&&c.loaded,"USE_BASE_COLOR_TEXTURE")?(this.setUniform("baseColorTexture","t",c),b=!0,this.setUniform("baseColorAtlasUvMod","v4",d),this._useBaseColorTextureAsCutout()?this.setUniform("alphaDiscardThreshold",
"f",.25):this.setUniform("alphaDiscardThreshold","f",0)):this.setUniform("baseColor","c",this.baseColor);this.condDefine(this._useAlphaInLowerHalf(),"USE_ALPHA_IN_LOWER_HALF");this.condDefine(this._useChromaKey(),"USE_CHROMA_KEY")&&(this.setUniform("chromaKeyColor","c",this.chromaKeyColor),d=this._chromaKeyDelta,this._chromaKeyDeltaCoeff.x=1/(1.22*d.x),this._chromaKeyDeltaCoeff.y=1/(1.22*d.y),this._chromaKeyDeltaCoeff.z=1/(1.22*d.z),this.setUniform("chromaKeyDeltaCoeff","v3",this._chromaKeyDeltaCoeff));
c=this.bumpTexture;this.condDefine(c&&c.loaded&&a,"USE_BUMP_TEXTURE")&&(this.enableStandardDerivativesExtension(),this.setUniform("bumpTexture","t",c),b=!0,this.setUniform("bumpScale","f",this.bumpScale),this.condDefine(this.parallaxCorrection,"USE_PARALLAX_CORRECTION")&&(this.addDefine(WALK.ParallaxModes[this.parallaxMode]),this.setUniform("parallaxScale","f",this.parallaxScale),this.setUniform("parallaxMinLayers","f",this.parallaxMinLayers),this.setUniform("parallaxMaxLayers","f",this.parallaxMaxLayers)));
b&&this.setUniform("uvMod","v4",this._uvOffsetScale||zf);this.condDefine(this.lightMapped&&!this.hideFromLightProbes,"USE_LIGHTMAP")&&this.setUniform("lightMap","t",null);this.condDefine(a,"USE_ENVMAP")&&(this._haveTextureLod&&this.enableTextureLodExtension(),this._setLightProbeUniforms());this.condDefine(this.highlight,"USE_HIGHLIGTH")&&(this.setUniform("highlight","c",this.highlight),this.setUniform("highlightMix","f",this.highlightMix));this.condDefine(this.hdrOutput,"HDR_OUTPUT");this.condDefine(!this.hdrOutput&&this.colorMap,
"USE_COLORMAP")&&this.setUniform("colorMap","t",this.colorMap);this.condDefine((this.headLight||!this.lightMapped)&&!this.specularOff,"USE_HEADLIGHT")};WALK.StandardMaterial.prototype.forceObjectUniformsRefresh=function(){this._lastUsedLightProbeId=null};WALK.StandardMaterial.prototype.textureNeedsUv0=function(){return!0};WALK.StandardMaterial.prototype.hash=function(){return this.baseColorTexture?"standard"+this.baseColorTexture.name:"standard#"+this.baseColor.r+":"+this.baseColor.g+":"+this.baseColor.b};
WALK.StandardMaterial.prototype.canMerge=function(a){if(this.type!==a.type||this.opacity!==a.opacity)return!1;if(this._baseColorTexture||a._baseColorTexture){if(this._baseColorTexture!==a._baseColorTexture||this.baseColorTextureCorrection!==a.baseColorTextureCorrection||this.baseColorTextureContrast!==a.baseColorTextureContrast||this.baseColorTextureHslOffset.h!==a.baseColorTextureHslOffset.h||this.baseColorTextureHslOffset.s!==a.baseColorTextureHslOffset.s||this.baseColorTextureHslOffset.l!==a.baseColorTextureHslOffset.l||
this._useAlphaInLowerHalf()!==a._useAlphaInLowerHalf()||(this._useChromaKey()?!(a._useChromaKey()&&this.chromaKeyColor.equals(a.chromaKeyColor)&&this._chromaKeyDelta.equals(a._chromaKeyDelta)):a._useChromaKey()))return!1}else if(!this.baseColor.equals(a.baseColor))return!1;if(this.emissive||a.emissive)if(this.emissive!==a.emissive||this.emissionStrength!==a.emissionStrength)return!1;if(this.roughnessTexture||a.roughnessTexture){if(this.roughnessTexture!==a.roughnessTexture)return!1}else if(this.roughness!==
a.roughness)return!1;if(this.metallicTexture||a.metallicTexture){if(this.metallicTexture!==a.metallicTexture)return!1}else if(this.metallic!==a.metallic)return!1;return(this.bumpTexture||a.bumpTexture)&&(this.bumpTexture!==a.bumpTexture||this.bumpScale!==a.bumpScale)||this.envMapProject!==a.envMapProject||this.doubleSided!==a.doubleSided||this.parallaxCorrection||a.parallaxCorrection?!1:!0};
WALK.StandardMaterial.prototype.refreshPerObjectUniforms=function(a,b){var c=!1;if(!this.isLightProbeDisabled()&&a.lightProbe){var d=a.lightProbe;if(this._lastUsedLightProbeId!==d.id){c=!0;this._lastUsedLightProbeId=d.id;var e=this.envMapMirror?d.getMirrorTexture():this._haveTextureLod?d.getFilteredTexture():d.getFilteredTextureNoLod(this._mipLevel0);b.envMap.value=e;this._haveTextureLod||(b.envMap2.value=d.getFilteredTextureNoLod(this._mipLevel1));this.envMapMirror||(b.envMipsCount.value=WALK.LIGHT_PROBE_MIPS_COUNT);
this.envMapProject&&(d.isBoundingBoxEnabled()?(b.envMapPosW.value=d.position,b.envBoxMin.value=d.boxMin,b.envBoxMax.value=d.boxMax):(b.envBoxMin.value=yf,b.envBoxMax.value=yf))}}a=a.lightMap;this.lightMapped&&b.lightMap&&b.lightMap.value!==a&&(c=!0,b.lightMap.value=a);return c};WALK.StandardMaterial.prototype.setBaseColorRGB=function(a,b,c){this.baseColor.setRGB(a,b,c);this.setUniforms();this._updated()};
WALK.StandardMaterial.prototype.setTexture=function(a,b){if(b){var c=this.baseColorTexture;c&&(b.wrapS=c.wrapS,b.wrapT=c.wrapT,b.anisotropy=c.anisotropy)}this[a]=b||null;"baseColorTexture"===a?(this._baseColorTextureCorrection=!1,this._baseColorTextureContrast=0,this.baseColorTextureHslOffset.h=0,this.baseColorTextureHslOffset.s=0,this.baseColorTextureHslOffset.l=0):"bumpTexture"===a&&(this._bumpScale=.001)};
WALK.StandardMaterial.prototype.serialize=function(){function a(e){var f=b[e];d[e]=f?f.serialize():null}var b=this,c=null;console.assert(!this.merged);this.baseColorTextureCorrection&&(c={contrast:this.baseColorTextureContrast,hslOffset:[this.baseColorTextureHslOffset.h,this.baseColorTextureHslOffset.s,this.baseColorTextureHslOffset.l]});var d={name:this.name,type:this.type,baseColor:this.baseColor.roundChannels().toArray(),baseColorTextureCorrection:c,alphaInLowerHalf:this.alphaInLowerHalf,opacity:this.opacity,
emissive:this.emissive,emissionStrength:this.emissionStrength,roughness:this.roughness,metallic:this.metallic,envMapProject:this.envMapProject,bumpScale:this.bumpScale,doubleSided:this.doubleSided,doNotImport:this.doNotImport};void 0!==this._chromaKeyEnabled&&(d.chromaKeyEnabled=this.chromaKeyEnabled,d.chromaKeyColor=this.chromaKeyColor.roundChannels().toArray(),d.chromaKeyDelta=this._chromaKeyDelta.toArray());d.uvOffsetScale=this.uvOffsetAndScaleEnabled?this._uvOffsetScale.toArray():null;a("baseColorTexture");
a("roughnessTexture");a("metallicTexture");a("bumpTexture");return d};WALK.StandardMaterialWater=function(){WALK.StandardMaterial.call(this);this.type="water";this._isPlaying=!0;this._isSleeping=!1;this.setUniform("time","f",0);this._roughness=0;this.baseColor=new G.Color(0);this._wavesScale=this._wavesSpeed=1;this._refractionFactor=0;this.opacity=.2;this.doNotImport={baseColor:!0,baseColorTexture:!0,opacity:!0}};WALK.StandardMaterialWater.prototype=Object.create(WALK.StandardMaterial.prototype);WALK.StandardMaterialWater.prototype.constructor=WALK.StandardMaterialWater;
WALK.StandardMaterialWater.prototype.addTextureProperty("normalTexture");WALK.StandardMaterialWater.prototype.textureNeedsUv0=function(){return!1};WALK.StandardMaterialWater.prototype.hash=function(){return"water"};WALK.StandardMaterialWater.prototype.canMerge=function(a){return this.type===a.type&&this.opacity===a.opacity&&this.baseColor.equals(a.baseColor)&&this.normalTexture===a.normalTexture&&this.wavesSpeed===a.wavesSpeed&&this.wavesScale===a.wavesScale&&this.refractionFactor===a.refractionFactor};
WALK.StandardMaterialWater.prototype.setUniforms=function(){WALK.StandardMaterial.prototype.setUniforms.call(this);var a=this.normalTexture;this.condDefine(a&&a.loaded&&!this.isLightProbeDisabled(),"USE_NORMAL_TEXTURE")&&(this.setUniform("normalTexture","t",a),this.setUniform("wavesScale","f",this.wavesScale),1!==this.opacity?this.setUniform("refractionFactor","f",this.refractionFactor):this.setUniform("refractionFactor","f",0))};WALK.StandardMaterialWater.prototype.fragmentShaderHooks=function(){return WALK.getShader("water.glsl")};
Object.defineProperty(WALK.StandardMaterialWater.prototype,"refractionFactor",{get:function(){return this._refractionFactor},set:function(a){this._refractionFactor=a;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterialWater.prototype,"wavesSpeed",{get:function(){return this._wavesSpeed},set:function(a){this._wavesSpeed=a;this.setUniforms();this._updated()}});
Object.defineProperty(WALK.StandardMaterialWater.prototype,"wavesScale",{get:function(){return this._wavesScale},set:function(a){this._wavesScale=a;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterialWater.prototype,"hideFromLightProbes",{get:function(){return 1!==this.opacity&&0!==this.refractionFactor}});Object.defineProperty(WALK.StandardMaterialWater.prototype,"isAnimated",{get:function(){return!0}});
Object.defineProperty(WALK.StandardMaterialWater.prototype,"isPlaying",{get:function(){return!this._isSleeping&&this._isPlaying&&0<this.wavesSpeed}});WALK.StandardMaterialWater.prototype.play=function(){this._isPlaying=!0};WALK.StandardMaterialWater.prototype.pause=function(){this._isPlaying=!1};WALK.StandardMaterialWater.prototype.sleepAnimation=function(){this._isSleeping=!0};WALK.StandardMaterialWater.prototype.wakeAnimation=function(){this._isSleeping=!1};
WALK.StandardMaterialWater.prototype.update=function(a){this.uniforms.time.value+=a*this.wavesSpeed*.1};WALK.StandardMaterialWater.prototype.serialize=function(){return{name:this.name,type:this.type,baseColor:this.baseColor.roundChannels().toArray(),baseColorTexture:null,opacity:this.opacity,normalTexture:this.normalTexture?this.normalTexture.serialize():null,wavesSpeed:this.wavesSpeed,wavesScale:this.wavesScale,refractionFactor:this.refractionFactor,doNotImport:this.doNotImport}};var Af=WALK.getShader("standard_material_vertex.glsl"),Bf=WALK.getShader("luma_fragment.glsl"),Cf=new G.Color(16777215);WALK.LumaMaterial=function(a){WALK.BaseMaterial.call(this,Af,Bf);this.computeIncidentLuma=a;this.setUniform("lightMap","t",null);this.color=new G.Color(Cf);this.setUniform("color","c",this.color);this.addDefine("USE_LIGHTMAP")};WALK.LumaMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.LumaMaterial.prototype.constructor=WALK.LumaMaterial;
WALK.LumaMaterial.prototype.refreshPerObjectUniforms=function(a,b){var c=a.lightMap,d=!1;b.lightMap.value!==c&&(b.lightMap.value=c,d=!0);a=this.computeIncidentLuma?Cf:a.material.baseColor;a.equals(this.color)||(this.color.copy(a),d=!0);return d};WALK.DebugMaterial=function(){WALK.StandardMaterial.call(this);this.noSharedBuffers=new G.Color(16777215);this.sharedBuffersMaster=new G.Color(255);this.sharedBuffersCopy=new G.Color(65280);this.headLight=!0;this.setUniforms();this.defaultAttributeValues=Object.assign({},this.defaultAttributeValues);this.defaultAttributeValues.sphericalNormal=[0,0]};WALK.DebugMaterial.prototype=Object.create(WALK.StandardMaterial.prototype);
WALK.DebugMaterial.prototype.refreshPerObjectUniforms=function(a,b){b.baseColor.value=0===a.sharedBuffersDebug?this.noSharedBuffers:1===a.sharedBuffersDebug?this.sharedBuffersMaster:this.sharedBuffersCopy;return!0};var Df=WALK.getShader("equirect_sky_vertex.glsl"),Ef=WALK.getShader("equirect_sky_fragment.glsl");WALK.EquirectSkyMaterial=function(){WALK.BaseMaterial.call(this,Df,Ef);this.depthWrite=!1;this.side=G.FrontSide;this.uniforms={map:{type:"t",value:null},colorMap:{type:"t",value:null},exposure:{type:"f",value:1},cameraGamma:{type:"f",value:1}}};WALK.EquirectSkyMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.EquirectSkyMaterial.prototype.constructor=WALK.EquirectSkyMaterial;
Object.defineProperty(WALK.EquirectSkyMaterial.prototype,"map",{get:function(){return this.uniforms.map.value},set:function(a){this.uniforms.map.value=a;this.condDefine(this.map.isRgbm,"USE_RGBM_MAP")}});Object.defineProperty(WALK.EquirectSkyMaterial.prototype,"hdrOutput",{get:function(){return this.hasDefine("HDR_OUTPUT")},set:function(a){this.condDefine(a,"HDR_OUTPUT")}});
Object.defineProperty(WALK.EquirectSkyMaterial.prototype,"colorMap",{get:function(){return this.uniforms.colorMap.value},set:function(a){this.uniforms.colorMap.value=a;this.condDefine(a,"USE_COLORMAP")}});Object.defineProperty(WALK.EquirectSkyMaterial.prototype,"cameraExposure",{get:function(){return Math.log2(this.uniforms.exposure.value)},set:function(a){this.uniforms.exposure.value=Math.pow(2,a)}});
Object.defineProperty(WALK.EquirectSkyMaterial.prototype,"cameraGamma",{get:function(){return this.uniforms.cameraGamma.value},set:function(a){this.uniforms.cameraGamma.value=a}});WALK.ProceduralSkyMaterial=function(){WALK.BaseMaterial.call(this,WALK.getShader("procedural_sky_vertex.glsl"),WALK.getShader("procedural_sky_fragment.glsl"));this.depthWrite=!1;this.side=G.BackSide;this.uniforms={topColor:{type:"c",value:new G.Color(15135487)},bottomColor:{type:"c",value:new G.Color(16777215)},sinBottomAngle:{type:"f",value:Math.sin(G.Math.degToRad(-30))},exponent:{type:"f",value:.9},colorMap:{type:"t",value:null}}};WALK.ProceduralSkyMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);
WALK.ProceduralSkyMaterial.prototype.constructor=WALK.ProceduralSkyMaterial;Object.defineProperty(WALK.ProceduralSkyMaterial.prototype,"hdrOutput",{get:function(){return this.hasDefine("HDR_OUTPUT")},set:function(a){this.condDefine(a,"HDR_OUTPUT")}});Object.defineProperty(WALK.ProceduralSkyMaterial.prototype,"colorMap",{get:function(){return this.uniforms.colorMap.value},set:function(a){this.uniforms.colorMap.value=a;this.condDefine(a,"USE_COLORMAP")}});var Ff=WALK.getShader("object_distance_vertex.glsl"),Gf=WALK.getShader("object_id_fragment.glsl"),Hf=WALK.getShader("object_id_distance_fragment.glsl");WALK.ObjectDistanceMaterial=function(a){WALK.BaseMaterial.call(this,Ff,a?Gf:Hf);this.doNotOverrideSide=!0;this.uniforms={objectId:{type:"i",value:null}}};WALK.ObjectDistanceMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.ObjectDistanceMaterial.prototype.constructor=WALK.ObjectDistanceMaterial;
WALK.ObjectDistanceMaterial.prototype.refreshPerObjectUniforms=function(a,b){b.objectId.value=a.visibilityId;return!0};var If=WALK.getShader("wireframe_vertex.glsl"),Jf=WALK.getShader("wireframe_fragment.glsl");
WALK.WireframeMaterial=function(a){WALK.BaseMaterial.call(this,If,Jf);this.lineColor=a;this.setUniform("lineColor","c",a);this.setUniform("lineMaxAlpha","f",.65);this.setUniform("highlight","c",WALK.EDITOR_SELECTION_COLOR);this.setUniform("highlightMix","f",0);this.customLightmapResolutionLineColor=new G.Color(170);this.autoLightmapResolutionLineColor=new G.Color(43690);this.meshSelectedLineColor=new G.Color(47872);this.meshSelectedSecondaryLineColor=new G.Color(13404160);this.transparent=!0;this.blending=
G.NormalBlending;this.depthWrite=this.depthTest=!1;this.attributes=this.attributes.concat(["order"]);this.enableStandardDerivativesExtension()};WALK.WireframeMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.WireframeMaterial.prototype.constructor=WALK.WireframeMaterial;WALK.WireframeMaterial.prototype.propertyFromUniform("lineMaxAlpha");WALK.WireframeMaterial.prototype.propertyFromUniform("highlight");WALK.WireframeMaterial.prototype.propertyFromUniform("highlightMix");
WALK.WireframeMaterial.prototype.refreshPerObjectUniforms=function(a,b){var c=!1;null!==a.highlightMix&&void 0!==a.highlightMix&&a.highlightMix!==b.highlightMix.value&&(b.highlightMix.value=a.highlightMix,c=!0);return null!==a.selected&&void 0!==a.selected&&(a=!0===a.selected?this.meshSelectedLineColor:!0===a.selectedSecondary?this.meshSelectedSecondaryLineColor:null!==a.node.lightmapResolution?this.customLightmapResolutionLineColor:0<=a.autoLightmapResolution?this.autoLightmapResolutionLineColor:
this.lineColor,b.lineColor.value!==a)?(b.lineColor.value=a,!0):c};var Kf=new WALK.InlineShader("attr vec3 envLookup;\nvarOut vec3 vEnvLookup;\nvoid main() {\nvEnvLookup = envLookup;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"),Lf=new WALK.InlineShader("uniform samplerCube envMap;\nvarIn vec3 vEnvLookup;\nvoid main() {\nint objectId = int(textureCube(envMap, vEnvLookup).x);\nint x = objectId / (256 * 256);\nint y = (objectId - 256 * 256 * x) / 256;\nint z = (objectId - 256 * 256 * x - 256 * y);\nfragColor = vec4(float(x) / 255.0, float(y) / 255.0,\nfloat(z) / 255.0, 1.0);\n}");
WALK.ObjectDistanceReader=function(a,b){var c=[],d=[],e=3*b,f=2*b;this.readCubeMapToBuffer=function(v){r.uniforms.envMap.value=v;n.set(!0,!1,!1);a.render(k,g,h);a.readPixels(e,f,l);n.restore();return l};this.dispose=function(){for(var v=0;6>v;v+=1)c[v].geometry.dispose();r.dispose();h.dispose();l=null};var g=new G.OrthographicCamera(-1,1,1,-1,0,1);var k=new G.Scene;var h=a.createRenderTarget(e,f,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1});
var l=new Uint8Array(4*e*f);var n=new be(a);var r=new WALK.BaseMaterial(Kf,Lf);r.uniforms={envMap:{type:"t",value:null}};r.attributes={envLookup:{type:"v3",value:null}};(function(){for(var v=[[[1,1,1],[1,1,-1],[1,-1,1],[1,-1,-1]],[[-1,1,-1],[-1,1,1],[-1,-1,-1],[-1,-1,1]],[[-1,1,-1],[1,1,-1],[-1,1,1],[1,1,1]],[[-1,-1,1],[1,-1,1],[-1,-1,-1],[1,-1,-1]],[[-1,1,1],[1,1,1],[-1,-1,1],[1,-1,1]],[[1,1,-1],[-1,1,-1],[1,-1,-1],[-1,-1,-1]]],p=0;6>p;p+=1){var w=new G.PlaneBufferGeometry(b,b),u=new Float32Array(12);
w.addAttribute("envLookup",new G.BufferAttribute(u,3));for(var y=0;4>y;y+=1){var B=y,D=v[p][y];u[3*B]=D[0];u[3*B+1]=D[1];u[3*B+2]=D[2]}c[p]=new G.Mesh(w,r);k.add(c[p])}d[0]=[0,0];d[1]=[b,0];d[2]=[2*b,0];d[3]=[0,b];d[4]=[b,b];d[5]=[2*b,b]})();(function(v,p){v/=2;var w=p/2;g.left=-v;g.right=v;g.top=w;g.bottom=-w;g.updateProjectionMatrix();p=-v+b/2;v=w-b/2;for(w=0;w<c.length;w+=1)c[w].position.set(p+d[w][0],v-d[w][1],0)})(e,f)};WALK.ObjectVisibilityQuery=function(a,b,c){var d=new WALK.ObjectDistanceMaterial(!0),e=new WALK.CubeCamera(WALK.CAMERA_WALK_NEAR,c),f=WALK.OBJECT_VISIBILITY_TARGET_SIZE,g=a.createRenderTarget(f,f,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,depthBuffer:!0,stencilBuffer:!1,generateMipmaps:!1}),k=new Uint8Array(4*f*f),h=new be(a),l=new ae(a),n=new G.Color(16777215);this.findVisibleObjects=function(r){var v=new Set,p=[];e.position.copy(r);e.updateMatrixWorld();for(r=0;r<b.length;r+=1){var w=
b[r];console.assert(!w.visibilityId);w.visibilityId=r;p.push(w)}h.set(!0,!0,!1);l.set(n);for(r=0;6>r;r+=1){a.renderMeshes(p,d,e.sideCameras[r],g);a.readPixels(f,f,k);w=k;for(var u=w.length,y=0;y<u;y+=4){var B=Math.round(65536*w[y]+256*w[y+1]+w[y+2]);16777215!==B&&v.add(B)}}l.restore();h.restore();p=[];v=m.makeIterator(v);for(r=v.next();!r.done;r=v.next())p.push(b[r.value]);for(v=0;v<b.length;v+=1)b[v].visibilityId=null;return p};this.dispose=function(){d.dispose();g.dispose();k=g=null}};
WALK.ObjectVisibilityQuery.prototype.constructor=WALK.ObjectDistanceQuery;var Mf=WALK.getShader("aabb_query_vertex.glsl"),Nf=WALK.getShader("aabb_query_fragment.glsl");WALK.AabbQueryMaterial=function(){WALK.BaseMaterial.call(this,Mf,Nf);this.side=G.DoubleSide;this.uniforms={axis:{type:"i",value:0}}};WALK.AabbQueryMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.AabbQueryMaterial.prototype.constructor=WALK.AabbQueryMaterial;
Object.defineProperty(WALK.AabbQueryMaterial.prototype,"axis",{get:function(){return this.uniforms.axis.value},set:function(a){console.assert(0===a||1===a||2===a);this.uniforms.axis.value=a}});var Of=WALK.getShader("gaze_pointer_vertex.glsl"),Pf=WALK.getShader("gaze_pointer_fragment.glsl");WALK.GazePointerMaterial=function(){WALK.BaseMaterial.call(this,Of,Pf);this.blending=G.NormalBlending;this.transparent=!0;this.transparentRenderOrder=2;this.setUniform("circleSpan","f",0)};WALK.GazePointerMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.GazePointerMaterial.prototype.constructor=WALK.GazePointerMaterial;
Object.defineProperty(WALK.GazePointerMaterial.prototype,"circleSpan",{set:function(a){console.assert(1>=a);this.uniforms.circleSpan.value=2*Math.PI*a-Math.PI}});var Qf=WALK.getShader("editor_light_vertex.glsl"),Rf=WALK.getShader("editor_light_fragment.glsl");WALK.LightMaterial=function(a){WALK.BaseMaterial.call(this,Qf,Rf);this.setUniform("color","c",a.color);this.setUniform("highlight","c",WALK.EDITOR_SELECTION_COLOR);this.setUniform("highlightMix","f",0)};WALK.LightMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.LightMaterial.prototype.propertyFromUniform("highlightMix");WALK.MirrorMaterial=function(a,b){WALK.BaseMaterial.call(this,WALK.getShader("mirror_vertex.glsl"),WALK.getShader("mirror_fragment.glsl"));this.hideFromLightProbes=!0;this.uniforms={mirrorColor:{type:"c",value:a},mirrorSampler:{type:"t",value:null},textureMatrix:{type:"m4",value:b}}};WALK.MirrorMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.MirrorMaterial.prototype.constructor=WALK.MirrorMaterial;
Object.defineProperty(WALK.MirrorMaterial.prototype,"hdrOutput",{get:function(){return this.hasDefine("HDR_OUTPUT")},set:function(a){this.condDefine(a,"HDR_OUTPUT")}});Object.defineProperty(WALK.MirrorMaterial.prototype,"mirrorSampler",{get:function(){return this.uniforms.mirrorSampler.value},set:function(a){this.uniforms.mirrorSampler.value=a}});var Sf=WALK.getShader("cap_vertex.glsl"),Tf=WALK.getShader("cap_fragment.glsl");WALK.CapMaterial=function(a){WALK.BaseMaterial.call(this,Sf,Tf);this.side=G.DoubleSide;this.uniforms={color:{type:"c",value:a}}};WALK.CapMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.CapMaterial.prototype.constructor=WALK.CapMaterial;var Uf=WALK.getShader("outline_vertex.glsl"),Vf=WALK.getShader("outline_fragment.glsl");WALK.OutlineMaterial=function(a,b){WALK.BaseMaterial.call(this,Uf,Vf);this.side=G.DoubleSide;this.uniforms={color:{type:"c",value:a},thickness:{type:"f",value:b}}};WALK.OutlineMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.OutlineMaterial.prototype.constructor=WALK.OutlineMaterial;WALK.createBoundingBoxMaterial=function(){var a=new WALK.WireframeMaterial(WALK.EDITOR_SELECTION_COLOR);a.depthTest=!0;a.depthWrite=!1;a.side=G.DoubleSide;a.hideFromLightProbes=!0;return a};var Wf=WALK.getShader("anchor_vertex.glsl");WALK.AnchorMaterial=function(){WALK.StandardMaterial.call(this);this._vertexShaderBody=Wf;this._metallic=.1;this._roughness=.5;this._bumpScale=.01;this.hideFromLightProbes=!0};WALK.AnchorMaterial.prototype=Object.create(WALK.StandardMaterial.prototype);var Xf=WALK.getShader("anchor_sprite_vertex.glsl");WALK.AnchorSpriteMaterial=function(){WALK.StandardMaterial.call(this);this._vertexShaderBody=Xf;this.hideFromLightProbes=!0};
WALK.AnchorSpriteMaterial.prototype=Object.create(WALK.StandardMaterial.prototype);var Yf=WALK.getShader("rotate_gizmo_material_vertex.glsl"),lg=WALK.getShader("rotate_gizmo_material_fragment.glsl");
WALK.RotateGizmoMaterial=function(a,b){WALK.BaseMaterial.call(this,Yf,lg);this.blending=G.NormalBlending;this.depthWrite=this.depthTest=!1;this.transparent=!0;this.transparentRenderOrder=1E3;this.hideFromLightProbes=!0;this.uniforms={opacity:{type:"f",value:1},color:{type:"c",value:a},gizmoPosition:{type:"v3",value:new G.Vector3(0,0,0)},sphereRadius:{type:"f",value:1}};Object.defineProperty(this,"color",{get:function(){return this.uniforms.color.value}});Object.defineProperty(this,"opacity",{get:function(){return this.uniforms.opacity.value},
set:function(c){this.uniforms.opacity.value=c}});Object.defineProperty(this,"gizmoPosition",{get:function(){return this.uniforms.gizmoPosition.value}});Object.defineProperty(this,"sphereRadius",{get:function(){return this.uniforms.sphereRadius.value},set:function(c){this.uniforms.sphereRadius.value=c}});this.opacity=b;this.setUniforms=function(){}};WALK.RotateGizmoMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.RotateGizmoMaterial.prototype.constructor=WALK.RotatoGizmoMaterial;WALK.Camera=function(){var a=this;G.PerspectiveCamera.call(this,WALK.CAMERA_DEFAULT_FOV,1,WALK.CAMERA_WALK_NEAR,WALK.CAMERA_MIN_FAR);this._defaultFov=this.fov;this._exposure=this._defaultExposure=0;this._gamma=this._defaultGamma=1;this._autoExposure=!1;this._autoExposureDarkness=.3;this._moveMaxSpeed=WALK.CAMERA_DEFAULT_MOVE_MAX_SPEED;this._autoClimb=this._autoPath=!1;this._colorMap=this._fixedHeight=null;this._exposureUpdatedEvent={type:"exposureUpdated",target:null};this._gammaUpdatedEvent={type:"gammaUpdated",
target:null};this._colorMapUpdated={type:"colorMapUpdated",target:null};var b={type:"updated",target:this};this._updated=function(){return a.dispatchEvent(b)}};WALK.Camera.prototype=Object.create(G.PerspectiveCamera.prototype);WALK.Camera.prototype.constructor=WALK.Camera;Object.defineProperty(WALK.Camera.prototype,"defaultFov",{get:function(){return this._defaultFov},set:function(a){this.fov=this._defaultFov=a;this._updated()}});
Object.defineProperty(WALK.Camera.prototype,"colorMap",{get:function(){return this._colorMap},set:function(a){var b=this;this._colorMap&&this._colorMap.dispose();(this._colorMap=a)?a.addLoadedListener(function(){return b.dispatchEvent(b._colorMapUpdated)}):this.dispatchEvent(this._colorMapUpdated)}});WALK.Camera.prototype.colorMapReady=function(){return this._colorMap&&this._colorMap.loaded};
Object.defineProperty(WALK.Camera.prototype,"defaultExposure",{get:function(){return this._defaultExposure},set:function(a){this._defaultExposure=a;this._updated()}});Object.defineProperty(WALK.Camera.prototype,"exposure",{get:function(){return this._exposure},set:function(a){a!==this._exposure&&(this._exposure=a,this.dispatchEvent(this._exposureUpdatedEvent))}});WALK.Camera.prototype.setExposureController=function(a){this.exposureController=a};
WALK.Camera.prototype.setExposure=function(a){this.exposureController?this.exposureController.setTargetExposure(a):this.exposure=a};Object.defineProperty(WALK.Camera.prototype,"defaultGamma",{get:function(){return this._defaultGamma},set:function(a){this._defaultGamma=a;this._updated()}});Object.defineProperty(WALK.Camera.prototype,"gamma",{get:function(){return this._gamma},set:function(a){a!==this._gamma&&(this._gamma=a,this.dispatchEvent(this._gammaUpdatedEvent))}});
WALK.Camera.prototype.setGamma=function(a){this.gamma=a};Object.defineProperty(WALK.Camera.prototype,"autoExposure",{get:function(){return this._autoExposure},set:function(a){a!==this._autoExposure&&(this._autoExposure=a,this._exposure=this._defaultExposure,this._updated())}});WALK.Camera.prototype.setFar=function(a){this.far=a;this.updateProjectionMatrix();this._updated()};
Object.defineProperty(WALK.Camera.prototype,"moveMaxSpeed",{get:function(){return this._moveMaxSpeed},set:function(a){this._moveMaxSpeed=a;this._updated()}});Object.defineProperty(WALK.Camera.prototype,"autoPath",{get:function(){return this._autoPath},set:function(a){this._autoPath=a;this._updated()}});Object.defineProperty(WALK.Camera.prototype,"autoClimb",{get:function(){return this._autoClimb},set:function(a){this._autoClimb=a;this._updated()}});
Object.defineProperty(WALK.Camera.prototype,"autoExposureDarkness",{get:function(){return this._autoExposureDarkness},set:function(a){this._autoExposureDarkness=a;this._updated()}});Object.defineProperty(WALK.Camera.prototype,"fixedHeight",{get:function(){return this._fixedHeight||WALK.CAMERA_FIXED_HEIGHT},set:function(a){this._fixedHeight=a;this._updated()}});
WALK.Camera.prototype.serialize=function(){return{fov:this.defaultFov,exposure:this.defaultExposure,gamma:this.defaultGamma,lutTexture:this.colorMap?this.colorMap.serialize():null,autoPath:this.autoPath,autoClimb:this.autoClimb,moveMaxSpeed:this.moveMaxSpeed,fixedHeight:this._fixedHeight}};G.EventDispatcher.prototype.apply(WALK.Camera.prototype);WALK.LightInstance=function(a,b,c){this.light=a;this.position=b;this.rotation=c;this._directionW=new G.Vector3};
WALK.LightInstance.prototype={constructor:WALK.LightInstance,directionW:function(){this._directionW.set(0,1,0);this._directionW.applyEuler(this.rotation);return this._directionW},get index(){var a=this.light.instances.indexOf(this);console.assert(-1!==a,"Light instance not found");return a},setPosition:function(a,b,c){this.position.set(a,b,c);this.light._updated()},setRotation:function(a,b,c){this.rotation.yaw=WALK.normalizeRotation(a);this.rotation.pitch=WALK.normalizeRotation(b);this.rotation.roll=
WALK.normalizeRotation(c);this.light._updated()},setRotationDeg:function(a,b,c){a=G.Math.degToRad(a);b=G.Math.degToRad(b);c=void 0===c?this.rotation.roll:G.Math.degToRad(c);this.setRotation(a,b,c)},serialize:function(){return{position:this.position.toArray(),rotation:this.rotation.toDegTriple()}}};var mg="angle color height photometricProfile strength size type width".split(" ");
WALK.Light=function(a){this._name=a.name;this._type=a.type||"spot";if(void 0!==a.strength)var b=a.strength;else a:{switch(this._type){case "point":case "spot":case "area":b=25;break a;case "sun":b=8;break a;default:console.assert(!1)}b=void 0}this._strength=b;if(void 0!==a.color)b=(new G.Color).fromArray(a.color);else a:{switch(this._type){case "point":case "spot":case "area":b=new G.Color(1,.88,.799);break a;case "sun":b=new G.Color(1,.8,.638);break a;default:console.assert(!1)}b=void 0}this._color=
b;if(void 0!==a.size)b=a.size;else a:{switch(this._type){case "point":case "spot":case "area":b=.1;break a;case "sun":b=.02;break a;default:console.assert(!1)}b=void 0}this._size=b;this._width=void 0!==a.width?a.width:.2;this._height=void 0!==a.height?a.height:.2;this._angle=void 0!==a.angle?a.angle:140;this._photometricProfile=void 0!==a.photometricProfile?a.photometricProfile:null;!0===a.doNotImport?this.doNotImport=!0:(this.doNotImport={},a.doNotImport&&WALK.copyProperties(a.doNotImport,mg,this.doNotImport));
this.instances=[]};
WALK.Light.prototype={constructor:WALK.Light,forEachLightInstance:function(a){for(var b=0;b<this.instances.length;b+=1)a(this.instances[b])},get name(){return this._name},set name(a){this._name=a;this._updated()},get type(){return this._type},set type(a){this._type=a;this._updated()},get size(){return this._size},set size(a){this._size=a;this._updated()},get width(){return this._width},set width(a){this._width=a;this._updated()},get height(){return this._height},set height(a){this._height=a;this._updated()},
get angle(){return this._angle},set angle(a){this._angle=a;this._updated()},get color(){return this._color},setColorRGB:function(a,b,c){this._color.setRGB(a,b,c);this._updated()},get strength(){return this._strength},set strength(a){this._strength=a;this._updated()},get photometricProfile(){return this._photometricProfile},set photometricProfile(a){this._photometricProfile=a;this._updated()},setDoNotImport:function(a,b){this.doNotImport[a]=b;this._updated()},addInstance:function(a,b){b=void 0===b?
[0,-90,0]:b;a=(new G.Vector3).fromArray(a);b=(new WALK.Euler).setFromDegTriple(b);b=new WALK.LightInstance(this,a,b);this.instances.push(b);this.dispatchEvent({type:"instanceAdded",instance:b,target:this})},removeInstance:function(a){WALK.removeFromArray(a,this.instances);this.dispatchEvent({type:"instanceRemoved",instance:a,target:this})},serialize:function(){return{name:this.name,type:this.type,angle:this.angle,strength:this.strength,photometricProfile:this.photometricProfile,size:this.size,width:this.width,
height:this.height,color:this.color.roundChannels().toArray(),doNotImport:this.doNotImport,instances:this.instances.map(function(a){return a.serialize()})}},_updated:function(){this.dispatchEvent({type:"updated",target:this})}};G.EventDispatcher.prototype.apply(WALK.Light.prototype);WALK.Light.iterateLightInstances=function(a,b){for(var c=1,d=0;d<a.length;d+=1)for(var e=a[d],f=0;f<e.instances.length;f+=1,c+=1)b(e,e.instances[f],c)};WALK.LightProbe=function(a){this.id=a.id;this.position=new G.Vector3;a.position&&this.position.fromArray(a.position);this._filteredCubeTexture=null;this._filteredCubeTextureNoLod={};this._mirrorCubeTexture=null;this._boxEnabled=a.box?!("enabled"in a.box)||a.box.enabled:!1;this.boxMin=new G.Vector3;this.boxMax=new G.Vector3;a.box&&(this.boxMin.fromArray(a.box.min),this._setClampedBoxMax(a.box.max[0],a.box.max[1],a.box.max[2]))};
WALK.LightProbe.prototype={constructor:WALK.LightProbe,setFilteredTexture:function(a){this._filteredCubeTexture&&this._filteredCubeTexture.dispose();this._filteredCubeTexture=a},setFilteredTextureNoLod:function(a,b){this._filteredCubeTextureNoLod[b]&&this._filteredCubeTextureNoLod[b].dispose();this._filteredCubeTextureNoLod[b]=a},isBoundingBoxInitialized:function(){return!this.boxMin.equals(this.boxMax)},resetBoundingBox:function(){this.boxMin.set(0,0,0);this.boxMax.set(0,0,0)},isBoundingBoxEnabled:function(){return this._boxEnabled},
disableBoundingBox:function(){this._boxEnabled=!1;this.dispatchEvent({type:"boundsUpdated",target:this})},enableBoundingBox:function(){this._boxEnabled=!0;this.isBoundingBoxInitialized()||this.dispatchEvent({type:"boundsInit",target:this});this.dispatchEvent({type:"boundsUpdated",target:this})},getFilteredTexture:function(){return this._filteredCubeTexture},getFilteredTextureNoLod:function(a){return this._filteredCubeTextureNoLod[a]},setMirrorTexture:function(a){this._mirrorCubeTexture&&this._mirrorCubeTexture.dispose();
this._mirrorCubeTexture=a},setPosition:function(a,b,c){this.position.set(a,b,c);this.dispatchEvent({type:"positionUpdated",target:this})},texturesReady:function(){return this._mirrorCubeTexture||this._filteredCubeTexture||this._filteredCubeTextureNoLod[0]},getMirrorTexture:function(){return this._mirrorCubeTexture||this._filteredCubeTexture||this._filteredCubeTextureNoLod[0]},_setClampedBoxMin:function(a,b,c){a>this.boxMax.x-.1&&(a=this.boxMax.x-.1);b>this.boxMax.y-.1&&(b=this.boxMax.y-.1);c>this.boxMax.z-
.1&&(c=this.boxMax.z-.1);this.boxMin.set(a,b,c)},setBoxMin:function(a,b,c){this._setClampedBoxMin(a,b,c);this.dispatchEvent({type:"boundsUpdated",target:this})},_setClampedBoxMax:function(a,b,c){a<this.boxMin.x+.1&&(a=this.boxMin.x+.1);b<this.boxMin.y+.1&&(b=this.boxMin.y+.1);c<this.boxMin.z+.1&&(c=this.boxMin.z+.1);this.boxMax.set(a,b,c)},setBoxMax:function(a,b,c){this._setClampedBoxMax(a,b,c);this.dispatchEvent({type:"boundsUpdated",target:this})},serialize:function(){var a={id:this.id,position:this.position.toArray()};
this.isBoundingBoxInitialized()&&(a.box={enabled:this._boxEnabled,min:this.boxMin.toArray(),max:this.boxMax.toArray()});return a},dispose:function(){this._filteredCubeTexture&&(this._filteredCubeTexture.dispose(),this._filteredCubeTexture=null);for(var a in this._filteredCubeTextureNoLod)this._filteredCubeTextureNoLod.hasOwnProperty(a)&&this._filteredCubeTextureNoLod[a].dispose();this._filteredCubeTextureNoLod={};this._mirrorCubeTexture&&(this._mirrorCubeTexture.dispose(),this._mirrorCubeTexture=
null)}};G.EventDispatcher.prototype.apply(WALK.LightProbe.prototype);function ng(a){return null!==a&&void 0!==a}
WALK.NodeConfig=function(a){var b=this;this.name=a.name;this._editable=a.editable||!1;this._setsDisableCollisions=ng(a.disableCollisions);this._disableCollisions=a.disableCollisions||!1;this._setsHideInViews=ng(a.hideInViews);this.hideInViews=null;a.hideInViews&&(this.hideInViews=a.hideInViews,this.hideInViews.sort());this._lightmapResolution=(this._setsLightmapResolution=ng(a.lightmapResolution))?a.lightmapResolution:null;this._ground=ng(a.ground)?a.ground:!1;this._faceCamera=a.faceCamera||null;
this._rotate=a.rotate||!1;this._rotationSpeed=a.rotationSpeed||.1;this._isolateShadows=ng(a.isolateShadows)?a.isolateShadows:!1;this.nodes=[];var c={type:"updated",target:this};this._updated=function(){return b.dispatchEvent(c)}};WALK.NodeConfig.prototype.constructor=WALK.NodeConfig;G.EventDispatcher.prototype.apply(WALK.NodeConfig.prototype);function og(a){a.configure()}function pg(a){a.visitSubtree(og)}WALK.NodeConfig.prototype._configUpdated=function(){this.nodes.forEach(pg);this._updated()};
WALK.NodeConfig.prototype.addNode=function(a){this.nodes.push(a)};WALK.NodeConfig.prototype.isOnHideInViews=function(a){return-1!==this.hideInViews.indexOf(a)};WALK.NodeConfig.prototype.addToHideInViews=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];console.assert(this.setsHideInViews);b=m.makeIterator(b);for(c=b.next();!c.done;c=b.next())c=c.value,console.assert(!this.isOnHideInViews(c)),this.hideInViews.push(c);this._updated()};
WALK.NodeConfig.prototype.removeFromHideInViews=function(a){if(this.hideInViews)for(var b=0;b<this.hideInViews.length;)this.hideInViews[b]===a?this.hideInViews.splice(b,1):b+=1;this._updated()};
WALK.NodeConfig.prototype.serialize=function(){return{name:this.name,disableCollisions:this.setsDisableCollisions?this.disableCollisions:null,hideInViews:this.setsHideInViews?this.hideInViews:null,lightmapResolution:this.setsLightmapResolution?this.lightmapResolution:null,ground:this.ground?!0:null,faceCamera:this.faceCamera,rotate:this.rotate?!0:null,rotationSpeed:this.rotate?this.rotationSpeed:null,isolateShadows:this.isolateShadows?!0:null}};
Object.defineProperty(WALK.NodeConfig.prototype,"setsDisableCollisions",{get:function(){return this._setsDisableCollisions},set:function(a){this._setsDisableCollisions=a;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"disableCollisions",{get:function(){return this._disableCollisions},set:function(a){console.assert(this._setsDisableCollisions);this._disableCollisions=a;this._configUpdated()}});
Object.defineProperty(WALK.NodeConfig.prototype,"editable",{get:function(){return this._editable||this.faceCamera||this.rotate},set:function(a){this._editable=a;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"ground",{get:function(){return this._ground},set:function(a){this._ground=a;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"faceCamera",{get:function(){return this._faceCamera},set:function(a){this._faceCamera=a;this._configUpdated()}});
Object.defineProperty(WALK.NodeConfig.prototype,"rotate",{get:function(){return this._rotate},set:function(a){this._rotate=a;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"rotationSpeed",{get:function(){return this._rotationSpeed},set:function(a){0===a&&(a=.01);this._rotationSpeed=a;this._configUpdated()}});
Object.defineProperty(WALK.NodeConfig.prototype,"setsLightmapResolution",{get:function(){return this._setsLightmapResolution},set:function(a){this._setsLightmapResolution=a;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"lightmapResolution",{get:function(){return this._lightmapResolution},set:function(a){console.assert(this._setsLightmapResolution);this._lightmapResolution=a;this._configUpdated()}});
Object.defineProperty(WALK.NodeConfig.prototype,"isolateShadows",{get:function(){return this._isolateShadows},set:function(a){this._isolateShadows=a;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"setsHideInViews",{get:function(){return this._setsHideInViews},set:function(a){this._setsHideInViews=a;null===this.hideInViews&&(this.hideInViews=[]);this._configUpdated()}});
function qg(a){function b(){e=new G.Vector3;var k=new G.Box3;a.visitSubtree(function(h){(h=h.mesh)&&k.union(h.geometry.boundingBox)});k.center(e);d.elements[12]=-e.x;d.elements[13]=-e.y;d.elements[14]=-e.z}var c=new G.Matrix4,d=new G.Matrix4,e,f=new G.Vector3,g=new WALK.Euler;return function(k,h){e||b();if(a.config.faceCamera)return f.copy(h).sub(e).normalize(),g.setFromDirection(f),"yaw"===a.config.faceCamera&&(g.pitch=0),c.makeRotationFromEuler(g),a.animationMatrix.identity().setPosition(e).multiply(c).multiply(d),
!1;console.assert(a.config.rotate);g.yaw=WALK.normalizeRotation(g.yaw+2*Math.PI*a.config.rotationSpeed*k);c.makeRotationFromEuler(g);a.animationMatrix.identity().setPosition(e).multiply(c).multiply(d);return!0}}
WALK.Node=function(a,b,c){this.id=c.id;this.initialLightProbeId=void 0===c.lightProbeId?null:c.lightProbeId;this.parent=a;this.config=b;this.children=[];this.shadowsIsolatedWithin=this.lightmapResolution=this.hideInViews=this.animationMatrix=this.ground=this.disableCollisions=this._facesCnt=this.mesh=null;this.editable=!1;this.editableRoot=null;b.addNode(this);this.configure()};WALK.Node.prototype.constructor=WALK.Node;
WALK.Node.prototype.configure=function(){this.ground=(this.disableCollisions=this.config.setsDisableCollisions?this.config.disableCollisions:this.parent?this.parent.disableCollisions:!1)?!1:this.config.ground;this.isAnimatedRoot?(this.animationMatrix=new G.Matrix4,this.update=qg(this)):this.animationMatrix=this.parent?this.parent.animationMatrix:null;this.hideInViews=this.config.setsHideInViews?this.config.hideInViews:this.parent?this.parent.hideInViews:null;this.lightmapResolution=this.config.setsLightmapResolution?
this.config.lightmapResolution:this.parent?this.parent.lightmapResolution:null;this.shadowsIsolatedWithin=this.config.isolateShadows?this.config.name:this.parent&&this.parent.shadowsIsolatedWithin?this.parent.shadowsIsolatedWithin:null;this.editableRoot=(this.editable=this.config.editable)?this:this.parent?this.parent.editableRoot:null};WALK.Node.prototype.visitSubtree=function(a){a(this);var b=this.children;if(b)for(var c=0;c<b.length;c+=1)b[c].visitSubtree(a)};
WALK.Node.prototype.facesInSubtree=function(){var a=this;null===a._facesCnt&&(a._facesCnt=0,a.visitSubtree(function(b){b.mesh&&(a._facesCnt+=b.mesh.geometry.vertexCnt/3)}));return a._facesCnt};WALK.Node.prototype.hide=function(){this.visitSubtree(function(a){a.mesh&&(a.mesh.visible=!1)})};WALK.Node.prototype.show=function(){this.visitSubtree(function(a){a.mesh&&(a.mesh.visible=!0)})};Object.defineProperty(WALK.Node.prototype,"isAnimatedRoot",{get:function(){return this.config.faceCamera||this.config.rotate}});
WALK.Node.prototype.serialize=function(){var a={id:this.id,children:this.children.map(function(c){return c.serialize()})},b=this.mesh;b&&(a.lightProbeId=b.lightProbe?b.lightProbe.id:null,a.mesh=!0);return a};Object.defineProperty(WALK.Node.prototype,"type",{get:function(){return this.config.name}});Object.defineProperty(WALK.Node.prototype,"highlightMix",{set:function(a){this.visitSubtree(function(b){b.mesh&&(b.mesh.highlightMix=a)})}});
Object.defineProperty(WALK.Node.prototype,"selected",{set:function(a){this.visitSubtree(function(b){b.mesh&&(b.mesh.selected=a)})}});Object.defineProperty(WALK.Node.prototype,"selectedSecondary",{set:function(a){this.visitSubtree(function(b){b.mesh&&(b.mesh.selectedSecondary=a)})}});WALK.Mesh=function(a,b,c){this._visible=!0;G.Mesh.call(this,b,c);this.node=a;this.useFaces16=!1;this.quantUv0Max=this.quantUv0Range=this.quantVertexMax=this.quantVertexRange=this.transformByteOffset=this.uv1CoordVOffset=this.uv1CoordUOffset=this.uv1CoordVScale=this.uv1CoordUScale=this.lightMapIdx=this.uv1ByteOffset=this.uv0ByteOffset=this.normalByteOffset=this.vertexCnt=this.vertexByteOffset=this.faceCnt=this.faceByteOffset=0;this.lightMap=null;this.autoLightmapResolution=-1;this.lightProbe=null;
this.matrixAutoUpdate=this.rotationAutoUpdate=!1;this.selected=this.highlightMix=null;this.selectedSecondary=!1;this.visibilityId=null;this.cameraDistance=0;var d=this.matrix=this.matrixWorld=null;Object.defineProperty(this,"matrixWorld",{get:function(){return d||this.node.animationMatrix},set:function(e){d=e}});this.sharedBuffersDebug=0;this._mergedMesh=null};WALK.Mesh.prototype=Object.create(G.Mesh.prototype);WALK.Mesh.prototype.constructor=WALK.Mesh;WALK.Mesh.prototype.clone=void 0;
WALK.Mesh.prototype.updateMatrixWorld=function(){};WALK.Mesh.prototype.uv0InBuffers=function(){return-1!==this.uv0ByteOffset};WALK.Mesh.prototype.uv1InBuffers=function(){return-1!==this.uv1ByteOffset};WALK.Mesh.prototype.quantVertexFactor=function(){return this.quantVertexRange/this.quantVertexMax};WALK.Mesh.prototype.quantUv0Disabled=function(){return 0===this.quantUv0Max};WALK.Mesh.prototype.quantUv0Factor=function(){return this.quantUv0Range/this.quantUv0Max};
Object.defineProperty(WALK.Mesh.prototype,"hideInViews",{get:function(){return this.node.hideInViews},set:function(){console.assert(!1)}});Object.defineProperty(WALK.Mesh.prototype,"visible",{get:function(){return this._visible},set:function(a){a!==this._visible&&(this._visible=a,this._mergedMesh&&!WALK.EDIT_MODE&&(this._mergedMesh.visible=a))}});
WALK.MergedMesh=function(a,b){this._visible=!0;G.Mesh.call(this,a,b);this.anyLogicalMeshHasUvs=!1;this.lightProbe=this.lightMap=null;this.matrixAutoUpdate=this.rotationAutoUpdate=!1;this.hideInViews=null;this.matrixAutoUpdate=this.rotationAutoUpdate=!1;this.center=null;this.cameraDistance=0;this.editableRootNode=this.matrix=this.matrixWorld=null;Object.defineProperty(this,"matrixWorld",{get:function(){return this.editableRootNode?this.editableRootNode.mesh?this.editableRootNode.mesh.matrixWorld:this.editableRootNode.animationMatrix:
null},set:function(){console.assert("Cannot set matrixWorld for a merged mesh. The mesh needs to be marked as editable to prevent merging.")}});this.logicalMeshes=[]};WALK.MergedMesh.prototype=Object.create(G.Mesh.prototype);WALK.MergedMesh.prototype.constructor=WALK.MergedMesh;WALK.MergedMesh.prototype.clone=void 0;WALK.MergedMesh.prototype.updateMatrixWorld=function(){};WALK.MergedMesh.prototype.addLogicalMesh=function(a){this.logicalMeshes.push(a);a._mergedMesh=this};
Object.defineProperty(WALK.MergedMesh.prototype,"visible",{get:function(){return this._visible},set:function(a){if(a!==this._visible){this._visible=a;for(var b=0;b<this.logicalMeshes.length;b+=1)this.logicalMeshes[b]._visible=a}}});WALK.SkyMesh=function(a,b,c,d){var e=this;G.Mesh.call(this,b,c);d&&this.position.fromArray(d);this.autoPosition=!d;this.name=a;var f={type:"updated",target:this};this._updated=function(){return e.dispatchEvent(f)}};WALK.SkyMesh.prototype=Object.create(G.Mesh.prototype);WALK.SkyMesh.prototype.constructor=WALK.SkyMesh;WALK.SkyMesh.prototype.clone=void 0;
WALK.SkyMesh.prototype.serialize=function(){var a={name:this.name};this.autoPosition||(a.center=this.position.toArray());this.isEquirect?(a.type="equirect",a.yawRotation=this.yawRotationDeg,a.texture=this.material.map?this.material.map.serialize():null):a.type="procedural";return a};Object.defineProperty(WALK.SkyMesh.prototype,"yawRotationDeg",{get:function(){return G.Math.radToDeg(this.rotation.y)},set:function(a){a=G.Math.degToRad(a);this.rotation.y=a;this.updateMatrixWorld();this._updated()}});
Object.defineProperty(WALK.SkyMesh.prototype,"isEquirect",{get:function(){return this.material instanceof WALK.EquirectSkyMaterial}});Object.defineProperty(WALK.SkyMesh.prototype,"radius",{get:function(){return this.scale.x},set:function(a){this.scale.set(a,a,a);this.updateMatrixWorld(!0);this._updated()}});var rg=1E3,sg={internal:!1,position:[0,0,0],rotation:[0,0],hideFromMenu:!0,sky:WALK.EDITOR_CONTROLLED_SKY_NAME};
WALK.View=function(a){var b=this;void 0===a&&(a=sg);this.id=void 0!==a.id?a.id:rg++;this.name=a.name||"view"+this.id;this.internal=a.internal||!1;a.position&&(this.position=new G.Vector3(a.position[0],a.position[1],a.position[2]));a.rotation&&(this.rotation=new WALK.Euler(WALK.normalizeRotation(G.Math.degToRad(a.rotation[0])),WALK.normalizeRotation(G.Math.degToRad(a.rotation[1])),0));this.hideFromMenu=a.hideFromMenu||!1;this.sky=a.sky||WALK.EDITOR_CONTROLLED_SKY_NAME;this.mode=a.mode||"fps";this.distance=
a.distance;this.panPrimary=a.panPrimary;this.noPan=a.noPan;this.noRotate=a.noRotate;this.noPitchRotate=a.noPitchRotate;this.minDistance=void 0===a.minDistance?1:a.minDistance;this.maxDistance=void 0===a.maxDistance?100:a.maxDistance;this.minUpAngle=void 0===a.minUpAngle?-Math.PI/2:a.minUpAngle;this.maxUpAngle=void 0===a.maxUpAngle?Math.PI/2:a.maxUpAngle;this.minSideAngle=void 0===a.minSideAngle?-Math.PI:a.minSideAngle;this.maxSideAngle=void 0===a.maxSideAngle?Math.PI:a.maxSideAngle;a.target&&(this.target=
new G.Vector3(a.target[0],a.target[1],a.target[2]));this.fov=a.fov;var c={type:"updated",target:this};this._updated=function(){return b.dispatchEvent(c)}};
WALK.View.prototype={constructor:WALK.View,isTop:function(){return"orbit"===this.mode&&this.panPrimary&&this.noPitchRotate},isOrbit:function(){return"orbit"===this.mode&&!this.isTop()},usesDefaultSky:function(){return this.sky===WALK.DEFAULT_SKY_NAME},switchSky:function(){this.usesDefaultSky()?this.sky=WALK.EDITOR_CONTROLLED_SKY_NAME:this.sky=WALK.DEFAULT_SKY_NAME;this._updated()},setName:function(a){this.name=a;this._updated()},setYaw:function(a){this.rotation.yaw=a;this._updated()},setMinUpAngle:function(a){a!==
this.minUpAngle&&(this.minUpAngle=a,this._updated())},setMaxUpAngle:function(a){a!==this.maxUpAngle&&(this.maxUpAngle=a,this._updated())},setMinSideAngle:function(a){a!==this.minSideAngle&&(this.minSideAngle=a,this._updated())},setMaxSideAngle:function(a){a!==this.maxSideAngle&&(this.maxSideAngle=a,this._updated())},setHideFromMenu:function(a){a!==this.hideFromMenu&&(this.hideFromMenu=a,this._updated())},setMinDistance:function(a){a!==this.minDistance&&(this.minDistance=a,this._updated())},setMaxDistance:function(a){a!==
this.maxDistance&&(this.maxDistance=a,this._updated())},serialize:function(){var a=this,b={id:this.id,name:this.name,mode:this.mode,rotation:this.rotation.toDegTriple().slice(0,2),hideFromMenu:this.hideFromMenu||!1,sky:this.sky};this.position&&(b.position=this.position.toArray());this.target&&(b.target=this.target.toArray());-Infinity!==this.minSideAngle&&(b.minSideAngle=this.minSideAngle);Infinity!==this.maxSideAngle&&(b.maxSideAngle=this.maxSideAngle);"distance minDistance maxDistance panPrimary noPan noRotate noPitchRotate minUpAngle maxUpAngle fov".split(" ").forEach(function(c){void 0!==
a[c]&&(b[c]=a[c])});return b}};G.EventDispatcher.prototype.apply(WALK.View.prototype);WALK.Mirror=function(a,b,c){G.Object3D.call(this);this.name="mirror_"+this.id;this.scene=a;this.mirrorCamera=b.clone();this.renderTargetParams={minFilter:GLC.LINEAR,magFilter:GLC.LINEAR,format:GLC.RGBA,stencilBuffer:!1,generateMipmaps:!0};this.texture=null;c=c||{};this.matrixNeedsUpdate=!0;this.clipBias=void 0!==c.clipBias?c.clipBias:0;a=void 0!==c.color?new G.Color(c.color):new G.Color(8355711);this.textureMatrix=new G.Matrix4;this.mirrorWorldPosition=new G.Vector3;this.mirrorRotationMatrix=new G.Matrix4;
this.mirrorNormal=new G.Vector3;this.cameraWorldPosition=new G.Vector3;this.cameraRotationMatrix=new G.Matrix4;this.mirrorToCamera=new G.Vector3;this.cameraFrustum=null;this.material=new WALK.MirrorMaterial(a,this.textureMatrix)};WALK.Mirror.prototype=Object.create(G.Object3D.prototype);
WALK.Mirror.prototype.renderWithMirror=function(a){this.updateTextureMatrix();this.matrixNeedsUpdate=!1;var b=a.camera;a.camera=this.mirrorCamera;a.renderTemp();a.material.uniforms.mirrorSampler.value=a.tempTexture;this.render();this.matrixNeedsUpdate=!0;a.material.uniforms.mirrorSampler.value=a.texture;a.camera=b;a.updateTextureMatrix()};
WALK.Mirror.prototype.updateMatrixWorld=function(a){G.Object3D.prototype.updateMatrixWorld.call(this,a);this.mirrorWorldPosition.setFromMatrixPosition(this.matrixWorld);this.mirrorRotationMatrix.extractRotation(this.matrixWorld);this.mirrorNormal.set(0,0,1);this.mirrorNormal.applyMatrix4(this.mirrorRotationMatrix)};
WALK.Mirror.prototype.updateCameraPosition=function(a,b){this.cameraWorldPosition.setFromMatrixPosition(a.matrixWorld);this.cameraRotationMatrix.extractRotation(a.matrixWorld);this.matrixNeedsUpdate=!0;this.cameraFrustum=b};WALK.Mirror.prototype.inFrustum=function(){this.mirrorToCamera.subVectors(this.cameraWorldPosition,this.mirrorWorldPosition);return this.mirrorToCamera.angleTo(this.mirrorNormal)<Math.PI/2&&this.cameraFrustum.intersectsBox(this.parent.geometry.boundingBox)};
WALK.Mirror.prototype.updateTextureMatrix=function(){var a=new G.Vector3,b=new G.Vector3,c=new G.Vector3,d=new G.Vector4,e=new G.Plane,f=new G.Vector4;return function(){a.copy(this.mirrorWorldPosition).sub(this.cameraWorldPosition).reflect(this.mirrorNormal).negate().add(this.mirrorWorldPosition);c.set(0,0,-1);c.applyMatrix4(this.cameraRotationMatrix);c.add(this.cameraWorldPosition);b.copy(this.mirrorWorldPosition).sub(c).reflect(this.mirrorNormal).negate().add(this.mirrorWorldPosition);this.up.set(0,
-1,0);this.up.applyMatrix4(this.cameraRotationMatrix);this.up.reflect(this.mirrorNormal).negate();this.mirrorCamera.position.copy(a);this.mirrorCamera.up=this.up;this.mirrorCamera.lookAt(b);this.mirrorCamera.updateProjectionMatrix();this.mirrorCamera.updateMatrixWorld();this.mirrorCamera.matrixWorldInverse.getInverse(this.mirrorCamera.matrixWorld);this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);this.textureMatrix.multiply(this.mirrorCamera.projectionMatrix);this.textureMatrix.multiply(this.mirrorCamera.matrixWorldInverse);
e.setFromNormalAndCoplanarPoint(this.mirrorNormal,this.mirrorWorldPosition);e.applyMatrix4(this.mirrorCamera.matrixWorldInverse);d.set(e.normal.x,e.normal.y,e.normal.z,e.constant);var g=this.mirrorCamera.projectionMatrix;f.x=(Math.sign(d.x)+g.elements[8])/g.elements[0];f.y=(Math.sign(d.y)+g.elements[9])/g.elements[5];f.z=-1;f.w=(1+g.elements[10])/g.elements[14];d.multiplyScalar(2/d.dot(f));g.elements[2]=d.x;g.elements[6]=d.y;g.elements[10]=d.z+1-this.clipBias;g.elements[14]=d.w}}();
WALK.Mirror.prototype.configure=function(a,b,c,d){this.mirrorCamera.aspect=c;this.mirrorCamera.fov=d;this.mirrorCamera.updateProjectionMatrix();null!==this.texture&&this.texture.dispose();this.material.mirrorSampler=this.texture};WALK.Mirror.prototype.render=function(a){this.material.visible&&(this.matrixNeedsUpdate&&(this.updateTextureMatrix(),this.matrixNeedsUpdate=!1),this.material.visible=!1,a.render(this.scene,this.mirrorCamera,this.texture,!0),this.material.visible=!0)};
WALK.Mirror.prototype.renderTemp=function(a){this.matrixNeedsUpdate&&this.updateTextureMatrix();a.render(this.scene,this.mirrorCamera,this.tempTexture,!0)};var tg=0;function ug(a,b,c){a=new WALK.Mirror(a,b,{clipBias:0,color:8355711,debugMode:!1});a.material.name=c.material.name;c=c.geometry;console.assert(c.boundingBox);b=c.boundingBox;var d=Math.sqrt(Math.pow(b.max.x-b.min.x,2)+Math.pow(b.max.z-b.min.z,2)),e=b.max.y-b.min.y;d&&e?(d=new G.Mesh(new G.PlaneBufferGeometry(d,e),a.material),d.rotation.y=Math.atan2(c.normals[0],c.normals[2]),b.center(d.position),d.geometry.boundingBox=b,d.add(a),a=d):(WALK.log("mirror with 0 dimension"),a=null);return a}
function vg(a,b,c){c=c||"id";for(var d=0;d<a.length;d+=1)if(a[d].hasOwnProperty(c)&&a[d][c]===b)return!1;return!0}function wg(a,b,c){c=c||"id";for(var d=0;d<a.length;d+=1)if(a[d][c]===b)return a[d];return null}function xg(a,b){a=a.name.toUpperCase();b=b.name.toUpperCase();return a<b?-1:a>b?1:0}
WALK.Scene=function(a){function b(){f.dispatchEvent(g)}function c(){f.dispatchEvent(k);b()}function d(h){h=h.target;var l=f._mainAnimatedMaterials.has(h);h.isAnimated&&!l?f._mainAnimatedMaterials.add(h):!h.isAnimated&&l&&f._mainAnimatedMaterials.delete(h);b()}function e(){f._animatedRootNodes.length=0;f.visitAllNodes(function(h){h.isAnimatedRoot&&f._animatedRootNodes.push(h)});b()}var f=this,g={type:"updated",target:this},k={type:"anyViewUpdated",target:this};this.id=tg++;this._headLight=!1;this.threeScene=
new G.Scene;this.autoAddLightProbes=!0;this.autoTour={disabled:!1,startOnLoad:!1};this.canStartAutoTour=function(){return!this.autoTour.disabled&&1<this.visibleViews().length};this.startAutoTourOnLoad=function(){return this.canStartAutoTour()&&this.autoTour.startOnLoad};this.disableProgressiveLoader=!1;this.camera=a;this._colorMap=null;this.materials=[];this._mainAnimatedMaterials=new Set;this._disabledMaterials=[];this._sortedMaterials=null;this.nodeConfigs=[];this._nodeConfigsLookup={};this.nodes=
[];this._animatedRootNodes=[];this._nodeLookup={};this.gpuMeshes=[];this.mirrors=[];this._animatableAuxiliaryObjects=new Set;this.boundingBox=new G.Box3;this.collisionBoundingBox=new G.Box3;this._sumLogicalMeshCenter=new G.Vector3;this._logicalNonemptyMeshCount=0;this._center=new G.Vector3;this.skyMeshes=[];this.hideViewsMenu=!1;this.views=[];this.lights=[];this.lightProbes=[];this.cameraVolumes=[];this.minimapConfig=null;this.serialize=function(){return{disableProgressiveLoader:this.disableProgressiveLoader,
autoTour:this.autoTour,camera:this.camera.serialize(),materials:this.materials.map(function(h){return h.serialize()}),nodeConfigs:this.nodeConfigs.map(function(h){return h.serialize()}),nodes:this.nodes.map(function(h){return h.serialize()}),lights:this.lights.map(function(h){return h.serialize()}),lightProbes:this.lightProbes.map(function(h){return h.serialize()}),cameraVolumes:this.cameraVolumes.map(function(h){return h.serialize()}),autoAddLightProbes:!1,views:this.views.filter(function(h){return!h.internal}).map(function(h){return h.serialize()}),
skies:this.skyMeshes.filter(function(h){return h.name!==WALK.DEFAULT_SKY_NAME}).map(function(h){return h.serialize()}),minimap:this.minimapConfig.serialize()}};this.addMaterial=function(h){this.materials.push(h);h.addEventListener("updated",d);h.isAnimated&&this._mainAnimatedMaterials.add(h);this.camera.colorMapReady()&&void 0!==h.colorMap&&(h.colorMap=this.camera.colorMap);void 0!==h.cameraExposure&&(h.cameraExposure=this.camera.exposure);void 0!==h.cameraGamma&&(h.cameraGamma=this.camera.gamma);
void 0!==h.headLight&&(h.headLight=this.headLight)};this.replaceMaterial=function(h,l){var n=this.materials.indexOf(h);void 0===this._disabledMaterials[n]&&(this._disabledMaterials[n]=new Map);this._disabledMaterials[n].set(h.type,h);var r=this._disabledMaterials[n].get(l);r||(r=WALK.createMaterialOfType(l),r.addEventListener("updated",d),r.name=h.name,0===this.lightProbes.length&&(r.disableLightProbeTmp=!0));this.materials[n]=r;b();for(l=0;l<this.gpuMeshes.length;l+=1)this.gpuMeshes[l].material===
h&&(this.gpuMeshes[l].material=r);h.isAnimated&&this._mainAnimatedMaterials.delete(h);r.isAnimated&&this._mainAnimatedMaterials.add(r);this._sortedMaterials=null;r.setUniforms();return r};this.addNodeConfig=function(h){this.nodeConfigs.push(h);this._nodeConfigsLookup[h.name]=h;h.addEventListener("updated",e)};this.findNodeConfig=function(h){return this._nodeConfigsLookup.hasOwnProperty(h)?this._nodeConfigsLookup[h]:null};this.addNode=function(h){var l=this;this.nodes.push(h);h.visitSubtree(function(n){l._nodeLookup[n.id]=
n;n.isAnimatedRoot&&l._animatedRootNodes.push(n)})};this.findNode=function(h){return this._nodeLookup[h]};this.visitAllNodes=function(h){for(var l=0;l<this.nodes.length;l+=1)this.nodes[l].visitSubtree(h)};this.visitMeshesWithMaterial=function(h,l){this.visitAllNodes(function(n){(n=n.mesh)&&n.material===h&&l(n)})};this.sortedMaterials=function(){null===this._sortedMaterials&&(this._sortedMaterials=this.materials.slice(0).sort(xg));return this._sortedMaterials};this._updateSceneCenterWithGpuMesh=function(){var h=
new G.Vector3;return function(l){if(l.logicalMeshes)for(var n=0;n<l.logicalMeshes.length;n+=1){var r=l.logicalMeshes[n].geometry.boundingBox;r.empty()||(r.center(h),this._sumLogicalMeshCenter.add(h),++this._logicalNonemptyMeshCount)}else l=l.geometry.boundingBox,l.empty()||(l.center(h),this._sumLogicalMeshCenter.add(h),++this._logicalNonemptyMeshCount);this._logicalNonemptyMeshCount&&this._center.copy(this._sumLogicalMeshCenter).divideScalar(this._logicalNonemptyMeshCount)}}();this.addGpuMesh=function(h){var l=
this;if(h.material.planarReflector){var n=ug(this.threeScene,this.camera,h);this.mirrors.push(n.children[0]);this.addAuxiliaryObject(n)}else this.addAuxiliaryObject(h);this.gpuMeshes.push(h);this.boundingBox.union(h.geometry.boundingBox);(h.logicalMeshes||[h]).forEach(function(r){r.node.disableCollisions||l.collisionBoundingBox.union(r.geometry.boundingBox)});this._updateSceneCenterWithGpuMesh(h)};this.addAuxiliaryObject=function(h,l){l=void 0===l?!1:l;this.threeScene.add(h);l&&this._animatableAuxiliaryObjects.add(h);
b()};this.removeAuxiliaryObject=function(h){this.threeScene.remove(h);this._animatableAuxiliaryObjects.delete(h);b()};this.addSkyMesh=function(h){var l=h.material;this.skyMeshes.push(h);this.camera.colorMapReady()&&(l.colorMap=this.camera.colorMap);void 0!==l.cameraExposure&&(l.cameraExposure=this.camera.exposure);void 0!==l.cameraGamma&&(l.cameraGamma=this.camera.gamma);h.addEventListener("updated",b);this.dispatchEvent({type:"skyMeshAdded",skyMesh:h,target:this})};this.removeSkyMesh=function(h){WALK.removeFromArray(h,
this.skyMeshes);this.dispatchEvent({type:"skyMeshRemoved",skyMesh:h,target:this});h.geometry.dispose();h.material.map&&h.material.map.dispose();h.material.dispose()};this.findSkyMesh=function(h){return wg(this.skyMeshes,h,"name")};this.addLight=function(h){console.assert(vg(this.lights,h.name,"name"));this.lights.push(h);h.addEventListener("updated",b);h.addEventListener("instanceAdded",b);h.addEventListener("instanceRemoved",b);b();this.dispatchEvent({type:"lightAdded",light:h,target:this})};this.removeLight=
function(h){WALK.removeFromArray(h,this.lights);b();this.dispatchEvent({type:"lightRemoved",light:h,target:this})};this.addLightProbe=function(h){console.assert(vg(this.lightProbes,h.id));this.lightProbes.push(h);h.addEventListener("positionUpdated",b);h.addEventListener("boundsUpdated",b);b();this.dispatchEvent({type:"lightProbeAdded",lightProbe:h,target:this})};this.removeLightProbe=function(h){WALK.removeFromArray(h,this.lightProbes);for(var l=0;l<this.gpuMeshes.length;l+=1)this.gpuMeshes[l].lightProbe===
h&&(this.gpuMeshes[l].lightProbe=null);b();this.dispatchEvent({type:"lightProbeRemoved",lightProbe:h,target:this});h.dispose()};this.findLightProbe=function(h){return wg(this.lightProbes,h)};this.closestLightProbe=function(h){for(var l=null,n=Infinity,r=m.makeIterator(this.lightProbes),v=r.next();!v.done;v=r.next()){v=v.value;var p=h.distanceTo(v.position);p<n&&(n=p,l=v)}return l};this.addCameraVolume=function(h){console.assert(vg(this.cameraVolumes,h.id));this.cameraVolumes.push(h);h.addEventListener("updated",
b);b();this.dispatchEvent({type:"cameraVolumeAdded",cameraVolume:h,target:this})};this.removeCameraVolume=function(h){WALK.removeFromArray(h,this.cameraVolumes);b();this.dispatchEvent({type:"cameraVolumeRemoved",cameraVolume:h,target:this});h.dispose()};this.findCameraVolume=function(h){return wg(this.cameraVolumes,h)};this.shiftCameraVolume=function(h,l){WALK.shiftItem(this.cameraVolumes,h,l);this.dispatchEvent({type:"cameraVolumeShifted",cameraVolume:h,target:this})};this.findView=function(h){return wg(this.views,
h)};this.findViewByName=function(h){return wg(this.views,h,"name")};this.visibleViews=function(){return WALK.filter(this.views,function(h){return!h.hideFromMenu})};this.addView=function(h){console.assert(vg(this.views,h.id));this.views.push(h);h.addEventListener("updated",c);b();this.dispatchEvent({type:"viewAdded",view:h,target:this})};this.removeView=function(h){WALK.removeFromArray(h,this.views);this.nodeConfigs.forEach(function(l){l.removeFromHideInViews(h.id)});b();this.dispatchEvent({type:"viewRemoved",
view:h,target:this})};this.shiftView=function(h,l){WALK.shiftItem(this.views,h,l);this.dispatchEvent({type:"viewShifted",view:h,target:this})};this.hasLightMap=function(){return void 0!==WALK.find(this.materials,function(h){return h.lightMapped})};this.adjustSkiesAndCameraFarToSpanWholeScene=function(){function h(u,y){var B=0;u.forEach(function(D){if("orbit"===D.mode){var H=void 0===D.maxDistance?D.distance:D.maxDistance;H=D.target&&H?D.target.distanceTo(y)+H:void 0}else"fps"===D.mode&&(H=D.position?
D.position.distanceTo(y):void 0);H&&H>B&&(B=H)});return B}function l(u,y){var B=Math.max(Math.abs(u.min.x-y.x),Math.abs(u.max.x-y.x)),D=Math.max(Math.abs(u.min.y-y.y),Math.abs(u.max.y-y.y));u=Math.max(Math.abs(u.min.z-y.z),Math.abs(u.max.z-y.z));return Math.sqrt(B*B+D*D+u*u)}for(var n=0,r=0;r<this.skyMeshes.length;r+=1){var v=this.skyMeshes[r];v.autoPosition&&v.position.copy(this.center);var p=void 0;if(this.boundingBox.empty())p=0;else{p=l(this.boundingBox,v.position);var w=h(this.views,v.position);
p=Math.max(p,w)}p+=WALK.SKY_DISTANCE_TO_SCENE;v.radius=p;n=Math.max(n,p)}this.camera.setFar(Math.max(this.camera.far,2*n));WALK.log("Camera far set to "+this.camera.far)};a.addEventListener("colorMapUpdated",function(){var h=a.colorMap;f.materials.forEach(function(l){void 0!==l.colorMap&&(l.colorMap=h);l.setUniforms()});f.skyMeshes.forEach(function(l){l.material.colorMap=h});b()});a.addEventListener("updated",b);this.disableLightProbesForMaterials=function(){for(var h=0;h<this.materials.length;h+=
1)this.materials[h].disableLightProbeTmp=!0,this.materials[h].setUniforms()};this.enableLightProbesForMaterials=function(){for(var h=0;h<this.materials.length;h+=1)this.materials[h].disableLightProbeTmp=!1,this.materials[h].setUniforms()};this.getAnimatedMaterials=function(){var h=!1,l=new Map;return function(){function n(u){u instanceof G.Mesh&&u.material.isAnimated&&l.set(u.material,r)}for(var r=!h,v=m.makeIterator(f._mainAnimatedMaterials),p=v.next();!p.done;p=v.next())l.set(p.value,r);v=m.makeIterator(f._animatableAuxiliaryObjects);
for(p=v.next();!p.done;p=v.next())p.value.traverse(n);v=m.makeIterator(l);for(p=v.next();!p.done;p=v.next()){p=m.makeIterator(p.value);var w=p.next().value;p.next().value===h&&l.delete(w)}h=r;return l.keys()}}();this.getAnimatedRootNodes=function(){return this._animatedRootNodes};a.addEventListener("exposureUpdated",function(){var h=a.exposure;f.materials.forEach(function(l){void 0!==l.cameraExposure&&(l.cameraExposure=h)});f.skyMeshes.forEach(function(l){l=l.material;void 0!==l.cameraExposure&&(l.cameraExposure=
h)})});a.addEventListener("gammaUpdated",function(){var h=a.gamma;f.materials.forEach(function(l){void 0!==l.cameraGamma&&(l.cameraGamma=h)});f.skyMeshes.forEach(function(l){l=l.material;void 0!==l.cameraGamma&&(l.cameraGamma=h)})})};WALK.Scene.prototype={constructor:WALK.Scene,get center(){return this._center},get headLight(){return this._headLight},set headLight(a){a!==this._headLight&&(this._headLight=a,this.materials.forEach(function(b){b.headLight=a;b.setUniforms()}))}};G.EventDispatcher.prototype.apply(WALK.Scene.prototype);
WALK.createMaterialOfType=function(a){return"water"===a?new WALK.StandardMaterialWater:new WALK.StandardMaterial};WALK.BufferAttribute=function(a,b,c){G.BufferAttribute.call(this,a,b);this._length=a.length;this.releaseOnLoadedToGpu=!0;this.divisor=c||0;this.glType=this.buffer=null};WALK.BufferAttribute.prototype={constructor:WALK.BufferAttribute,get length(){return this._length}};G.BufferGeometry.prototype.addTriangleOrderAttribute=function(){if(void 0===this.getAttribute("order")){for(var a=this.getAttribute("position").length/3,b=new Float32Array(a),c=0;c<a;c+=1)b[c]=c%3;this.addAttribute("order",new WALK.BufferAttribute(b,1))}};
G.BufferGeometry.prototype.convertNormalsToSpherical=function(){console.assert(void 0===this.getAttribute("sphericalNormal"));var a=this.getAttribute("normal");console.assert(!a.buffer);a=a.array;for(var b=a.length/3,c=WALK.DETECTOR.ios?new Int16Array(2*b):new Int8Array(2*b),d=0;d<b;d+=1){var e=3*d,f=2*d,g=Math.atan2(a[e+1],a[e])/Math.PI;c[f]=WALK.Math.toSnorm8(2*(Math.acos(a[e+2])/Math.PI-.5));c[f+1]=WALK.Math.toSnorm8(g)}delete this.attributes.normal;this.addAttribute("sphericalNormal",new WALK.BufferAttribute(c,
2))};G.BufferGeometry.prototype.changePosition=function(a){var b=this.getAttribute("position"),c=b.length/3;b=b.array;for(var d=0;d<3*c;d+=3)b[d]+=a.x,b[d+1]+=a.y,b[d+2]+=a.z};G.BufferGeometry.prototype.clone=function(){console.error("WALK.BufferGeometry cloning not supported")};function yg(a,b,c,d,e){c=new WALK.BufferAttribute(c,d,e||0);a.addAttribute(b,c)}
WALK.Geometry=function(){G.BufferGeometry.call(this);this.isInstanced=!1;this.instanceCount=0;this.index=null;this.indexUint=!0;this.uvs0=this.normals=this.vertices=null;this.isUvs0Repeating=!1;this.uvs1=null;this.vertexOffset=this.vertexCnt=this.indexOffset=this.indexCnt=0;this.boundingBox=new G.Box3;this.boundingSphere=new G.Sphere;this.gpuSize=0};WALK.Geometry.prototype=Object.create(G.BufferGeometry.prototype);WALK.Geometry.prototype.constructor=WALK.Geometry;
WALK.Geometry.prototype.allocateCoreBuffers=function(a){console.assert(!this.vertices);a&&(65536>=this.vertexCnt?(this.indexUint=!1,this.index=new Uint16Array(this.indexCnt),this.gpuSize+=2*this.indexCnt):(this.indexUint=!0,this.index=new Uint32Array(this.indexCnt),this.gpuSize+=4*this.indexCnt));this.vertices=new Float32Array(3*this.vertexCnt);this.gpuSize+=12*this.vertexCnt;this.normals=WALK.DETECTOR.ios?new Int16Array(2*this.vertexCnt):new Int8Array(2*this.vertexCnt);this.gpuSize+=2*this.vertexCnt};
WALK.Geometry.prototype.addCoreAttributes=function(){this.index&&(yg(this,"index",this.index,1),this.index=null);yg(this,"position",this.vertices,3);this.vertices=null;yg(this,"sphericalNormal",this.normals,2);this.normals=null};WALK.Geometry.prototype.allocateUv0=function(){console.assert(!this.uvs0);this.uvs0=new Float32Array(2*this.vertexCnt);this.gpuSize+=8*this.vertexCnt};WALK.Geometry.prototype.addUv0Attribute=function(){yg(this,"uv",this.uvs0,2);this.uvs0=null};
WALK.Geometry.prototype.allocateUv1=function(){console.assert(!this.uvs1);this.uvs1=new Uint16Array(2*this.vertexCnt);this.gpuSize+=4*this.vertexCnt};WALK.Geometry.prototype.addUv1Attribute=function(){yg(this,"uv2",this.uvs1,2);this.uvs1=null};WALK.Geometry.prototype.computeBoundingBox=void 0;WALK.Geometry.prototype.computeBoundingSphere=void 0;
WALK.InstancedGeometry=function(a,b){G.BufferGeometry.call(this);this.parent=a;this.ownsGpuBuffers=b;this.isInstanced=!0;this.instanceCount=0;this.transforms2=this.transforms1=this.transforms0=this.uvs1Mod=null;this.vertexOffset=this.indexOffset=0;this.boundingBox=new G.Box3;this.boundingSphere=new G.Sphere;this._gpuSize=0};WALK.InstancedGeometry.prototype=Object.create(G.BufferGeometry.prototype);WALK.InstancedGeometry.prototype.constructor=WALK.InstancedGeometry;
WALK.InstancedGeometry.prototype.allocateCoreBuffers=function(a){console.assert(!this.transforms0);this.parent.vertices||this.parent.allocateCoreBuffers(a);a=4*this.instanceCount;this.transforms0=new Float32Array(a);this.transforms1=new Float32Array(a);this.transforms2=new Float32Array(a);this._gpuSize+=12*a};
WALK.InstancedGeometry.prototype.addCoreAttributes=function(){this.parent.attributes.position||this.parent.addCoreAttributes();for(var a=m.makeIterator(Object.keys(this.parent.attributes)),b=a.next();!b.done;b=a.next())b=b.value,this.addAttribute(b,this.parent.attributes[b]);yg(this,"t0",this.transforms0,4,1);yg(this,"t1",this.transforms1,4,1);yg(this,"t2",this.transforms2,4,1);this.transforms2=this.transforms1=this.transforms0=null};
WALK.InstancedGeometry.prototype.allocateUv0=function(){this.parent.uvs0||this.parent.allocateUv0()};WALK.InstancedGeometry.prototype.addUv0Attribute=function(){this.parent.attributes.uv||this.parent.addUv0Attribute();this.addAttribute("uv",this.parent.attributes.uv)};WALK.InstancedGeometry.prototype.allocateUv1=function(){console.assert(!this.uvs1Mod);this.parent.uvs1||this.parent.allocateUv1();this.uvs1Mod=new Float32Array(4*this.instanceCount);this._gpuSize+=16*this.instanceCount};
WALK.InstancedGeometry.prototype.addUv1Attribute=function(){this.parent.attributes.uv2||this.parent.addUv1Attribute();this.addAttribute("uv2",this.parent.attributes.uv2);yg(this,"uv2Mod",this.uvs1Mod,4,1);this.uvs1Mod=null};WALK.InstancedGeometry.prototype.computeBoundingBox=void 0;WALK.InstancedGeometry.prototype.computeBoundingSphere=void 0;Object.defineProperty(WALK.InstancedGeometry.prototype,"index",{get:function(){return this.parent.index}});
Object.defineProperty(WALK.InstancedGeometry.prototype,"vertices",{get:function(){return this.parent.vertices}});Object.defineProperty(WALK.InstancedGeometry.prototype,"normals",{get:function(){return this.parent.normals}});Object.defineProperty(WALK.InstancedGeometry.prototype,"uvs0",{get:function(){return this.parent.uvs0}});Object.defineProperty(WALK.InstancedGeometry.prototype,"uvs1",{get:function(){return this.parent.uvs1}});
Object.defineProperty(WALK.InstancedGeometry.prototype,"indexUint",{get:function(){return this.parent.indexUint}});Object.defineProperty(WALK.InstancedGeometry.prototype,"vertexCnt",{get:function(){return this.parent.vertexCnt},set:function(a){this.parent.vertexCnt=a}});Object.defineProperty(WALK.InstancedGeometry.prototype,"indexCnt",{get:function(){return this.parent.indexCnt},set:function(a){this.parent.indexCnt=a}});
Object.defineProperty(WALK.InstancedGeometry.prototype,"gpuSize",{get:function(){return this.ownsGpuBuffers?this._gpuSize+this.parent.gpuSize:this._gpuSize}});Object.defineProperty(WALK.InstancedGeometry.prototype,"isUvs0Repeating",{get:function(){return this.parent.isUvs0Repeating},set:function(a){this.parent.isUvs0Repeating=a}});
WALK.SubGeometry=function(a,b,c,d,e,f,g){G.BufferGeometry.call(this);this.indexCnt=a;this.vertexCnt=b;this.parent=c;this.vertexOffset=e;this.indexOffset=d;this.boundingBox=f;this.boundingSphere=g;this.isInstanced=c.isInstanced;this.instanceId=0;this.instanceCount=1};WALK.SubGeometry.prototype=Object.create(G.BufferGeometry.prototype);WALK.SubGeometry.prototype.constructor=WALK.SubGeometry;Object.defineProperty(WALK.SubGeometry.prototype,"attributes",{get:function(){return this.parent.attributes}});
Object.defineProperty(WALK.SubGeometry.prototype,"attributesKeys",{get:function(){return this.parent.attributesKeys}});Object.defineProperty(WALK.SubGeometry.prototype,"indexUint",{get:function(){return this.parent.indexUint}});Object.defineProperty(WALK.SubGeometry.prototype,"isUvs0Repeating",{get:function(){return this.parent.isUvs0Repeating}});WALK.SubGeometry.prototype.computeBoundingBox=void 0;WALK.SubGeometry.prototype.computeBoundingSphere=void 0;
WALK.SubGeometry.prototype.addTriangleOrderAttribute=function(){this.parent.addTriangleOrderAttribute()};var zg=null,Ag=null,Bg=new G.Vector3,Cg=new G.Quaternion;WALK.CameraVolume=function(a){this.id=a.id;this.name=a.name;this._type=a.type;console.assert(0<=WALK.CameraVolume.CameraVolumeTypes.indexOf(this._type));this.position=(new G.Vector3).fromArray(a.position);this.rotation=(new WALK.Euler).setFromDegTriple(a.rotation);this.scale=(new G.Vector3).fromArray(a.scale);this.exposure=a.exposure;this.gamma=a.gamma;this._inverse=new G.Matrix4;this._inverseDirty=!0};
function Dg(a){a.dispatchEvent({type:"updated",target:a})}WALK.CameraVolume.CameraVolumeTypes=["cube","sphere"];
WALK.CameraVolume.prototype={constructor:WALK.CameraVolume,getVolumeGeometry:function(){zg||(zg=new G.BoxBufferGeometry(2,2,2),zg.addTriangleOrderAttribute(),zg.convertNormalsToSpherical(),Ag=new G.IcosahedronBufferGeometry(1,2),Ag.addTriangleOrderAttribute(),Ag.convertNormalsToSpherical());return"sphere"===this._type?Ag:zg},setName:function(a){this.name=a;Dg(this)},setPosition:function(a,b,c){this.position.set(a,b,c);this._inverseDirty=!0;Dg(this)},setRotation:function(a,b,c){this.rotation.yaw=WALK.normalizeRotation(a);
this.rotation.pitch=WALK.normalizeRotation(b);this.rotation.roll=WALK.normalizeRotation(c);this._inverseDirty=!0;Dg(this)},setRotationDeg:function(a,b,c){a=G.Math.degToRad(a);b=G.Math.degToRad(b);c=G.Math.degToRad(c);this.setRotation(a,b,c)},setScale:function(a,b,c){this.scale.set(a,b,c);this._inverseDirty=!0;Dg(this)},setExposure:function(a){this.exposure=a;Dg(this)},setGamma:function(a){this.gamma=a;Dg(this)},worldCoordinatesInside:function(a){this._inverseDirty&&(this._inverseDirty=!1,this._inverse.compose(this.position,
Cg.setFromEuler(this.rotation),this.scale),this._inverse.getInverse(this._inverse));Bg.copy(a).applyMatrix4(this._inverse);return"sphere"===this._type?1>=Bg.lengthSq():1>=Math.abs(Bg.x)&&1>=Math.abs(Bg.y)&&1>=Math.abs(Bg.z)},serialize:function(){return{id:this.id,name:this.name,type:this._type,position:this.position.toArray(),rotation:this.rotation.toDegTriple(),scale:this.scale.toArray(),exposure:this.exposure,gamma:this.gamma}},dispose:function(){}};G.EventDispatcher.prototype.apply(WALK.CameraVolume.prototype);var Eg=512-2*Math.floor(512*(.5-.5*Math.sin(70/180*Math.PI/2))),Fg=null,Gg,Hg,Ig=null,Jg;function Kg(a){Fg&&Ig===a.id||(Fg=new G.SphereBufferGeometry(1,32,16),Fg.convertNormalsToSpherical(),Gg=new G.PlaneBufferGeometry(1,1),Gg.convertNormalsToSpherical(),Hg=new G.CylinderBufferGeometry(.5,.5,1,16,1),Jg||(Jg=new G.Matrix4,Jg.makeRotationX(Math.PI/2)),Hg.applyMatrix(Jg),Hg.convertNormalsToSpherical(),Ig=a.id)}var Lg=new G.Color,Mg=new Map;
function Ng(a){var b=a.icon&&WALK.ICONS[a.icon],c=b?b.value:a.text,d=b?b.fontFamily:"Open Sans",e=a.color||"#4c9ed9";var f=a.opacity;void 0===f||1<=f?f=e:(Lg.setStyle(e),f="rgba("+(255*Lg.r|0)+","+(255*Lg.g|0)+","+(255*Lg.b|0)+","+f+")");var g=f;f=a.textColor||"#ffffff";var k=void 0!==a.opacity&&1>a.opacity,h="sphere"===a.type;b=[b||"",c,d,g,f,h,20,a.borderRadius||0,k].join("_");var l=Mg.get(b);if(l)return l.usedTimes++,[e,f,b,l.texture];l=document.getElementById("anchor-canvas");l||(l=document.createElement("canvas"),
l.id="anchor-canvas");if(h){h=l;var n=c;h.width=512;h.height=512;h=h.getContext("2d");h.font="400 128px "+d;n=h.measureText(n).width;n=Math.floor(Eg/n*128);n=Math.min(n,Eg);h.font="400 "+n+"px "+d;d=h}else{h=m;n=h.makeIterator;var r=l,v=WALK.SPRITE_ANCHOR_FONT_SIZE,p=r.getContext("2d");p.font="400 "+v+"px "+d;for(var w=c,u=c.length-1,y;;){y=p.measureText(w).width;y+=40;if(2048>=y)break;w=c.substring(0,u)+"...";--u}r.width=y;r.height=1.5*v;p=r.getContext("2d");p.font="400 "+v+"px "+d;c=n.call(h,[p,
w]);d=c.next().value;c=c.next().value}d.fillStyle=g;a.borderRadius?(g=d,h=l.width,n=l.height,a=.5*a.borderRadius*Math.min(h,n),g.beginPath(),g.moveTo(0+a,0),g.lineTo(0+h-a,0),g.quadraticCurveTo(0+h,0,0+h,0+a),g.lineTo(0+h,0+n-a),g.quadraticCurveTo(0+h,0+n,0+h-a,0+n),g.lineTo(0+a,0+n),g.quadraticCurveTo(0,0+n,0,0+n-a),g.lineTo(0,0+a),g.quadraticCurveTo(0,0,0+a,0),g.closePath(),g.fill()):d.fillRect(0,0,l.width,l.height);d.fillStyle=f;d.textAlign="center";d.textBaseline="middle";d.shadowColor="black";
d.shadowBlur=16;d.fillText(c,l.width/2,l.height/2);a=new WALK.Texture(l);a.width=l.width;a.height=l.height;a.hasAlpha=k;a.minFilter=GLC.LINEAR;a.loaded=!0;a.needsUpdate=!0;Mg.set(b,{usedTimes:1,texture:a});return[e,f,b,a]}
WALK.Anchor=function(a,b){Kg(a);var c=new G.Vector3;c.fromArray(b.position);var d=m.makeIterator(Ng(b)),e=d.next().value,f=d.next().value,g=d.next().value;d=d.next().value;this._textureSignature=g;var k=new G.Color;k.setStyle(e);k.convertGammaToLinear();Object.defineProperty(this,"color",{get:function(){return k}});var h=new G.Color;h.setStyle(f);h.convertGammaToLinear();Object.defineProperty(this,"textColor",{get:function(){return h}});if("sphere"===b.type)e=Fg,f=new WALK.AnchorMaterial,g=a.closestLightProbe(c),
f.bumpTexture=d,f.disableLightProbe=null===g||!g.texturesReady(),f.headLight=!0,a=[b.radius,b.radius,b.radius];else{e=Gg;f=new WALK.AnchorSpriteMaterial;g=null;f.disableLightProbe=!0;f.headLight=!1;f.specularOff=1;a=[d.width/d.height*b.height,b.height,1];var l=new G.Mesh(Hg,null)}f.baseColorTexture=d;f.configureTransparency();f.setUniforms();G.Mesh.call(this,e,f);this.position.copy(c);this.scale.fromArray(a);this.updateMatrixWorld(!0);this.lightProbe=g;l?(l.position.copy(c),c=Math.max(a[0],a[1]),
l.scale.fromArray([c,c,b.height]),l.updateMatrixWorld(!0),this.colliderMesh=l):this.colliderMesh=this;this.colliderMesh.visibilityId=null;this.colliderMesh.anchor=this;this.extension=null};WALK.Anchor.prototype=Object.create(G.Mesh.prototype);WALK.Anchor.prototype.dispose=function(){var a=this.material;a.dispose();var b=this._textureSignature,c=Mg.get(b),d=c.texture;console.assert(a.baseColorTexture===d);c.usedTimes--;0===c.usedTimes&&(d.dispose(),Mg.delete(b))};
WALK.Anchor.prototype.enableLightProbe=function(){if(this.lightProbe){console.assert(this.lightProbe.texturesReady());var a=this.material;a.disableLightProbe=!1;a.setUniforms()}};var Og=null,Pg=null,Qg={mainMaterial:{name:"mainMaterial",baseColor:[.5,.5,.5],roughness:.7,metallic:1},displayMaterial:{name:"displayMaterial",baseColor:[0,0,0],roughness:.001,metallic:0}},Rg={sphere:null,cylinder:null,head:[],torso:[],displayPortrait:[],displayLandscape:[]};
function Sg(a){Rg.plane&&Og===a.id||(Rg.sphere=new G.SphereBufferGeometry(.08,32,16),Rg.sphere.convertNormalsToSpherical(),Rg.cylinder=new G.CylinderBufferGeometry(.005,.005,1,3),Rg.cylinder.convertNormalsToSpherical(),Og=a.id)}function Tg(a,b,c){var d=new G.Box3;Rg.head.forEach(function(e){d.union(e.geometry.boundingBox)});return new WALK.Anchor(a,{type:"sprite",position:[0,0,.1+(d.max.z-d.min.z)/2],height:.1,text:b,textColor:c,opacity:0})}
function Ug(a){a=new G.Mesh(Rg.sphere,a);a.scale.set(.4,.4,.4);a.visible=!1;return a}function Vg(a){var b=new WALK.StandardMaterial;b.headLight=!1;b.baseColor.setStyle(a).convertGammaToLinear();b.transparent=!0;b.opacity=.5;b.emissive=!0;b.disableLightProbe=!0;b.setUniforms();a=new G.Mesh(Rg.cylinder,b);a.visible=!1;return a}
function Wg(a,b,c){c=void 0===c?!0:c;var d=new WALK.StandardMaterial;d.baseColor.fromArray(a.baseColor);d.roughness=a.roughness||1;d.metallic=a.metallic||0;d.opacity=a.opacity||1;d.highlight=new G.Color(16777215);d.highlightMix=0;if(a.baseColorTexture){var e=new Image;e.src=b+a.baseColorTexture.file;d.baseColorTexture=WALK.getViewer().createTextureFromHtmlImage(e)}c||(d.disableLightProbe=!0,d.headLight=!0);d.setUniforms();return d}function Xg(a){a&&a.forEach(function(b){Qg[b.name]=b})}
WALK.setAvatarModel=function(a,b,c){Pg=a;a=b.meshes;a.length!==c.size&&console.warn("Mismatch between avatar meshes count and geometries map size");a=m.makeIterator(a);for(var d=a.next();!d.done;d=a.next()){d=d.value;c.has(d.geometryName)||console.assert(!1,'Avatar "'+d.geometryName+'" mesh is missing');var e={materialName:d.materialName?d.materialName:"mainMaterial",geometry:c.get(d.geometryName)};Rg[d.group].push(e)}Xg(b.materials)};
WALK.Avatar=function(a,b,c){function d(g,k){Rg[k].forEach(function(h){h=new G.Mesh(h.geometry,e.materials[h.materialName]);g.add(h);h.visibilityId=null;e.colliders.push(h)})}var e=this;G.Object3D.call(this);this.uuid=b;this.displayName=c.displayName;this._scene=a;this._lastLightProbeCheckPosition=new G.Vector3(0,0,0);this.colliders=[];Sg(a);this._haveLightProbe=0<this._scene.lightProbes.length;this.materials={};b=m.makeIterator(Object.values(Qg));for(var f=b.next();!f.done;f=b.next())f=f.value,this.materials[f.name]=
Wg(f,Pg,this._haveLightProbe);this.materials.mainMaterial.baseColor.setStyle(c.color).convertGammaToLinear();this._body=new G.Object3D;this._head=new G.Object3D;this._head.rotation.order="ZXY";this._torso=new G.Object3D;this._displayLandscape=new G.Object3D;this._displayPortrait=new G.Object3D;d(this._head,"head");d(this._torso,"torso");d(this._displayLandscape,"displayLandscape");d(this._displayPortrait,"displayPortrait");this._pointer=Ug(this.materials.mainMaterial);this._pointerLeaderStartOffset=
new G.Vector3(0,.3,-.35);this._pointerLeader=Vg(c.color);this._displayNameAnchor=Tg(a,c.displayName,c.color);this._body.add(this._torso);this._head.add(this._displayLandscape);this._head.add(this._displayPortrait);this._body.add(this._head);this.add(this._body);this.add(this._displayNameAnchor);this.add(this._pointerLeader);this.add(this._pointer);c.position&&this.position.fromArray(c.position);this.updateMatrixWorld(!0);this._setClosestLightProbe();this._videoTexture1=this._videoTexture0=null;this._landscape=
!0;this._displayLandscape.visible=!0;this._displayPortrait.visible=!1;this._soundThreshold=140;this._maxHighlight=.5;this._highlightStepDown=.05};WALK.Avatar.prototype=Object.create(G.Object3D.prototype);WALK.Avatar.prototype.constructor=WALK.Avatar;WALK.Avatar.prototype.switchToPortrait=function(){this._landscape&&(this._landscape=!1,this._displayLandscape.visible=!1,this._displayPortrait.visible=!0,this._head.rotation.y=Math.PI/2,this._torso.position.z-=.05)};
WALK.Avatar.prototype.switchToLandscape=function(){this._landscape||(this._landscape=!0,this._displayLandscape.visible=!0,this._displayPortrait.visible=!1,this._head.rotation.y=0,this._torso.position.z+=.05)};WALK.Avatar.prototype.hideBody=function(){this._head.visible=!1;this._torso.visible=!1;this._displayNameAnchor.visible=!1};WALK.Avatar.prototype._updated=function(){this.dispatchEvent({type:"avatarUpdated",target:this})};
WALK.Avatar.prototype.rotate=function(a,b){this._body.rotation.z=a;this._head.rotation.x=b};WALK.Avatar.prototype.setOrientation=function(){this._videoTexture0.width<this._videoTexture0.height?this.switchToPortrait():this.switchToLandscape()};
WALK.Avatar.prototype.setVideoTexture0=function(a){var b=this;this._videoTexture0&&(this._videoTexture0.dispose(),this._videoTexture0=null);this._haveLightProbe&&(this.materials.displayMaterial.disableLightProbe=!1);this.materials.displayMaterial.baseColorTexture=null;this._updated();a?a.addLoadedListener(function(){b._videoTexture0=a;b.setOrientation();b.materials.displayMaterial.disableLightProbe=!0;b.materials.displayMaterial.baseColorTexture=a;a.addResizedListener(function(){b.setOrientation();
b._updated()});b._updated()}):(this.switchToLandscape(),this._updated())};WALK.Avatar.prototype.getVideoTexture0=function(){return this._videoTexture0};WALK.Avatar.prototype.setVideoTexture1=function(a){var b=this;this._videoTexture1&&(this._videoTexture1.dispose(),this._videoTexture1=null,this._updated());a&&a.addLoadedListener(function(){b._videoTexture1=a;b._updated()})};WALK.Avatar.prototype.getVideoTexture1=function(){return this._videoTexture1};WALK.Avatar.prototype.getMainMaterial=function(){return this.materials.mainMaterial};
WALK.Avatar.prototype._setClosestLightProbe=function(){var a=this._scene.closestLightProbe(this.position);if(a!==this._head.children[0].lightProbe){for(var b=m.makeIterator([this._head,this._torso,this._displayPortrait,this._displayLandscape]),c=b.next();!c.done;c=b.next())c.value.children.forEach(function(d){d.lightProbe=a});this._pointer.lightProbe=a;this._pointerLeader.lightProbe=a}};
WALK.Avatar.prototype.setPositionFromArray=function(a){this.position.fromArray(a);.5<this._lastLightProbeCheckPosition.distanceTo(this.position)&&(this._lastLightProbeCheckPosition.copy(this.position),this._setClosestLightProbe(this.position))};
WALK.Avatar.prototype.placePointer=function(){var a=new G.Matrix4,b=new G.Vector3,c=new G.Vector3,d=new G.Vector3,e=new G.Vector3,f=new G.Matrix4,g=new G.Matrix4;g.set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1);var k=new G.Matrix4;return function(h,l,n){this._pointer.position.set(h-this.position.x,l-this.position.y,n-this.position.z);this._pointer.visible=!0;a.makeRotationZ(this._body.rotation.z);b.set(this._pointerLeaderStartOffset.x,this._pointerLeaderStartOffset.y,this._pointerLeaderStartOffset.z);b.applyMatrix4(a);
c.set(this.position.x,this.position.y,this.position.z).add(b);d.set(h,l,n);e.set(h,l,n).sub(c);k.makeScale(1,e.length(),1);f.lookAt(c,d,G.Object3D.DefaultUp);f.multiply(g);k.multiplyMatrices(f,k);e.divideScalar(2).add(b);k.setPosition(e);this._pointerLeader.matrix.identity();this._pointerLeader.applyMatrix(k);this._pointerLeader.visible=!0}}();WALK.Avatar.prototype.hidePointer=function(){this._pointerLeader.visible=!1;this._pointer.visible=!1};
WALK.Avatar.prototype.onSoundVolumeUpdated=function(a){null!==a&&(a=this._computeHighlighMix(a),this.getMainMaterial().highlightMix!==a&&(this.getMainMaterial().highlightMix=a,WALK.getViewer().requestFrame()))};WALK.Avatar.prototype.onSoundSwitchedOff=function(){0<this.getMainMaterial().highlightMix&&(this.getMainMaterial().highlightMix=0,WALK.getViewer().requestFrame())};
WALK.Avatar.prototype._computeHighlighMix=function(a){var b=this.getMainMaterial().highlightMix;if(a<this._soundThreshold)return 0<b?Math.max(0,b-this._highlightStepDown):0;a=(a-this._soundThreshold)/(255-this._soundThreshold)*this._maxHighlight;return a>b?a:Math.max(a,b-this._highlightStepDown)};
WALK.Avatar.prototype.dispose=function(){for(var a=m.makeIterator(Object.values(this.materials)),b=a.next();!b.done;b=a.next())b.value.dispose();this._videoTexture0&&this._videoTexture0.dispose();this._videoTexture1&&this._videoTexture1.dispose();this._displayNameAnchor.dispose();this.dispatchEvent({type:"dispose"})};var Yg,Zg,$g,ah;function bh(a,b,c,d,e){c=new G.SphereBufferGeometry(c,32,16);c.changePosition(d);c.computeBoundingSphere();c.convertNormalsToSpherical();d=new WALK.Mesh(null,c,b);b.lightMapped&&(d.lightMap=e);a.camera.getWorldPosition(ah);d.lightProbe=a.closestLightProbe(ah);d.frustumCulled=!1;d.userData.hideFromLightProbes=!0;return d}var ch=new G.Matrix4,dh=new G.Vector2;
function eh(a){Yg.setRGB(a,a,a);a=WALK.ColorUtils.hdrEncode(Yg,Zg);var b=new Uint8Array(4);b[0]=Math.round(255*Zg.r);b[1]=Math.round(255*Zg.g);b[2]=Math.round(255*Zg.b);b[3]=Math.round(255*a);a=new WALK.DataTexture(b,1,1);a.magFilter=GLC.NEAREST;a.minFilter=GLC.NEAREST;a.anisotropy=WALK.NO_ANISOTROPY;a.hasAlpha=!0;a.isRgbm=!0;a.loaded=!0;a.needsUpdate=!0;return a}
WALK.MaterialPicker=function(a,b,c,d,e,f,g){function k(){return l(!1)}function h(){return l(!0)}function l(K){r.forEach(function(J){return J(K)})}var n=this;this.lightMap=null;this.meshes=[];var r=[],v=Math.max(2*d.camera.near,.1);Yg||(Yg=new G.Color,Zg=new G.Color,ah=new G.Vector3,$g=new G.Vector3,ah=new G.Vector3);var p=d.camera.aspect,w=Math.tan(G.Math.degToRad(d.camera.fov/2))*v,u=-w;p=Math.abs(p*w-p*u);w=Math.abs(w-u);var y=.01*p,B=(p-a.length*y-y)/(2*a.length);B=Math.min(B,WALK.MATERIAL_PICKER_BALL_MAX_SIZE/
2*p);var D=a.length/2*-(2*B+y)+B+y;u=document.getElementById("menu-bar").getBoundingClientRect().top;var H=-w/2+(window.innerHeight-u)/window.innerHeight*w+B+y;a.some(function(K){return K.lightMapped})&&(f=f.measureIncidentLuma(),0>f&&(f=1),this.lightMap=eh(f));a.forEach(function(K,J){if(K){$g.set(D,H,-v);var W=bh(d,K,B,$g,n.lightMap);D+=2*B+y;var M=null;if(b){M=new G.Matrix4;M.multiply(ch.makeTranslation(b.x,b.y,b.z));K=e.cameraWorldPosition();dh.x=K.x-b.x;dh.y=K.y-b.y;K=M;var ba=K.multiply,ha=ch.makeRotationZ;
var ta=Math.abs(dh.y)>Math.abs(dh.x)?0<dh.x?0:-Math.PI:0<dh.y?Math.PI/2:-Math.PI/2;ba.call(K,ha.call(ch,ta));M.multiply(ch.makeRotationX(-Math.PI/2));M.multiply(ch.makeScale(c,c,c));M.multiply(ch.makeTranslation(2.1*(J+1),0,0));M.multiply(ch.makeScale(1/B,1/B,1/B));M.multiply(ch.makeTranslation(-$g.x,-$g.y,-$g.z))}n.meshes.push(W);r.push(function(I){I&&M?(W.matrix=M,W.matrixWorld=M):(W.matrix=d.camera.matrix,W.matrixWorld=d.camera.matrixWorld)})}});g.addEventListener("modeEnabled",h);g.addEventListener("modeDisabled",
k);this.dispose=function(){r.length=0;g.removeEventListener("modeEnabled",h);g.removeEventListener("modeDisabled",k);this.meshes.forEach(function(K){return K.geometry.dispose()});this.meshes=null;this.lightMap&&(this.lightMap.dispose(),this.lightMap=null)};l(g.modeIsEnabled())};function fh(a,b,c){function d(){r.set({x:b.min.x,y:b.min.y},{x:b.max.x,y:b.max.y})}function e(){var w=r.center(),u=Math.abs(Math.sin(l)),y=Math.abs(Math.cos(l)),B=Math.abs(r.max.x-r.min.x),D=Math.abs(r.max.y-r.min.y),H=B*y+D*u;u=B*u+D*y;p.set({x:w.x-H/2,y:w.y+u/2},{x:w.x+H/2,y:w.y-u/2})}function f(){var w=Math.abs(b.min.x-b.max.x),u=Math.abs(b.min.y-b.max.y);w=r.size().x/w;u=r.size().y/u;w>u?v.set(1,u/w):v.set(w/u,1)}var g=a.name||"level",k=a.slicePlaneHeight,h=a.farPlaneHeight,l=a.rotation||0,n=
!!a.cropRange,r=a.cropRange?new G.Box2((new G.Vector2).fromArray(a.cropRange.min),(new G.Vector2).fromArray(a.cropRange.max)):new G.Box2,v=new G.Vector2(1,1),p=new G.Box2;n&&f();this.setRange=function(w,u,y){w>r.max[y]&&(w=r.max[y]);u<r.min[y]&&(u=r.min[y]);r.min[y]=w;r.max[y]=u;e();f();c()};this.serialize=function(){var w=n?{min:r.min.toArray(),max:r.max.toArray()}:null;return{name:g,slicePlaneHeight:k,farPlaneHeight:h,cropRange:w,rotation:l}};Object.defineProperty(this,"name",{get:function(){return g},
set:function(w){g=w?w.trim()||"level":"level";c()}});Object.defineProperty(this,"slicePlaneHeight",{get:function(){return k},set:function(w){w>=h&&(k=w,c())}});Object.defineProperty(this,"farPlaneHeight",{get:function(){return h},set:function(w){w<=k&&(h=w,c())}});Object.defineProperty(this,"crop",{get:function(){return n},set:function(w){(n=w)||d();e();f();c()}});Object.defineProperty(this,"cropRange",{get:function(){r.empty()&&d();return r}});Object.defineProperty(this,"visibleRange",{get:function(){p.empty()&&
e();return p}});Object.defineProperty(this,"ratio",{get:function(){0!==v.x&&0!==v.y&&isNaN(v.x)&&isNaN(v.y)||f();return v}});Object.defineProperty(this,"rotation",{get:function(){return l},set:function(w){l=w;n||d();e();f();c()}});Object.defineProperty(this,"rotationDeg",{get:function(){return G.Math.radToDeg(this.rotation)},set:function(w){this.rotation=G.Math.degToRad(w)}})}
WALK.MinimapConfig=function(a,b,c){function d(){return g.dispatchEvent(k)}function e(){return new fh({name:"level0",slicePlaneHeight:c?c:b.min.z+WALK.FALLBACK_CAMERA_HEIGHT,farPlaneHeight:b.min.z},b,d)}function f(){return v.map(function(p){return p.serialize()})}var g=this;a=void 0!==a?a:{enabled:!1,outlineColor:[0,0,0],outlineThickness:1,fillEnabled:!0,levels:[]};var k={type:"updated",target:this},h=a.enabled,l=(new G.Color).fromArray(a.outlineColor),n=a.outlineThickness,r=a.fillEnabled,v=a.levels.map(function(p){return new fh(p,
b,d)});this.addLevel=function(p){var w=v.length;if(0===w)v.push(e());else{var u=v,y=u.push;var B="level"+w;var D=v[w-1];w=D.slicePlaneHeight+(b.max.z-D.slicePlaneHeight)/2;var H=D.farPlaneHeight;D=D.rotation;p=p.crop?{min:p.cropRange.min.toArray(),max:p.cropRange.max.toArray()}:null;B=new fh({name:B,slicePlaneHeight:w,farPlaneHeight:H,cropRange:p,rotation:D},b,d);y.call(u,B)}d()};this.removeLevel=function(p){WALK.removeFromArray(p,v);0===v.length&&v.push(e());d()};this.shiftLevel=function(p,w){WALK.shiftItem(v,
p,w);d()};this.setOutlineColorRGB=function(p,w,u){l.setRGB(p,w,u);d()};this.serialize=function(){return{enabled:this.enabled,outlineColor:this.outlineColor.toArray(),outlineThickness:this.outlineThickness,fillEnabled:this.fillEnabled,levels:f()}};Object.defineProperty(this,"enabled",{get:function(){return h},set:function(p){p&&0===v.length&&this.addLevel();h=p;d()}});Object.defineProperty(this,"outlineColor",{get:function(){return l}});Object.defineProperty(this,"outlineThickness",{get:function(){return n},
set:function(p){n=p;d()}});Object.defineProperty(this,"fillEnabled",{get:function(){return r},set:function(p){r=p;d()}});Object.defineProperty(this,"levels",{get:function(){return v}})};G.EventDispatcher.prototype.apply(WALK.MinimapConfig.prototype);function gh(){var a=new Set,b=[];this.add=function(c){c instanceof RegExp?b.push(c):a.add(c)};this.matchesAny=function(c){return a.has(c)?!0:b.some(function(d){return d.test(c)})}}
WALK.MergeConfig=function(){window._MergeConfig=this;this._editableNodeTypes=new gh;this._editableMaterialNames=new gh;this._allMaterialsEditable=!1;this.setNodeTypeEditable=function(a){this._editableNodeTypes.add(a)};this.setMaterialEditable=function(a){this._editableMaterialNames.add(a)};this.setAllMaterialsEditable=function(){this._allMaterialsEditable=!0};this.isMaterialEditable=function(a){return this._allMaterialsEditable||this._editableMaterialNames.matchesAny(a)};this.isNodeTypeEditable=function(a){return this._editableNodeTypes.matchesAny(a)}};function hh(){function a(h,l,n){return(0<=h?h-1:h+l/n)*n}var b=this,c=new G.Vector3,d=new G.Vector3,e=new G.Vector3,f=new G.Vector3,g=new G.Vector3;this.objects=[];var k=null;this.vertices=[];this.normals=[];this.uvs=[];this.startObject=function(h){k={name:h||"",vertices:[],normals:[],uvs:[],hasUvs:!1};this.objects.push(k)};this.addFace=function(h,l,n,r,v,p,w,u,y){var B=this.vertices.length;h=a(h,B,3);l=a(l,B,3);n=a(n,B,3);B=b.vertices;var D=k.vertices;D.push(B[h+0],B[h+1],B[h+2]);D.push(B[l+0],B[l+
1],B[l+2]);D.push(B[n+0],B[n+1],B[n+2]);void 0!==w?(h=this.normals.length,w=a(w,h,3),u=a(u,h,3),y=a(y,h,3),h=b.normals,l=k.normals,l.push(h[w+0],h[w+1],h[w+2]),l.push(h[u+0],h[u+1],h[u+2]),l.push(h[y+0],h[y+1],h[y+2])):(y=b.vertices,u=k.normals,c.fromArray(y,h),d.fromArray(y,l),e.fromArray(y,n),g.subVectors(e,d),f.subVectors(c,d),g.cross(f),g.normalize(),u.push(g.x,g.y,g.z),u.push(g.x,g.y,g.z),u.push(g.x,g.y,g.z));void 0!==r?(y=this.uvs.length,r=a(r,y,2),v=a(v,y,2),p=a(p,y,2),y=b.uvs,u=k.uvs,u.push(y[r+
0],y[r+1]),u.push(y[v+0],y[v+1]),u.push(y[p+0],y[p+1]),k.hasUvs=!0):(p=k.uvs,p.push(0,0),p.push(0,0),p.push(0,0))}}function ih(a){if(void 0!==a&&""!==a)return parseInt(a,10)}
WALK.parseObj=function(a){var b=/^[og]\s*(.+)?/,c=/^mtllib /,d=/^usemtl /,e=/^usemap /,f=new hh;-1!==a.indexOf("\r\n")&&(a=a.replace(/\r\n/g,"\n"));-1!==a.indexOf("\\\n")&&(a=a.replace(/\\\n/g,""));a=a.split("\n");var g;a=m.makeIterator(a);for(g=a.next();!g.done;g=a.next()){var k=g.value;if(0!==k.length&&"\x00"!==k){var h=k.charAt(0);if("#"!==h)if("v"===h)switch(g=k.split(/\s+/),g[0]){case "v":f.vertices.push(parseFloat(g[1]),parseFloat(g[2]),parseFloat(g[3]));7<=g.length&&console.assert(!1,"obj with vertex colors is not supported");
break;case "vn":f.normals.push(parseFloat(g[1]),parseFloat(g[2]),parseFloat(g[3]));break;case "vt":f.uvs.push(parseFloat(g[1]),parseFloat(g[2]))}else if("f"===h){k=k.substr(1).trim().split(/\s+/);g=[];k=m.makeIterator(k);for(h=k.next();!h.done;h=k.next())h=h.value,0<h.length&&(h=h.split("/"),g.push(h));k=g[0];h=1;for(var l=g.length-1;h<l;h++){var n=g[h],r=g[h+1];f.addFace(ih(k[0]),ih(n[0]),ih(r[0]),ih(k[1]),ih(n[1]),ih(r[1]),ih(k[2]),ih(n[2]),ih(r[2]))}}else"l"===h?console.assert(!1,"line geometry is not supported"):
"p"===h?console.assert(!1,"obj point geometry not supported"):null!==(g=b.exec(k))?(g=(" "+g[0].substr(1).trim()).substr(1),f.startObject(g)):d.test(k)||c.test(k)||e.test(k)||"s"!==h&&console.warn('OBJLoader: Unexpected line: "'+k+'"')}}b=new Map;f=m.makeIterator(f.objects);for(c=f.next();!c.done;c=f.next())c=c.value,0!==c.vertices.length&&(d=new G.BufferGeometry,d.addAttribute("position",new WALK.BufferAttribute(new Float32Array(c.vertices),3)),0<c.normals.length&&d.addAttribute("normal",new WALK.BufferAttribute(new Float32Array(c.normals),
3)),!0===c.hasUvs&&d.addAttribute("uv",new WALK.BufferAttribute(new Float32Array(c.uvs),2)),d.convertNormalsToSpherical(),d.computeBoundingBox(),d.computeBoundingSphere(),b.set(c.name,d));return b};WALK.KTXLoader=function(){this._parser=WALK.KTXLoader.parse};WALK.KTXLoader.prototype=Object.create(WALK.CompressedTextureLoader.prototype);
WALK.KTXLoader.parse=function(a){var b=[],c=new Int32Array(a,0,16);67305985===c[3]&&console.assert("Big endian machines not supported");console.assert(0===c[4]);console.assert(1===c[5]);console.assert(0===c[6]);if(35842===c[7]){console.assert(6408===c[8]);var d=GLC.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG}else 36196===c[7]?(console.assert(6407===c[8]),d=GLC.COMPRESSED_RGB_ETC1_WEBGL):33776===c[7]?(console.assert(6407===c[8]),d=GLC.COMPRESSED_RGB_S3TC_DXT1_EXT):33779===c[7]?(console.assert(6408===c[8]),d=
GLC.COMPRESSED_RGBA_S3TC_DXT5_EXT):console.error("Unknown KTX glInternalFormat: "+c[7]);var e=c[9],f=c[10];console.assert(0===(e&e-1));console.assert(0===(f&f-1));console.assert(0===c[11]);console.assert(0===c[12]);console.assert(1===c[13]);var g=c[14];c=c[15];console.assert(0===c%4);c=64+c;for(var k=new DataView(a,0),h=e,l=f,n=0;n<g;++n){var r=k.getUint32(c,!0);c+=4;var v=new Uint8Array(a,c,r);b.push({data:v,width:h,height:l});c+=r+(3-(r+3)%4);h=Math.max(h/2,1);l=Math.max(l/2,1)}console.assert(c===
a.byteLength);return{format:d,width:e,height:f,mipmapCount:g,mipmaps:b}};var jh=function(){function a(b,c){return{formatIdx:b,gpuFormat:c}}return{ETC1:a(0,GLC.COMPRESSED_RGB_ETC1_WEBGL),BC1:a(2,GLC.COMPRESSED_RGB_S3TC_DXT1_EXT),BC3:a(3,GLC.COMPRESSED_RGBA_S3TC_DXT5_EXT),PVRTC1_4_RGB:a(8,GLC.COMPRESSED_RGB_PVRTC_4BPPV1_IMG),PVRTC1_4_RGBA:a(9,GLC.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG),ASTC_4x4:a(10,GLC.COMPRESSED_RGBA_ASTC_4x4_KHR),RGBA32:a(13,GLC.RGBA)}}();
function kh(a,b,c,d,e){a({wasmBinary:b}).then(function(f){function g(k,h,l){var n=0===Math.log2(h)%1&&0===Math.log2(l)%1;return d.dxtTextures?k?c.BC3:c.BC1:d.pvrtcTextures&&h===l&&n?k?c.PVRTC1_4_RGBA:c.PVRTC1_4_RGB:d.etc1Textures&&!k?c.ETC1:d.astcTextures?c.ASTC_4x4:c.RGBA32}f.initializeBasis();e(function(k){function h(D){l.close();l.delete();throw D;}var l=new f.BasisFile(new self.Uint8Array(k));k=l.getHasAlpha();var n=l.getNumImages(),r=l.getNumLevels(0),v=l.getImageWidth(0,0),p=l.getImageHeight(0,
0);0!==v&&0!==p&&0!==n&&0!==r||h("Invalid .basis file");1<n&&h("Missing multiple images handling");n=g(k,v,p);v=n.formatIdx;l.startTranscoding()||h("startTranscoding failed");p=[];for(var w=0;w<r;++w){var u=l.getImageWidth(0,w),y=l.getImageHeight(0,w),B=l.getImageTranscodedSizeInBytes(0,w,v);B=new self.Uint8Array(new self.ArrayBuffer(B));l.transcodeImage(B,0,w,v,0,k)||h(".transcodeImage failed");p.push({data:B,width:u,height:y})}l.close();l.delete();return{gpuFormat:n.gpuFormat,mipmaps:p}})})}
function lh(a,b,c,d){function e(){g.removeEventListener("error",f);g.removeEventListener("message",e);g.addEventListener("error",function(l){l="Worker error @L"+l.lineno+": "+l.message;k&&(k.onError(l),k=null)});g.addEventListener("message",function(l){console.assert(k);k.onSuccess(l.data);k=null;d(h)});c();d(h)}function f(l){throw"Worker error @L"+l.lineno+": "+l.message;}var g=new window.Worker(a),k=null,h={processItem:function(l){console.assert(!k);k=l;g.postMessage(l.texBuffer,[l.texBuffer])},
terminate:function(){console.assert(!k);g.terminate()}};g.addEventListener("error",f);g.addEventListener("message",e);g.postMessage(b)}
function mh(a,b,c,d){function e(){n.deferRun();0!==l.length&&(0<h.length?(h.pop().processItem(l.pop()),e()):k<d&&!g&&(k++,g=!0,lh(f,c,function(){g=!1},function(r){h.push(r);e()})))}a="\nself.importScripts("+JSON.stringify(a)+");\nconst initBasis = "+kh.toString()+";\nconst basisFormats = "+JSON.stringify(jh)+";\nconst glDetector = "+JSON.stringify({astcTextures:b.gl.astcTextures,dxtTextures:b.gl.dxtTextures,etc1Textures:b.gl.etc1Textures,pvrtcTextures:b.gl.pvrtcTextures})+";\n\nfunction initHandler(evt) {\n  self.removeEventListener('message', initHandler);\n\n  const wasmBinary = evt.data;\n  initBasis(BASIS, wasmBinary, basisFormats, glDetector,\n            decodeTexBuffer => {\n    self.addEventListener('message', function(evt) {\n        const texBuffer = evt.data;\n        const texDatas = decodeTexBuffer(texBuffer);\n        // second argument to transfer ownership to the main thread\n        self.postMessage(texDatas, texDatas.mipmaps.map(t => t.data.buffer));\n    });\n    self.postMessage({}); // communicate end of init\n  });\n}\n\nself.addEventListener('message', initHandler);\n";
var f=window.URL.createObjectURL(new window.Blob([a])),g=!1,k=0,h=[],l=[],n=new WALK.DeferringExecutorOnce(function(){for(var r=m.makeIterator(h),v=r.next();!v.done;v=r.next())v.value.terminate();k-=h.length;h.length=0},5E3);return function(r,v,p){l.push({texBuffer:r,onSuccess:v,onError:p});e()}}
function nh(a,b){WALK.ajaxGet(WALK.getViewerAssetUrl("lib/basis/basis_transcoder.wasm"),!0,function(c){var d=WALK.getViewerAssetUrl("lib/basis/basis_transcoder.js"),e=a.BASIS_DECODE_WORKERS;if(0>=e){var f=window.document.createElement("script");f.addEventListener("load",function k(){f.removeEventListener("load",k);kh(window.BASIS,c,jh,a.gl,function(h){b(function(l,n,r){try{n(h(l))}catch(v){r(v)}})})});f.src=d;window.document.head.appendChild(f)}else b(mh(d,a,c,e))},function(c){throw c;})}
WALK.createBasisLoader=function(a){function b(f){for(var g=[],k=0;k<arguments.length;++k)g[k-0]=arguments[k];d.push(g)}function c(f){b=f;d.forEach(function(g){return b.apply(null,m.arrayFromIterable(g))});d.length=0}if(!window.WebAssembly||!(a.gl.pvrtcTextures||a.gl.etc1Textures||a.gl.dxtTextures||a.gl.astcTextures))return null;var d=[],e=!1;return{load:function(f,g,k){var h=new WALK.CompressedTexture;e||(e=!0,nh(a,c));f(function(l){b(l,function(n){h.format=n.gpuFormat;n=n.mipmaps;h.mipmaps=n;h.width=
n[0].width;h.height=n[0].height;h.generateMipmaps=!1;h.minFilter=1===n.length?GLC.LINEAR:GLC.LINEAR_MIPMAP_LINEAR;h.flipY=!1;h.needsUpdate=!0;g(h)},k)},k);return h}}};function oh(){var a={};this.cacheKey=function(b,c,d,e,f){return b+"@"+c+"@"+d+"@"+e+"@"+f};this.get=function(b){return a[b]};this.insert=function(b,c){a[b]=c}}function ph(a,b){return function(c,d){WALK.queueAjaxGet(a,b,!0,c,d)}}function qh(a,b,c){return function(d,e){ph(a,b)(function(f){WALK.decrypt(f,c,d,e)},e)}}
function rh(a,b,c,d,e,f){function g(h){k.image=h;k.width=h.width;k.height=h.height;e(k)}var k=new WALK.Texture;k.format=c;void 0!==d?qh(a,b,d)(function(h){h=new Uint8Array(h);var l=b.endsWith("png")?"image/png":"image/jpeg";h=new Blob([h],{type:l});h=(window.URL||window.webkitURL).createObjectURL(h);var n=new Image;n.onload=function(){g(n)};n.src=h},f):WALK.queueImageGet(a,b,g,f);return k}
function sh(a,b,c,d,e,f){var g=new WALK.VideoTexture;g.format=c;WALK.queueVideoGet(a,b,function(k){g.video=k;g.width=k.videoWidth;g.height=k.videoHeight;G.Math.isPowerOfTwo(g.width)&&G.Math.isPowerOfTwo(g.height)||(g.wrapS=GLC.CLAMP_TO_EDGE,g.wrapT=GLC.CLAMP_TO_EDGE);e(g);d&&g.pause()},f);return g}function th(a,b){!1===a.importGpuCompress&&(b.importGpuCompress=!1);!1===a.importAutoScale&&(b.importAutoScale=!1)}
WALK.TextureLoader=function(a,b,c,d,e,f,g){function k(y){var B=y.id,D=y.webFormats;console.assert(D&&0<D.length,"No web format for texture: "+y.id+"."+y.rawExt);if(y.video)return a+"video/"+D[0]+"/"+B+"."+y.stdExt;var H=a+"img/",K=b.ios&&y.rgbm;if(u&&!K){if(!b.mobile&&-1<D.indexOf("large/basis"))return H+"large/basis/"+B+".basis";if(-1<D.indexOf("small/basis"))return H+"small/basis/"+B+".basis"}if(b.gl.pvrtcTextures&&!K&&-1<D.indexOf("small/pvr"))return H+"small/pvr/"+B+".ktx";if(b.gl.etc1Textures&&
-1<D.indexOf("small/etc1"))return H+"small/etc1/"+B+".ktx";if(b.gl.dxtTextures&&-1<D.indexOf("large/dxt"))return H+"large/dxt/"+B+".ktx";K=-1<D.indexOf("small/std");return!(-1<D.indexOf("large/std"))||b.mobile&&K?H+"small/std/"+B+"."+y.stdExt:H+"large/std/"+B+"."+y.stdExt}function h(y){--v.texturesToLoad;y.needsUpdate=!0;c(y);y.notifyLoaded()}function l(){--v.texturesToLoad;d()}function n(){--v.texturesToLoad;e()}function r(y,B,D,H,K){var J=new WALK.DataTexture;WALK.queueAjaxGet(y,B,!0,function(W){W=
new Uint8Array(W,0,W.byteLength);var M=W[1];J.image.width=Math.pow(2,W[0]);J.image.height=Math.pow(2,M);J.format=D;J.type=GLC.UNSIGNED_BYTE;J.image.data=W.subarray(2);H&&H(J);J=null},K);return J}var v=this,p=new oh,w=new WALK.KTXLoader,u=!WALK.NO_BASIS&&WALK.createBasisLoader(b);f&&(p.insert=function(){});this.texturesToLoad=0;this.clearCache=function(){p=null};this.load=function(y,B,D,H,K){var J=B.alpha?GLC.RGBA:GLC.RGB,W=k(B),M=/\.basis$/.test(W),ba=/\.ktx$/.test(W),ha=/\.buf$/.test(W),ta=B.video,
I=!(ba||ha||ta),U=B.passphrase,ia=p.cacheKey(W,D,H,K,J),R=p.get(ia);if(R)return th(B,R),R;v.texturesToLoad+=1;ha?R=r(y,W,J,h,l):M?(y=void 0===U?ph(y,W):qh(y,W,U),R=u.load(y,h,l)):ba?R=w.load(y,W,h,l):I?R=rh(y,W,J,U,h,l):(console.assert(ta),R=sh(WALK.LOAD_PRIORITY.VIDEO,W,J,g,h,n));R.hasAlpha=!!B.alpha;R.isRgbm=!!B.rgbm;D&&(R.wrapS=GLC.REPEAT,R.wrapT=GLC.REPEAT);H&&!ta?(R.minFilter=GLC.LINEAR_MIPMAP_LINEAR,R.generateMipmaps=!ba):(R.minFilter=GLC.LINEAR,R.generateMipmaps=!1);K&&(R.anisotropy=K);p.insert(ia,
R);R.id=B.id;R.name=B.name;R.webFormats=B.webFormats;B.passphrase&&(R.passphrase=B.passphrase);th(B,R);B.rawExt&&(R.rawExt=B.rawExt);R.stdExt=B.stdExt;return R}};var uh="doubleSided name opacity parallaxCorrection parallaxMode parallaxScale parallaxMinLayers parallaxMaxLayers planarReflector".split(" "),vh="bumpScale emissive emissionStrength envMapProject metallic roughness alphaInLowerHalf chromaKeyEnabled".split(" "),wh="baseColor bumpScale bumpTexture doubleSided emissive metallic opacity roughness".split(" ");function xh(a,b,c){for(var d=0;d<b.length;d+=1){var e=b[d],f=a[e];void 0!==f&&(c["_"+e]=f)}}
WALK.MaterialLoader=function(a,b,c){var d=WALK.DETECTOR;this.load=function(e,f){for(var g=new Map,k=0,h=0;h<e.length;h+=1){var l,n=e[h];var r=WALK.createMaterialOfType(n.type);if("water"===r.type)r.name=n.name,n.normalTexture&&(r.normalTexture=a.load(WALK.LOAD_PRIORITY.SPECULARITY,n.normalTexture,!0,!1,WALK.DEFAULT_ANISOTROPY)),n.baseColor&&r.baseColor.fromArray(n.baseColor),void 0!==n.opacity&&(r.opacity=n.opacity),xh(n,["wavesSpeed","wavesScale","refractionFactor"],r),r.setUniforms();else{WALK.copyProperties(n,
uh,r);xh(n,vh,r);n.baseColor&&(r.baseColor.fromArray(n.baseColor),r.baseColor.roundChannels());if(l=n.baseColorTextureCorrection)r._baseColorTextureCorrection=!0,void 0!==l.contrast&&(r._baseColorTextureContrast=l.contrast),r.baseColorTextureHslOffset.h=l.hslOffset[0],r.baseColorTextureHslOffset.s=l.hslOffset[1],r.baseColorTextureHslOffset.l=l.hslOffset[2];if(l=n.baseColorTexture){if(l.atlasId){var v=b[l.atlasId].getAtlasEntry(l.id,l.name,l.atlasOffset[0],l.atlasOffset[1],l.atlasScale[0],l.atlasScale[1]);
null!==v.rawExt&&v.rawExt!==l.rawExt&&console.warn("Atlas entries with not matching rawExt "+l.name);v.rawExt=l.rawExt;null!==v.stdExt&&v.stdExt!==l.stdExt&&console.warn("Atlas entries with not matching stdExt "+l.name);v.stdExt=l.stdExt;!1===l.importGpuCompress&&(v.importGpuCompress=!1);!1===l.importAutoScale&&(v.importAutoScale=!1);l=v}else l=a.load(WALK.LOAD_PRIORITY.DIFFUSE,l,!0,!0,WALK.DEFAULT_ANISOTROPY);l.isCutout=null;r.baseColorTexture=l}n.roughnessTexture&&(r.roughnessTexture=a.load(WALK.LOAD_PRIORITY.SPECULARITY,
n.roughnessTexture,!0,!0,WALK.DEFAULT_ANISOTROPY));n.metallicTexture&&(r.metallicTexture=a.load(WALK.LOAD_PRIORITY.SPECULARITY,n.metallicTexture,!0,!0,WALK.DEFAULT_ANISOTROPY));n.bumpTexture&&d.gl.standardDerivatives&&(r.bumpTexture=a.load(WALK.LOAD_PRIORITY.SPECULARITY,n.bumpTexture,!0,!0,WALK.DEFAULT_ANISOTROPY));n.doNotImport&&WALK.copyProperties(n.doNotImport,wh,r.doNotImport);n.chromaKeyColor&&(r.chromaKeyColor.fromArray(n.chromaKeyColor),r.chromaKeyColor.roundChannels());n.chromaKeyDelta&&r._chromaKeyDelta.fromArray(n.chromaKeyDelta);
n.uvOffsetScale&&(n=n.uvOffsetScale,r.setUvOffsetAndScale(n[0],n[1],n[2],n[3]))}if(!c.isMaterialEditable(r.name)){n=r.hash();l=g.get(n)||[];v=m.makeIterator(l);for(var p=v.next();!p.done;p=v.next())if(p=p.value,p.canMerge(r)){k+=1;p.merged=!0;r=p;break}r.merged||(l.push(r),g.set(n,l))}f.addMaterial(r);r.merged||r.setUniforms()}WALK.log("Have "+e.length+" materials and "+(e.length-k)+" merged materials.")}};WALK.SkyLoader=function(a){function b(d,e,f){var g=new G.SphereBufferGeometry(1,64,64);return new WALK.SkyMesh(d,g,e,f)}function c(d){var e=new WALK.ProceduralSkyMaterial;return b(d.name,e,d.center)}this.loadSkyTexture=function(d,e){d.material.map&&d.material.map.dispose();d.material.map=a.load(WALK.LOAD_PRIORITY.SKY,e,!1,!1,WALK.NO_ANISOTROPY);d.yawRotationDeg=0};this.loadSingleSky=function(d,e){if("procedural"===d.type||void 0===d.type)d=c(d);else if("equirect"===d.type){var f=new WALK.EquirectSkyMaterial;
f.map=a.load(WALK.LOAD_PRIORITY.SKY,d.texture,!1,!1,WALK.NO_ANISOTROPY);f=b(d.name,f,d.center);f.geometry.applyMatrix((new G.Matrix4).makeScale(1,1,-1));f.rotation.x=Math.PI/2;f.yawRotationDeg=d.yawRotation||0;d=f}else console.warn("Unknown sky type: ",d.type),d=c(d);e.addSkyMesh(d)};this.load=function(d,e){this.loadSingleSky({name:WALK.DEFAULT_SKY_NAME,type:"procedural"},e);for(var f=0;f<d.length;f+=1)this.loadSingleSky(d[f],e)}};WALK.LightmapLoader=function(a,b,c){function d(){--f;if(0===f)e.onComplete()}var e=this,f=b;this.lightmaps=[];this.onComplete=null;this.load=function(){var g;if(g=WALK.DETECTOR.webp)g=void 0!==c&&void 0!==c.formats?0<=c.formats.indexOf("webp"):!1;g={id:null,name:null,stdExt:g?"webp":"png",webFormats:["large/std"],alpha:!0,rgbm:!0};for(var k=0;k<b;k+=1){g.id=g.name="lightmap-rgbm"+k;var h=a.load(WALK.LOAD_PRIORITY.LIGHTMAP,g,!1,!1,WALK.NO_ANISOTROPY);h.addLoadedListener(d);this.lightmaps.push(h)}}};WALK.TextureAtlasLoader=function(a,b){this.atlases={};this.load=function(c){for(var d=0;d<c.length;++d){var e=a.load(WALK.LOAD_PRIORITY.DIFFUSE,c[d],!1,!0,WALK.DEFAULT_ANISOTROPY);e.flipY=!1;e.enableAtlas(b);this.atlases[c[d].id]=e}}};WALK.BufferLoader=function(a,b){var c={};this.onHaveBuffer=this.onFailure=this.onProgress=null;this._buffersDone={};this.buffers={meshes:null,transforms:null,bounds:null,faces16:null,faces:null,vertices:null,normals:null,uvs0:null,uvs1:null};this.haveAllBuffers=function(){for(var d in this.buffers)if(this.buffers.hasOwnProperty(d)&&null===this.buffers[d])return!1;return!0};this.haveCoreBuffers=function(){var d=this.buffers;return d.faces16&&d.faces&&d.vertices&&d.normals&&d.transforms};this.releaseCoreBuffers=
function(){var d=this.buffers;d.faces16=d.faces=d.vertices=d.normals=null};this.load=function(){function d(h){return function(l){f.buffers[h]=l;f.onHaveBuffer()}}function e(h){return function(l){c[h]=l.loaded;f.onProgress()}}var f=this,g=WALK.LOAD_PRIORITY.CORE_RESOURCE,k={meshes:g,transforms:g,bounds:g,faces16:g,faces:g,vertices:g,normals:g,uvs0:b?g:WALK.LOAD_PRIORITY.UV0,uvs1:b?g:WALK.LOAD_PRIORITY.LIGHTMAP};(function(){for(var h in f.buffers)if(f.buffers.hasOwnProperty(h)){var l=k[h];console.assert(void 0!==
l);WALK.queueAjaxGet(l,a+h+".buf",!0,d(h),f.onFailure,e(h),!0)}})()};this.totalDone=function(){var d=0,e;for(e in c)c.hasOwnProperty(e)&&(d+=c[e]);return d}};function yh(a,b,c,d,e,f){this.meshPropsSet=new Set;this.meshPropsSet.add(a);this.material=b;this.lightMap=c;this.lightProbe=d;this.hideInViews=e;this.editableRootNode=f;this.anyLogicalMeshHasUvs=-1!==a.uv0ByteOffset;this.sharedGeometryId=a.useInstances?a.vertexByteOffset:null}yh.prototype.canUseLightMap=function(a){return null===this.lightMap||null===a||this.lightMap===a};
function zh(a,b,c){var d=new Int32Array(a);a=new Float32Array(a);var e=new Float32Array(b),f={},g=d[0],k=d[1],h=2;for(b=0;h<d.length;){var l={nodeId:d[h],materialIdx:d[h+1],useFaces16:1===d[h+2],faceByteOffset:d[h+3],faceCnt:d[h+4],vertexByteOffset:d[h+5],vertexCnt:d[h+6],normalByteOffset:d[h+7],uv0ByteOffset:d[h+8],uv1ByteOffset:d[h+9],lightMapIdx:d[h+10],uv1CoordUScale:a[h+11],uv1CoordVScale:a[h+12],uv1CoordUOffset:d[h+13],uv1CoordVOffset:d[h+14],transformByteOffset:d[h+15],boundsByteOffset:d[h+
16],quantVertexRange:a[h+17],quantVertexMax:d[h+18],quantUv0Range:a[h+19],quantUv0Max:d[h+20],autoLightmapResolution:2<=g?d[h+21]:-1,useInstances:!1,hasCopies:!1,isMasterCopy:!1};l.boundingBox=new G.Box3;l.boundingSphere=new G.Sphere;a:{for(var n=l.boundingBox,r=l.boundingSphere,v=l.boundsByteOffset/4,p=0;6>p;++p)if(!isFinite(e[v+p]))break a;n.max.x=e[v];n.max.y=e[v+1];n.max.z=e[v+2];n.min.x=e[v+3];n.min.y=e[v+4];n.min.z=e[v+5];n.center(r.center);r.radius=e[v+6]}b=Math.max(b,l.lightMapIdx+1);WALK.DETECTOR.gl.instances&&
(n=l.vertexByteOffset,f.hasOwnProperty(n)?(n=f[n],r=n[0],r.isMasterCopy=!0,r.hasCopies=!0,l.hasCopies=!0,n.push(l)):f[n]=[l]);c.push(l);h+=k}c=m.makeIterator(Object.values(f));for(d=c.next();!d.done;d=c.next())if(d=d.value,a=d.length,1<a&&500<a*d[0].faceCnt)for(d=m.makeIterator(d),a=d.next();!a.done;a=d.next())a.value.useInstances=!0;return b}
WALK.MeshMaker=function(a,b,c,d){function e(r){var v=[],p=new Map;g.forEach(function(w){var u=a.findNode(w.nodeId),y=a.materials[w.materialIdx],B=null;null!==u.initialLightProbeId&&(B=a.findLightProbe(u.initialLightProbeId));var D=null;-1!==w.lightMapIdx&&(D=r[w.lightMapIdx]);var H=u.hideInViews||[],K=u.editableRoot;if(u.editable||1!==y.opacity)v.push(new yh(w,y,D,B,H,K));else{var J=w.useInstances?w.vertexByteOffset:null;u=p.get(y)||[];for(var W=m.makeIterator(u),M=W.next();!M.done;M=W.next()){M=
M.value;var ba;if(ba=M.lightProbe===B&&M.editableRootNode===K&&M.canUseLightMap(D)&&M.sharedGeometryId===J)a:if(ba=M.hideInViews,ba.length!==H.length)ba=!1;else{for(var ha=0;ha<ba.length;ha+=1)if(ba[ha]!==H[ha]){ba=!1;break a}ba=!0}if(ba){null!==D&&(M.lightMap=D);M.anyLogicalMeshHasUvs=M.anyLogicalMeshHasUvs||-1!==w.uv0ByteOffset;M.meshPropsSet.add(w);return}}w=new yh(w,y,D,B,H,K);u.push(w);p.set(y,u);v.push(w)}});return v}var f=this,g=[],k=b.byteLength,h=0,l=0,n=0;this.mergedMeshes=[];this.lightmapCount=
this.geometryDownloadSize=this.coreGeometryDownloadSize=0;this.createMeshes=function(r){var v=r?r[0]:null,p=e(r);r={};p=m.makeIterator(p);for(var w=p.next();!w.done;w=p.next()){var u=w.value;w=u.sharedGeometryId;if(null!==w){var y=r[w],B=!1;y||(y=new WALK.Geometry,B=!0,r[w]=y);w=new WALK.InstancedGeometry(y,B)}else w=new WALK.Geometry;y=new WALK.MergedMesh(w,u.material);y.lightProbe=u.lightProbe;y.lightMap=u.lightMap||v;y.hideInViews=u.hideInViews;y.anyLogicalMeshHasUvs=u.anyLogicalMeshHasUvs;y.editableRootNode=
u.editableRootNode;this.mergedMeshes.push(y);u=m.makeIterator(u.meshPropsSet);for(B=u.next();!B.done;B=u.next()){B=B.value;var D,H=w;if(d){var K=3*B.faceCnt;var J=B.vertexCnt}else K=0,J=3*B.faceCnt;if(H.isInstanced)var W=D=0;else D=H.indexCnt,W=H.vertexCnt;W=new WALK.SubGeometry(K,J,H,D,W,B.boundingBox,B.boundingSphere);H.boundingBox.union(B.boundingBox);WALK.Math.spheresUnion(B.boundingSphere,H.boundingSphere);H.isInstanced?(W.instanceId=H.instanceCount,H.instanceCount+=1,H.indexCnt=K,H.vertexCnt=
J):(H.indexCnt+=K,H.vertexCnt+=J);K=W;J=a.findNode(B.nodeId);K=new WALK.Mesh(J,K,y.material);K.lightMap=y.lightMap;K.lightProbe=y.lightProbe;K.autoLightmapResolution=B.autoLightmapResolution;K.useFaces16=B.useFaces16;K.faceByteOffset=B.faceByteOffset;K.faceCnt=B.faceCnt;K.vertexByteOffset=B.vertexByteOffset;K.vertexCnt=B.vertexCnt;K.normalByteOffset=B.normalByteOffset;K.uv0ByteOffset=B.uv0ByteOffset;K.uv1ByteOffset=B.uv1ByteOffset;K.lightMapIdx=B.lightMapIdx;K.uv1CoordUScale=B.uv1CoordUScale;K.uv1CoordVScale=
B.uv1CoordVScale;K.uv1CoordUOffset=B.uv1CoordUOffset;K.uv1CoordVOffset=B.uv1CoordVOffset;K.transformByteOffset=B.transformByteOffset;K.quantVertexRange=B.quantVertexRange;K.quantVertexMax=B.quantVertexMax;K.quantUv0Range=B.quantUv0Range;K.quantUv0Max=B.quantUv0Max;B.hasCopies&&(K.sharedBuffersDebug=B.isMasterCopy?1:2);h+=1;y.addLogicalMesh(K);J.mesh=K}}WALK.log("Have "+h+" meshes and "+this.mergedMeshes.length+" merged meshes.")};this.lightmapCount=zh(b,c,g);b=c=null;(function(){for(var r=0,v=0,p=
0,w=0,u=0,y=0,B=0,D=m.makeIterator(g),H=D.next();!H.done;H=D.next()){H=H.value;var K=H.vertexCnt;l+=K;n+=H.faceCnt;r=Math.max(r,H.faceByteOffset+3*H.faceCnt*(H.useFaces16?2:4));v=Math.max(v,H.vertexByteOffset+3*K*WALK.Math.minBytesToHold(H.quantVertexMax)+3&-4);p=Math.max(p,H.normalByteOffset+2*K);w=Math.max(w,H.transformByteOffset+64);u=Math.max(u,H.boundsByteOffset+28);-1!==H.uv0ByteOffset&&(y=Math.max(y,H.uv0ByteOffset+2*K*WALK.Math.minBytesToHold(H.quantVertexMax)+3&-4));-1!==H.uv1ByteOffset&&
(B=Math.max(B,H.uv1ByteOffset+4*K))}f.coreGeometryDownloadSize=k+r+v+p+w+u;f.geometryDownloadSize+=f.coreGeometryDownloadSize+y+B})();WALK.log("Have "+l+" vertices, "+n+" faces and "+this.lightmapCount+" lightmaps.")};var Ah=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0]);function Bh(a){this.minVerticesUntilTimeCall=a;this.verticesCount=0;this.timer=new WALK.Timer}Bh.prototype.shouldInterrupt=function(a){return false;this.verticesCount+=a;return this.verticesCount>this.minVerticesUntilTimeCall&&10<this.timer.elapsedMSec()?(this.verticesCount=0,this.timer.reset(),!0):!1};
function Ch(a,b,c,d,e,f,g){var k=0;for(c*=3;k<c;k+=3){var h=a[k+b]*e,l=a[k+b+1]*e,n=a[k+b+2]*e;f[g+k]=d[0]*h+d[1]*l+d[2]*n+d[3];f[g+k+1]=d[4]*h+d[5]*l+d[6]*n+d[7];f[g+k+2]=d[8]*h+d[9]*l+d[10]*n+d[11]}}
function Dh(a,b,c,d,e,f){var g=0;for(c*=2;g<c;g+=2){var k=(a[g+b]/254+.5)*Math.PI,h=Math.PI/127*a[g+b+1],l=Math.sin(k),n=l*Math.cos(h);h=l*Math.sin(h);k=Math.cos(k);l=d[0]*n+d[1]*h+d[2]*k;var r=d[4]*n+d[5]*h+d[6]*k;k=2*(Math.acos(d[8]*n+d[9]*h+d[10]*k)/Math.PI-.5);h=Math.atan2(r,l)/Math.PI;e[f+g]=WALK.Math.toSnorm8(k);e[f+g+1]=WALK.Math.toSnorm8(h)}}function Eh(a){return 0!==a.instanceId||!1===a.parent.ownsGpuBuffers}
function Fh(a,b,c,d,e,f){var g=!1,k=0;for(c*=2;k<c;k+=1){var h=a[k+b]*d;e[f+k]=h;if(0>h||1<h)g=!0}return g}function Gh(a,b,c,d,e){var f=!1,g=0;for(c*=2;g<c;g+=1){var k=a[g+b];d[e+g]=k;if(0>k||1<k)f=!0}return f}function Hh(a,b,c,d,e,f,g,k,h){var l=0;for(c*=2;l<c;l+=2){var n=a[l+b],r=a[l+b+1];0!==n||0!==r?(k[h+l]=Math.round(n*d)+f,k[h+l+1]=Math.round(r*e)+g):(k[h+l]=0,k[h+l+1]=0)}}
function mi(a,b,c,d,e){function f(){for(;k<a.length;){var l=a[k];if(0!==h||b(l)){for(;h<l.logicalMeshes.length;){var n=l.logicalMeshes[h];c(n);h+=1;if(g.shouldInterrupt(n.vertexCnt)){setTimeout(f,0);return}}d(l);k+=1;h=0}else k+=1}e()}var g=new Bh(5E4),k=0,h=0;f()}function ni(a,b){b.geometry.allocateCoreBuffers(a);return!0}function oi(a){return a.anyLogicalMeshHasUvs?(a.geometry.allocateUv0(),!0):!1}function pi(a){return a.lightMap?(a.geometry.allocateUv1(),!0):!1}
WALK.asyncFillIndexedUv0=function(a,b,c,d){var e=new Uint16Array(a),f=new Float32Array(a);mi(b,oi,function(g){if(g.uv0InBuffers()){var k=g.geometry;if(!Eh(k)){var h=k.vertexOffset;k=k.parent;if(g.quantUv0Disabled()?Gh(f,g.uv0ByteOffset/4,g.vertexCnt,k.uvs0,2*h):Fh(e,g.uv0ByteOffset/2,g.vertexCnt,g.quantUv0Factor(),k.uvs0,2*h))k.isUvs0Repeating=!0}}},c,d)};function qi(a,b,c,d,e){var f=4*e.instanceId;e=e.parent.uvs1Mod;e[f]=c/65535;e[f+1]=d/65535;e[f+2]=a/65535;e[f+3]=b/65535}
WALK.asyncFillIndexedUv1=function(a,b,c,d){var e=new Uint16Array(a);mi(b,pi,function(f){if(f.uv1InBuffers()){var g=f.uv1CoordUScale,k=f.uv1CoordVScale,h=f.uv1CoordUOffset,l=f.uv1CoordVOffset,n=f.geometry;if(n.isInstanced){qi(g,k,h,l,n);if(Eh(n))return;g=k=1;h=l=0}Hh(e,f.uv1ByteOffset/2,f.vertexCnt,g,k,h,l,n.parent.uvs1,2*n.vertexOffset)}},c,d)};
function ri(a,b){var c=b.parent;b=4*b.instanceId;var d=c.transforms0;d[b]=a[0];d[b+1]=a[1];d[b+2]=a[2];d[b+3]=a[3];d=c.transforms1;d[b]=a[4];d[b+1]=a[5];d[b+2]=a[6];d[b+3]=a[7];c=c.transforms2;c[b]=a[8];c[b+1]=a[9];c[b+2]=a[10];c[b+3]=a[11]}
WALK.asyncFillIndexedCoreGeometry=function(a,b,c,d){var e=a.faces16?new Uint16Array(a.faces16):null,f=a.faces?new Uint32Array(a.faces):null,g=new Int8Array(a.vertices),k=new Int16Array(a.vertices),h=new Int32Array(a.vertices),l=new Int8Array(a.normals);mi(b,ni.bind(null,!0),function(n){var r=n.geometry,v=r.parent,p=new Float32Array(a.transforms,n.transformByteOffset,16);if(r.isInstanced){ri(p,r);if(Eh(r))return;p=Ah}switch(WALK.Math.minBytesToHold(n.quantVertexMax)){case 1:var w=g;var u=n.vertexByteOffset;
break;case 2:w=k;u=n.vertexByteOffset/2;break;case 4:w=h,u=n.vertexByteOffset/4}var y=r.vertexOffset;Ch(w,u,n.vertexCnt,p,n.quantVertexFactor(),v.vertices,3*y);Dh(l,n.normalByteOffset,n.vertexCnt,p,v.normals,2*y);v=v.index;r=r.indexOffset;n.useFaces16?(u=n.faceByteOffset/2,p=e):(u=n.faceByteOffset/4,p=f);w=u;for(n=u+3*n.faceCnt;w<n;w+=1,r+=1)v[r]=p[w]+y},c,d)};
WALK.asyncFillNotIndexedGeometry=function(a,b,c,d){var e=a.faces16?new Uint16Array(a.faces16):null,f=a.faces?new Uint32Array(a.faces):null,g=new Int8Array(a.vertices),k=new Int16Array(a.vertices),h=new Int32Array(a.vertices),l=new Int8Array(a.normals),n=new Uint16Array(a.uvs0),r=new Float32Array(a.uvs0),v=a.uvs1?new Uint16Array(a.uvs1):null;mi(b,function(p){ni(!1,p);oi(p);pi(p);return!0},function(p){var w=p.geometry,u=p.geometry.parent,y=new Float32Array(a.transforms,p.transformByteOffset,16);if(p.uv0InBuffers()&&
u.uvs0)var B=u.uvs0;if(p.uv1InBuffers()&&u.uvs1){var D=u.uvs1;var H=p.uv1CoordUScale;var K=p.uv1CoordVScale;var J=p.uv1CoordUOffset;var W=p.uv1CoordVOffset}if(w.isInstanced){ri(y,w);D&&qi(H,K,J,W,w);if(Eh(w))return;y=Ah;H=K=1;J=W=0}if(p.useFaces16){w=e;var M=p.faceByteOffset/2}else w=f,M=p.faceByteOffset/4;switch(WALK.Math.minBytesToHold(p.quantVertexMax)){case 1:var ba=g;var ha=p.vertexByteOffset;break;case 2:ba=k;ha=p.vertexByteOffset/2;break;case 4:ba=h,ha=p.vertexByteOffset/4}var ta=p.quantUv0Disabled();
if(ta)var I=p.uv0ByteOffset/4;else{var U=p.quantUv0Factor();I=p.uv0ByteOffset/2}var ia=3*p.geometry.vertexOffset,R=2*p.geometry.vertexOffset,E=p.quantVertexFactor(),Y=u.vertices,X=u.normals,fa=p.normalByteOffset,ka=p.uv1ByteOffset/2,qa=M;for(p=M+3*p.faceCnt;qa<p;qa+=1,ia+=3,R+=2){M=w[qa];Ch(ba,ha+3*M,1,y,E,Y,ia);Dh(l,fa+2*M,1,y,X,R);if(B){var ya=I+2*M;if(ta?Gh(r,ya,1,B,R):Fh(n,ya,1,U,B,R))u.isUvs0Repeating=!0}D&&Hh(v,ka+2*M,1,H,K,J,W,D,R)}},c,d)};function si(a,b){a.forEach(function(c){b.addView(new WALK.View(c))})}function ti(a){if(0!==a.length&&a[0].position)return a[0].position[2]}function ui(a,b,c){a.forEach(function(d){c.isNodeTypeEditable(d.name)&&(d.editable=!0);b.addNodeConfig(new WALK.NodeConfig(d))})}function vi(a,b){a.forEach(function(c){var d=new WALK.Light(c);c=c.instances;for(var e=0;e<c.length;e+=1){var f=c[e];d.addInstance(f.position,f.rotation)}b.addLight(d)})}
function wi(a,b){a.forEach(function(c){b.addLightProbe(new WALK.LightProbe(c))})}
function xi(a,b,c){c=c.camera;a&&(a.fov&&(c.defaultFov=a.fov),a.exposure&&(c.defaultExposure=a.exposure),a.gamma&&(c.defaultGamma=a.gamma),a.lutTexture&&(b=b.load(WALK.LOAD_PRIORITY.COLORMAP,a.lutTexture,!1,!1,WALK.NO_ANISOTROPY),b.flipY=!1,c.colorMap=b),c.autoPath=!!a.autoPath,c.autoClimb=!!a.autoClimb,c.autoExposure=!!a.autoExposure,c.fixedHeight=a.fixedHeight,void 0!==a.autoExposureDarkness&&(c.autoExposureDarkness=a.autoExposureDarkness),void 0!==a.moveMaxSpeed&&(c.moveMaxSpeed=a.moveMaxSpeed),
c.updateProjectionMatrix())}function yi(a,b){function c(d,e){var f=b.findNodeConfig(e.config),g=new WALK.Node(d,f,e);void 0!==e.children&&(g.children=e.children.map(function(k){return c(g,k)}));return g}a.forEach(function(d){b.addNode(c(null,d))})}
function zi(){var a=null;WALK.DETECTOR.whatsApp?a="WhatsApp":WALK.DETECTOR.facebookApp&&(a="Facebook app");null===a?WALK.USER_MSG.error("Scene failed to load. Reload the page to retry."):WALK.USER_MSG.error("Scene failed to load. Open the scene outside of "+a+' by copying the link to the native web browser: <div class="message-scrollable-line"><a href="'+(window.location+'" taget="_blank">'+window.location+"</a></div>"))}
WALK.SceneLoader=function(a,b,c,d,e){var f=!c&&WALK.DETECTOR.gl.indexUint,g=!c&&!WALK.DEBUG_SHARED_BUFFERS,k=new WALK.Timer;this.onComplete=this.onReadyToDisplay=this.onTextureLoaded=this.onMeshBuffersLoaded=this.onProgress=null;this.panoramas=[];this.load=function(){function h(){if(void 0!==fa.total)M.onProgress(fa)}function l(){U||(U=!0,M.onReadyToDisplay(a))}function n(qa){0===qa.name.indexOf("lightmap-rgbm")?fa.texturesDone+=12582912:fa.texturesDone+=524288;h();M.onTextureLoaded(qa);ka()}function r(){console.warn("Failed to load video texture");
ka()}function v(){if(0===ba.texturesToLoad&&R){ba.clearCache();for(var qa=0,ya=m.makeIterator(ta.mergedMeshes),za=ya.next();!za.done;za=ya.next())qa+=za.value.geometry.gpuSize;WALK.log("Total GPU geometry buffers size "+qa+" bytes");ba=ha=ta=null;WALK.defer(function(){l();M.onComplete(a)})}}function p(){E&&ia&&I&&(ka=v,X&&a.materials.forEach(function(qa){qa.lightMapped||(qa.lightMapped=!0,qa.setUniforms())}),ka())}function w(qa){qa.geometry.addUv1Attribute();M.onMeshBuffersLoaded(qa)}function u(){ha.buffers.uvs1&&
(ka=p,WALK.asyncFillIndexedUv1(ha.buffers.uvs1,ta.mergedMeshes,w,function(){ha.buffers.uvs1=null;E=!0;ka()}))}function y(qa){qa.geometry.isUvs0Repeating&&qa.material.ensureTexturesRepeatable();qa.geometry.addUv0Attribute();M.onMeshBuffersLoaded(qa)}function B(){ha.buffers.uvs0&&(ka=u,WALK.asyncFillIndexedUv0(ha.buffers.uvs0,ta.mergedMeshes,y,function(){ha.buffers.uvs0=null;R=!0;ka()}))}function D(){I=!0;0===a.views.length&&a.addView(new WALK.View({id:0,name:"Start place",hideFromMenu:!0,position:a.center.toArray(),
rotation:[0,0],internal:!0,sky:WALK.EDITOR_CONTROLLED_SKY_NAME}));if(!c&&!a.disableProgressiveLoader){l()}ka()}function H(qa){a.addGpuMesh(qa)}function K(qa){qa.geometry.addCoreAttributes();var ya=qa.logicalMeshes;console.assert(!ya[0].node.editable||1===ya.length);ya[0].node.editable||!g?ya.forEach(H):H(qa);M.onMeshBuffersLoaded(qa)}function J(qa){qa.geometry.isUvs0Repeating&&qa.material.ensureTexturesRepeatable();
qa.geometry.uvs0&&qa.geometry.addUv0Attribute();qa.geometry.uvs1&&qa.geometry.addUv1Attribute();K(qa)}function W(){if(f){if(!ha.haveCoreBuffers())return;WALK.log("Using indexed geometry");ka=B;WALK.asyncFillIndexedCoreGeometry(ha.buffers,ta.mergedMeshes,K,D)}else{if(!ha.haveAllBuffers())return;ka=p;WALK.asyncFillNotIndexedGeometry(ha.buffers,ta.mergedMeshes,J,function(){E=R=!0;D()})}ha&&ha.releaseCoreBuffers()}var M=this,ba=null,ha=null,ta=null,I=!1,U=!1,ia=!1,R=!1,E=!1,Y=null,X=!1,fa={total:void 0,
texturesDone:0,totalDone:function(){return this.texturesDone+ha.totalDone()}};k.reset();var ka=function(){if(Y&&ha.buffers.meshes&&ha.buffers.bounds){ka=W;void 0!==Y.autoAddLightProbes&&(a.autoAddLightProbes=Y.autoAddLightProbes);a.disableProgressiveLoader=Y.disableProgressiveLoader||!1;void 0!==Y.autoTour&&(a.autoTour.disabled=Y.autoTour.disabled||!1,a.autoTour.startOnLoad=Y.autoTour.startOnLoad||!1);vi(Y.lights,a);wi(Y.lightProbes||[],a);Y.cameraVolumes&&Y.cameraVolumes.forEach(function(za){return a.addCameraVolume(new WALK.CameraVolume(za))});
ba=new WALK.TextureLoader(b,WALK.DETECTOR,n,zi,r,!1,!0);xi(Y.camera,ba,a);var qa=new WALK.TextureAtlasLoader(ba,e);qa.load(Y.atlases||[]);(new WALK.MaterialLoader(ba,qa.atlases,d)).load(Y.materials||[],a);(new WALK.SkyLoader(ba)).load(Y.skies||[],a);null===a.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME)&&console.error("A sky with name "+WALK.EDITOR_CONTROLLED_SKY_NAME+" is missing.");si(Y.views||[],a);Y.hideViewsMenu&&(a.hideViewsMenu=!0);ui(Y.nodeConfigs,a,d);yi(Y.nodes,a);ta=new WALK.MeshMaker(a,
ha.buffers.meshes,ha.buffers.bounds,f);qa=null;if(0!==ta.lightmapCount){X=!0;var ya=new WALK.LightmapLoader(ba,ta.lightmapCount,Y.lightmap);ya.onComplete=function(){ia=!0;ka()};ya.load();qa=ya.lightmaps;ya=null}else ia=!0;ta.createMeshes(qa);fa.total=ta.geometryDownloadSize+524288*(ba.texturesToLoad-ta.lightmapCount)+12582912*ta.lightmapCount;Y.panoramas&&(M.panoramas=Y.panoramas);a.minimapConfig=new WALK.MinimapConfig(Y.minimap,a.boundingBox,ti(Y.views||[]));Y=null;ka()}};WALK.queueAjaxGet(WALK.LOAD_PRIORITY.CORE_RESOURCE,
b+"scene.json",!1,function(qa){Y=qa;ka()},zi);ha=new WALK.BufferLoader(b,!f);ha.onProgress=h;ha.onFailure=zi;ha.onHaveBuffer=function(){ka()};ha.load()};this.elapsedLoadTimeSec=function(){return k.elapsedSec()}};var Ai=!1;
WALK.decrypt=function(a,b,c){function d(){Ai=!0;var e=CryptoJS.lib.WordArray.create(a),f=e.clone();f.sigBytes=16;f.clamp();e.words.splice(0,4);e.sigBytes-=16;var g=CryptoJS.enc.Base64.parse(b);f=CryptoJS.AES.decrypt({ciphertext:e},g,{iv:f,mode:CryptoJS.mode.CFB});e=f.sigBytes;f=f.words;g=new Uint8Array(e);for(var k=0,h=0;k!==e;){var l=f[h++];g[k++]=(l&4278190080)>>>24;if(k===e)break;g[k++]=(l&16711680)>>>16;if(k===e)break;g[k++]=(l&65280)>>>8;if(k===e)break;g[k++]=l&255}c(g.buffer)}Ai?d():WALK.loadScriptAndExecute(WALK.getViewerAssetUrl("lib/crypto-js.min.js"),
d,function(){return WALK.USER_MSG.error("Cannot load required library")})};var Bi=new G.Vector3;function Ci(a,b,c,d){for(var e=[],f=0;6>f;f+=1){var g=d?new G.OrthographicCamera(-1,1,1,-1,a,b):new G.PerspectiveCamera(90,1,a,b);c.add(g);e.push(g)}e[0].up.set(0,-1,0);Bi.set(1,0,0);e[0].lookAt(Bi);e[1].up.set(0,-1,0);Bi.set(-1,0,0);e[1].lookAt(Bi);e[2].up.set(0,0,1);Bi.set(0,1,0);e[2].lookAt(Bi);e[3].up.set(0,0,-1);Bi.set(0,-1,0);e[3].lookAt(Bi);e[4].up.set(0,-1,0);Bi.set(0,0,1);e[4].lookAt(Bi);e[5].up.set(0,-1,0);Bi.set(0,0,-1);e[5].lookAt(Bi);return e}
WALK.CubeCamera=function(a,b){G.Object3D.call(this);this.sideCameras=Ci(a,b,this,!1)};WALK.CubeCamera.prototype=Object.create(G.Object3D.prototype);WALK.CubeCamera.prototype.constructor=WALK.CubeCamera;WALK.OrthoCubeCamera=function(a,b){G.Object3D.call(this);this.sideCameras=Ci(a,b,this,!0)};WALK.OrthoCubeCamera.prototype=Object.create(G.Object3D.prototype);WALK.OrthoCubeCamera.prototype.constructor=WALK.OrthoCubeCamera;/*
 Copyright (C) 2015-present Shapespark
*/
WALK.CubeMapFilterShader={uniforms:{gloss:{type:"f",value:.9},face:{type:"f",value:0},mipSize:{type:"f",value:128},envMap:{type:"t",value:null}},vertexShader:WALK.getShader("cubemap_filter_vertex.glsl"),fragmentShader:WALK.getShader("cubemap_filter_fragment.glsl")};function Di(a,b,c){for(var d=!0;d;){a.readPixels(b,b,c);for(var e=0;e<b*b*4;e+=4)if(0!==c[e]||0!==c[e+1]||0!==c[e+2]){d=!1;break}if(d){console.warn("Cube face has all pixels black.");break}}}var Ei=function(){var a=null;return function(b,c){var d=null,e=0;c*=c;console.assert(c<Math.pow(2,16));null===a&&(a=new Uint16Array(65536));for(var f=0;f<4*c;f+=4)a[256*b[f]+b[f+1]]+=1;a[0]>.7*c&&(e=a[0]);a[0]=0;for(b=1;b<a.length;b+=1)a[b]>e&&(e=a[b],d=Math.floor(b/256)+b%256/255),a[b]=0;return d}}();
function Fi(a,b){var c=new Set;a.traverse(function(d){if(d instanceof G.Mesh&&d.visible){var e=d.material;d.userData.hideFromLightProbes||e.hideFromLightProbes?(b.add(d),d.visible=!1):c.has(e)||(c.add(e),e.configureTransparency&&(e.transparent=!1,e.blending=G.NoBlending,e.depthWrite=!0),void 0!==e.hdrOutput&&(e.hdrOutput=!0),void 0!==e.specularOff&&(e.specularOff+=1))}});c=null}
function Gi(a,b){var c=new Set;a.traverse(function(d){if(d instanceof G.Mesh){var e=d.material;e.forceObjectUniformsRefresh&&e.forceObjectUniformsRefresh();d.visible?c.has(e)||(c.add(e),void 0!==e.hdrOutput&&(e.hdrOutput=!1),e.configureTransparency&&e.configureTransparency(),void 0!==e.specularOff&&--e.specularOff):b.has(d)&&(d.visible=!0)}});c=null}
var Hi=function(){var a=null;return function(b,c,d){var e=b.renderer,f=b.aabbQueryMaterial,g=b.pixelBuf,k=b.targetCubeRaw;null===a&&(a=new WALK.OrthoCubeCamera(.01,255));a.position.copy(c.position);a.updateMatrixWorld();var h;for(h=0;6>h;h+=1){k.activeCubeFace=h;f.axis=Math.floor(h/2);e.renderMeshes(b.scene.gpuMeshes,f,a.sideCameras[h],k);Di(e,k.width,g);var l=Ei(g,k.width);if(null===l){WALK.log("failed to find light probe bound");break}switch(h){case 0:d.boxMax.x=c.position.x+l;break;case 1:d.boxMin.x=
c.position.x-l;break;case 2:d.boxMax.y=c.position.y+l;break;case 3:d.boxMin.y=c.position.y-l;break;case 4:d.boxMax.z=c.position.z+l;break;case 5:d.boxMin.z=c.position.z-l}}6!==h&&(WALK.log("Light probe bounds: X["+d.boxMin.x.toFixed(2)+":"+d.boxMax.x.toFixed(2)+"] Y["+d.boxMin.y.toFixed(2)+":"+d.boxMax.y.toFixed(2)+"] Z["+d.boxMin.z.toFixed(2)+":"+d.boxMax.z.toFixed(2)+"]"),d.resetBoundingBox())}}();
function Ii(a,b){var c={format:GLC.RGBA,magFilter:GLC.LINEAR,minFilter:GLC.LINEAR,stencilBuffer:!1,generateMipmaps:!1};this.renderer=a;this.scene=b;this.threeScene=b.threeScene;this.aabbQueryMaterial=new WALK.AabbQueryMaterial;this.filterPass=new G.ShaderPass(WALK.CubeMapFilterShader,"envMap");b=WALK.LIGHT_PROBE_MAX_MIP_SIZE;this.pixelBuf=new Uint8Array(b*b*4);this.targetCubeRaw=a.createRenderTargetCube(b,b,c);c.depthBuffer=!1;this.targetFiltered=a.createRenderTarget(b,b,c);this.autoClearAlter=new be(a);
this.dispose=function(){this.targetCubeRaw.dispose();this.targetFiltered.dispose();this.aabbQueryMaterial.dispose();this.filterPass.material.dispose();this.pixelBuf=null}}Ii.prototype.constructor=Ii;function Ji(a,b){var c=b.geometry.boundingSphere.center;if(null===b.lightProbe||c.distanceTo(a.position)<c.distanceTo(b.lightProbe.position))b.lightProbe=a}function Ki(a,b){for(var c=0;c<b.length;c+=1)Ji(a,b[c])}
function Li(a,b){WALK.log("No visible light probe found for "+b.length+" objects. Assigning the closest ones.");for(var c=0;c<b.length;c+=1)for(var d=0;d<a.length;d+=1)Ji(a[d],b[c])}
WALK.LightProbeMaker=function(a,b,c,d,e){function f(r,v){n.position.copy(r.position);n.updateMatrixWorld();var p;if((p=d)&&!(p=e))a:{p=a.gpuMeshes;for(var w=0;w<p.length;w+=1){var u=p[w];if(u.lightProbe===r&&u.material.envMapMirror){p=!0;break a}}p=!1}(w=p)&&WALK.log("Mirror texture needed for the light probe.");l.reset();p=h.renderer;h.autoClearAlter.set(!0,!0,!1);if(w){var y=h.renderer;w=WALK.LIGHT_PROBE_MIRROR_SIZE;w=y.createRenderTargetCube(w,w,{format:GLC.RGBA,magFilter:GLC.LINEAR,minFilter:GLC.LINEAR,
stencilBuffer:!1,generateMipmaps:!1});for(u=0;6>u;u+=1)w.activeCubeFace=u,y.render(h.threeScene,n.sideCameras[u],w);y.deallocateRenderTargetRenderingBuffers(w);y=w;r.setMirrorTexture(y)}v&&Hi(h,n,r);v=h.renderer;w=h.targetCubeRaw;for(u=0;6>u;u+=1)w.activeCubeFace=u,v.render(h.threeScene,n.sideCameras[u],w);h.autoClearAlter.restore();p.enableScissorTest(!0);h.autoClearAlter.set(!1,!1,!1);c&&(y=p.createCubeTexture(h.targetFiltered.width,!0),r.setFilteredTexture(y));for(v=0;v<WALK.LIGHT_PROBE_MIPS_COUNT;v+=
1){w=v;w=Math.pow(2,WALK.log2(h.targetFiltered.width)-w);p.setScissor(0,0,w,w);h.filterPass.uniforms.mipSize.value=w;h.filterPass.uniforms.gloss.value=WALK.LIGHT_PROBE_GLOSS_FOR_MIP[v];c||(y=p.createCubeTexture(w,!1),r.setFilteredTextureNoLod(y,v));u=h.filterPass;var B=h.targetCubeRaw,D=h.targetFiltered,H=h.pixelBuf,K=c?v:0,J=y;if(WALK.DEBUG_LIGHT_PROBE_MIPS)for(var W=H,M=255*K/WALK.LIGHT_PROBE_MIPS_COUNT,ba=0;ba<4*w*w;ba+=4)W[ba]=M,W[ba+1]=M,W[ba+2]=M,W[ba+3]=31.875;for(W=0;6>W;W+=1)WALK.DEBUG_LIGHT_PROBE_MIPS||
(u.uniforms.face.value=W,u.render(p,D,B),Di(p,w,H)),p.copyBufferToCubeFaceMip(K,w,W,H,J)}p.enableScissorTest(!1);h.autoClearAlter.restore();WALK.log("Cube generation time "+l.elapsedSec())}var g,k=a.threeScene,h=new Ii(b,a),l=new WALK.Timer,n=new WALK.CubeCamera(.15,a.camera.far);this.assignLightProbesToObjects=function(){l.reset();void 0===g&&(g=new WALK.ObjectVisibilityQuery(b,a.gpuMeshes,a.camera.far));for(var r=0;r<a.gpuMeshes.length;r+=1)a.gpuMeshes[r].lightProbe=null;for(r=0;r<a.lightProbes.length;r+=
1){var v=a.lightProbes[r],p=g.findVisibleObjects(v.position);WALK.log("Have visible objects "+p.length);Ki(v,p)}WALK.log("Light probe assigment time "+l.elapsedSec());Li(a.lightProbes,WALK.filter(a.gpuMeshes,function(w){return null===w.lightProbe}))};this.findBounds=function(r){n.position.copy(r.position);n.updateMatrixWorld();h.autoClearAlter.set(!0,!0,!1);Hi(h,n,r);h.autoClearAlter.restore()};this.createLightProbeTexture=function(r,v){var p=new Set;Fi(k,p);f(r,v);Gi(k,p)};this.createAllLightProbeTextures=
function(){var r=new Set;Fi(k,r);for(var v=0;v<a.lightProbes.length;v+=1)f(a.lightProbes[v],!1);Gi(k,r)};this.dispose=function(){h.dispose();g&&g.dispose()}};var Mi;function Ni(a){if(a.empty())return 0;a.size(Mi);return Mi.x*Mi.y*Mi.z}function Oi(a){if(a.empty())return 0;a.size(Mi);a=Mi.x*Mi.y;return 1>Mi.x||1>Mi.y||1.9>Mi.z||1.5>a?0:a*Mi.z}
function Pi(a){var b=[],c=[];b.push(a);this.addFilledBox=function(e){c.push(e)};this.findBestFilledBoxes=function(){function e(n){return n[1]}function f(n){n=n[0];n=n.max.x<l.min.x+.2||n.min.x>l.max.x-.2||n.max.y<l.min.y+.2||n.min.y>l.max.y-.2||n.max.z<l.min.z+.2||n.min.z>l.max.z-.2?!1:!0;return!n}var g=[],k=[];for(c.forEach(function(n){k.push([n,Ni(n)])});0<k.length&&10>g.length;){var h=WALK.indexOfMax(k,e);var l=k[h][0];g.push(l);k=k.filter(f)}return g};this.isEnclosedInFilledBox=function(e){return WALK.any(c,
function(f){f=f.min.x-.1<=e.min.x&&e.max.x<=f.max.x+.1&&f.min.y-.1<=e.min.y&&e.max.y<=f.max.y+.1&&f.min.z-.1<=e.min.z&&e.max.z<=f.max.z+.1?!0:!1;return f})};this.findLargestEmptyBox=function(){var e=WALK.indexOfMax(b,Ni);return null!==e?b[e]:null};var d=function(){var e=[];e[0]=new G.Box3;e[1]=new G.Box3;e[2]=new G.Box3;e[3]=new G.Box3;e[4]=new G.Box3;e[5]=new G.Box3;return function(f,g,k){e[0].max.copy(f.max);e[0].min.copy(f.min);e[0].min.z=g.max.z;e[1].max.copy(f.max);e[1].max.z=g.min.z;e[1].min.copy(f.min);
e[2].max.copy(f.max);e[2].min.copy(f.min);e[2].min.x=g.max.x;e[3].max.copy(f.max);e[3].max.x=g.min.x;e[3].min.copy(f.min);e[4].max.copy(f.max);e[4].min.copy(f.min);e[4].min.y=g.max.y;e[5].max.copy(f.max);e[5].max.y=g.min.y;e[5].min.copy(f.min);var h=WALK.indexOfMax(e,Oi);0!==Oi(e[h])&&(k.push(e[h].clone()),0===h?f.max.z=g.max.z:1===h?f.min.z=g.min.z:2===h?f.max.x=g.max.x:3===h?f.min.x=g.min.x:4===h?f.max.y=g.max.y:5===h&&(f.min.y=g.min.y),d(f,g,k))}}();this.split=function(e){for(var f=[],g=0;g<b.length;g+=
1){var k=b[g];k.isIntersectionBox(e)?d(k,e,f):f.push(k)}b=f}}
WALK.arrangeLightProbes=function(a,b,c){function d(u){var y=new WALK.LightProbe({id:a.lightProbes.length});u.center(y.position);y.position.z=u.min.z+1.3;y.enableBoundingBox();y.boxMin.copy(u.min);y.boxMax.copy(u.max);a.lightProbes.push(y)}var e=new Pi(a.boundingBox.clone()),f=new G.Box3,g=new G.Box3,k=new G.Vector3,h=new WALK.Timer;Mi=new G.Vector3;for(var l=new WALK.LightProbe({id:0}),n=0;200>n;n+=1){var r=e.findLargestEmptyBox();if(null===r)break;r.center(l.position);l.position.z=r.min.z+1.3;l.enableBoundingBox();
g.makeEmpty();for(var v=0;5>v;v+=1){b.findBounds(l);if(!l.isBoundingBoxInitialized())break;f.set(l.boxMin,l.boxMax);var p=Oi(f);if(0===p)break;if(e.isEnclosedInFilledBox(f))break;f.center(k);k.z=f.min.z+1.3;var w=l.position.distanceToSquared(k);Ni(g)<p&&.25>w&&g.set(f.min,f.max);if(.04>w)break;l.position.copy(k)}g.empty()?(r.center(f.min),r.center(f.max),e.split(f)):(e.addFilledBox(g.clone()),e.split(g))}WALK.log("Light probes arrangement time "+h.elapsedSec());b=e.findBestFilledBoxes();(b.reduce(function(u,
y){return u+Ni(y)},0)>.2*Ni(a.boundingBox)||c)&&b.forEach(d);0===a.lightProbes.length&&c&&d(a.boundingBox)};function Qi(a){return document.getElementById(a)}function Ri(a,b){a=document.getElementsByClassName(a);for(var c=0;c<a.length;c+=1)b(a[c])}function Si(a){var b=[];Ri(a,function(d){b.push(d)});for(var c=0;c<b.length;c+=1)b[c].classList.remove(a)}function Ti(a,b){a.style.display=b?"":"none"}function Ui(a,b){Ti(Qi(a),b)}function Vi(a,b){Ri(a,function(c){Ti(c,b)})}function Wi(a){Ti(a,!0);a.style.opacity=0;WALK.defer(function(){a.style.opacity=1})}
function Xi(){var a=document.getElementById("qr-code-canvas");a?a.remove():(a=document.createElement("canvas"),a.setAttribute("id","qr-code-canvas"),document.body.appendChild(a),QRCode.toCanvas(a,window.location.toString()))}function Yi(a){a.style.opacity=0;var b=window.getComputedStyle(a).transitionDuration;if(b){var c=parseFloat(b);-1===b.indexOf("ms")&&(c*=1E3);setTimeout(function(){Ti(a,!1);a.style.opacity=1},c)}else Ti(a,!1),a.style.opacity=1}
WALK.focusWalkCanvas=function(){WALK.DETECTOR.ios||Qi("walk-canvas").focus()};
WALK.Menu=function(a,b,c,d,e){function f(P){return function(N){N.stopPropagation();P();WALK.focusWalkCanvas()}}function g(P,N){P.addEventListener("click",f(N))}function k(P,N){g(Qi(P),N)}function h(P){if(P){var N=null===ia?[]:ia.visibleViews(),da;for(da=0;da<N.length&&N[da]!==P;da+=1);P=Qi("view-list-items").children;if(da<P.length)return P[da]}return null}function l(P){return function(){P.classList.remove("active-view");P.classList.remove("next-active-view")}}function n(){for(var P=Qi("view-list-items").children,
N=0;N<P.length;N+=1)P[N].classList.remove("active-view"),P[N].classList.remove("next-active-view")}function r(){Qi("tour-button").classList.add("tour-on")}function v(){Qi("tour-button").classList.remove("tour-on");n()}function p(){E.isRunning()?E.stop():E.start()}function w(){return E.isRunning()?(E.stop(),!0):!1}function u(P){n();(P=h(P.view))&&P.classList.add("next-active-view")}function y(P){if(P=h(P.view))P.classList.remove("next-active-view"),P.classList.add("active-view"),setTimeout(l(P),WALK.AUTO_TOUR_IN_VIEW_STILL_TIME_MS)}
function B(P){return f(function(){var N=w();R.switchToView(P,N?0:void 0)})}function D(){var P=Qi("info-bar"),N=Qi("info-bar-slide"),da=Qi("view-list"),ua=Qi("view-list-slide"),ja=Qi("menu-bar"),S=Qi("menu-bar-slide"),sa=Qi("menu-bar-folder");if(window.__SHAPESPARK_PLUGIN_UI&&window.__SHAPESPARK_PLUGIN_UI.noUI){return;}Ti(sa,ia&&!qa);if(I.visible){P.style.pointerEvents=null;N.style.left=0;da.style.pointerEvents=null;ua.style.top=0;ja.style.pointerEvents=null;S.style.right=0;sa.style.pointerEvents=null;sa.children[0].style.transform="";if(null!==I.cover){ja=I.cover.title;ua=
I.cover.author;S=I.cover.authorHref;da=I.cover.engineLogoOn;P=I.cover.engineLogoText;N=I.cover.engineLogoUrl;sa=I.cover.authorLogoUrl;I.cover.authorLogo&&(sa=WALK.getExtraAssetUrl(I.cover.authorLogo.path));var Ga=Qi("author-logo"),Ya=Ga.firstElementChild;sa?(S&&(Ga.href=S),Ya.src=sa):(Ti(Ga,!1),Ya.removeAttribute("src"));sa=null===ia||null!==ma;Ui("info-text",sa&&(ja||ua));sa&&(WALK.setTextContent(Qi("info-title"),ja),WALK.setTextContent(Qi("info-author"),ua),S&&(Qi("info-author").href=S));ja=ja?
ja:"3D scene";ua&&(ja+=" by "+ua);document.title=ja;ua=Qi("engine-logo");Ti(ua,da);da&&(P&&(da=Qi("engine-logo-text"),Ti(da,!0),WALK.setTextContent(da,P)),N&&(ua.href=N))}P=null===ia?[]:ia.visibleViews();N=Qi("view-list-items");Ui("view-list",0<P.length&&!qa);if(0<P.length){da=N.children[0];for(l(da)();1!==N.children.length;)N.removeChild(N.children[N.children.length-1]);for(ua=0;ua<P.length;ua+=1)ja=P[ua],ja.hideFromMenu||(WALK.setTextContent(da,ja.name),da.onclick=B(ja),N.appendChild(da),da=da.cloneNode(!0))}Ui("menu-buttons",
ia&&!qa);ia&&ia.canStartAutoTour()&&!ya?Ui("tour-button",!0):(E&&E.isRunning()&&E.stop(),Ui("tour-button",!1))}else Ga=Qi("menu-bar-content"),P.style.pointerEvents="none",N.style.left=-N.offsetWidth+"px",da.style.pointerEvents="none",ua.style.top=-ua.offsetHeight+"px",ja.style.pointerEvents="none",sa.style.pointerEvents="auto",S.style.right=-Ga.offsetWidth+"px",sa.children[0].style.transform="rotate(180deg)";P=I.helpVisible;WALK.DETECTOR.mobile?Ui("mobile-help",P):(Ui("desktop-help",P),P&&(P=Qi("desktop-help-switch"),
N=Qi("desktop-help-content"),da=V?1:0,P.children[da].classList.add("selected"),Ti(N.children[da],!0),P.children[1-da].classList.remove("selected"),Ti(N.children[1-da],!1)))}function H(){I.visible=!za}function K(){I.helpVisible=!T}function J(){V=!1;D()}function W(){V=!0;D()}function M(){var P=w();R.switchToPreviousVisibleView(P?0:void 0)}function ba(){var P=w();R.switchToNextVisibleView(P?0:void 0)}function ha(P){if(!(P.ctrlKey||P.altKey||P.metaKey)){var N=P.target||P.srcElement;N=N.nodeType===Node.ELEMENT_NODE?
N.nodeName.toUpperCase():"";if(!/INPUT|SELECT|TEXTAREA/.test(N))if(67===P.keyCode&&WALK.DEBUG)P.shiftKey?WALK.DETECTOR.gl.extension("WEBGL_lose_context").restoreContext():WALK.DETECTOR.gl.extension("WEBGL_lose_context").loseContext();else if(null!==ia){switch(P.keyCode){case 27:w();break;case 70:fa&&d();break;case 76:ka&&e();break;case 72:K();break;case 77:H();break;case 86:X&&c();break;case 80:WALK.NO_SCREENSHOTS||(P.shiftKey?Y.monoScreenToLocalImage(!0,4E3,2E3):Y.monoScreenToLocalImage(!1,window.innerWidth,
window.innerHeight));break;case 85:WALK.loadScriptAndExecute(WALK.getViewerAssetUrl("lib/qrcode.js"),Xi);break;case 219:M();break;case 221:ba()}N=P.keyCode-48;if(1<=N&&9>=N){--N;var da=null===ia?[]:ia.visibleViews();N=da.length>N?da[N]:null;null!==N&&B(N)(P)}}}}function ta(P){switch(P.action){case WALK.GAMEPAD_ACTION.PREVIOUS:M();break;case WALK.GAMEPAD_ACTION.NEXT:ba()}}var I=this,U={type:"visibilityChanged"},ia=null,R=null,E=null,Y=null,X=!1,fa=!1,ka=!1,qa=!1,ya=!1,za=!0,T=!1,V=!1,ma=null;this.cover=
null;Object.defineProperty(this,"visible",{get:function(){var P=ya&&WALK.DETECTOR.mobile;return za&&!P},set:function(P){var N=this.visible;za=P;N!==this.visible&&this.dispatchEvent(U);D()}});Object.defineProperty(this,"helpVisible",{get:function(){var P=ya&&WALK.DETECTOR.mobile;return T&&!P&&!qa},set:function(P){T=P;D()}});window.__Menu = this;window.__Menu.toogleVr = c;window.__Menu.toogleFullscreen = d;window.__Menu.lockScreen = e;this.updateCover=function(P){this.cover=P;null!==ma&&clearTimeout(ma);ma=setTimeout(function(){ma=null;D()},5E3);D()};this.refresh=function(){D()};this.onFullScreenChange=function(){};
this.onPointerLockChange=function(P){qa=P;D()};this.onVrChange=function(P){var N=this.visible;ya=P;N!==this.visible&&this.dispatchEvent(U);D()};this.onResize=function(){if(!this.visible){var P=Qi("info-bar-slide"),N=Qi("menu-bar-slide"),da=Qi("view-list-slide");P.style.transition="none";N.style.transition="none";da.style.transition="none";D();P.style.transition="";N.style.transition="";da.style.transition=""}};this.enablePlayButton=function(P){var N=Qi("play-button");N.addEventListener("click",P);
Ti(N,!0)};this.setVrSupported=function(P){X=P;Vi("vr-specific",P)};this.setFullScreenSupported=function(){(fa=!a)&&Vi("fullscreen-specific",!0)};this.setPointerLockSupported=function(){ka=!a};this.addExtraButton=function(P){var N=Qi("tour-button"),da=document.createElement("img");da.src=P;P=document.createElement("div");P.className="menu-button menu-item ui-hoverable ui-panel";P.appendChild(da);N.parentNode.insertBefore(P,N);return P};this.removeExtraButton=function(P){P.remove()};this.getExtraButonIcon=
function(P){return P.firstElementChild};this.sceneLoadStarted=function(){Ui("play-button",!1);Ui("primary-progress",!0)};this.loadProgress=function(P){P=P.totalDone()/P.total;if(null===ia){var N=Math.max(314.159*(1-P),0);Qi("primary-progress-done").style.strokeDashoffset=N}P=Math.floor(100*P);Qi("secondary-progress-done").style.width=P+"%"};this.sceneReadyToDisplay=function(P,N,da,ua){ia=P;R=N;R.addEventListener("teleportStarted",u);R.addEventListener("teleportDone",y);E=da;E.addEventListener("tourStarted",
r);E.addEventListener("tourStopped",v);Y=ua;Yi(Qi("cover-image"));Yi(Qi("primary-progress"));Wi(Qi("secondary-progress"));ia.addEventListener("viewAdded",D);ia.addEventListener("viewRemoved",D);ia.addEventListener("viewShifted",D);document.body.style.backgroundImage="none";document.body.style.backgroundColor="#000";D()};this.sceneLoadComplete=function(){Ui("secondary-progress",!1)};this.init=function(){a&&(Vi("viewer-specific",!1),Vi("editor-specific",!0));Ri("ui-panel",function(da){g(da,function(){})});
WALK.DETECTOR.mobile&&Si("ui-hoverable");var P=Qi("author-logo"),N=P.firstElementChild;N.onload=function(){Ti(P,!0)};N.onerror=function(){Ti(P,!1)};document.addEventListener("keydown",ha,!1);k("help-button",K);k("fullscreen-button",d);k("vr-button",c);k("tour-button",p);k("menu-bar-folder",H);k("view-list-folder",H);k("basic-desktop-help-option",J);k("advanced-desktop-help-option",W);k("close-desktop-help-button",K);k("close-mobile-help-button",K);b.addEventListener("actionActivated",ta);D()};this.contextLost=
function(){ia=R=E=Y;D()}};G.EventDispatcher.prototype.apply(WALK.Menu.prototype);var Zi=null;
WALK.Popup=function(a,b,c){var d=!1,e=document.getElementById("ext-html-label"),f=e.querySelector("#ext-html-label-content");this.close=function(g){d?(e.classList.add("ui-out"),WALK.focusWalkCanvas(),window.setTimeout(function(){e.classList.remove("ext-html-label-topleft");e.classList.remove("ext-html-label-horizontal-center");e.classList.remove("ext-html-label-vertical-center");e.classList.remove("ext-html-label-center");e.classList.remove("ui-out");f.innerHTML="";e.style.display="none";c&&c();g&&
g();d=!1},400)):g()};this.open=function(){var g=this;if(!d){if(a instanceof Node)f.appendChild(a);else{var k=WALK.getExtraAssetUrl("").slice(0,-1);k=a.replace(/\$EXTRA_ASSETS/g,k);f.innerHTML=k}f.style.padding=b.padding||void 0===b.padding?"":0;e.style.display="";b.centerVertically?b.centerHorizontally?e.classList.add("ext-html-label-center"):e.classList.add("ext-html-label-vertical-center"):b.centerHorizontally?e.classList.add("ext-html-label-horizontal-center"):e.classList.add("ext-html-label-topleft");
e.classList.add("ui-out");e.classList.remove("ext-html-label-animated");WALK.preventClosureCompilerDeadCodeRemoval(e.offsetHeight);e.classList.add("ext-html-label-animated");e.classList.remove("ui-out");e.querySelector("#ext-html-label-close").onclick=function(){g.close()};d=!0}}};WALK.openPopup=function(a,b,c){var d=new WALK.Popup(a,b,c);null!==Zi?Zi.close(function(){return d.open()}):d.open();return Zi=d};WALK.USER_MSG=new function(){this.hideInfo=function(){document.getElementById("info-message").style.display="none"};this.info=function(a,b){var c=document.getElementById("info-message");c.innerHTML=a;c.style.display="";setTimeout(this.hideInfo,b||15E3);console.info(a)};this.error=function(a){var b=document.getElementById("error-message");b.innerHTML=a;b.style.display="";console.error(a)}};function $i(a,b){return Math.abs(a.x-b.x)<Number.EPSILON&&Math.abs(a.y-b.y)<Number.EPSILON&&Math.abs(a.z-b.z)<Number.EPSILON}function aj(a,b){a.addEventListener("click",function(c){c.stopPropagation();b();WALK.focusWalkCanvas()})}function bj(a,b,c){var d=Math.sin(b);b=Math.cos(b);a.set((a.x-c.x)*b-(a.y-c.y)*d+c.x,(a.x-c.x)*d+(a.y-c.y)*b+c.y,a.z)}
function cj(a){var b=document.createElement("canvas");b.width=a;b.height=a;var c=60*Math.PI/180,d=-c/2-Math.PI/2;c=c/2-Math.PI/2;var e=b.getContext("2d");e.beginPath();e.arc(a/2,a/2,4,0,2*Math.PI);e.fillStyle="rgb(0, 220, 255)";e.fill();e.moveTo(a/2,a/2);e.arc(a/2,a/2,12,d,c,!0);e.lineTo(a/2,a/2);e.arc(a/2,a/2,90,d,c);e.lineTo(a/2,a/2);e.fillStyle="rgba(0, 220, 255, 0.5)";e.fill();return b}
function dj(a,b){var c=document.createElement("div"),d=cj(200);c.style.width="200px";c.style.height="200px";c.style.position="absolute";c.style.pointerEvents="none";c.style.zIndex="2";c.style.opacity="1";c.style.transition="opacity 0.5s";c.id="minimap-camera";c.appendChild(d);this.update=function(e,f){c.style.left=e.x/a*100+"%";c.style.top=e.y/b*100+"%";c.style.transform="translate(-100px, -100px) rotate("+f+"rad)"};this.show=function(){c.style.opacity="1"};this.hide=function(){c.style.opacity="0"};
this.getContainer=function(){return c}}function ej(a,b){function c(){e=!0;var h=d.width,l=d.height;g!==h||k!==l?(g=h,k=l,b(),window.requestAnimationFrame(c)):0<f?(--f,window.requestAnimationFrame(c)):e=!1}if("ResizeObserver"in window)(new ResizeObserver(b)).observe(a);else{var d=window.getComputedStyle(a),e,f,g,k;(new MutationObserver(function(){f=60;e||c()})).observe(a,{attributes:!0});window.addEventListener("resize",function(){f=60;e||c()})}}
function fj(a,b,c,d){function e(){h.style.transform="translate("+g.x+","+g.y+")"}function f(){h.style.width=l.width;h.style.height=l.height}var g={x:0,y:0},k=document.createElement("canvas");k.width=3*a;k.height=3*b;k.style.position="absolute";k.style.maxWidth="100%";k.style.maxHeight="100%";var h=document.createElement("div");h.classList.add("minimap-content-controller");var l=window.getComputedStyle(k);d.appendChild(k);d.appendChild(h);ej(c,f);this.add=function(n){h.appendChild(n)};this.clear=function(){h.innerHTML=
""};this.updateOffset=function(n){g.x=50-n.x/a*100+"%";g.y=50-n.y/b*100+"%";e()};this.addOffset=function(){e()};this.removeOffset=function(){h.style.transform=""};this.updateRatio=function(n){window.requestAnimationFrame(function(){var r=Math.abs(Math.sin(n.rotation)),v=Math.abs(Math.cos(n.rotation));k.width=3*(a*n.ratio.x*v+b*n.ratio.y*r);k.height=3*(a*n.ratio.x*r+b*n.ratio.y*v);f()})}}
WALK.Minimap=function(a,b,c,d){function e(){R=b.minimapConfig.levels.map(function(Ca){return{level:Ca,canvas:null,tab:null}})}function f(){R.forEach(function(Ca){Ca.tab=document.createElement("div");Ca.tab.classList.add("minimap-tab");Ca.tab.innerText=Ca.level.name;Ca.tab.addEventListener("click",function(){M.selectLevel(Ca.level);WALK.focusWalkCanvas()});da.appendChild(Ca.tab)})}function g(Ca){ia=Ca;I.show();R.forEach(function(na){na.level===Ca?na.tab.classList.add("minimap-tab-current"):na.tab.classList.remove("minimap-tab-current")})}
function k(Ca){R.forEach(function(na){na.canvas&&(na.canvas.style.opacity=na.level===Ca?"1":"0",na.canvas.style.zIndex=na.level===Ca?"1":"0");na.level===Ca?na.tab.classList.add("minimap-tab-active"):na.tab.classList.remove("minimap-tab-active")})}function h(){var Ca=R.find(function(na){return na.level===ia})?ia:R[R.length-1].level;M.selectLevel(Ca,!0)}function l(Ca){var na=R.filter(function(Ma){return Ma.level.slicePlaneHeight<Ca.slicePlaneHeight}).sort(function(Ma,Q){return Q.level.slicePlaneHeight-
Ma.level.slicePlaneHeight})[0],Ea=R.filter(function(Ma){return Ma.level.slicePlaneHeight>Ca.slicePlaneHeight}).sort(function(Ma,Q){return Ma.level.slicePlaneHeight-Q.level.slicePlaneHeight})[0];Y=na?Ca.slicePlaneHeight-(Ca.slicePlaneHeight-na.level.slicePlaneHeight)/2:-Infinity;X=Ea?Ca.slicePlaneHeight-(Ca.slicePlaneHeight-Ea.level.slicePlaneHeight)/2:Infinity}function n(Ca){return R.reduce(function(na,Ea){return Math.abs(Ea.level.slicePlaneHeight-Ca.z)<Math.abs(na.level.slicePlaneHeight-Ca.z)?Ea:
na}).level}function r(Ca,na){ia&&(Ca||na||(Ca=d.getCameraPosition(),na=d.getCameraRotation()),S.set(Ca.x,Ca.y),bj(S,ia.rotation,ia.cropRange.center()),sa.set(G.Math.mapLinear(S.x,ia.visibleRange.max.x,ia.visibleRange.min.x,Ga.max,Ga.min),G.Math.mapLinear(S.y,ia.visibleRange.max.y,ia.visibleRange.min.y,Ya.max,Ya.min)),I.update(sa,-1*na.z+-1*ia.rotation),ta&&U.updateOffset(sa))}function v(){ta=!0;ma.classList.add("minimap-container-minimized");P.classList.add("minimap-wrapper-minimized");U.addOffset();
r()}function p(){ta=!1;ma.classList.remove("minimap-container-minimized");P.classList.remove("minimap-wrapper-minimized");U.removeOffset()}function w(){ba=!0;P.style.transform="translate(-101%, 0)"}function u(){d.menuVisible?ta&&(640>window.innerWidth||640>window.innerHeight)?(p(),ba=!1,P.style.transform=""):ba?(ba=!1,P.style.transform=""):w():w()}function y(){ba&&d.menuVisible&&(640>window.innerWidth||640>window.innerHeight)||u()}function B(Ca,na,Ea){var Ma=new G.Vector3;na.addEventListener("click",
function(Q){var oa=na.getBoundingClientRect(),Aa=(Q.clientX-oa.left)/oa.width;Q=(Q.clientY-oa.top)/oa.height;0!==Ca.data[4*(Math.round(Aa*ka)+Math.round(Q*qa)*ka)+3]&&(Ma.set(G.Math.mapLinear(Aa,0,1,Ea.visibleRange.min.x,Ea.visibleRange.max.x),G.Math.mapLinear(Q,0,1,Ea.visibleRange.min.y,Ea.visibleRange.max.y),Ea.slicePlaneHeight),bj(Ma,-1*Ea.rotation,Ea.cropRange.center()),Aa=new WALK.View({position:[Ma.x,Ma.y,Ma.z]}),c.switchToView(Aa),Ea!==ia&&g(Ea));WALK.focusWalkCanvas()})}function D(){U.add(I.getContainer());
V.style.display="";ma.style.display="";1<R.length&&(da.style.display="",P.classList.add("minimap-wrapper-tabs"))}function H(){U.clear();da.innerHTML="";da.style.display="none";ma.style.display="none";V.style.display="none";P.classList.remove("minimap-wrapper-tabs")}function K(Ca){var na=document.createElement("canvas");na.width=ka;na.height=qa;na.style.transition="opacity 0.5s";var Ea=a.createMinimapImageDataComponents(b.minimapConfig,Ca,ka,qa),Ma=Ea.minimapImageData;Ea=Ea.walkableImageData;na.getContext("2d").putImageData(Ma,
0,0);B(Ea,na,Ca);U.add(na);return na}function J(){if(!(ya&&za&&T&&V&&ma&&P&&N))return!0}function W(){J()||(U=new fj(ka,qa,P,N),I=new dj(ka,qa),640>window.innerWidth||640>window.innerHeight?w():v(),aj(ya,v),aj(za,p),aj(T,w),aj(V,u),d.onMenuVisibilityChanged(y),ha=!0,e(),f(),h(),D())}var M=this,ba=!1,ha=!1,ta=!1,I=null,U=null,ia=null,R=[],E=!1,Y=-Infinity,X=Infinity;d.onViewSwitchStarted(function(){return E=!0});d.onViewSwitchDone(function(){return E=!1});var fa=a.calculateRenderSize(700,b.boundingBox),
ka=fa.width,qa=fa.height,ya=document.getElementById("minimap-button-minimize"),za=document.getElementById("minimap-button-maximize"),T=document.getElementById("minimap-button-close"),V=document.getElementById("minimap-button-toggle"),ma=document.getElementById("minimap-container"),P=document.getElementById("minimap-wrapper"),N=document.getElementById("minimap-content"),da=document.getElementById("minimap-tabs"),ua=new G.Vector3(0,0,0),ja=new G.Vector3(0,0,0),S=new G.Vector2,sa=new G.Vector2,Ga={min:0,
max:ka},Ya={min:0,max:qa},Za={type:"minimapLevelSelected",target:this,level:null};G.EventDispatcher.prototype.apply(WALK.Minimap.prototype);this.selectLevel=function(Ca,na){na=void 0===na?!1:na;var Ea=R.filter(function(Ma){return Ma.level===Ca})[0];na&&g(Ca);Ea.canvas||(Ea.canvas=K(Ca));Ca===ia?I.show():I.hide();k(Ca);l(Ca);r();U.updateRatio(Ca);Za.level=Ca;this.dispatchEvent(Za)};this.update=function(){if(!J()){var Ca=d.getCameraPosition(),na=d.getCameraRotation();if(!1===$i(ua,Ca)||!1===$i(ja,na)){r(Ca,
na);if(!E&&(Ca.z>X||Ca.z<Y)){var Ea=n(Ca);l(Ea);M.selectLevel(Ea,!0)}ua.set(Ca.x,Ca.y,Ca.z);ja.set(na.x,na.y,na.z)}}};b.minimapConfig.enabled&&W();b.minimapConfig.addEventListener("updated",function(){ha?b.minimapConfig.enabled?(H(),e(),f(),h(),D()):H():W()});d._onMeetingJoined(w)};WALK.Timer=function(){this.clock=performance||Date;this.reset()};WALK.Timer.prototype={constructor:WALK.Timer,reset:function(){this.startMS=this.clock.now()},elapsedMSec:function(){return this.clock.now()-this.startMS},elapsedSec:function(){return.001*this.elapsedMSec()}};
WALK.Perf=function(){var a=new WALK.Timer,b=[];this.begin=function(){a.reset()};this.end=function(){b.push(a.elapsedSec());0===b.length%100&&(b.sort(),console.log("Best "+b[0]+" Median "+b[Math.floor(.5*b.length)]+" 95 "+b[Math.floor(.95*b.length)]))}};WALK.DeferringExecutorOnce=function(a,b){function c(){d=null;a()}var d=null;this.deferRun=function(){null!==d&&clearTimeout(d);d=setTimeout(c,b)}};
WALK.DeferringExecutorInterval=function(a,b){function c(){a()}var d=null;this.deferRun=function(){null!==d&&clearInterval(d);d=setInterval(c,b)}};WALK.AnimationController=function(a,b,c){function d(){l||(h||k.getDelta(),l=!0,a.vrEnabled()?a.requestAnimationFrame(e):requestAnimationFrame(f))}function e(){p(a.vrEnabled())}function f(){p(!1)}var g=this,k=new G.Clock,h=!1,l=!1,n=!1,r=0,v=!1;var p=function(w){v&&(l=!1,n?(console.assert(!w),c(k.getDelta(),r)?(r+=1,d()):n=!1):(h=!0,b(k.getDelta(),w),WALK.ALWAYS_RENDER&&g.requestFrame(),h=!1,l||(n=!0,r=0,d())))};this.requestFrame=function(){v&&(n=!1,d())};this.disable=function(){v=!1};this.enable=
function(){v=!0;l=!1;this.requestFrame()};this.isEnabled=function(){return v}};WALK.ExposureController=function(a,b,c){function d(p){l=p;g=p-e.exposure;h=Math.sign(g);g=Math.abs(g);k=g/1}var e=a.camera,f=!1,g=0,k,h,l,n=new WALK.Timer;this.adaptExposure=function(){if(f&&e.autoExposure){n.reset();var p=c.measureReflectedLuma();0>p?g=0:(d(Math.log2(e.autoExposureDarkness/p)),.3>g&&(g=0))}};this.exposureNeedsUpdate=function(){return 0<g};var r=new G.Vector3(Infinity,Infinity,Infinity),v=function(){return function(){if(!f||!e.autoExposure){for(var p=a.cameraVolumes.length-1;0<=p;--p){var w=
a.cameraVolumes[p];if(w.worldCoordinatesInside(r)){d(w.exposure);e.setGamma(w.gamma);return}}d(e.defaultExposure);e.setGamma(e.defaultGamma)}}}();a.addEventListener("cameraVolumeAdded",function(p){p.cameraVolume.addEventListener("updated",v);v()});a.addEventListener("cameraVolumeShifted",v);a.addEventListener("cameraVolumeRemoved",function(p){p.cameraVolume.removeEventListener("cameraVolumeUpdated",v);v()});e.addEventListener("updated",v);this.update=function(p){var w=b.cameraWorldPosition();r.equals(w)||
(r.copy(w),v());this.exposureNeedsUpdate()&&(p=Math.min(k*p,g),g-=p,1E-5>g?(g=0,e.exposure=l):e.exposure+=p*h)};this.updateWithoutDelay=function(){this.update(1)};this.enableAutoExposure=function(){f=!0;g=0};this.disableAutoExposure=function(){f=!1;v()}};function gj(a,b){for(var c=0,d=0,e=0;65536>e;++e){var f=4*e;f=a[f]+255*a[f+1];0!==f&&(d+=1,b[f]+=1,c=Math.max(c,f))}if(256>d)return-1;e=a=0;for(f=1;f<=c;++f)if(b[f]+a<.3*d)a+=b[f],b[f]=0;else break;for(f=c;0<=f;--f)if(b[f]+e<.1*d)e+=b[f],b[f]=0;else break;f=0;for(var g=1;g<=c;++g)f+=b[g]*Math.log(g/255),b[g]=0;return Math.exp(f/(d-a-e))}
WALK.LumaMeter=function(a,b){function c(n){e||(console.assert(!e),e=a.createRenderTarget(256,256,{minFilter:GLC.NEAREST,magFilter:GLC.NEAREST,format:GLC.RGBA,stencilBuffer:!1,generateMipmaps:!1}),f=new be(a),g=new Uint8Array(262144),k=new Uint32Array(65280),h=new WALK.LumaMaterial(!0),l=new WALK.LumaMaterial(!1));n=n?h:l;f.set(!0,!0,!1);var r=b.gpuMeshes.filter(function(v){return!v.material.transparent});a.renderMeshes(r,n,d,e);a.readPixels(256,256,g);a.setRenderTarget(null);f.restore();return gj(g,
k)}var d=b.camera,e,f,g,k,h,l;this.measureIncidentLuma=function(){return c(!0)};this.measureReflectedLuma=function(){return c(!1)}};function hj(a,b,c,d,e){return a.createRenderTarget(b,c,{format:GLC.RGBA,magFilter:d,minFilter:d,depthBuffer:e,stencilBuffer:!1,generateMipmaps:!1})}
function ij(a,b,c){var d=[],e=[],f=[{totalFovFraction:.25,count:2},{totalFovFraction:.25,count:16},{totalFovFraction:.375,count:48},{totalFovFraction:.125,count:8}];(function(){for(var g=0,k=0,h=0,l=0;l<f.length;l++){var n=f[l],r=n.totalFovFraction*a/n.count;console.assert(r===Math.floor(r),"Height ("+r+")must be an integer");var v=n.totalFovFraction*Math.PI/2/n.count,p=hj(c,4*b,4*r,GLC.LINEAR,!0);e.push(p);for(var w=0;w<n.count;w++)d.push({fov:v,fovOffset:g+(w+.5)*v,height:r,yOffset:k+w*r,renderTarget:p});
g+=n.count*v;k+=n.count*r;h+=n.totalFovFraction}console.assert(1===h,"Invalid fractions sum");console.assert(g===Math.PI/2,"Invalid fov definition for rectangles");console.assert(k===a,"Invalid rectangles height")})();this.getRectangleHeight=function(g){return d[g].height};this.getRectangleOffset=function(g){return d[g].yOffset};this.getRectangleFov=function(g){return d[g].fov};this.getRectangleFovOffset=function(g){return d[g].fovOffset};this.getRectangleRenderTarget=function(g){return d[g].renderTarget};
this.dispose=function(){e.forEach(function(g){g.dispose()});d.length=0;e.length=0};this.getRectangleCount=function(){return d.length}}
function jj(a,b,c){function d(){var v=(document.body.offsetWidth-document.body.offsetHeight*k)/2,p=v+"px";v=Math.max(v,0)+"px";h.style.width=v;l.style.width=v;n.style.left=p;n.style.right=p}function e(v,p,w,u,y,B){function D(ja,S){for(var sa=N[ja].hemisphere,Ga=N[ja].eyeOffset,Ya=N[ja].parallaxOffset,Za=N[ja].targetYOffset,Ca=0;Ca<qa;Ca++){J(sa,S,Ca,Ga);var na=ka.getRectangleRenderTarget(Ca);a.render(b.threeScene,fa,na);var Ea=ka.getRectangleHeight(Ca),Ma=ka.getRectangleOffset(Ca);ma.y=sa===E?Za+
ta+Ma:Za+ta-Ma-Ea;ma.x=(S*U+Ya+w)%w;ma.height=Ea;P.render(a,ma,na)}B()?K(null):(sa=m.makeIterator(H(ja,S)),ja=sa.next().value,S=sa.next().value,-1===ja?(sa=new Uint8Array(2*w*ba*4),a.readPixels(w,2*ba,sa),K(sa)):(0===S%ua&&u({done:512*ja+S,total:da}),setTimeout(function(){return D(ja,S)},0)))}function H(ja,S){S++;if(512===S){ja++;if(ja===N.length)return[-1,-1];S=0}return[ja,S]}function K(ja){ma.dispose();ka.dispose();P.dispose();y(ja)}function J(ja,S,sa,Ga){S=-(S*I-Y);ja=ja===E?-ka.getRectangleFovOffset(sa):
ka.getRectangleFovOffset(sa);ya.set(Ga,0,0).applyMatrix4(V.makeRotationZ(S));fa.position.copy(v).add(ya);za.copy(ha).applyMatrix4(V.makeRotationX(ja)).applyMatrix4(V.makeRotationZ(S));T.copy(fa.position).add(za);fa.lookAt(T);sa=W*Math.tan(ka.getRectangleFov(sa)/2);Ga=X*Math.cos(ja);fa.projectionMatrix.makeFrustum(-Ga,Ga,-sa,sa,W,M);fa.updateMatrix();fa.updateMatrixWorld()}var W=b.camera.near,M=b.camera.far;console.assert(0===w%512,"Invalid width for stereo panorama");var ba=w/2,ha=new G.Vector3(0,
-1,0),ta=ba/2,I=2*Math.PI/512,U=w/512,ia=-U,R=Symbol("Bottom"),E=Symbol("Top"),Y=Math.floor(p/I)*I,X=W*Math.tan(I/2),fa=new G.PerspectiveCamera;fa.up.set(0,0,1);var ka=new ij(ta,U,a),qa=ka.getRectangleCount(),ya=new G.Vector3,za=new G.Vector3,T=new G.Vector3,V=new G.Matrix4,ma=hj(a,w,2*ba,GLC.NEAREST,!1);ma.width=U;var P=new de,N=[{hemisphere:E,eyeOffset:.03,parallaxOffset:ia,targetYOffset:ba},{hemisphere:R,eyeOffset:.03,parallaxOffset:ia,targetYOffset:ba},{hemisphere:E,eyeOffset:-.03,parallaxOffset:U,
targetYOffset:0},{hemisphere:R,eyeOffset:-.03,parallaxOffset:U,targetYOffset:0}],da=512*N.length,ua=Math.ceil(da/100);D(0,0)}function f(v,p,w,u){var y=new WALK.CubeCamera(b.camera.near,b.camera.far);y.rotateZ(p);y.position.copy(v);y.updateMatrixWorld();v=a.createRenderTargetCube(4096,4096,{format:GLC.RGBA,magFilter:GLC.LINEAR,minFilter:GLC.LINEAR,stencilBuffer:!1,generateMipmaps:!1});for(p=0;6>p;p+=1)v.activeCubeFace=p,a.render(b.threeScene,y.sideCameras[p],v);y=hj(a,w,u,GLC.NEAREST,!0);p={uniforms:{panoramaCube:{type:"t",
value:null}},vertexShader:WALK.getShader("cube_to_equirect_vertex.glsl"),fragmentShader:WALK.getShader("cube_to_equirect_fragment.glsl")};p=new G.ShaderPass(p,"panoramaCube");p.render(a,y,v);p.dispose();v.dispose();v=new Uint8Array(w*u*4);a.readPixels(w,u,v);y.dispose();return v}function g(v,p){var w=hj(a,v,p,GLC.NEAREST,!0);v=hj(a,v,p,GLC.NEAREST,!1);p=new he(a,b);p.setTargets(w,v);p.renderAllSamples();var u=p.copyAccumulatedSamplesToBuffer();w.dispose();v.dispose();p.dispose();return u}var k=null,
h=null,l=null,n=null,r=new G.Vector3;this.markArea=function(v){function p(u,y){u.style.zIndex=1;u.style.pointerEvents="none";u.style.position="absolute";u.style.top=0;u.style.bottom=0;u.style[y]=0;u.style.backgroundColor="rgba(0, 0, 0, 0.5)"}function w(u){u.style.zIndex=1;u.style.pointerEvents="none";u.style.position="absolute";u.style.boxSizing="border-box";u.style.top=0;u.style.bottom=0;u.style.border="4px solid rgba(35, 181, 233, 0.5)"}n||(h=document.createElement("div"),p(h,"left"),l=document.createElement("div"),
p(l,"right"),n=document.createElement("div"),w(n),document.body.appendChild(h),document.body.appendChild(l),document.body.appendChild(n),window.addEventListener("resize",d));k=v;d()};this.unmarkArea=function(){n&&(h.remove(),l.remove(),n.remove(),window.removeEventListener("resize",d),n=l=h=k=null)};this.monoScreenToBuffer=function(v,p,w){return v?f(c.cameraWorldPosition(),c.getYawAngle(),p,w):g(p,w)};this.stereoPanoramaToBuffer=function(v,p,w,u){e(c.cameraWorldPosition(),c.getYawAngle(),v,p,w,u)};
this.monoScreenToDataUrl=function(v,p,w){v=this.monoScreenToBuffer(v,p,w);for(var u=0;u<w;++u)for(var y=0;y<p;++y){var B=4*(u*p+y);if(u<w/2)for(var D=4*((w-u-1)*p+y),H=0;3>H;++H){var K=v[B+H];v[B+H]=v[D+H];v[D+H]=K}v[B+3]=255}v=new Uint8ClampedArray(v);v=new ImageData(v,p,w);u=document.createElement("canvas");u.width=p;u.height=w;u.getContext("2d").putImageData(v,0,0);return u.toDataURL("image/jpeg")};this.monoScreenToLocalImage=function(v,p,w){v=this.monoScreenToDataUrl(v,p,w);navigator.msSaveOrOpenBlob?
fetch(v).then(function(u){return u.blob()}).then(function(u){return navigator.msSaveOrOpenBlob(u,"screen.jpg")}):(p=document.createElement("a"),document.body.appendChild(p),p.style.cssText="display: none",p.href=v,p.download="screenshot",p.click(),window.URL.revokeObjectURL(v),p.parentNode.removeChild(p))};this.coverToServer=function(v,p){var w=g(v,p);WALK.ajaxPost("screenshot?width="+v+"&height="+p,"application/binary",w)};this.monoPanoramaToServer=function(v,p){v.position?r.fromArray(v.position):
r.copy(c.cameraWorldPosition());var w=void 0!==v.width?v.width:8E3,u=void 0!==v.height?v.height:4E3,y=m,B=y.makeIterator;var D=Math.min(WALK.MAX_PANORAMA_SIZE,WALK.DETECTOR.gl.maxRenderBufferSize);if(w<=D&&u<=D)w=[w,u];else{var H=w/u;w=w>u?[D,Math.floor(D/H)]:[Math.floor(D*H),D]}u=B.call(y,w);w=u.next().value;u=u.next().value;y=void 0!==v.rotation?G.Math.degToRad(v.rotation):0;y=f(r,y,w,u);WALK.ajaxPost("panorama?width="+w+"&height="+u+"&name="+v.name,"application/binary",y,p,p)}};function kj(a){var b=new WALK.OutlineMaterial(new G.Color(0,0,0),1),c=new WALK.StandardMaterial;a.hasLightMap()?c.lightMapped=!0:c.specularOff=!0;c.setUniforms();return{outlineMaterial:b,planMaterial:c}}function lj(a,b,c){for(var d=0;d<c;++d)for(var e=0;e<b;++e){var f=4*(d*b+e);if(d<c/2)for(var g=4*((c-d-1)*b+e),k=0;4>k;++k){var h=a[f+k];a[f+k]=a[g+k];a[g+k]=h}}}function mj(a,b){console.assert(0===b%4,"id passed does not point to alpha channel");return 0!==a[b+3]}
function nj(a,b){console.assert(0===b%4,"id passed does not point to alpha channel");return 255>a[b+3]}function oj(a,b,c){return 255>a[c+3]&&a[c+3]>=a[b+3]}function pj(a,b,c){return a.createRenderTarget(b,c,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,generateMipmaps:!1})}
function qj(a,b){var c={uniforms:{tColor:{type:"t",value:null},tAlpha:{type:"t",value:null},colorFill:{type:"c",value:null}},vertexShader:WALK.getShader("minimap_add_alpha_vertex.glsl"),fragmentShader:WALK.getShader("minimap_add_alpha_fragment.glsl")};c=new G.ShaderPass(c,"tColor");c.uniforms.tAlpha.value=a;b&&(c.material.condDefine(!0,"USE_ALPHA_FROM_COLOR"),c.uniforms.colorFill.value=b);return c}
function rj(a,b){function c(g,k,h,l,n,r,v){var p=new Uint8Array(k.width*k.height*4),w=new be(a);w.set(!0,!0,!1);var u=[];b.gpuMeshes.forEach(function(B){(B.logicalMeshes||[B]).forEach(function(D){var H=n?!D.node.disableCollisions:!0;(l?!D.material.transparent:1)&&H&&u.push(D)})});if(r){r=pj(a,k.width,k.height);var y=pj(a,k.width,k.height);g=new he(a,b,g);g.setTargets(r,y);g.renderAllSamples(u,h);h=qj(r,v);w.restore();w.set(!0,!0,!1);h.render(a,k,y);w.restore();a.readPixels(k.width,k.height,p);r.dispose();
y.dispose();g.dispose()}else a.renderMeshes(u,h,g,k),w.restore(),a.readPixels(k.width,k.height,p);lj(p,k.width,k.height);return p}function d(g,k,h,l,n){l=Math.max(l,n);h=Math.max(h.size().x,h.size().y);f.outlineMaterial.setUniform("thickness","f",g/(l/h*.1));f.outlineMaterial.setUniform("color","c",k)}var e=new G.Color(1,1,1),f=kj(b);this.createMinimapImageDataComponents=function(g,k,h,l){d(g.outlineThickness,e,b.boundingBox,h,l);var n=k.cropRange.center(),r=pj(a,h,l),v=new G.OrthographicCamera(k.visibleRange.min.x-
n.x,k.visibleRange.max.x-n.x,k.visibleRange.min.y-n.y,k.visibleRange.max.y-n.y,0,10);v.rotation.set(0,0,-1*k.rotation);v.position.set(n.x,n.y,k.slicePlaneHeight);v.updateMatrixWorld(!0);k=k.slicePlaneHeight-k.farPlaneHeight;v.near=0;v.far=k;v.updateProjectionMatrix();k=c(v,r,f.planMaterial,!0,!0,!0);if(0<b.minimapConfig.outlineThickness){v.near=0;v.far=.1;v.updateProjectionMatrix();var p=c(v,r,f.outlineMaterial,!0,!0,!0,g.outlineColor);if(b.minimapConfig.fillEnabled){v=p;g=g.outlineColor;var w=void 0;
w=void 0===w?.02:w;n=new Uint8Array(v.length);w*=v.length/4;for(var u=[-4,4,4*-h,4*h],y=0;y<v.length;y+=4)if(0===n[y]&&nj(v,y)){var B=v,D=[],H=[],K=y,J=H;n[K]=1;for(J.push(K);H.length;){K=H.pop();D.push(K);J=B;for(var W=H,M=0;M<u.length;++M){var ba=K+u[M];if(ba=0===n[ba]&&oj(J,K,ba)){ba=K+u[M];var ha=W;n[ba]=1;ha.push(ba)}}}B=D;if(B.length<w)for(D=g,H=v,K=0;K<B.length;++K)H[B[K]]=255*D.r,H[B[K]+1]=255*D.g,H[B[K]+2]=255*D.b,H[B[K]+3]=255}}v=p;for(g=0;g<k.length;g+=4)if(mj(v,g)){n=v[g+3]/255;for(w=
0;3>w;++w)k[g+w]=k[g+w]*(1-n)+v[g+w]*n;k[g+3]=255}}r.dispose();r=new Uint8Array(k.length);for(v=0;v<k.length;v+=4)if(mj(k,v)&&(!p||nj(p,v)))for(g=0;4>g;++g)r[v+g]=255;k=new Uint8ClampedArray(k.buffer);k=new ImageData(k,h,l);r=new Uint8ClampedArray(r.buffer);h=new ImageData(r,h,l);return{minimapImageData:k,walkableImageData:h}};this.getCollisionData=function(g,k,h){var l={x:{min:0,max:k},y:{min:0,max:h}},n={x:{min:b.collisionBoundingBox.min.x,max:b.collisionBoundingBox.max.x},y:{min:b.collisionBoundingBox.max.y,
max:b.collisionBoundingBox.min.y}};d(g.outlineThickness,g.outlineColor,b.collisionBoundingBox,k,h);var r=a.createRenderTarget(k,h,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,generateMipmaps:!1}),v=new G.OrthographicCamera(b.collisionBoundingBox.min.x,b.collisionBoundingBox.max.x,b.collisionBoundingBox.max.y,b.collisionBoundingBox.min.y,0,10);v.position.set(0,0,g.slicePlaneHeight);v.updateMatrixWorld(!0);v.near=0;v.far=.1;v.updateProjectionMatrix();g=c(v,r,f.outlineMaterial,
!1,!0);r.dispose();r=new Uint8ClampedArray(g.buffer);return{collisionImageData:new ImageData(r,k,h),canvasRange:l,collisionRange:n}};this.calculateRenderSize=function(g,k){k=k.size().y/k.size().x;return{width:1>k?g:Math.round(1/k*g),height:1>k?Math.round(g*k):g}}};WALK.InteractionDispatcher=function(a,b,c,d,e,f,g,k){function h(J,W){J=J?e:d;for(var M=0;M<J.length;M+=1)if(J[M](W.object,W.point,W.distance))return!0;return!1}function l(){return b.findIntersectionAtPosition(0,0,!0,u)}function n(){h(!1,u)}function r(J,W,M){k&&k.reset();return b.findIntersectionAtPosition(J,W,!0,D)?h(M,D):!1}function v(J){k&&k.reset();J.action===WALK.GAMEPAD_ACTION.TRIGGER&&r(0,0,!1)}function p(J,W){for(var M=0;M<f.length&&!f[M](J,W);M+=1);}var w=!1,u=new WALK.RayIntersection,y=null;
k&&k.setGazeHandlers(l,n);var B=new WALK.PointerEventHelper(a,WALK.POINTER_PRIORITY.INTERACTION_DISPATCHER);a=B.callbacks;var D=new WALK.RayIntersection,H=null,K=null;a.onPointerMove=function(J,W){console.assert(w);0!==f.length&&(H=J,K=W,c());return!1};a.onClick=function(J,W){return r(J,W,!1)};a.onDoubleClick=function(J,W){return r(J,W,!0)};g.addEventListener("actionActivated",v);this.handleHover=function(){if(w&&0!==f.length){var J=b.findObstacleMeshAtPosition(H,K,!0);null===J?y&&(p(y,!1),y=null):
J!==y&&(y&&p(y,!1),p(J,!0),y=J)}};this.enable=function(){w=!0;B.enable();console.assert(null===y)};this.disable=function(){w=!1;null!==y&&(p(y,!1),y=null);B.disable()};this.dispose=function(){this.disable();g.removeEventListener("actionActivated",v)};this.enable()};var sj=document.getElementById("walk-canvas"),tj=WALK.EDIT_MODE,uj,vj,wj,xj,yj,zj,Aj,Bj,Cj,Dj,Ej,Fj,Gj,Hj,Ij,Jj,Kj,Lj,Mj,Nj,Oj,Pj,Qj,Rj,Sj,Tj,Uj=null,Vj=null,Wj=null,Xj,Yj,Zj,ak=0,bk=!1,ck=!1,dk,ek=new WALK.GazeModeObserver;function fk(a,b){return Jj.renderIdle(a,b)}
function gk(a,b){b&&Bj.update();Pj.update(a);Yj&&Ij.minimapConfig.enabled&&Yj.update();Dj.enableCollisions&&!b&&Kj.handleCollisions(a);Nj&&Nj.handleHover();Oj.update(a);Aj.update(a);Lj&&Lj.updateCameraHeight(a);Mj&&Mj.updateCameraHeight();b&&!Pj.teleportingToPoint&&(vj.update(),Cj.requestFrame());Qj&&(b&&!Bj.hasGamepads()?Qj.update(a):Qj.reset());for(var c=!1,d=m.makeIterator(Ij.getAnimatedRootNodes()),e=d.next();!e.done;e=d.next())e.value.update(a,Aj.cameraWorldPosition())&&(c=!0);d=m.makeIterator(Ij.getAnimatedMaterials());
for(e=d.next();!e.done;e=d.next())e=e.value,e.isPlaying&&(e.update(a),c=!0);c&&Cj.requestFrame();Tj&&Tj.update(a);yj._update(a);Jj.renderToScreen(a,b);Vj&&Vj.animate()}function hk(a){a.view&&(Lj&&Lj.disable(),Nj&&Nj.disable())}function ik(a){!Lj||Lj.isEnabled()||vj.vrEnabled()||Lj.enable();if(Mj&&vj.vrEnabled())Mj.onTeleportDone();a.view&&Nj&&Nj.enable();vj.vrEnabled()&&Aj.hmdReset()}
function jk(){if("hidden"===document.visibilityState){if(Ij)for(var a=m.makeIterator(Ij.getAnimatedMaterials()),b=a.next();!b.done;b=a.next())b.value.sleepAnimation()}else if("visible"===document.visibilityState&&Ij){a=m.makeIterator(Ij.getAnimatedMaterials());for(b=a.next();!b.done;b=a.next())b.value.wakeAnimation();Cj.requestFrame()}}
function kk(){WALK.DETECTOR.ios&&(document.documentElement.style.height=window.innerHeight+"px",0!==document.body.scrollTop&&window.scrollTo(0,0));Jj.resize(vj.vrEnabled());Cj.requestFrame();wj.onResize()}function lk(){return document.pointerLockElement===sj||document.mozPointerLockElement===sj||document.webkitPointerLockElement===sj}
function mk(){return document.fullscreenElement||document.mozFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement}function nk(){if(lk()){Aj.mousePressLook=!1;wj.onPointerLockChange(!0);var a=WALK.GAZE_IN_POINTER_LOCK;a?ek.enableMode():ek.disableMode();yj.anchorsVisible=a}else Aj.mousePressLook=!0,wj.onPointerLockChange(!1),ek.disableMode(),yj.anchorsVisible=!0;Vj&&dat.GUI.toggleHide()}
function ok(){if(mk())wj.onFullScreenChange(!0),screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary");else wj.onFullScreenChange(!1)}
function pk(){var a=document.body;return void 0!==document.fullscreenEnabled||void 0!==document.webkitFullscreenEnabled||void 0!==document.mozFullScreenEnabled||void 0!==document.msFullscreenEnabled?!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled):void 0!==a.mozRequestFullScreen||void 0!==a.webkitRequestFullscreen||void 0!==a.msRequestFullscreen||void 0!==a.requestFullscreen}
function qk(a){uj.uploadNewBuffers(a);Cj&&Cj.requestFrame()}function rk(a){uj.uploadTexture(a);a.isAtlas()?a.forEachAtlasEntry(function(b){console.assert(null===b.isCutout);Wj.isCutoutTexture(b)}):null===a.isCutout&&Wj.isCutoutTexture(a);Cj&&Cj.requestFrame()}
function sk(){var a=[],b=[],c=[];a.push(yj._clickListener.bind(yj));var d=yj._createHoverListener();d&&c.push(d);Oj=new WALK.ClickNavigator(Ij,Kj,Aj,Pj);b.push(Oj.onMeshClicked);tj||a.push(Oj.onMeshClicked);Nj=new WALK.InteractionDispatcher(Ej,Kj,function(){Cj.requestFrame()},a,b,c,Bj,Qj)}function tk(){Lj&&Lj.disable();Mj&&Mj.enable();Aj.mouseControlsPitch=!1;Aj.hmdReset();Pj.onVrChange(!0);ek.enableMode();wj.onVrChange(!0);yj._vrChange(!0);kk()}
function uk(a){Cj.isEnabled()&&(a?tk():(Aj.resetRollAngle(),Aj.resetPitchAngle(),Aj.mouseControlsPitch=!0,console.assert(!vj.vrEnabled()),Mj&&Mj.disable(),Lj&&Lj.enable(),Pj.onVrChange(!1),ek.disableMode(),wj.onVrChange(!1),yj._vrChange(!1),kk(),setTimeout(kk,1E3)))}function vk(a){tj||WALK.DETECTOR.mobile&&!WALK.ALLOW_MOBILE_VR||(WALK.DETECTOR.ios||WALK.DETECTOR.mobile&&WALK.DETECTOR.firefox)&&WALK.DETECTOR.inCrossOriginIframe||wj.setVrSupported(a)}
function wk(a,b){if(Mj&&null!==b)Mj.onHmdPositionUpdate(b);Aj.onHmdUpdate(a,b)}function xk(a,b){a&&Aj.cameraWorldPosition().set(a[0],a[1],a[2]);b&&(a=new WALK.Euler,a.setFromDegTriple(b),Aj.setYawAngle(a.yaw),Aj.setPitchAngle(a.pitch))}function yk(a){for(var b=0;b<a.length;b+=1)if(!a[b].lightProbe)return!1;return!0}function zk(a,b,c){Kj=new WALK.Collider(a,b,c);b.visitAllNodes(function(d){d.mesh&&Kj.addStaticObstacle(d.mesh)})}
function Ak(){var a=G.Scene.prototype.add;G.Object3D.prototype.add=function(b){b instanceof G.Mesh&&uj.uploadNewBuffers(b);a.call(this,b)}}function Bk(a){var b=WALK.urlHashGetArgument("view"),c=null;b&&(c=a.findViewByName(b));return c||a.views[0]}
function Ck(a){function b(){Cj.requestFrame()}Ij=a;Ij.adjustSkiesAndCameraFarToSpanWholeScene();Ij.headLight=WALK.HEAD_LIGHT;Ij.addEventListener("updated",function(){return Cj.requestFrame()});Ij.addEventListener("anyViewUpdated",function(){return wj.refresh()});Ij.disableLightProbesForMaterials();Aj.enable();Ij.threeScene.updateMatrixWorld(!0);vj.setCameraFar(Ij.camera.far);Jj=new De(uj,vj,Ij,Gj);Zj=new rj(uj,Ij);Ej=new WALK.PointerEventDispatcher(uj.domElement,tj);if((a=Dj.enableCollisions)||tj)zk(uj,
Ij,Aj),Aj.orbit.collider=Kj;Pj=new WALK.Teleport(Ij,Aj,Kj,Cj,Zj);Pj.addEventListener("teleportStarted",hk);Pj.addEventListener("teleportDone",ik);Sj=new WALK.AutoTour(Ij,Pj);a&&Ij.camera.autoClimb&&(Lj=new WALK.StepsClimber(Kj,Aj,Cj));a&&(Mj=new WALK.VRHeightController(Aj,Kj));Pj.switchToView(Bk(Ij),0);Gj.updateWithoutDelay();Rj=new WALK.HashChangeTeleport(Ij,Pj);Xj=new jj(uj,Ij,Aj);a&&!0!==WALK.NO_GAZE_TELEPORT&&(Qj=new WALK.GazePointer(Ij,Aj,b,ek));yj._sceneReadyToDisplay(uj,Ij,Aj,Pj,Sj,Kj,Xj,Fj,
ek,Ej,Cj,zj);sk(a);document.addEventListener("visibilitychange",jk);window.addEventListener("resize",function(){WALK.DETECTOR.ios?setTimeout(kk,1E3):kk()},!1);pk()&&wj.setFullScreenSupported();WALK.DETECTOR.mobile||WALK.DETECTOR.opera||void 0===document.pointerLockElement&&void 0===document.mozPointerLockElement&&void 0===document.webkitPointerLockElement||wj.setPointerLockSupported();wj.sceneReadyToDisplay(Ij,Pj,Sj,Xj);kk();WALK.DEBUG&&WALK.DebugUI&&(Vj=new WALK.DebugUI(Ij,Aj,kk,Cj));WALK.focusWalkCanvas();
WALK.DEBUG_SHARED_BUFFERS&&(Ij.threeScene.overrideMaterial=new WALK.DebugMaterial);Ij.startAutoTourOnLoad()&&Sj.start();Cj.enable();vj.vrEnabled()&&tk();dk=Uj.elapsedLoadTimeSec()}function Dk(a){tj||WALK.urlHashContains("nostats")||0!==ak||wj.cover.sendStats&&WALK.ajaxPost("./stats/"+a,null,null)}
function Ek(a,b){function c(k){function h(){f.delete(l);null!==a.findLightProbe(l.id)&&(b.assignLightProbesToObjects(),b.createLightProbeTexture(l,!1),Cj.requestFrame())}var l=k.target;k=f.get(l);void 0===k&&(k=new WALK.DeferringExecutorOnce(h,1E3),f.set(l,k));k.deferRun()}function d(k){k=k.target;b.createLightProbeTexture(k,!0);if(!k.isBoundingBoxInitialized()){var h=k.boxMax;k.boxMin.copy(k.position).addScalar(-1);h.copy(k.position).addScalar(1);k.enableBoundingBox()}}function e(){for(var k=0;k<
a.materials.length;k+=1)a.materials[k].forceObjectUniformsRefresh()}var f=new Map;a.addEventListener("lightProbeAdded",function(k){k=k.lightProbe;b.assignLightProbesToObjects();b.createLightProbeTexture(k,!0);k.isBoundingBoxInitialized()||k.disableBoundingBox();k.addEventListener("boundsInit",d);k.addEventListener("positionUpdated",c);k.addEventListener("boundsUpdated",e)});a.addEventListener("lightProbeRemoved",function(){b.assignLightProbesToObjects()});for(var g=0;g<a.lightProbes.length;g+=1)a.lightProbes[g].addEventListener("positionUpdated",
c),a.lightProbes[g].addEventListener("boundsInit",d),a.lightProbes[g].addEventListener("boundsUpdated",e)}function Fk(a,b,c){function d(f){if(f===a.length)c();else{var g=a[f],k=g.name;e.has(k)?d(f+1):(e.add(k),b.monoPanoramaToServer(g,function(){return d(f+1)}))}}var e=new Set;d(0)}
function Gk(a){function b(){if(Dj.onSceneLoaded)Dj.onSceneLoaded(new WALK.EditorHooks(a,wj,Aj,Pj,Tj,zj,Xj,Cj,Yj,Wj));wj.sceneLoadComplete();for(var k=m.makeIterator(a.getAnimatedMaterials()),h=k.next();!h.done;h=k.next())h.value.play();yj._sceneLoadComplete();Cj.requestFrame();k=Uj.elapsedLoadTimeSec();Dk("loaded?readyToDisplayTime="+dk.toFixed(1)+"&loadTime="+k.toFixed(1));Uj=null}var c=WALK.urlHashContains("headless");null===Dj.onSceneLoaded&&Wj.dispose();if(0<a.lightProbes.length||tj){var d=new WALK.LightProbeMaker(a,
uj,WALK.DETECTOR.gl.textureLod,WALK.DETECTOR.gl.mirrorCubeMaps,tj);0===a.lightProbes.length&&tj&&a.autoAddLightProbes&&WALK.arrangeLightProbes(a,d,c);if(0<a.lightProbes.length){yk(a.gpuMeshes)||(console.warn("Some objects do not have light probes assigned, this is not optimal."),d.assignLightProbesToObjects());var e;for(e=0;e<a.views.length&&"orbit"===a.views[e].mode;e+=1);e===a.views.length&&(e=0);Pj.executeWithViewVisibilitySettings(a.views[e],function(){d.createAllLightProbeTextures()});a.enableLightProbesForMaterials()}}a.hasLightMap()&&
Jj.enableAutoExposure();if(tj){d?Ek(a,d):console.warn("Cube maps support is required in the edit mode");e=new WALK.LightControls(a,Cj);var f=new WALK.LightProbeControls(a,Cj),g=new WALK.CameraVolumeControls(a,Cj);Tj=new WALK.EditorSelector(Ej,a,uj,Kj,e,f,g,Cj,Aj);Dj.sendCoverToServer&&Xj.coverToServer(WALK.EDITOR_COVER_WIDTH,WALK.EDITOR_COVER_HEIGHT);xk(Dj.forcedInitialCameraPosition,Dj.forcedInitialCameraRotation)}else d&&(d.dispose(),d=null);Yj=new WALK.Minimap(Zj,a,Pj,yj);tj&&c?Fk(Uj.panoramas,
Xj,b):b()}function Hk(){bk&&(bk=!1,Uj.load(),wj.sceneLoadStarted(),WALK.SHOW_HELP_ON_LOAD&&(wj.helpVisible=!0),Dk("play"))}
function Ik(a){wj.updateCover(a);zj.updateConfig(a.extensions||[]);WALK.DETECTOR.canForceBrotliBuffers=!0===a.canForceBrotliBuffers;1===a.webwalkLogMode?(WALK.logInfoMessages(),WALK.initLoggingToServer(!0)):2===a.webwalkLogMode&&WALK.initLoggingToServer(!1);tj||zj.startExtensions();yj._viewerConfigLoaded(a);if(a.language){var b=WALK.STRINGS[a.language];b?WALK.updateViewerStrings(b):console.log("Unknown language: "+a.language)}Wj=new WALK.CutoutTextureDetector(uj);Hj=new WALK.TextureCropper(uj);bk=
!0;a=new WALK.Scene(Aj.camera());void 0!==Dj.assetsUrl&&null!==Dj.assetsUrl&&(WALK.ASSETS_URL=Dj.assetsUrl);Uj=new WALK.SceneLoader(a,WALK.ASSETS_URL,tj,xj,Hj);Fj=new WALK.LumaMeter(uj,a);Gj=new WALK.ExposureController(a,Aj,Fj);Uj.onProgress=wj.loadProgress;Uj.onTextureLoaded=rk;Uj.onMeshBuffersLoaded=qk;Uj.onReadyToDisplay=Ck;Uj.onComplete=Gk;WALK.AUTO_PLAY||ck||0<ak?Hk():WALK.HIDE_PLAY||wj.enablePlayButton(Hk)}
function Jk(a){a.preventDefault();ak+=1;Cj.disable();!tj&&null===Uj&&ak<=WALK.CONTEXT_LOST_RESTORE_LIMIT?(zj.stopExtensions(),yj._contextLost(),Rj.dispose(),Rj=null,Nj.dispose(),Nj=null,Oj&&(Oj.dispose(),Oj=null),wj.contextLost()):WALK.USER_MSG.error("Graphics context lost, reload to retry.")}
function Kk(a){a.preventDefault();!tj&&null===Uj&&ak<=WALK.CONTEXT_LOST_RESTORE_LIMIT&&(WALK.USER_MSG.info("Graphics context switched, reloading the scene to use the new context.",5E3),WALK.DETECTOR.resetGlDetector(uj.context),WALK.DETECTOR.gl.reportToConsole(),uj.webGLContextRestored(),Ik(wj.cover))}
function Lk(){WALK.ajaxGet(WALK.COVER_JSON_URL,!1,function(a){WALK.DETECTOR.onAsyncPropertiesDetected(function(){Ik(a)})},function(a,b){var c="Failed to initialize the scene.";401==a&&void 0!==b&&(c=b);WALK.USER_MSG.error(c)})}
function Mk(a){Ak();Dj=a;if(uj=Ce(sj))if(WALK.DETECTOR.gl.missingCapabilities)WALK.USER_MSG.error(WALK.DETECTOR.gl.missingCapabilities);else{sj.addEventListener("webglcontextlost",Jk,!1);sj.addEventListener("webglcontextrestored",Kk,!1);wj.init();zj=new WALK.ExtensionManager;a=null;try{WALK.VR_LO?WebXRConfig.cardboardConfig.BUFFER_SCALE*=.5:WALK.VR_HI&&(WebXRConfig.cardboardConfig.BUFFER_SCALE*=1.5),a=new WebXRPolyfill(WebXRConfig)}catch(b){WALK.log("Failed to initialize WebXR polyfill")}vj=new WALK.VRManager(uj,
Bj,a,vk,wk,function(b){b?Cj.disable():Cj.enable()},uk);Cj=new WALK.AnimationController(vj,gk,fk);Cj.disable();a=new WALK.Camera;Aj=new WALK.Controls(a,sj,Bj,Cj);Aj.mousePressLook=!0;WALK.FLIP_MOUSE&&(Aj.flipMouseLook=!0);Aj.disable();Lk();WALK.getExtraAssetUrl=function(b){return b.startsWith("extra-assets/")?WALK.ASSETS_URL+b:WALK.ASSETS_URL+"extra-assets/"+b}}else WALK.USER_MSG.error(window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" target="_blank">WebGL</a> or your browser has WebGL disabled.<br/><a href="http://get.webgl.org/" target="_blank">Find out how to get it.</a>':
'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" target="_blank">WebGL</a>.<br/><a href="http://get.webgl.org/" target="_blank">Find out how to get it.</a>')}Bj=new WALK.GamepadManager;
wj=new WALK.Menu(tj,Bj,function(){vj.vrEnabled()?vj.disableVr():(Sj.isRunning()&&Sj.stop(),vj.enableVr(uj.context))},function(){if(mk())mk()&&(document.exitFullScreen=document.exitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen||document.webkitExitFullscreen,document.exitFullScreen&&document.exitFullScreen());else{var a=document.body;(a.mozRequestFullScreen||a.webkitRequestFullscreen||a.msRequestFullscreen||a.requestFullscreen).call(a);document.addEventListener("fullscreenchange",
ok,!1);document.addEventListener("mozfullscreenchange",ok,!1);document.addEventListener("webkitfullscreenchange",ok,!1);document.addEventListener("MSFullscreenChange",ok,!1)}},function(){lk()?lk()&&(document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,document.exitPointerLock&&document.exitPointerLock()):(sj.requestPointerLock=sj.requestPointerLock||sj.mozRequestPointerLock||sj.webkitRequestPointerLock,sj.requestPointerLock(),document.addEventListener("pointerlockchange",
nk,!1),document.addEventListener("mozpointerlockchange",nk,!1),document.addEventListener("webkitpointerlockchange",nk,!1))});xj=new WALK.MergeConfig;tj&&xj.setAllMaterialsEditable();yj=new WALK.Viewer(tj,wj,xj);var Nk={FontAwesomeSolid:"\uf2b9",FontAwesomeRegular:"\uf2b9",FontAwesomeBrands:"\uf293"};
WALK.loadFontFamilies=function(a,b,c){function d(k){k?++f:++g;f+g===a.length&&(0===g?b():c&&c())}if(0===a.length)b();else{var e={};a.forEach(function(k){console.assert(Nk[k],"Font "+JSON.stringify(k)+" is not supported.");e[k]=Nk[k]});var f=0,g=0;WebFont.load({custom:{families:a,testStrings:e},timeout:1E4,fontactive:function(){d(!0)},fontinactive:function(k){console.error("Cannot load font: "+k);d(!1)}})}};
WALK.getViewerAssetUrl=function(){var a=function(){for(var b=document.getElementsByTagName("script"),c=0;c<b.length;++c){var d=b[c].src.match(/^(.*\/)walk(\.min)?\.js$/);if(d)return d[1]}console.error("Cannot determine webwalk URL.");return"/webwalk/"}();return function(b){return a+b}}();WALK.initEditMode=function(a){var b=document.createElement("base");b.target="_blank";document.head.appendChild(b);WALK.loadFontFamilies(Object.keys(Nk),function(){Mk(a)})};WALK.init=function(a){tj||Mk(a)};
WALK.play=function(){bk?Hk():ck=!0};WALK.getViewer=function(){return yj};WALK.Extensions={};WALK.STRINGS.English={help:{basic:"BASIC",advanced:"ADVANCED",mouse:"Mouse",or:"or",keyboard:"Keyboard",vrTeleport:"VR teleport",holdLeftButton:"Hold the left button",clickLeftButton:"Click the left button",lookAround:"Look around",walkToClickedPlace:"Walk to the clicked place",selectMaterialLightObject:"Select material, light, object",scroll:"Scroll",walkStraight:"Walk straight",walkStraightAndLookAround:"Walk straight and look around",walkStraightAndSideways:"Walk straight and sideways",changeHeight:"Change height",
switchView:"Switch view",screenshot:"Screenshot",illuminationPreview:"Illumination preview",hideShowMenu:"Hide/show menu",hideShowMousePointer:"Hide/show mouse pointer",vrMode:"VR Mode",gazeAtFixedPlace:"Gaze at a fixed place",clickControllerButton:"Click a controller button",teleport:"Teleport",touch:"Touch"}};WALK.STRINGS.Chinese={help:{basic:"\u57fa\u672c",advanced:"\u9ad8\u7ea7",mouse:"\u6ed1\u9f20",or:"\u6216",keyboard:"\u952e\u76d8",vrTeleport:"VR \u4f20\u9001",holdLeftButton:"\u6309\u4f4f\u5de6\u952e",clickLeftButton:"\u5355\u6309\u5de6\u952e",lookAround:"\u8c03\u6574\u89c6\u89d2",walkToClickedPlace:"\u8d70\u53bb\u6307\u5b9a\u5730\u70b9",selectMaterialLightObject:"\u9009\u62e9\u6750\u8d28\uff0c\u706f\u5149\uff0c\u7269\u4f53",scroll:"\u6ed1\u8f6e",walkStraight:"\u76f4\u8d70",walkStraightAndLookAround:"\u8c03\u6574\u89c6\u89d2",
walkStraightAndSideways:"\u79fb\u52a8",changeHeight:"\u8c03\u6574\u9ad8\u5ea6",switchView:"\u79fb\u52a8\u81f3\u6307\u5b9a\u89c6\u89d2",screenshot:"\u622a\u56fe",illuminationPreview:"\u7167\u660e\u9884\u89c8",hideShowMenu:"\u9690\u85cf/\u663e\u793a\u83dc\u5355",hideShowMousePointer:"\u9690\u85cf/\u663e\u793a\u9f20\u6807",vrMode:"VR \u6a21\u5f0f",gazeAtFixedPlace:"\u51dd\u89c6\u4e00\u4e2a\u56fa\u5b9a\u7684\u5730\u65b9",clickControllerButton:"\u5355\u51fb\u63a7\u5236\u5668\u6309\u94ae",teleport:"\u4f20\u9001",
touch:"\u89e6\u78b0"}};WALK.STRINGS.French={help:{basic:"BASIQUES",advanced:"AVANC\u00c9S",mouse:"Souris",or:"ou",keyboard:"Clavier",vrTeleport:"T\u00e9l\u00e9portation VR",holdLeftButton:"Maintenez le bouton gauche",clickLeftButton:"Cliquez sur le bouton gauche",lookAround:"Regardez autour",walkToClickedPlace:"D\u00e9placez-vous jusqu\u2019\u00e0 l\u2019endroit cliqu\u00e9",selectMaterialLightObject:"S\u00e9lectionnez le mat\u00e9riel, la lumi\u00e8re, l\u2019objet",scroll:"D\u00e9filement",walkStraight:"Allez tout droit",
walkStraightAndLookAround:"Allez tout droit et regardez autour",walkStraightAndSideways:"Allez tout droit et de c\u00f4t\u00e9",changeHeight:"Changez la hauteur",switchView:"Changez de vue",screenshot:"Capture d\u2019\u00e9cran",illuminationPreview:"Aper\u00e7u de l\u2019\u00e9clairage",hideShowMenu:"Masquer / Afficher le menu",hideShowMousePointer:"Masquer / Afficher le pointeur de la souris",vrMode:"Mode RV",gazeAtFixedPlace:"Fixez un endroit pr\u00e9cis",clickControllerButton:"Appuyez sur un bouton du contr\u00f4leur",
teleport:"T\u00e9l\u00e9portation",touch:"Touchez"}};WALK.STRINGS.German={help:{basic:"GRUNDLAGEN",advanced:"ERWEITERT",mouse:"Maus",or:"oder",keyboard:"Tastatur",vrTeleport:"VR-Teleport",holdLeftButton:"Linke Maustaste gedr\u00fcckt halten",clickLeftButton:"Klick auf die linke Maustaste",lookAround:"Umschauen",walkToClickedPlace:"Zum angeklickten Punkt bewegen",selectMaterialLightObject:"Material, Licht, Objekt ausw\u00e4hlen",scroll:"Mausrad",walkStraight:"Geradeaus gehen",walkStraightAndLookAround:"Geradeaus gehen und umsehen",walkStraightAndSideways:"Geradeaus und seitw\u00e4rts gehen",
changeHeight:"H\u00f6he \u00e4ndern",switchView:"Ansicht wechseln",screenshot:"Bildschirmfoto",illuminationPreview:"Beleuchtungsvorschau",hideShowMenu:"Men\u00fc aus- / einblenden",hideShowMousePointer:"Mauszeiger aus-/einblenden",vrMode:"VR-Modus",gazeAtFixedPlace:"Blick auf einem Punkt fixieren",clickControllerButton:"Controller Taste dr\u00fccken",teleport:"Teleportieren",touch:"Tippen"}};WALK.STRINGS.Spanish={help:{basic:"B\u00c1SICO",advanced:"AVANZADO",mouse:"Rat\u00f3n",or:"o",keyboard:"Teclado",vrTeleport:"Teletransporte VR",holdLeftButton:"Mant\u00e9n presionado el bot\u00f3n izquierdo",clickLeftButton:"Haz clic en el bot\u00f3n izquierdo",lookAround:"Mira a tu alrededor",walkToClickedPlace:"Camina hasta el lugar donde hiciste clic",selectMaterialLightObject:"Selecciona material, luz, objeto",scroll:"Despl\u00e1zate",walkStraight:"Camina en l\u00ednea recta",walkStraightAndLookAround:"Camina en l\u00ednea recta y mira a tu alrededor",
walkStraightAndSideways:"Camina recto y de lado",changeHeight:"Cambiar altura",switchView:"Cambiar vista",screenshot:"Captura de pantalla",illuminationPreview:"Vista previa de iluminaci\u00f3n",hideShowMenu:"Ocultar / mostrar men\u00fa",hideShowMousePointer:"Ocultar / mostrar el puntero del rat\u00f3n",vrMode:"Modo VR",gazeAtFixedPlace:"Mira a un punto fijo",clickControllerButton:"Pulsa un bot\u00f3n del mando",teleport:"Teletransporte",touch:"Tocar"}};WALK.STRINGS.Korean={help:{basic:"\uae30\ubcf8 \uc870\uc791\ubc95",advanced:"\uc0c1\uc138 \uc870\uc791\ubc95",mouse:"\ub9c8\uc6b0\uc2a4",or:"\ud639\uc740",keyboard:"\ud0a4\ubcf4\ub4dc",vrTeleport:"VR \uc774\ub3d9",holdLeftButton:"\uc88c\uce21 \ubc84\ud2bc \ub4dc\ub798\uadf8",clickLeftButton:"\uc88c\uce21 \ubc84\ud2bc \ud074\ub9ad",lookAround:"\uc8fc\ubcc0 \ub458\ub7ec\ubcf4\uae30",walkToClickedPlace:"\ud074\ub9ad\ud55c \uacf3\uc73c\ub85c \uc774\ub3d9",selectMaterialLightObject:"\uc7ac\uc9c8, \uc870\uba85, \uc0ac\ubb3c \uc120\ud0dd",
scroll:"\uc2a4\ud06c\ub864",walkStraight:"\uc9c1\uc9c4 \uc774\ub3d9",walkStraightAndLookAround:"\uc9c1\uc9c4 \uc774\ub3d9 / \uc8fc\ubcc0 \ub458\ub7ec\ubcf4\uae30",walkStraightAndSideways:"\uc9c1\uc9c4 \uc774\ub3d9 / \uc606\uc73c\ub85c \uc774\ub3d9",changeHeight:"\ub192\uc774 \uc870\uc808",switchView:"\ubdf0 \uc120\ud0dd",screenshot:"\uc2a4\ud06c\ub9b0\uc0f7",illuminationPreview:"\uc77c\ub8e8\ubbf8\ub124\uc774\uc158 \ud504\ub9ac\ubdf0",hideShowMenu:"\uba54\ub274 On/Off",hideShowMousePointer:"\ub9c8\uc6b0\uc2a4 \ud3ec\uc778\ud130 On/Off",
vrMode:"VR \ubaa8\ub4dc",gazeAtFixedPlace:"\ud2b9\uc815 \uc7a5\uc18c \ubc14\ub77c\ubcf4\uae30",clickControllerButton:"\ucee8\ud2b8\ub864\ub7ec \ubc84\ud2bc \ud074\ub9ad",teleport:"\ud154\ub808\ud3ec\ud2b8",touch:"\ud130\uce58"}};WALK.STRINGS.Polish={help:{basic:"PODSTAWOWE",advanced:"ZAAWANSOWANE",mouse:"Myszka",or:"lub",keyboard:"Klawiatura",vrTeleport:"Teleportacja VR",holdLeftButton:"Przytrzymaj lewy przycisk",clickLeftButton:"Naci\u015bnij lewy przycisk",lookAround:"Rozgl\u0105daj si\u0119",walkToClickedPlace:"Id\u017a do naci\u015bni\u0119tego miejsca",selectMaterialLightObject:"Wybierz materia\u0142, \u015bwiat\u0142o, obiekt",scroll:"Przewi\u0144",walkStraight:"Id\u017a prosto",walkStraightAndLookAround:"Id\u017a prosto i rozgl\u0105daj si\u0119",
walkStraightAndSideways:"Id\u017a prosto i na boki",changeHeight:"Zmie\u0144 wysoko\u015b\u0107",switchView:"Zmie\u0144 widok",screenshot:"Zrzut ekranu",illuminationPreview:"Podgl\u0105d o\u015bwietlenia",hideShowMenu:"Schowaj/poka\u017c menu",hideShowMousePointer:"Schowaj/poka\u017c kursor myszki",vrMode:"Tryb VR",gazeAtFixedPlace:"Patrz w ustalone miejsce",clickControllerButton:"Naci\u015bnij przycisk kontrolera",teleport:"Teleportacja",touch:"Dotyk"}};WALK.STRINGS.Portuguese={help:{basic:"B\u00c1SICO",advanced:"AVAN\u00c7ADO",mouse:"Mouse",or:"ou",keyboard:"Teclado",vrTeleport:"Teletransporte VR",holdLeftButton:"Mantenha pressionado o bot\u00e3o esquerdo",clickLeftButton:"Clique com o bot\u00e3o esquerdo",lookAround:"Olhe ao redor",walkToClickedPlace:"Ande at\u00e9 o lugar que foi clicado",selectMaterialLightObject:"Selecione material, luz, objeto",scroll:"Rolagem",walkStraight:"Ande em frente",walkStraightAndLookAround:"Ande em frente e olhe ao redor",
walkStraightAndSideways:"Ande em frente e para os lados",changeHeight:"Variar altura",switchView:"Alternar entre cenas",screenshot:"Captura de imagem",illuminationPreview:"Visualiza\u00e7\u00e3o de ilumina\u00e7\u00e3o",hideShowMenu:"Ocultar/mostrar menu",hideShowMousePointer:"Ocultar/mostrar a seta do mouse",vrMode:"Modo VR",gazeAtFixedPlace:"Olhe para um lugar fixo",clickControllerButton:"Clique num bot\u00e3o controlador",teleport:"Teletransporte",touch:"Toque"}};WALK.STRINGS.Turkish={help:{basic:"Basit",advanced:"\u0130leri D\u00fczey",mouse:"Fare",or:"veya",keyboard:"Klavye",vrTeleport:"VR I\u015f\u0131nlanma",holdLeftButton:"Sol tu\u015fa bas\u0131l\u0131 tut",clickLeftButton:"Sol tu\u015fa t\u0131kla",lookAround:"\u00c7evrene bak",walkToClickedPlace:"T\u0131klad\u0131\u011f\u0131n alana y\u00fcr\u00fc",selectMaterialLightObject:"Materyal, \u0131\u015f\u0131k veya obje se\u00e7",scroll:"A\u015fa\u011f\u0131 kayd\u0131r",walkStraight:"D\u00fcz y\u00fcr\u00fc",
walkStraightAndLookAround:"D\u00fcz y\u00fcr\u00fc ve \u00e7evrene bak\u0131n",walkStraightAndSideways:"D\u00fcz ve yanlana do\u011fru y\u00fcr\u00fc",changeHeight:"Y\u00fckseklik de\u011fi\u015ftir",switchView:"G\u00f6r\u00fcn\u00fcm de\u011fi\u015ftir",screenshot:"Ekran G\u00f6r\u00fcnt\u00fcs\u00fc",illuminationPreview:"Ayd\u0131nlatma \u00f6nizlemesi",hideShowMenu:"Men\u00fcy\u00fc g\u00f6ster/gizle",hideShowMousePointer:"\u0130mleci g\u00f6ster/gizle",vrMode:"VR Modu",gazeAtFixedPlace:"Bir noktaya kitlenerek bak",
clickControllerButton:"Kumanda butonuna t\u0131kla",teleport:"I\u015f\u0131nlan",touch:"Dokun"}};var Ok=WALK.cloneObject(WALK.STRINGS[WALK.DEFAULT_LANGUAGE]);function Pk(){for(var a=document.querySelectorAll("[data-strings]"),b=0;b<a.length;++b){var c=a.item(b);a:{var d=c.getAttribute("data-strings").split(".");for(var e=Ok,f=0;f<d.length;f++)if(e=e[d[f]],!e){d=null;break a}d="string"===typeof e?e:null}c.textContent=d}}
WALK.updateViewerStrings=function(a){function b(c,d,e){Object.keys(d).forEach(function(f){var g=""===e?f:e+"."+f;if(void 0===c[f])console.warn("Viewer string "+g+" doesn\u2019t exist");else if(typeof c[f]!==typeof d[f])console.error(g+" should be "+typeof c[f]);else switch(typeof d[f]){case "string":c[f]=d[f];break;case "object":b(c[f],d[f],g)}})}b(Ok,a,"");Pk()};WALK.getViewerStrings=function(){return WALK.readOnlyCopy(Ok)};Pk();WALK.ExtensionManager=function(){this.extensionTypes=WALK.Extensions};WALK.ExtensionManager.getExtensionDefinition=function(a){return WALK.Extensions[a].definition};
WALK.ExtensionManager.prototype={constructor:WALK.ExtensionManager,updateConfig:function(a){this.extensions=[];a=m.makeIterator(a);for(var b=a.next();!b.done;b=a.next())this._createExtensionFromConfig(b.value)},_createExtensionFromConfig:function(a){function b(k,h){return k.some(function(l){return l.name===h&&l.config.type===a.type})}var c=this;a.name=a.name.toString();for(var d=a.name,e=2;b(this.extensions,a.name);)a.name=d+e.toString(),e+=1;var f=new this.extensionTypes[a.type](a);if(f.isTriggerExclusive()){console.assert(f.isTriggerable());
var g=f.trigger;f.trigger=function(k){!1!==k&&c.extensions.forEach(function(h){h!==f&&h.isTriggerExclusive()&&h.trigger(!1)});g.call(f,k)}}this.extensions.push(f);return f},startExtensions:function(){var a=this;this._loadFontAwesomeIfNeeded(function(){for(var b=0;b<a.extensions.length;b+=1)a.extensions[b].start()})},_loadFontAwesomeIfNeeded:function(a){var b=this,c=this.extensions.map(function(d){return b._getFonts(d.config)}).concat(WALK.FONT_FAMILIES_TO_LOAD).reduce(function(d,e){return d.concat(e)},
[]).filter(function(d,e,f){return e===f.indexOf(d)});0<c.length&&!WALK.EDIT_MODE?WALK.loadFontFamilies(c,a,a):a()},_getFonts:function(a){for(var b=[],c=m.makeIterator(this.extensionTypes[a.type].definition.properties),d=c.next();!d.done;d=c.next())if(d=d.value,"trigger"===d.type&&a[d.id])d=a[d.id],(d=d.icon&&WALK.ICONS[d.icon].fontFamily)&&b.push(d);else if("list"===d.type&&"trigger"===d.elementType&&a[d.id]){d=m.makeIterator(a[d.id]);for(var e=d.next();!e.done;e=d.next())e=e.value,(e=e.icon&&WALK.ICONS[e.icon].fontFamily)&&
b.push(e)}return b},stopExtensions:function(){for(var a=0;a<this.extensions.length;a+=1)this.extensions[a].stop()},getEditableExtensionDefinitions:function(){for(var a=[],b=m.makeIterator(Object.entries(this.extensionTypes||{})),c=b.next();!c.done;c=b.next()){var d=m.makeIterator(c.value);c=d.next().value;d=d.next().value;d.definition.hideFromEditor||a.push({type:c,definition:d.definition})}return a},getEditableExtensions:function(){for(var a=[],b=m.makeIterator(this.extensions),c=b.next();!c.done;c=
b.next())c=c.value,c.definition.hideFromEditor||a.push(c);return a},addExtension:function(a){a=this._createExtensionFromConfig(a);a.start();return a},removeExtension:function(a){a.stop();for(var b=0;b<this.extensions.length;b+=1)if(this.extensions[b]===a){this.extensions.splice(b,1);break}},getConfig:function(){return this.extensions.map(function(a){return a.config})},getExtension:function(a,b){for(var c=m.makeIterator(this.extensions),d=c.next();!d.done;d=c.next())if(d=d.value,d.type===a&&d.name===
b)return d;console.error("Unrecognized extension "+a+" "+b+", supported types: "+Object.keys(this.extensionTypes))}};var Qk=WALK.EDIT_MODE;function Rk(){}
var Sk={"\uf2b9":"address-book","\uf2bb":"address-card","\uf1fe":"area-chart","\uf047":"arrows","\uf062":"arrow-up","\uf063":"arrow-down","\uf2a2":"assistive-listening-systems","\uf069":"asterisk","\uf29e":"audio-description","\uf1fa":"at","\uf0c9":"bars","\uf0f3":"bell","\uf02d":"book","\uf02e":"bookmark","\uf0a1":"bullhorn","\uf1ec":"calculator","\uf030":"camera","\uf080":"chart-bar","\uf200":"chart-pie","\uf0c2":"cloud","\uf013":"cog","\uf075":"comment","\uf14e":"compass","\uf09d":"credit-card",
"\uf05b":"crosshairs","\uf019":"download","\uf0e0":"envelope","\uf08e":"external-link","\uf06e":"eye","\uf1fb":"eye-dropper","\uf008":"film","\uf024":"flag","\uf07b":"folder","\uf06b":"gift","\uf025":"headphones","\uf015":"home","\uf03e":"image","\uf090":"sign-in","\uf129":"info","\uf0eb":"lightbulb","\uf0d0":"magic","\uf076":"magnet","\uf041":"map-marker","\uf276":"map-pin","\uf277":"map-signs","\uf1fc":"paint-brush","\uf040":"pencil","\uf095":"phone","\uf128":"question","\uf064":"share","\uf1e0":"share-alt",
"\uf07a":"shopping-cart","\uf1de":"sliders","\uf005":"star","\uf0e4":"tachometer","\uf02b":"tag","\uf03d":"video","\uf0ad":"wrench","\uf04b":"play","\uf16a":"youtube","\uf27d":"vimeo","\uf09a":"facebook","\uf099":"twitter","\uf16d":"instagram"};function Tk(){console.error("This extension cannot be triggered on/off")}
var Uk=new function(){var a=new Map;this.onNodeTypeClicked=function(b,c){function d(f){return function(g,k,h){var l=a.get(f);console.assert(l,"listenerMulti not found for "+f);l.listeners.forEach(function(n){try{n(g,k,h)}catch(r){console.error(r)}});return!0}}var e=a.get(b);e?e.listeners.push(c):(e=d(b),a.set(b,{listenerMulti:e,listeners:[c]}),WALK.getViewer().onNodeTypeClicked(b,e))};this.removeOnNodeTypeClicked=function(b,c){var d=a.get(b);console.assert(d,"listenerMulti not registered for "+b);
c=d.listeners.indexOf(c);console.assert(0<=c,"listener not registered for "+b);d.listeners.splice(c,1);0===d.listeners.length&&(WALK.getViewer().removeOnNodeTypeClicked(b,d.listenerMulti),a.delete(b))}};
WALK.Extension=function(a){function b(f){return c.definition.properties.some(function(g){return g.id===f})}var c=this;this.triggers=[];var d=[];this.definition=this.constructor.definition;this.viewerApi=WALK.getViewer();this.running=!1;var e=[];this.config=WALK.readOnlyCopy(function(f){f=WALK.cloneObject(f);if(void 0!==f.anchor&&void 0===f.trigger&&!b("anchor")&&b("trigger")){var g=f.anchor;g.icon&&g.icon.font&&(g.icon=Sk[g.icon.value]);f.trigger=g;f.anchor=void 0}g=m.makeIterator(c.definition.properties);
for(var k=g.next();!k.done;k=g.next())k=k.value,void 0===f[k.id]&&void 0!==k.defaultValue&&(f[k.id]=k.defaultValue);return f}(a));Object.defineProperty(this,"name",{get:function(){return this.config.name}});Object.defineProperty(this,"type",{get:function(){return this.config.type}});Object.defineProperty(this,"vrCompatible",{get:function(){return this.definition.vrCompatible},configurable:!0});this.cloneConfig=function(){return WALK.cloneObject(this.config)};this.updateConfig=function(f){this.stop();
this.config=WALK.readOnlyCopy(f);this.start()};this.doStop=this.doStart=Rk;this.trigger=Tk;this.start=function(){this.running||(this.doStart(),this.running=!0)};this.stop=function(){if(this.running){this.doStop();for(var f=m.makeIterator(d),g=f.next();!g.done;g=f.next())this.viewerApi.removeAnchor(g.value);f=m.makeIterator(e);for(g=f.next();!g.done;g=f.next())g=g.value,Uk.removeOnNodeTypeClicked(g[0],g[1]);e.length=0;this.triggers.length=0;d.length=0;this.running=!1}};this._vrChanged=function(f){f&&
!this.vrCompatible?this.stop():f||this.vrCompatible||this.start()};this.addTrigger=function(f,g){"node"===f.type?(f=f.nodeType,e.push([f,g]),Uk.onNodeTypeClicked(f,g),this.triggers.push.apply(this.triggers,m.arrayFromIterable(this.viewerApi.findNodesOfType(f)))):(g=this.viewerApi.addAnchor(f,g),g.extension=this,d.push(g),this.triggers.push(g))};this.isTriggerable=function(){return this.trigger!==Tk};this.isTriggerExclusive=function(){return!!this.config.triggerExclusive};this.viewerApi.onVrChange(this._vrChanged.bind(this))};
WALK.Extensions.HtmlLabel=function(a){function b(){f=null;WALK.Extensions.HtmlLabel._activeLabel===e&&(WALK.Extensions.HtmlLabel._activeLabel=null,d())}function c(g){if(g instanceof HTMLVideoElement||g instanceof HTMLIFrameElement)return!0;g=m.makeIterator(g.children);for(var k=g.next();!k.done;k=g.next())if(c(k.value))return!0;return!1}function d(){WALK.Extensions.HtmlLabel._animatedMaterialsAreSleeping&&(e.viewerApi.wakeAnimatedMaterials(),WALK.Extensions.HtmlLabel._animatedMaterialsAreSleeping=
!1)}var e=this;WALK.Extension.call(this,a);var f=null;this.trigger=function(g){var k=WALK.Extensions.HtmlLabel._activeLabel===this;!0===g&&k||!1===g&&!k||(k?(console.assert(null!==f),f.close()):(WALK.Extensions.HtmlLabel._activeLabel=this,f=this.viewerApi.openPopup(this.config.content,this.config,b),g=document.createElement("div"),g.innerHTML=this.config.content,c(g)?WALK.Extensions.HtmlLabel._animatedMaterialsAreSleeping||(e.viewerApi.sleepAnimatedMaterials(),WALK.Extensions.HtmlLabel._animatedMaterialsAreSleeping=
!0):d()))};this.doStart=function(){var g=this;g.viewerApi.onSceneReadyToDisplay(function(){g.config.trigger&&g.addTrigger(g.config.trigger,function(){return g.trigger()})})};this.doStop=function(){null!==f&&f.close()}};
WALK.Extensions.HtmlLabel.definition={name:"HTML label",properties:[{id:"trigger",type:"trigger",label:"Trigger",optional:!0},{id:"content",type:"textArea",label:"Content",optional:!0,defaultValue:"Content to display..."},{id:"centerHorizontally",type:"bool",label:"Center horizontally",defaultValue:!1},{id:"centerVertically",type:"bool",label:"Center vertically",defaultValue:!1},{id:"padding",type:"bool",label:"Padding",defaultValue:!0}],vrCompatible:!1};WALK.Extensions.HtmlLabel._activeLabel=null;
WALK.Extensions.HtmlLabel._animatedMaterialsAreSleeping=!1;
WALK.Extensions.Audio=function(a){function b(){d.trigger()}function c(){var r=d.config;r.trigger&&d.addTrigger(r.trigger,b);r.menuButton&&(h=e.addMenuButton(g.src),h.addEventListener("click",b),l=e.getMenuButtonIcon(h));if(r.autoplay)d.viewerApi.onNextPageInteraction(function(){b()})}a.url&&!a.file&&(a.file={file:a.url.split("/").pop(),url:a.url},delete a.url);a.file.path&&a.file.url&&delete a.file.url;WALK.Extension.call(this,a);var d=this,e=this.viewerApi,f=null,g=null,k=null,h=null,l=null,n=!1;
this.trigger=function(r){!0===r&&n||!1===r&&!n||(n?k.pause():(d.config.playRewinds&&(k.currentTime=0),k.play()))};this.doStart=function(){WALK.log("Audio start");this.config.menuButton&&!f&&(f=WALK.preloadImage(e.getViewerAssetUrl("img/audio-on.svg")),g=WALK.preloadImage(e.getViewerAssetUrl("img/audio-off.svg")));k=document.createElement("audio");this.config.file&&(this.config.file.path?k.src=WALK.getExtraAssetUrl(this.config.file.path):this.config.file.url&&(k.src=this.config.file.url));k.src&&(k.loop=
this.config.loop,k.addEventListener("play",function(){n=!0;l&&(l.src=f.src)}),k.addEventListener("pause",function(){n=!1;l&&(l.src=g.src)}),document.body.appendChild(k),e.onSceneReadyToDisplay(c))};this.doStop=function(){WALK.log("Audio stop");n=!1;h&&(this.viewerApi.removeMenuButton(h),l=h=null);k.pause();k.remove();k=null}};
WALK.Extensions.Audio.definition={name:"Audio",properties:[{id:"file",type:"file",label:"File",fileType:"audio"},{id:"autoplay",type:"bool",label:"Autoplay",defaultValue:!1},{id:"triggerExclusive",type:"bool",label:"Exclusive",defaultValue:!1},{id:"playRewinds",type:"bool",label:"Play rewinds",defaultValue:!1},{id:"loop",type:"bool",label:"Loop",defaultValue:!0},{id:"menuButton",type:"bool",label:"Show menu button",defaultValue:!0},{id:"trigger",type:"trigger",label:"Trigger",optional:!0}],vrCompatible:!0};
function Vk(a,b){var c=new G.Vector3,d=new G.Vector3;if(b&&"node"!==b.type){c.fromArray(b.position);var e=b.radius}else e=WALK.Extensions.MaterialPicker.VR_RADIUS;this.getPosition=function(f){b&&"node"!==b.type||(d.copy(a.getCameraPosition()),d.sub(f),d.normalize().multiplyScalar(e),c.copy(f).add(d));return c};this.getRadius=function(){return e}}
WALK.Extensions.MaterialPicker=function(a){function b(){return(k.config.toReplace?[k.config.toReplace]:[]).concat(k.config.toPick||[])}function c(){return b().map(function(r){return k.viewerApi.findMaterial(r)})}function d(r){k.viewerApi.apiUserChangeState(n,r.name)}function e(r,v){console.assert(r===n);if(r=k.viewerApi.findMaterial(v))for(v=0;v<h.length;v+=1)k.viewerApi.setMaterialForMesh(r,h[v])}function f(r,v){k.triggerAtPosition(void 0,v)}function g(){k.config.trigger&&k.addTrigger(k.config.trigger,
f);h=k.viewerApi.findMeshesWithMaterial(k.config.toReplace||[])}WALK.Extension.call(this,a);var k=this,h=[],l=new Vk(k.viewerApi,k.config.trigger),n="MaterialPicker:"+this.name;this.config.materials&&(a=WALK.cloneObject(this.config),0<a.materials.length&&(a.toReplace=a.materials[0],a.toPick=a.materials.slice(1)),a.materials=void 0,this.config=WALK.readOnlyCopy(a));k.viewerApi.isSceneReadyToDisplay()||b().map(function(r){k.viewerApi.setMaterialEditable(r)});this.trigger=function(r){!1!==r&&k.viewerApi.openMaterialPicker(c(),
d)};this.triggerAtPosition=function(r,v){!1!==r&&k.viewerApi.openMaterialPicker(c(),d,null,l.getPosition(v),l.getRadius())};this.doStart=function(){this.viewerApi.onSceneReadyToDisplay(g);this.viewerApi.onApiUserStateChanged(n,e)};this.doStop=function(){var r=k.viewerApi.findMaterial(k.config.toReplace);r&&d(r);this.viewerApi.removeOnApiUserStateChanged(n,e)}};WALK.Extensions.MaterialPicker.VR_RADIUS=.07;
WALK.Extensions.MaterialPicker.definition={name:"Material picker",properties:[{id:"toReplace",type:"material",label:"Material to replace"},{id:"toPick",type:"list",elementType:"material",label:"Materials to pick"},{id:"trigger",type:"trigger",label:"Trigger",optional:!0}],vrCompatible:!0};
WALK.Extensions.MaterialComboPicker=function(a){function b(){for(var J=new Set,W=m.makeIterator(H),M=W.next();!M.done;M=W.next()){M=m.makeIterator(M.value);for(var ba=M.next();!ba.done;ba=M.next())ba=ba.value,J.add(ba.toReplace),J.add(ba.toUse)}return J}function c(){for(var J=[H[0][0].toReplace],W=m.makeIterator(H),M=W.next();!M.done;M=W.next())J.push(M.value[0].toUse);return J}function d(){return c().map(function(J){return D.findMaterial(J)})}function e(){if(-1!==K)for(var J=0;J<H[K].length;++J){var W=
H[K][J],M=D.findMaterial(W.toUse);W=D.findMaterial(W.toReplace);M.setUvOffsetAndScale(u[M]);M.setUniforms();M=m.makeIterator(p[K][J]);for(var ba=M.next();!ba.done;ba=M.next())D.setMaterialForMesh(W,ba.value)}}function f(J,W){D.apiUserChangeState(B,W)}function g(J,W){console.assert(J===B);e();if(0!==W)for(K=W-1,J=0;J<H[K].length;++J){var M=H[K][J];W=D.findMaterial(M.toUse);var ba=u[W];W.setUvOffsetAndScale(ba.x,ba.y,ba.z*(M.uvScale?M.uvScale[0]:w[0]),ba.w*(M.uvScale?M.uvScale[1]:w[1]));W.setUniforms();
M=m.makeIterator(p[K][J]);for(ba=M.next();!ba.done;ba=M.next())D.setMaterialForMesh(W,ba.value)}}function k(){WALK.Extensions.MaterialComboPicker._menuPopup.close();WALK.Extensions.MaterialComboPicker._menuPopup=null}function h(){WALK.Extensions.MaterialComboPicker._pickerOpened=!1}function l(J,W){WALK.Extensions.MaterialComboPicker._menuPopup&&k();J=d();D.openMaterialPicker(J,f,h,y.getPosition(W),y.getRadius());WALK.Extensions.MaterialComboPicker._pickerOpened=!0}function n(){for(var J=m.makeIterator(v.config.triggers),
W=J.next();!W.done;W=J.next())v.addTrigger(W.value,l);for(J=0;J<H.length;++J){p[J]=[];W=m.makeIterator(H[J]);for(var M=W.next();!M.done;M=W.next()){M=M.value;var ba=M.toUse;p[J].push(D.findMeshesWithMaterial(M.toReplace));M=D.findMaterial(ba);u.has(M)||(ba=new G.Vector4,u[M]=M.getUvOffsetAndScale(ba))}}}function r(){var J=WALK.Extensions.MaterialComboPicker._startedPickers;console.assert(0<J.length);WALK.Extensions.MaterialComboPicker._pickerOpened&&D.closeMaterialPicker();if(WALK.Extensions.MaterialComboPicker._menuPopup)k();
else{var W=document.createElement("div");W.innerHTML='\n        <div class="ext-material-combo-picker-menu-title">\n          <img src="'+D.getViewerAssetUrl("img/sliders-horizontal.svg")+'">\n        </div>\n        <ul class="ext-material-combo-picker-menu-list">\n          <li class="ext-material-combo-picker-menu-item"></li>\n        </ul>';for(var M=W.getElementsByClassName("ext-material-combo-picker-menu-list")[0],ba=M.getElementsByClassName("ext-material-combo-picker-menu-item")[0],ha={},ta=
0;ta<J.length;ha={$jscomp$loop$prop$picker$187:ha.$jscomp$loop$prop$picker$187},++ta)0<ta&&(ba=ba.cloneNode(!0),M.appendChild(ba)),ha.$jscomp$loop$prop$picker$187=J[ta],WALK.setTextContent(ba,ha.$jscomp$loop$prop$picker$187.name),ba.addEventListener("click",function(I){return function(){I.$jscomp$loop$prop$picker$187._openFromMenu()}}(ha));WALK.Extensions.MaterialComboPicker._menuPopup=WALK.openPopup(W,{centerHorizontally:!0,centerVertically:!0},function(){WALK.Extensions.MaterialComboPicker._menuPopup=
null})}}WALK.Extension.call(this,a);var v=this,p=[],w=[1,1],u=new Map,y=new Vk(v.viewerApi),B="MaterialComboPicker:"+this.name,D=this.viewerApi,H=v.config.options,K=-1;D.isSceneReadyToDisplay()||b().forEach(function(J){D.setMaterialEditable(J)});this._openFromMenu=function(){k();var J=d();D.openMaterialPicker(J,f);WALK.Extensions.MaterialComboPicker._pickerOpened=!0};this.doStart=function(){D.onSceneReadyToDisplay(n);D.onApiUserStateChanged(B,g);var J=WALK.Extensions.MaterialComboPicker._startedPickers;
J.push(this);1===J.length&&(J=D.addMenuButton(D.getViewerAssetUrl("img/sliders-horizontal.svg")),J.addEventListener("click",r),WALK.Extensions.MaterialComboPicker._menuButton=J)};this.doStop=function(){e();this.viewerApi.removeOnApiUserStateChanged(B,g);var J=WALK.Extensions.MaterialComboPicker._startedPickers;J.splice(J.indexOf(this),1);0===J.length&&(D.removeMenuButton(WALK.Extensions.MaterialComboPicker._menuButton),WALK.Extensions.MaterialComboPicker._menuButton=null)}};
WALK.Extensions.MaterialComboPicker.definition={name:"Material combo picker",hideFromEditor:!0,properties:[{id:"triggers",type:"list",label:"Triggers",elementType:"trigger"},{id:"options",type:"list",label:"Options",elementType:{type:"list",label:"option",elementType:[{id:"toReplace",type:"material",label:"Material to replace"},{id:"toUse",type:"material",label:"Material to use"},{id:"uvScale",type:"list",label:"UV Scale",elementType:"float"}]}}],vrCompatible:!0};
WALK.Extensions.MaterialComboPicker._startedPickers=[];WALK.Extensions.MaterialComboPicker._menuButton=null;WALK.Extensions.MaterialComboPicker._menuPopup=null;WALK.Extensions.MaterialComboPicker._pickerOpened=!1;
WALK.Extensions.VideoTextureControl=function(a){function b(){var f=e.baseColorTexture,g=d.config;f.loop=g.loop;if(!g.autoplay)e.pause(),f.muted=g.muted;else if(!g.muted)d.viewerApi.onNextPageInteraction(function(){f.muted=!1});g.trigger&&d.addTrigger(g.trigger,function(){return d.trigger()})}function c(){var f=d.config;(e=d.viewerApi.findMaterial(f.material))?e.baseColorTexture&&e.baseColorTexture instanceof WALK.VideoTexture?e.baseColorTexture.addLoadedListener(b):(console.error("Material '"+f.material+
"' for video texture control '"+(f.name+"' does not have a video texture")),e=null):console.error("Material '"+f.material+"' for video texture control '"+(f.name+"' does not exist"))}WALK.Extension.call(this,a);var d=this,e=null;this.viewerApi.isSceneReadyToDisplay()||this.viewerApi.setMaterialEditable(this.config.material);this.trigger=function(f){!0===f&&e.isPlaying||!1===f&&!e.isPlaying||(e.isPlaying?e.pause():(d.config.playRewinds&&e.rewind(),e.play()))};this.doStart=function(){this.viewerApi.onSceneLoadComplete(c)};
this.doStop=function(){e&&(e.baseColorTexture.muted=!0,e.pause(),e=null)}};
WALK.Extensions.VideoTextureControl.definition={name:"Video texture control",properties:[{id:"material",type:"material",label:"Material with video"},{id:"trigger",type:"trigger",label:"Trigger",optional:!0},{id:"autoplay",type:"bool",label:"Autoplay",defaultValue:!0},{id:"triggerExclusive",type:"bool",label:"Exclusive",defaultValue:!1},{id:"playRewinds",type:"bool",label:"Play rewinds",defaultValue:!1},{id:"loop",type:"bool",label:"Loop",defaultValue:!0},{id:"muted",type:"bool",label:"Muted",defaultValue:!0}],
vrCompatible:!0};WALK.Extensions.OpenWebsite=function(a){WALK.Extension.call(this,a);var b=this;this.trigger=function(){b.viewerApi.openUrl(b.config.url,b.config.newWindow)};this.doStart=function(){this.viewerApi.onSceneReadyToDisplay(function(){b.config.trigger&&b.addTrigger(b.config.trigger,function(){return b.trigger()})})}};
WALK.Extensions.OpenWebsite.definition={name:"Open URL",properties:[{id:"url",type:"text",label:"URL"},{id:"newWindow",type:"bool",label:"New window",defaultValue:!0},{id:"trigger",type:"trigger",label:"Trigger",optional:!0}],vrCompatible:!0};
WALK.Extensions.ChangeView=function(a){WALK.Extension.call(this,a);var b=this,c=0;this.trigger=function(){b.viewerApi.switchToView(b.config.views[c],void 0,b.config.doNotMoveCamera);c=(c+1)%b.config.views.length};this.doStart=function(){var d=this.viewerApi;c=0;d.onSceneReadyToDisplay(function(){b.config.trigger&&b.addTrigger(b.config.trigger,function(){return b.trigger()})})}};
WALK.Extensions.ChangeView.definition={name:"Change view",properties:[{id:"views",type:"list",elementType:"view",label:"Views to toggle"},{id:"doNotMoveCamera",type:"bool",label:"Do not move camera",defaultValue:!1},{id:"trigger",type:"trigger",label:"Trigger",optional:!0}],vrCompatible:!0};
WALK.Extensions.HideAnchors=function(a){function b(h){k.src=h?e.src:f.src}WALK.Extension.call(this,a);var c=this,d=c.viewerApi,e=WALK.preloadImage(d.getViewerAssetUrl("img/anchors-on.svg")),f=WALK.preloadImage(d.getViewerAssetUrl("img/anchors-off.svg")),g=null,k=null;this.trigger=function(h){!0===h&&d.anchorsVisible||!1===h&&!d.anchorsVisible||(d.anchorsVisible=!d.anchorsVisible)};this.doStart=function(){d=c.viewerApi;d.onAnchorsVisibilityChanged(b);g=d.addMenuButton(e.src);k=d.getMenuButtonIcon(g);
g.addEventListener("click",function(){return c.trigger()});var h=c.config;d.onSceneReadyToDisplay(function(){return d.anchorsVisible=h.visibleOnStart})};this.doStop=function(){d.removeAnchorsVisibilityChangedListener(b);d.removeMenuButton(g);k=g=null;d.anchorsVisible=!0}};WALK.Extensions.HideAnchors.definition={name:"Hide triggers",properties:[{id:"visibleOnStart",type:"bool",label:"Visible on start",defaultValue:!0}],vrCompatible:!0};
WALK.Extensions.Script=function(a){function b(){c.trigger()}WALK.Extension.call(this,a);var c=this;this.trigger=function(){try{(new Function('"use strict"; '+c.config.code))()}catch(d){console.error("Script extension error: "+d)}};this.doStart=function(){var d=this;if(this.config.trigger)this.viewerApi.onSceneReadyToDisplay(function(){return d.addTrigger(d.config.trigger,b)});else b()}};
WALK.Extensions.Script.definition={name:"Script",properties:[{id:"code",type:"textArea",label:"Code",defaultValue:"\x3c!-- Put your JavaScript code here. If a trigger is set, the code is executed when the trigger is clicked. Otherwise the code is executed when a page is loaded --\x3e"},{id:"trigger",type:"trigger",label:"Trigger",optional:!0}],vrCompatible:!0};
WALK.Extensions.ProjectionScreen=function(a){function b(){var w=p.getVideoTexture1();r.baseColorTexture=w?w:v}function c(){WALK.log("Presentation stop");p&&(p.uuid===n.myUuid&&n.stopShareScreen(),p.removeEventListener("dispose",c),p.removeEventListener("avatarUpdated",b));p=null;r.baseColorTexture=v;h.triggers[0].material.highlightMix=0}function d(){(new WALK.Popup("In a 3D meeting this trigger will start a screen sharing on the "+(h.config.material+" material. Outside of a 3D meeting the trigger will be hidden."),
{padding:!0,centerVertically:!0,centerHorizontally:!0})).open()}function e(){var w=n.myUuid;p&&p.getVideoTexture1()?p.uuid===w&&(WALK.log("Requesting presentation stop"),h.viewerApi.apiUserChangeState(l,null)):(WALK.log("Requesting screen share "+w),n.startShareScreen(function(){h.viewerApi.apiUserChangeState(l,w)},function(){h.viewerApi.apiUserChangeState(l,null)},function(){}))}function f(w,u){console.assert(w===l);u?(p&&p.uuid!==u&&(WALK.log("Changing presenting user"),c()),p||(WALK.log("New presenting user "+
u),(p=h.viewerApi.findAvatar(u)||null)?(p.addEventListener("dispose",c),p.addEventListener("avatarUpdated",b),w=h.triggers[0].material,w.highlight=p.getMainMaterial().baseColor,w.setUniforms(),w.highlightMix=.7,b()):console.log("Cannot attach presentation stream of a user "+u+" The user was not found."))):c()}function g(){f(l,h.viewerApi.getApiUserState(l))}function k(w){var u=h.config;(r=h.viewerApi.findMaterial(u.material))?(n=w,v=r.baseColorTexture,h.addTrigger(u.trigger,e),h.viewerApi.onApiUserStateChanged(l,
f),h.viewerApi._onAvatarListChanged(g)):(console.error("Material for a projection screen is missing"),r=null)}WALK.Extension.call(this,a);var h=this,l="ProjectionScreen:"+this.name,n=null,r=null,v=null,p=null;this.viewerApi.isSceneReadyToDisplay()||this.viewerApi.setMaterialEditable(this.config.material);this.doStart=function(){Qk?h.addTrigger(h.config.trigger,d):this.viewerApi._onMeetingJoined(k)};this.doStop=function(){Qk||(this.viewerApi._removeOnMeetingJoined(k),n&&(this.viewerApi.removeOnApiUserStateChanged(l,
f),this.viewerApi._removeOnAvatarListChanged(g)),r=n=null)}};WALK.Extensions.ProjectionScreen.definition={name:"Meeting projection screen",properties:[{id:"material",type:"material",label:"Material to project on"},{id:"trigger",type:"trigger",label:"Trigger"}],vrCompatible:!0};
WALK.Extensions.SwitchObjects=function(a){WALK.Extension.call(this,a);var b=this,c=this.viewerApi,d,e;if(!c.isSceneReadyToDisplay()){a=m.makeIterator(this.config.nodeTypes);for(var f=a.next();!f.done;f=a.next())c.setNodeTypeEditable(f.value)}this.trigger=function(){if(0!==b.config.nodeTypes.length){for(var g=m.makeIterator(e),k=g.next();!k.done;k=g.next())k.value.hide();d+=1;if(d===b.config.nodeTypes.length){if(b.config.hideAllAfterLast){d=-1;e.length=0;c.requestFrame();return}d=0}e=c.findNodesOfType(b.config.nodeTypes[d]);
g=m.makeIterator(e);for(k=g.next();!k.done;k=g.next())k.value.show();c.requestFrame()}};this.doStart=function(){var g=this;c.onSceneReadyToDisplay(function(){for(var k=0;k<g.config.nodeTypes.length;++k)if(0<k||g.config.hideAllOnStart){var h=c.findNodesOfType(g.config.nodeTypes[k]),l=m.makeIterator(h);for(h=l.next();!h.done;h=l.next())h.value.hide()}if(0<g.config.nodeTypes.length&&!g.config.hideAllOnStart)for(d=0,e=c.findNodesOfType(g.config.nodeTypes[0]),k=m.makeIterator(e),h=k.next();!h.done;h=k.next())h.value.show();
else d=-1,e=[];g.config.trigger&&g.addTrigger(g.config.trigger,function(){return b.trigger()});c.requestFrame()})};this.doStop=function(){for(var g=0;g<this.config.nodeTypes.length;++g)if(g!==d){var k=c.findNodesOfType(this.config.nodeTypes[g]);k=m.makeIterator(k);for(var h=k.next();!h.done;h=k.next())h.value.show()}c.requestFrame()}};
WALK.Extensions.SwitchObjects.definition={name:"Switch objects",properties:[{id:"nodeTypes",type:"list",elementType:"nodeType",label:"Objects to switch"},{id:"trigger",type:"trigger",label:"Trigger",optional:!0},{id:"hideAllOnStart",type:"bool",label:"Hide all on start",defaultValue:!1},{id:"hideAllAfterLast",type:"bool",label:" Hide all after last",defaultValue:!1}],vrCompatible:!0};
WALK.Extensions.VideoStream=function(a){function b(){function l(n){var r=document.createElement("video");r.classList.add("video-js");r.autoplay=!0;r.muted=!0;r.type="application/x-mpegURL";if(Hls.isSupported()){var v=new Hls;v.loadSource(n);v.attachMedia(r)}else r.canPlayType("application/vnd.apple.mpegurl")?r.src=n:console.log("No Hls support");return k.createStreamTextureFromHtmlVideo(r)}(function(){var n=l(h.config.streamUrl);n.addLoadedListener(function(){g=!1;h.running&&(console.log(n),d=e.baseColorTexture,
e.baseColorTexture=n,h.viewerApi.onNextPageInteraction(function(){n.muted=!1}),f=!0)});g=!0;WALK.DETECTOR.mobile?h.viewerApi.onNextPageInteraction(function() {n.play()}):n.play();return!0})()}function c(){var l=h.config;(e=k.findMaterial(l.material))?e.baseColorTexture?WALK.loadScriptAndExecute(WALK.getViewerAssetUrl("lib/Hls.js"),function(){l.trigger&&h.addTrigger(l.trigger,function(){return h.trigger()});!l.autoplay&&l.trigger||h.trigger()},function(){return WALK.USER_MSG.error("Cannot load required library")}):(console.error("Material '"+l.material+"' for stream texture control '"+
(l.name+"' does not have a stream texture")),e=null):console.error("Material '"+l.material+"' for stream texture control '"+(l.name+"' does not exist"))}WALK.Extension.call(this,a);var d=null,e=null,f=!1,g=!1,k=WALK.getViewer(),h=this;this.viewerApi.isSceneReadyToDisplay()||this.viewerApi.setMaterialEditable(this.config.material);this.trigger=function(l){g||(f||g?!0===l&&e.isPlaying||!1===l&&!e.isPlaying||(e.isPlaying?e.pause():(h.config.playRewinds&&e.rewind(),e.play())):!1!==l&&b())};this.doStart=
function(){this.viewerApi.onSceneLoadComplete(c)};this.doStop=function(){if(e){if(f){f=!1;var l=e.baseColorTexture;e.baseColorTexture=d;l.dispose();d=null}e=null}}};
WALK.Extensions.VideoStream.definition={name:"Video Stream",properties:[{id:"material",type:"material",label:"Material with stream"},{id:"streamUrl",type:"text",label:"Stream URL"},{id:"trigger",type:"trigger",label:"Trigger",defaultValue:!1,optional:!0},{id:"autoplay",type:"bool",label:"Autoplay",defaultValue:!0},{id:"triggerExclusive",type:"bool",label:"Exclusive",defaultValue:!1},{id:"playRewinds",type:"bool",label:"Play rewinds",defaultValue:!1}],vrCompatible:!0};
function Wk(a){var b=m.makeIterator(a.split(":"));a=b.next().value;b=b.next().value;return[a,b]}
WALK.Extensions.MultiTrigger=function(a){function b(){return e.config.extensions.map(function(k){var h=m.makeIterator(Wk(k));k=h.next().value;h=h.next().value;return f.getExtension(k,h)}).filter(function(k){return k})}function c(k,h){k=m.makeIterator(b());for(var l=k.next();!l.done;l=k.next()){l=l.value;try{l.triggerAtPosition?l.triggerAtPosition(g,h):l.trigger(g)}catch(n){console.error("Failed to trigger an extension "+n)}}g=!g}function d(){var k=e.config;k.trigger&&e.addTrigger(k.trigger,c)}WALK.Extension.call(this,
a);var e=this,f=this.viewerApi,g=!0;Object.defineProperty(this,"vrCompatible",{get:function(){for(var k=m.makeIterator(b()),h=k.next();!h.done;h=k.next())if(!h.value.vrCompatible)return!1;return!0}});this.doStart=function(){f.onSceneReadyToDisplay(d);g=!0}};
WALK.Extensions.MultiTrigger.definition={name:"Multi trigger",getListElementsToAdd:function(a,b,c){console.assert("extensions"===a);var d=new Set(b.map(function(e){return Wk(e)[0]}));return c.getEditableExtensions().filter(function(e){return e.isTriggerable()&&("VideoTextureControl"===e.type||"SwitchObjects"===e.type||!d.has(e.type))}).map(function(e){return e.type+":"+e.name})},formatListElement:function(a){var b=m.makeIterator(Wk(a));a=b.next().value;b=b.next().value;return WALK.ExtensionManager.getExtensionDefinition(a).name+
": "+b},properties:[{id:"extensions",type:"list",elementType:"string",label:"Extensions to trigger",elementLabel:"extension"},{id:"trigger",type:"trigger",label:"Trigger",defaultValue:!1,optional:!0}]};var Xk={};function Yk(a){a.style.display=""}function Zk(a){a.style.display="none"}
function $k(a){var b=null,c=null;this.showDismiss=!0;this.onDismiss=this.onClose=null;this.position=$k.DEFAULT;this.modal=this.foremost=!1;this.open=function(){null===c&&(this.modal?(b=document.createElement("div"),b.className="modal-backdrop",document.body.appendChild(b),c=document.createElement("div"),b.appendChild(c)):(c=document.createElement("div"),document.body.appendChild(c)),this.update(a))};this.hide=function(){b?Zk(b):Zk(c)};this.unhide=function(){b?Yk(b):Yk(c)};this.update=function(d){var e=
this,f=this.showDismiss?'<div class="ext-popup-close-button-panel ui-close-hoverable">\n           <div class="ext-popup-close-button"></div>\n         </div>':"",g=function(){switch(e.position){case $k.TOP:return"ui-top ui-center";case $k.DEFAULT:return"ui-upper-half-center";case $k.CENTER:return"ui-all-center";default:return console.log("Invalid popup position: "+e.position),"ui-all-center"}}();c.innerHTML='\n       <div class="ext-popup '+g+" "+(this.foremost?"ui-foremost":"")+'">\n         <div class="ext-popup-content">\n           '+
d+"\n         </div>"+f+"\n       </div>";this.showDismiss&&(c.getElementsByClassName("ext-popup-close-button-panel")[0].onclick=function(){return e.dismiss()})};this.getElementsByClassName=function(d){return c.getElementsByClassName(d)};this.dismiss=function(){if(null!==c&&(this.close(),this.onDismiss))this.onDismiss()};this.close=function(){if(null!==c&&(this.modal?(document.body.removeChild(b),b=null):document.body.removeChild(c),c=null,this.onClose))this.onClose()}}$k.CENTER="center";
$k.DEFAULT="default";$k.TOP="top";
Xk={removeChildren:function(a){for(;a.firstChild;)a.removeChild(a.firstChild)},addClickHandler:function(a,b){document.getElementById(a).onclick=b},addChangeHandler:function(a,b){document.getElementById(a).onchange=b},show:Yk,hide:Zk,setVisibility:function(a,b){b?Yk(a):Zk(a)},setButtonHighlight:function(a,b){b?a.classList.add("ext-meeting-button-highlight"):a.classList.remove("ext-meeting-button-highlight")},highlightInput:function(a){a.classList.add("ext-meeting-input-missing");window.setTimeout(function(){a.classList.remove("ext-meeting-input-missing")},
200)},highlightText:function(a){a.classList.add("ext-meeting-text-highlighted");window.setTimeout(function(){a.classList.remove("ext-meeting-text-highlighted")},200)},UiPopup:$k,showMessage:function(a,b){var c="";b&&(c='<h3 class="ext-meeting-dialog-title">'+b+"</h3>");var d=new $k(c+('\n      <div class="ext-meeting-dialog-message">\n        '+a+'\n      </div>\n      <div class="ext-meeting-dialog-buttons">\n        <button class="ext-meeting-button">\n          Close\n        </button>\n      </div>\n    '));
d.showDismiss=!1;d.foremost=!0;d.modal=!0;d.open();d.getElementsByClassName("ext-meeting-button")[0].onclick=function(){d.close()}},showIframePopup:function(a,b,c){var d=new $k('\n      <div class="ext-meeting-dialog-iframe-container">\n        <h3 class="ext-meeting-dialog-title">'+a+'</h3>\n        <iframe src="'+b+'" class="ext-meeting-dialog-iframe">\n        </iframe>\n        <div>\n          <div class="ext-meeting-dialog-buttons">\n            <button class="ext-meeting-button">\n              Close\n            </button>\n          </div>\n        </div>\n      <div>\n    ');
d.showDismiss=!1;d.position=$k.CENTER;d.onClose=c;d.open();var e=d.getElementsByClassName("ext-meeting-dialog-iframe")[0];e.style.visibility="hidden";e.onload=function(){e.style.visibility="visible"};d.getElementsByClassName("ext-meeting-button")[0].onclick=function(){return d.close()}}};var al={},bl=null;function cl(){null===bl&&(bl=new (window.AudioContext||window.webkitAudioContext));return bl}
function dl(a,b,c){this._frequencyDiv=b;this._noSoundThreshold=c;this._maxFrequencyIndex=this._minFrequencyIndex=-1;this._noSoundCalls=0;this._source=null;this._analyser=cl().createAnalyser();this._analyser.fftSize=2*this._frequencyDiv;this._analyser.smoothingTimeConstant=.5;a=new MediaStream([a.mediaStreamTrack]);this._source=cl().createMediaStreamSource(a);this._source.connect(this._analyser);a=cl().sampleRate/this._frequencyDiv;this._minFrequencyIndex=Math.floor(dl._minVoiceFrequency/a);this._maxFrequencyIndex=
Math.floor(dl._maxVoiceFrequency/a);this._dataArray=new Uint8Array(this._maxFrequencyIndex+1)}dl.prototype.measureSoundVolume=function(){var a=this._getOverallSoundVolume();return this._shouldSkipNoSoundNotification(a)?null:a};dl.prototype.dispose=function(){null!==this._source&&(this._source.disconnect(),this._source=null)};
dl.prototype._getOverallSoundVolume=function(){this._analyser.getByteFrequencyData(this._dataArray);for(var a=0,b=this._minFrequencyIndex;b<=this._maxFrequencyIndex;b++)this._dataArray[b]>a&&(a=this._dataArray[b]);return a};dl.prototype._shouldSkipNoSoundNotification=function(a){if(a<this._noSoundThreshold)return this._noSoundCalls++,this._noSoundCalls<dl._skippedNoSoundCalls;this._noSoundCalls=0;return!1};dl._minVoiceFrequency=85;dl._maxVoiceFrequency=350;dl._skippedNoSoundCalls=3;
function el(a,b,c,d){this._width=a;this._height=b;this._bottomMargin=void 0!==d?d:0;this._volumeRect=null;this._rectId=el._baseRectId+el._counter;el._counter++;this._noSoundThreshold=c;this._lengthCoef=a/(255-this._noSoundThreshold)}
el.prototype.getHTML=function(){this._volumeRect=null;return'\n        <svg style="filter: drop-shadow(0px 0px 1px black);\n                    margin-bottom: '+this._bottomMargin.toString()+'px;"\n             width="'+this._width.toString()+'px"\n             height="'+this._height.toString()+'px">\n          <rect id="'+this._rectId+'"\n                x = "'+(this._width/2-1).toString()+'" y = "0"\n                width="'+(1).toString()+'"\n                height="'+this._height.toString()+'"\n                fill="red"/>\n        </svg>\n      '};
el.prototype.getEmptyHTML=function(){return'\n        <svg width="'+this._width.toString()+'px"\n             height="'+this._height.toString()+'px">\n        </svg>\n      '};
el.prototype.update=function(a){null===this._volumeRect&&(this._volumeRect=document.getElementById(this._rectId));console.assert(null!==this._volumeRect,"Volume visualizer HTML not attached to any element");if(null!==a){var b=this._getColor(a),c=Math.max(el._minimalDisplayedValue,Math.max(a,this._noSoundThreshold)-this._noSoundThreshold);a=this._width/2-c*this._lengthCoef/2;c*=this._lengthCoef;this._volumeRect.setAttribute("fill",b);this._volumeRect.setAttribute("x",a.toString());this._volumeRect.setAttribute("width",
c.toString())}};el.prototype._getColor=function(a){return a<this._noSoundThreshold?"red":a<el._lowSoundThreshold?"orange":"green"};el._counter=0;el._baseRectId="ext-meeting-mic-bar-";el._lowSoundThreshold=180;el._minimalDisplayedValue=20;al={VolumeMeter:dl,VolumeVisualizer:el};var fl,gl={name:"mic"},hl={name:"camera",facingMode:"user"};function il(a,b){return a?b[0].toUpperCase()+b.slice(1):b[0].toLowerCase()+b.slice(1)}function jl(a,b){var c=void 0!==b;c=il(!0,a.name)+(c?" and "+il(!1,b.name):"");a=a.error.name;console.assert(void 0===b||b.error.name===a);return"NotFoundError"===a?c+" not found":"NotAllowedError"===a?c+" blocked":"Error"===a?"Error":c+" not available"}
function kl(a,b){var c=void 0!==b,d=c?"they are":"it is",e=c?"them":"it",f=a.error.name;return"NotFoundError"===f?"Check if your "+(il(!1,a.name)+(c?" and "+il(!1,b.name):""))+" "+(c?"are":"is")+" properly connected.":"NotAllowedError"===f?WALK.DETECTOR.mobile?WALK.DETECTOR.ios?"Unblock "+e+" by clicking "+(c?a.unblockIcon+" and "+b.unblockIcon:"the "+a.unblockIcon)+" "+(c?"buttons":"button")+".":"Unblock "+e+" in the browser settings for this webpage.":"Unblock "+e+" by clicking the "+(c?b.unblockIcon:
a.unblockIcon)+" button in the browser\u2019s address bar and refresh the webpage.":"Error"===f?"Your browser doesn't support video meetings. Open the meeting link in another browser.":"If "+d+" connected, close all other applications using "+(e+" and refresh the webpage.")}function ll(a,b,c,d){this._firstErrorDiv=document.getElementById(a);this._secondErrorDiv=document.getElementById(b);this._devicePreview1=c;this._devicePreview2=d}
ll.prototype._reset=function(){this._devicePreview1.setErrorDiv(null);this._devicePreview2.setErrorDiv(null);Xk.removeChildren(this._firstErrorDiv);Xk.removeChildren(this._secondErrorDiv)};
ll.prototype._displayAndLogErrorMessage=function(a,b,c){function d(g){if(void 0!==g)return g.device}var e=jl(b.device,d(c)),f=kl(b.device,d(c));a.innerHTML='\n        <div class="ext-meeting-join-error-title">'+e+'</div>\n        <div class="ext-meeting-join-error-description">'+f+"</div>\n      ";b.setErrorDiv(a);b.device.logError();void 0!==c&&(c.setErrorDiv(a),c.device.logError())};
ll.prototype.update=function(){this._reset();var a=this._devicePreview1.device.error,b=this._devicePreview2.device.error;if(null!==a||null!==b)null!==a&&null!==b?a.name===b.name?this._displayAndLogErrorMessage(this._firstErrorDiv,this._devicePreview1,this._devicePreview2):(this._displayAndLogErrorMessage(this._firstErrorDiv,this._devicePreview1),this._displayAndLogErrorMessage(this._secondErrorDiv,this._devicePreview2)):null!==a?this._displayAndLogErrorMessage(this._firstErrorDiv,this._devicePreview1):
this._displayAndLogErrorMessage(this._firstErrorDiv,this._devicePreview2)};function ml(a,b){this._name=a;this._active=!1;this._unblockIcon=b;this._error=this._track=this._trackOptions=null}ml.prototype.logError=function(){null!==this._error&&WALK.log("Can't create local "+this.name+" track : "+(this._error.name+", "+this._error.message))};ml.prototype._getLabel=function(){return this._track?this._track.mediaStreamTrack.label:null};
ml.prototype.getId=function(){return this._trackOptions&&this._trackOptions.deviceId?this._trackOptions.deviceId.exact:null};ml.prototype.getErrorMessageInfo=function(){if(null===this._error)return null;var a=jl(this),b=kl(this);return{title:a,description:b}};
m.global.Object.defineProperties(ml.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this._name}},track:{configurable:!0,enumerable:!0,get:function(){return this._track},set:function(a){this._track=a}},active:{configurable:!0,enumerable:!0,get:function(){return this._active},set:function(a){this._active=a}},unblockIcon:{configurable:!0,enumerable:!0,get:function(){return this._unblockIcon}},error:{configurable:!0,enumerable:!0,get:function(){return this._error},set:function(a){this._error=
a}},trackOptions:{configurable:!0,enumerable:!0,get:function(){return this._trackOptions},set:function(a){this._trackOptions=a}}});
function nl(a,b,c,d,e,f,g){this._device=new ml(a,g);this._width=c;this._height=d;this._toggleButton=document.getElementById(e);this._previewContainer=document.getElementById(f);this._errorDiv=null;this._meetingStarter=b;Xk.addClickHandler(this._toggleButton.id,this._onToggleButtonClicked.bind(this));this._onStoppedBound=this._onStopped.bind(this);this._twilioCreateTrackFunction=null}nl.prototype.isAvailable=function(){return null!==this._device.track};
nl.prototype.dispose=function(){null!==this._device.track&&this._device.track.removeListener("stopped",this._onStoppedBound);this._close()};nl.prototype._pauseMonitoringTrackBeforeReset=function(){this._device.track.removeListener("stopped",this._onStoppedBound)};nl.prototype._resumeMonitoringTrackAfterReset=function(){this._device.track.addListener("stopped",this._onStoppedBound)};nl.prototype.setErrorDiv=function(a){this._errorDiv=a};nl.prototype.showInTestNeededMode=function(){this.setError({name:"Test needed"})};
nl.prototype.showInPreviewMode=function(){this.setError({name:"Initializing"});this.setToggleButtonVisibility(!0)};nl.prototype.createTrack=function(a){var b=this;return new Promise(function(c){var d=a?a:b._device.trackOptions;b._twilioCreateTrackFunction(WALK.cloneObject(d)).then(function(e){b.setTrack(e,d)}).catch(function(e){b.setTrack(null,d,e)}).finally(function(){b._toggleButton.disabled=!1;c()})})};
nl.prototype.updateTrackDeviceId=function(a){function b(d,e){return(d=d.find(function(f){return f.label===e}))?d.deviceId:null}if(this._device.track&&!this._device.trackOptions.deviceId){var c=this._device._getLabel();a=b(a,c);console.assert(null!==a,"deviceId not found");this._device.trackOptions={name:this._device.trackOptions.name,deviceId:{exact:a}}}};
nl.prototype.setTrack=function(a,b,c){b&&(this._device.trackOptions=b);null!==a&&void 0!==c?console.assert("Invalid setTrack parameters : track and error set"):null===a&&void 0===c&&console.assert("Invalid setTrack parameters : track and error not set");this._disposeTrack();this._device.track=a;null!==this._device.track?(this._device.track.on("stopped",this._onStoppedBound),this._device.active=!0,this._showTrack(),this.setError(null)):(this._device.active=!1,this._hideTrack(),this.setError(c));this._meetingStarter.updateErrorMessage();
this._updateToggleButtonState()};nl.prototype.setError=function(a){this._device.error=a};
nl.prototype.restartTrack=function(a){var b=this;this._toggleButton.disabled=!0;this.isAvailable()?(this._pauseMonitoringTrackBeforeReset(),this._device.trackOptions=a,this._device.track.restart(WALK.cloneObject(a)).then(function(){b._resumeMonitoringTrackAfterReset();b._meetingStarter.updateErrorMessage();b._toggleButton.disabled=!1}).catch(function(){WALK.log("Second attempt to create track,device: "+b._device.name);window.setTimeout(function(){return b.createTrack(a)},1E3)})):this.createTrack(a)};
nl.prototype.setToggleButtonVisibility=function(a){Xk.setVisibility(this._toggleButton,a)};nl.prototype._updateToggleButtonState=function(){this._device.active?(Xk.setButtonHighlight(this._toggleButton,!1),Xk.setVisibility(this._toggleButton.children[0],!0),Xk.setVisibility(this._toggleButton.children[1],!1)):(Xk.setButtonHighlight(this._toggleButton,!0),Xk.setVisibility(this._toggleButton.children[0],!1),Xk.setVisibility(this._toggleButton.children[1],!0))};
nl.prototype._disposeTrack=function(){if(null!==this._device.track){var a=this._device.track;a.removeListener("stopped",this._onStoppedBound);a.detach();a.stop()}this._device.track=null};nl.prototype._onStopped=function(){null!==this._device.track&&this.setTrack(null,null,{name:"NotReadableError",message:"Stopped"})};nl.prototype._close=function(){Xk.removeChildren(this._previewContainer)};nl.prototype._setPreviewInnerHTML=function(a){this._close();this._previewContainer.innerHTML=a;Xk.show(this._previewContainer)};
nl.prototype._setPreviewElement=function(a){this._close();null!==a&&(a.style.width=this._width.toString()+"px",a.style.height=this._height.toString()+"px",this._previewContainer.appendChild(a),Xk.show(this._previewContainer))};nl.prototype._showTrack=function(){this._device.active=!0;this._device.track.enable()};nl.prototype._hideTrack=function(){this._device.active=!1};
nl.prototype._onToggleButtonClicked=function(){var a=this;this.isAvailable()?(this._device.active?this._onSwitchOff():this._onSwitchOn(),this._updateToggleButtonState()):this.createTrack().then(function(){a._device.error&&Xk.highlightText(a._errorDiv)})};nl.prototype._onSwitchOff=function(){this._hideTrack();this._device.track.disable()};nl.prototype._onSwitchOn=function(){this._showTrack();this._device.track.enable()};
m.global.Object.defineProperties(nl.prototype,{device:{configurable:!0,enumerable:!0,get:function(){return this._device}}});function ol(a,b,c,d,e){nl.call(this,"Camera",a,b,c,d,e,'<span class="fa-video-slash"></span>');this._twilioCreateTrackFunction=Twilio.Video.createLocalVideoTrack;this._device.trackOptions=hl}m.inherits(ol,nl);ol.prototype.showInTestNeededMode=function(){nl.prototype.showInTestNeededMode.call(this);this._showPlaceholder()};
ol.prototype.showInPreviewMode=function(){nl.prototype.showInPreviewMode.call(this);this._showPlaceholder()};ol.prototype._showPlaceholder=function(){this._setPreviewInnerHTML('\n        <div class="ext-meeting-join-camera-preview-placeholder">\n          <span class="fa-video absolute-center"></span>\n        </div>\n      ')};ol.prototype._hideTrack=function(){nl.prototype._hideTrack.call(this);this._showPlaceholder()};ol.prototype._showTrack=function(){nl.prototype._showTrack.call(this);this._setPreviewElement(this._device.track.attach())};
ol.prototype._onSwitchOff=function(){nl.prototype._onSwitchOff.call(this);this.setTrack(null,null,null)};function pl(a,b,c,d,e){nl.call(this,"Microphone",a,b,c,d,e,'<span class="fa-microphone-slash"></span>');this._noSoundThreshold=80;this._volumeVisualizer=new al.VolumeVisualizer(b,c,this._noSoundThreshold);this._measurementIntervalId=this._volumeMeter=null;this._twilioCreateTrackFunction=Twilio.Video.createLocalAudioTrack;this._device.trackOptions=gl}m.inherits(pl,nl);
pl.prototype.showInTestNeededMode=function(){nl.prototype.showInTestNeededMode.call(this);this._setPreviewElement(null)};pl.prototype.showInPreviewMode=function(){nl.prototype.showInPreviewMode.call(this);this._setPreviewElement(null)};pl.prototype.dispose=function(){this._isMeasurementActive()&&this._stopMeasurement();nl.prototype.dispose.call(this)};pl.prototype._measure=function(){this._volumeVisualizer.update(this._volumeMeter.measureSoundVolume())};
pl.prototype._hideTrack=function(){nl.prototype._hideTrack.call(this);this._isMeasurementActive()&&this._stopMeasurement();this._setPreviewElement(null)};pl.prototype._showTrack=function(){nl.prototype._showTrack.call(this);this._setPreviewInnerHTML(this._volumeVisualizer.getHTML());this._startMeasurement()};pl.prototype._startMeasurement=function(){var a=this;this._volumeMeter=new al.VolumeMeter(this._device.track,512,this._noSoundThreshold);this._measurementIntervalId=setInterval(function(){return a._measure()})};
pl.prototype._stopMeasurement=function(){clearInterval(this._measurementIntervalId);this._measurementIntervalId=null;this._volumeMeter.dispose();this._volumeMeter=null};pl.prototype._isMeasurementActive=function(){return null!==this._measurementIntervalId};pl.prototype._pauseMonitoringTrackBeforeReset=function(){nl.prototype._pauseMonitoringTrackBeforeReset.call(this);this._isMeasurementActive()&&this._stopMeasurement()};
pl.prototype._resumeMonitoringTrackAfterReset=function(){nl.prototype._resumeMonitoringTrackAfterReset.call(this);this._startMeasurement()};pl.prototype._disposeTrack=function(){this._isMeasurementActive()&&this._stopMeasurement();nl.prototype._disposeTrack.call(this)};
fl=function(a,b){this._onJoinCallback=a;this._joinMode=!1;this._dialog=null;this._mediaInitialized=this._preflightTestDone=!1;this._micVolumePreview=this._cameraPreview=null;this._cameraPreviewHeight=198;this._cameraPreviewWidth=264;this._micVolumePreviewHeight=4;this._micVolumePreviewWidth=40;this._onDevicesChangedBound=this._onDevicesChanged.bind(this);this._errorMessageActive=!0;this._runPrefilghtTest(b)};
fl.prototype.show=function(){var a=this;this._blurHelp();this._createDialog();this._cameraPreview=new ol(this,this._cameraPreviewWidth,this._cameraPreviewHeight,"ext-meeting-join-camera-toggle","ext-meeting-join-camera-preview-container");this._micVolumePreview=new pl(this,this._micVolumePreviewWidth,this._micVolumePreviewHeight,"ext-meeting-join-mic-toggle","ext-meeting-join-mic-volume-container");this._errorMessageGenerator=new ll("ext-meeting-join-first-error","ext-meeting-join-second-error",this._micVolumePreview,
this._cameraPreview);this._setupDevicesSelection();this._checkPermissions().then(function(){a._runPreviewMode(!1);a._createMediaTracksSeparately(hl,gl,function(){return a._onMediaInitialized()})}).catch(function(b){void 0!==b&&WALK.log("Error checking audio/video devices permissions: "+b.name+": "+b.message);a._runTestNeededMode()})};
fl.prototype._checkPermissions=function(){return new Promise(function(a,b){return navigator.mediaDevices.enumerateDevices().then(function(c){var d=c.filter(function(e){return"audioinput"===e.kind&&""!==e.deviceId&&""!==e.label});c=c.filter(function(e){return"videoinput"===e.kind&&""!==e.deviceId&&""!==e.label});0<d.length||0<c.length?a():b()}).catch(function(c){b(c)})})};
fl.prototype._setupDevicesSelection=function(){var a=this;Xk.addChangeHandler("ext-meeting-join-select-camera",function(b){a._cameraPreview.restartTrack({name:"camera",deviceId:{exact:b.currentTarget.value}})});Xk.addChangeHandler("ext-meeting-join-select-microphone",function(b){a._micVolumePreview.restartTrack({name:"mic",deviceId:{exact:b.currentTarget.value}})});navigator.mediaDevices.addEventListener("devicechange",this._onDevicesChangedBound)};
fl.prototype._onDevicesChanged=function(){if(this._joinMode){var a=this._cameraPreview.device.error,b=this._micVolumePreview.device.error;a||b?this._createMediaTracksSeparately(a?hl:null,b?gl:null):this._fillDevicesSelectControls()}};
fl.prototype._fillDevicesSelectControls=function(){var a=this;navigator.mediaDevices.enumerateDevices().then(function(b){a._cameraPreview.updateTrackDeviceId(b);a._micVolumePreview.updateTrackDeviceId(b);var c=b.filter(function(d){return"audioinput"===d.kind});a._fillDevicesSelectControl(c,"ext-meeting-join-select-microphone-container","ext-meeting-join-select-microphone",a._micVolumePreview.device.getId());b=b.filter(function(d){return"videoinput"===d.kind});a._fillDevicesSelectControl(b,"ext-meeting-join-select-camera-container",
"ext-meeting-join-select-camera",a._cameraPreview.device.getId())})};fl.prototype._fillDevicesSelectControl=function(a,b,c,d){b=document.getElementById(b);var e=document.getElementById(c);Xk.setVisibility(b,1<a.length);Xk.removeChildren(e);1<a.length&&(a.forEach(function(f){var g=document.createElement("option");g.value=""+f.deviceId;WALK.setTextContent(g,""+f.label);e.appendChild(g)}),e.value=d)};
fl.prototype._createDialog=function(){var a=this;this._dialog=new Xk.UiPopup('\n        <h3 class="ext-meeting-dialog-title">Join 3D meeting</h3>\n        <div class="ext-meeting-join-row">\n          <div id="ext-meeting-join-name-label">\n            Name:\n          </div>\n          <input type="text" id="ext-meeting-join-name"\n                 class="ext-meeting-join-input"\n                 autocomplete="off">\n          </input>\n        </div>\n        <div class="ext-meeting-join-row">\n          <div class="ext-meeting-join-main-container">\n            <div id="ext-meeting-join-error-container"\n                 class="absolute-vertical-center">\n              <div id="ext-meeting-join-first-error"></div>\n              <div id="ext-meeting-join-second-error"></div>\n            </div>\n            <div id="ext-meeting-join-camera-preview-container"></div>\n            <div id="ext-meeting-join-mic-volume-container"></div>\n            <div id="ext-meeting-join-preview-toggle-container"\n                 class="absolute-horizontal-center">\n              <button id="ext-meeting-join-mic-toggle" style="display: none"\n                      class="ext-meeting-button ext-meeting-button-highlight\n                            ext-meeting-join-device-button">\n                <span class="fa-microphone" style="display: none"></span>\n                <span class="fa-microphone-slash"></span>\n              </button>\n              <button id="ext-meeting-join-camera-toggle" style="display: none"\n                      class="ext-meeting-button ext-meeting-button-highlight\n                            ext-meeting-join-device-button">\n                <span class="fa-video" style="display: none"></span>\n                <span class="fa-video-slash"></span>\n              </button>\n            </div>\n          </div>\n        </div>\n        <div class="ext-meeting-join-row">\n          <div id="ext-meeting-join-select-camera-container"\n               style="display: none">\n            Camera:\n            <select id="ext-meeting-join-select-camera"\n                    class="ext-meeting-join-input">\n            </select>\n          </div>\n          <div id="ext-meeting-join-select-microphone-container"\n               style="display: none">\n            Microphone:\n            <select id="ext-meeting-join-select-microphone"\n                    class="ext-meeting-join-input">\n            </select>\n          </div>\n        </div>\n        <div id="ext-meeting-join-network-error-container" style="display: none">\n          <div>Network issues detected.</div>\n          <div>\n            <a href="https://networktest.twilio.com/" style="color: white" target="_blank">\n              Diagnose your connection.\n            </a>\n          </div>\n        </div>\n        <div id="ext-meeting-join-button-container"\n             class="ext-meeting-join-row">\n          <button id="ext-meeting-join-button"\n                  class="ext-meeting-button ext-meeting-dialog-buttons">\n                  Join\n          </button>\n        </div>\n        <div class="ext-meeting-join-footer">\n          By joining, you agree to the\n          <span id="terms-of-service-link" class="ext-meeting-terms-link"><u>\n            Terms of Service </u></span> and\n          <span id="privacy-policy-link" class="ext-meeting-terms-link"><u>\n            Privacy Policy</u></span>.\n        </div>\n      ');this._dialog.showDismiss=
!1;this._dialog.foremost=!0;this._dialog.open();document.getElementById("terms-of-service-link").onclick=function(){a._dialog.hide();Xk.showIframePopup("The 3D meeting infrastructure is provided by Shapespark under the following Terms of Service","https://www.shapespark.com/terms#in-viewer",function(){return a._dialog.unhide()})};document.getElementById("privacy-policy-link").onclick=function(){a._dialog.hide();Xk.showIframePopup("The 3D meeting infrastructure is provided by Shapespark under the following Privacy Policy",
"https://www.shapespark.com/privacy#in-viewer",function(){return a._dialog.unhide()})};this._initializeDisplayName()};fl.prototype._createMediaTracksSeparately=function(a,b,c){function d(){e._fillDevicesSelectControls();e._errorMessageActive=!0;e.updateErrorMessage();c&&c()}var e=this;this._errorMessageActive=!1;a&&b?this._cameraPreview.createTrack(a).then(function(){return e._micVolumePreview.createTrack(b)}).then(function(){d()}):a?this._cameraPreview.createTrack(a).then(function(){d()}):this._micVolumePreview.createTrack(b).then(function(){d()})};
fl.prototype._runTestNeededMode=function(){this._setTestNeededMode();this._cameraPreview.showInTestNeededMode();this._micVolumePreview.showInTestNeededMode()};fl.prototype._runPreviewMode=function(a){this._setPreviewMode(a);a?(this._cameraPreview.setToggleButtonVisibility(!0),this._micVolumePreview.setToggleButtonVisibility(!0)):(this._cameraPreview.showInPreviewMode(),this._micVolumePreview.showInPreviewMode())};
fl.prototype._onCreateMediaTracks=function(a,b,c){var d=a.filter(function(e){return"audio"===e.kind});a=a.filter(function(e){return"video"===e.kind});this._errorMessageActive=!1;0<d.length?this._micVolumePreview.setTrack(d[0],b):this._micVolumePreview.setTrack(null,b,{name:"Unknown error",message:""});0<a.length?this._cameraPreview.setTrack(a[0],c):this._cameraPreview.setTrack(null,c,{name:"Unknown error",message:""});this._errorMessageActive=!0;this.updateErrorMessage();this._fillDevicesSelectControls();
this._runPreviewMode(!0)};fl.prototype._testCamera=function(){var a=this,b={audio:WALK.cloneObject(gl),video:WALK.cloneObject(hl)};Twilio.Video.createLocalTracks(b).then(function(c){a._onCreateMediaTracks(c)}).catch(function(){a._createMediaTracksSeparately(hl,gl,function(){return a._runPreviewMode(!0)})})};
fl.prototype._setTestNeededMode=function(){var a=this;this._joinMode=!1;var b=document.getElementById("ext-meeting-join-button-container");Xk.removeChildren(b);b.innerHTML='\n        <button class="ext-meeting-button ext-meeting-dialog-buttons"\n                id="ext-meeting-test-button">\n          Test camera\n        </button>\n      ';Xk.addClickHandler("ext-meeting-test-button",function(){return a._testCamera()})};
fl.prototype._setPreviewMode=function(a){var b=this;if(!this._joinMode){this._joinMode=!0;var c=document.getElementById("ext-meeting-join-button-container");Xk.removeChildren(c);c.innerHTML='\n        <button class="ext-meeting-button ext-meeting-dialog-buttons"\n                id="ext-meeting-join-button">\n          Join\n        </button>\n      ';this._mediaInitialized=!0;this._updateJoinButtonState();Xk.addClickHandler("ext-meeting-join-button",function(){return b._joinMeeting()});a||this._setMediaInitialized(!1)}};
fl.prototype._onMediaInitialized=function(){this._setMediaInitialized(!0)};fl.prototype._updateJoinButtonState=function(){var a=document.getElementById("ext-meeting-join-button");a&&(a.disabled=!(this._preflightTestDone&&this._mediaInitialized))};fl.prototype._setMediaInitialized=function(a){this._mediaInitialized=a;this._updateJoinButtonState()};fl.prototype._setPreflightTestDone=function(){this._preflightTestDone=!0;this._updateJoinButtonState()};
fl.prototype._initializeDisplayName=function(){var a=document.getElementById("ext-meeting-join-name"),b=localStorage.getItem("extMtgDisplayName");b&&(a.value=b);a.focus();a.select()};fl.prototype._checkDisplayName=function(){var a=document.getElementById("ext-meeting-join-name"),b=a.value.trim();if(b)return b;Xk.highlightInput(a)};fl.prototype._blurHelp=function(){document.getElementById("help-and-primary-progress").classList.add("ui-blur")};
fl.prototype._unblurHelp=function(){var a=document.getElementById("help-and-primary-progress");a.classList.remove("ui-blur");a.classList.add("ui-unblur")};fl.prototype._runPrefilghtTest=function(a){var b=this;a=Twilio.Video.runPreflight(a,{duration:2E3});a.on("failed",function(c){console.error("Twilio test error:",c);c=document.getElementById("ext-meeting-join-network-error-container");Xk.show(c);b._setPreflightTestDone()});a.on("completed",function(){b._setPreflightTestDone()})};
fl.prototype._joinMeeting=function(){var a=this._checkDisplayName();if(void 0!==a){localStorage.setItem("extMtgDisplayName",a);var b=this._micVolumePreview.device,c=this._cameraPreview.device;this._dispose();this._onJoinCallback(a,b,c)}};fl.prototype.updateErrorMessage=function(){this._errorMessageActive&&this._errorMessageGenerator.update()};
fl.prototype._dispose=function(){this._dialog.close();this._unblurHelp();navigator.mediaDevices.removeEventListener("devicechange",this._onDevicesChangedBound);this._cameraPreview.dispose();this._micVolumePreview.dispose();this._micVolumePreview=this._cameraPreview=this._dialog=null};function ql(){this._room=null;this._bars=[];this._crossLines=[];this._crossIsVisible=!1;this._updateBind=this._update.bind(this);this._qualityToBarIndex=[-1,0,0,1,2,2];this._create()}
ql.prototype._create=function(){var a=document.getElementById("ext-meeting-quality-indicator-container");console.assert(null!==a,"Quality indicator container not found");var b=document.createElementNS("http://www.w3.org/2000/svg","svg");b.setAttribute("width",13);b.setAttribute("height",15);a.appendChild(b);for(a=0;3>a;a++){var c=5*(a+1);this._addBar(b,5*a,15-c,3,c)}this._addCrossLine(b,2,3,11,12);this._addCrossLine(b,2,12,11,3)};
ql.prototype._addBar=function(a,b,c,d,e){var f=document.createElementNS("http://www.w3.org/2000/svg","rect");f.setAttribute("x",b);f.setAttribute("y",c);f.setAttribute("width",d);f.setAttribute("height",e);f.setAttribute("display","none");a.appendChild(f);this._bars.push(f)};
ql.prototype._addCrossLine=function(a,b,c,d,e){var f=document.createElementNS("http://www.w3.org/2000/svg","line");f.setAttribute("x1",b);f.setAttribute("y1",c);f.setAttribute("x2",d);f.setAttribute("y2",e);f.setAttribute("stroke","red");f.setAttribute("stroke-width",2);f.setAttribute("display","none");a.appendChild(f);this._crossLines.push(f)};ql.prototype._hideBars=function(){this._bars.forEach(function(a){a.setAttribute("display","none")})};
ql.prototype._hideCross=function(){this._crossIsVisible&&(this._crossLines.forEach(function(a){a.setAttribute("display","none")}),this._crossIsVisible=!1)};ql.prototype._showBars=function(){this._bars.forEach(function(a){a.setAttribute("display","block")})};ql.prototype._showCross=function(){this._crossIsVisible||(this._crossLines.forEach(function(a){a.setAttribute("display","block")}),this._crossIsVisible=!0)};
ql.prototype.onConnect=function(a){console.assert(null===this._room);this._room=a;this._showBars();this._update(this._room.localParticipant.networkQualityLevel);a.localParticipant.on("networkQualityLevelChanged",this._updateBind)};ql.prototype.onDisconnect=function(){console.assert(null!=this._room);this._room.localParticipant.removeListener("networkQualityLevelChanged",this._updateBind);this._room=null;this._hideBars();this._hideCross()};
ql.prototype._getColor=function(a,b){return a<=this._qualityToBarIndex[b]?"white":"dimgray"};ql.prototype._update=function(a){if(null!==a){for(var b=0;3>b;b++){var c=this._getColor(b,a);this._bars[b].setAttribute("fill",c);this._bars[b].setAttribute("stroke",c)}0===a?this._showCross():this._hideCross()}};function rl(){function a(){var I=this;this._users=new Set;this._maxIntervalBetweenUpdates=100;this._idleCallback=new WALK.DeferringExecutorInterval(function(){return I._execute()},this._maxIntervalBetweenUpdates);WALK.getViewer().onBeforeRender(function(){return I._onBeforeRender()})}function b(){var I=window.location.hostname;return I.endsWith(".shapespark.com")?"https://cloud"+I.substr(I.indexOf(".")):I.endsWith(".shapespark.com.cn")?"https://cloud.shapespark.com.cn":WALK.DEVEL_MEETING_CLOUD_URL||
"https://cloud.shapespark.com"}function c(I){I=new Date(I);var U=new Date;return U.getDate()===I.getDate()&&U.getMonth()===I.getMonth()&&U.getFullYear()===I.getFullYear()?I.toLocaleTimeString():I.toLocaleDateString()+" "+I.toLocaleTimeString()}function d(I,U,ia,R){var E=document.createElement("li");E.classList.add("ext-meeting-list-entry");var Y=E.appendChild(document.createElement("span"));Y.classList.add("ext-meeting-list-name");Y.innerText=I;Y.style.color=ia;R&&(E.onclick=R,E.style.cursor="pointer");
U&&(E.appendChild(document.createElement("br")),I=E.appendChild(document.createElement("small")),I.innerText=U,I.style.color="white");return E}function e(I,U,ia){return{color:"#0775e8",icon:"edit",opacity:1,position:[I,U,ia],radius:.07,type:"sphere"}}function f(I,U,ia,R){R=void 0===R?!0:R;var E=new Xk.UiPopup("<div>\n         "+I+"\n       </div>\n       <div class ='ext-meeting-dialog-buttons'>\n         <button class='ext-meeting-dialog-ok ext-meeting-button'>\n           "+U+"\n         </button>\n         "+
(R?"<button class='ext-meeting-dialog-cancel ext-meeting-button'>\n         Cancel\n        </button>":"")+"\n       </div>");E.showDismiss=!1;E.open();R&&(E.getElementsByClassName("ext-meeting-dialog-cancel")[0].onclick=function(){return E.dismiss()});E.getElementsByClassName("ext-meeting-dialog-ok")[0].onclick=function(){E.close();ia()}}function g(I,U){U=U.attach();I=I.createTextureFromHtmlVideo(U);I.play();return I}function k(I){I.detach().forEach(function(U){return U.remove()})}function h(I){return I&&
I.isStarted&&I.isEnabled&&!I.isStopped}function l(I,U,ia){this._viewer=I;this._uuid=U;I=parseInt(U.substring(2));this._color=WALK.AVATAR_COLORS[I%WALK.AVATAR_COLORS.length];this._twilioParticipant=this._avatar=this._displayName=null;this._lastRenderedPosition=[];this._lastRenderedPositionLength=0;this._audioTrack=this._screenTrack=this._cameraTrack=this._micTrack=this._dataTrack=null;this._noSoundThreshold=80;this._soundVolumeUpdatesScheduler=ia;this._volumeVisualizer=new al.VolumeVisualizer(20,3,
this._noSoundThreshold,3);this._volumeMeter=null}function n(I,U,ia,R,E,Y){l.call(this,I,U,R,!0);this._displayName=ia;this._setUpAvatar();this._avatar.hideBody();this._isPublishingTracksDuringConnecting=!1;this._dataTrack=new Twilio.Video.LocalDataTrack({name:"data",maxPacketLifeTime:1E3});this._isCreatingCameraTrack=this._isCreatingMicTrack=!1;this._micDevice=E;this._cameraDevice=Y;this._micTrack=this._micDevice.track;null!==this._micTrack&&this._subscribeToMicEvents();this._updateSoundMeasurementState();
this._cameraTrack=this._cameraDevice.track;null!==this._cameraTrack&&(console.assert(this._cameraDevice.active,"Got inactive camera track from MeetingStarter"),this._subscribeToCameraEvents());this._lastPosition=null;this._positionMessage=[U,ia,null];this._onCameraTrackStateChanged=this._onMicTrackStateChanged=this._resendInterval=null}function r(I,U,ia,R){l.call(this,I,U,ia,!1);this._onUiRefreshNeeded=R;this._cameraTrackDisabledBound=this._cameraTrackEnabledBound=this._micTrackStateChangedBound=
null;this._trackSubscribedBound=this._trackSubscribed.bind(this);this._trackUnsubscribedBound=this._trackUnsubscribed.bind(this);this._disposed=!1}function v(I,U,ia,R,E,Y){var X=new PubNub({publishKey:U.publishKey,subscribeKey:U.subscribeKey,authKey:U.authKey,uuid:I.uuid,ssl:!0}),fa=U.channel;X.subscribe({channels:[fa],withPresence:!0});X.addListener({message:function(ka){WALK.log("listener received message",ka);"SceneState"===ka.message.type&&E(ka.message.state)},presence:function(ka){ka.uuid!==
I.uuid&&(WALK.log("listener presence event",ka),"join"===ka.action?ia(ka.uuid):"leave"===ka.action&&R(ka.uuid))},status:function(ka){"PNAccessDeniedCategory"!==ka.category&&"PNNetworkIssuesCategory"!==ka.category&&"PNNetworkDownCategory"!==ka.category&&"PNTimeoutCategory"!==ka.category||Y(ka.category)}});X.hereNow({channels:[fa],includeUUIDs:!0,includeState:!0},function(ka,qa){WALK.log("herenow",ka,qa);qa.channels[fa].occupants.forEach(function(ya){ya.uuid!==I.uuid&&ia(ya.uuid)})});this.dispose=function(){X.unsubscribeAll()}}
function p(I,U,ia,R,E,Y,X,fa,ka){function qa(ja){var S=ja.identity.match(/^u-\d+/);S=S&&S[0];return S?S:(WALK.warn("Unknown participant",ja.identity),null)}function ya(ja){WALK.log('Participant "%s" connected',ja.identity);var S=qa(ja);S&&ia(S,ja)}function za(ja){WALK.log('Participant "%s" disconnected',ja.identity);var S=qa(ja);S&&R(S,ja)}var T=U.avToken,V=U.channel,ma=["NotAllowedError","NotFoundError","NotReadableError","OverconstrainedError","TypeError"],P=null,N=!1,da=0,ua=WALK.urlHashContains("av-turn");
this.isConnected=function(){return N};this.disconnect=function(){N=!1;P&&(P.disconnect(),ka());I.disconnectedFromTwilio()};this.dispose=function(){this.disconnect()};this.connect=function(){console.assert(!N);N=!0;I.startedConnectingToTwilio();WALK.log('Connecting to room "%s"',V);Twilio.Video.connect(T,{name:V,tracks:I.getAllTracks(),preferredVideoCodecs:["VP8"],iceTransportPolicy:ua?"relay":"all",region:ta||"gll",networkQuality:{local:1,remote:1}}).then(function(ja){P=ja;WALK.log("Connected to room");
P.participants.forEach(ya);P.on("participantConnected",ya);P.on("participantDisconnected",za);P.on("reconnecting",function(){da+=1});P.on("reconnected",function(){da=0});P.once("disconnected",function(S){N&&(P.participants.forEach(za),I.disconnectedFromTwilio(),0<da?Y("TReconnectionDisconnected"+(S.code?" "+S.code:"")):X())});I.connectedToTwilio(P.localParticipant);fa(P)}).catch(function(ja){I.failedToConnectToTwilio();ma.includes(ja.name)?E(ja):Y("T"+ja.code)})}}function w(I){function U(fa,ka){var qa=
document.createElement("span");qa.classList.add("ext-meeting-status-list-name");qa.innerText=fa;qa.style.color=ka;return qa}function ia(fa){var ka=document.createElement("span");ka.classList.add("ext-meeting-status-list-mic-indicator");fa?ka.classList.add("fa-microphone"):ka.classList.add("fa-microphone-slash");return ka}function R(){var fa=document.createElement("span");fa.classList.add("ext-meeting-status-list-mic-indicator");fa.classList.add("fa-file-audio-o");return fa}function E(fa){console.assert(null!==
fa.volumeVisualizer,"volumeVisualizer not initialized");var ka=document.createElement("span");fa.isSoundMeasurementActive()?ka.innerHTML=fa.volumeVisualizer.getHTML():ka.innerHTML=fa.volumeVisualizer.getEmptyHTML();return ka}var Y=document.getElementById("ext-meeting-status"),X=document.getElementById("ext-meeting-who-list");this.update=function(fa){Xk.removeChildren(X);var ka=X.appendChild,qa=document.createElement("li");qa.classList.add("ext-meeting-status-list-entry");qa.appendChild(E(I));qa.appendChild(U(I.displayName+
" (me)",I.color));var ya=h(I.micTrack);qa.appendChild(ia(ya));I.audioTrack&&qa.appendChild(R(ya));ka.call(X,qa);fa=m.makeIterator(Object.values(fa));for(ka=fa.next();!ka.done;ka=fa.next())if(ya=ka.value,ya.hasDisplayName){ka=X;qa=ka.appendChild;var za=document.createElement("li");za.classList.add("ext-meeting-status-list-entry");za.appendChild(E(ya));var T=U(ya.displayName,ya.color);T.onclick=ya.seeAvatar.bind(ya);T.style.cursor="pointer";za.appendChild(T);T=ya.micTrack&&ya.micTrack.isEnabled;za.appendChild(ia(T));
ya.audioTrack&&za.appendChild(R(T));qa.call(ka,za)}};this.show=function(){Xk.show(Y)};this.hide=function(){Xk.hide(Y)};this.update([]);this.show()}function u(I){return"\n      <div>\n        <textarea id='ext-meeting-note-text'\n          class='ext-meeeting-note-edit'\n          placeholder='"+I+"'></textarea>\n      </div>\n      <button id='ext-meeting-note-publish'\n        class='ext-meeting-button ext-meeting-dialog-buttons'>\n        Publish\n      </button>\n    "}function y(I,U){function ia(E){var Y=
R;null!==E.location&&(Y+=":"+E.location.join(":"));return Y}var R="extMtg:"+I+":"+U+":";this.getTimeStampOfLastReadNoteAtLocation=function(E){return localStorage.getItem(ia(E))||-1};this.isNoteRead=function(E){return E.ts<=this.getTimeStampOfLastReadNoteAtLocation(E)||E.author===U};this.markAllNotesAtLocationAsRead=function(E){localStorage.setItem(ia(E),E.ts)}}function B(I,U,ia,R,E,Y){function X(ja){if(ja===U.displayName)return U.color;for(var S=m.makeIterator(Object.values(ia)),sa=S.next();!sa.done;sa=
S.next())if(sa=sa.value,sa.displayName===ja)return sa.color;return"#ffffff"}function fa(){T=!1;R.show();ha.style.cursor="default";V.dismiss();ma.close()}function ka(ja){return za.filter(function(S){S=S.location;var sa=ja.location;S=null===S||null===sa?!1:WALK.deepEqual(S,sa);return S})}function qa(ja,S){function sa(Ca,na){if(!T){Za.classList.remove("ext-meeting-note-list-unread");Za.classList.add("ext-meeting-note-list-selected");na&&Za.scrollIntoView();Ca.material.highlightMix=.7;I.requestFrame();
var Ea="";na=new Map;for(var Ma=E.getTimeStampOfLastReadNoteAtLocation(ja),Q=null,oa=m.makeIterator(ka(ja)),Aa=oa.next();!Aa.done;Aa=oa.next()){Q=Aa.value;Aa="ext-meeting-note-text"+Q.id;var Wa="ext-meeting-note-author"+Q.id,Ra="ext-meeting-note-entry";Q.ts>Ma&&Q.author!==U.displayName&&(Ra+=" ext-meeting-note-unread");Ea+="<div class='"+Ra+"'>\n               <strong id='"+Wa+"'\n                   style='color: "+X(Q.author)+"'>\n               </strong> <span>"+c(Q.ts)+"</span>\n               <div id='"+
Aa+"'>\n               </div>\n             </div>";na.set(Aa,Q.text);na.set(Wa,Q.author)}Ea+=u("Type your response");P?P.update(Ea):(P=new Xk.UiPopup(Ea),P.position=Xk.UiPopup.TOP,P.onClose=function(){Za.classList.remove("ext-meeting-note-list-selected");Ca.material.highlightMix=0;I.requestFrame();P=null});E.markAllNotesAtLocationAsRead(Q);N=ja.location;P.open();na.forEach(function(Pa,db){document.getElementById(db).innerText=Pa});Xk.addClickHandler("ext-meeting-note-publish",function(){var Pa=document.getElementById("ext-meeting-note-text"),
db=Pa.value.trim();if(db){var Oa=Ca.position;Y(db,[Oa.x,Oa.y,Oa.z]);Pa.value=""}else Xk.highlightInput(Pa)})}}var Ga=I.addAnchor(e(ja.location[0],ja.location[1],ja.location[2],"#0775e8"),function(Ca){return sa(Ca,!0)});Ga.material.highlight=ba;Ga.material.setUniforms();ya.push(Ga);var Ya=ja.author;var Za=d(Ya,c(ja.ts),X(Ya),function(){I.seeItem(Ga);sa(Ga,!1)});E.isNoteRead(ja)||Za.classList.add("ext-meeting-note-list-unread");S.appendChild(Za);null!==P&&WALK.deepEqual(N,ja.location)&&sa(Ga,!0)}var ya=
[],za=[],T=!1,V=new Xk.UiPopup("\n      <h2>\n        Click a place to leave a note there.\n      </h2>");V.position=Xk.UiPopup.TOP;var ma=new Xk.UiPopup(u("Type your note"));ma.position=Xk.UiPopup.TOP;var P=null,N=null;Xk.addClickHandler("ext-meeting-add-note",function(){T=!0;R.hide();ha.style.cursor="pointer";P&&P.close();I.onNodeTypeClicked(ua);V.onDismiss=function(){I.removeOnNodeTypeClicked(ua);fa()};V.open()});var da=new G.Vector3;var ua=function(ja,S){ha.style.cursor="default";da.copy(S);WALK.movePointTowards(da,
I.getCameraPosition(),.1);I.removeOnNodeTypeClicked(ua);var sa=I.addAnchor(e(da.x,da.y,da.z));sa.material.highlight=ba;sa.material.setUniforms();sa.material.highlightMix=.7;V.close();ma.onClose=function(){I.removeAnchor(sa);fa()};ma.open();Xk.addClickHandler("ext-meeting-note-publish",function(){var Ga=document.getElementById("ext-meeting-note-text"),Ya=Ga.value.trim();Ya?Y(Ya,[da.x,da.y,da.z]):Xk.highlightInput(Ga)});return!0};I.onApiUserStateChanged("MeetingNotes",function(ja,S){console.assert("MeetingNotes"===
ja);za=S.sort(function(Za,Ca){var na=E.isNoteRead(Za),Ea=E.isNoteRead(Ca);return na!==Ea?na?-1:1:Za.ts-Ca.ts});fa();ja=m.makeIterator(ya);for(S=ja.next();!S.done;S=ja.next())I.removeAnchor(S.value);ya.length=0;ja=document.getElementById("ext-meeting-note-list");Xk.removeChildren(ja);S=new Map;for(var sa=za.length-1;0<=sa;sa--){var Ga=za[sa];if(null!==Ga.location){var Ya=Ga.location.join("/");S.has(Ya)||(S.set(Ya,sa),qa(Ga,ja),ja.lastChild.scrollIntoView())}}})}function D(I,U){function ia(){fa=X=null;
Y.pointerX=null;Y.pointerY=null;Y.pointerZ=null;I._enableControls()}function R(){Y.isEnabled()?(ha.style.cursor="default",ia(),qa.disable(),ka.close(),U.show()):(ha.style.cursor="pointer",ka.open(),qa.enable(),ka.onDismiss=R,U.hide())}var E=this,Y=this,X=null,fa=null,ka=new Xk.UiPopup("\n      <h2>\n        Point a place by clicking.\n      </h2>");ka.position=Xk.UiPopup.TOP;var qa=I._createPointerEventHelper(0);qa.disable();this.pointerZ=this.pointerY=this.pointerX=null;this.isEnabled=function(){return qa.isEnabled()};
this.showPointer=function(){return null!==this.pointerX};I.onBeforeRender(function(){if(null!==X){var ya=I._findIntersectionAtPosition(X,fa);Infinity!==ya.distance&&(E.pointerX=ya.point.x,E.pointerY=ya.point.y,E.pointerZ=ya.point.z)}});qa.callbacks.onPointerDown=function(ya,za){X=ya;fa=za;I._disableControls();I.requestFrame();return!0};qa.callbacks.onPointerMove=function(ya,za){if(null===X)return!1;X=ya;fa=za;I.requestFrame();return!0};qa.callbacks.onPointerUp=function(){ia();I.requestFrame();return!0};
Xk.addClickHandler("ext-meeting-pointer",function(){R()})}function H(){var I=[0,0,0,0,0],U=[0,0,0,0,0,0,0,0],ia=null,R=!1;this.newUpdateWithPointer=function(){R=!1;ia!==U&&(R=!0,ia=U)};this.newUpdateNoPointer=function(){R=!1;ia!==I&&(R=!0,ia=I)};this.set=function(E,Y){ia[E]!==Y&&(ia[E]=Y,R=!0)};this.getFilledArray=function(){return R?ia:null}}function K(){function I(X){Xk.setVisibility(X.children[0],!0);Xk.setVisibility(X.children[1],!1)}function U(X){Xk.setVisibility(X.children[0],!1);Xk.setVisibility(X.children[1],
!0)}var ia=document.getElementById("ext-meeting-mic-toggle"),R=document.getElementById("ext-meeting-camera-toggle"),E=document.getElementById("ext-meeting-camera-preview"),Y=null;this.refreshMicControls=function(X){h(X)?(Xk.setButtonHighlight(ia,!1),I(ia)):(Xk.setButtonHighlight(ia,!0),U(ia))};this.refreshCameraControls=function(X){h(X)?(Y||(Y=X.attach(),E.appendChild(Y)),Xk.show(E),Xk.setButtonHighlight(R,!1),I(R)):(Y&&(X.detach(),Y.remove(),Y=null),Xk.hide(E),Xk.setButtonHighlight(R,!0),U(R))};
this.setToggleButtonHandlers=function(X,fa){ia.onclick=X;R.onclick=fa}}function J(I,U,ia,R){function E(na){WALK.USER_MSG.error("Connection lost. Reload the page to rejoin the meeting.<br/>(Code:"+na+")")}function Y(na,Ea){na={meetingKey:sa,author:I,text:na,location:Ea};WALK.ajaxPost(b()+"/meetings/"+S+"/notes","application/json",JSON.stringify(na),function(){return WALK.log("Note added.")},function(){return WALK.log("Failed to add note")})}function X(){ua.update(da)}function fa(na){var Ea=da[na];
Ea||(Ea=new r(V,na,P,X),da[na]=Ea);return Ea}function ka(na){na in da&&(da[na].dispose(),delete da[na],ua.update(da),Ca.isConnected()&&0===Object.keys(da).length&&Ca.disconnect())}function qa(na){Ga=na;for(var Ea=m.makeIterator(Object.keys(na)),Ma=Ea.next();!Ma.done;Ma=Ea.next())Ma=Ma.value,V.apiUserChangeState(Ma,na[Ma])}function ya(){N.dispose();Ca.dispose();Za.dispose();for(var na in da)da.hasOwnProperty(na)&&da[na].dispose();P.dispose()}function za(){Ya.showPointer()?(ma.newUpdateWithPointer(),
ma.set(5,WALK.round(Ya.pointerX,3)),ma.set(6,WALK.round(Ya.pointerY,3)),ma.set(7,WALK.round(Ya.pointerZ,3))):ma.newUpdateNoPointer();var na=V.getCameraPosition(),Ea=V.getCameraRotation();ma.set(0,WALK.round(na.x,3));ma.set(1,WALK.round(na.y,3));ma.set(2,WALK.round(na.z,3));ma.set(3,WALK.round(Ea.yaw,1));ma.set(4,WALK.round(Ea.pitch,1));(na=ma.getFilledArray())&&N.updatePosition(na)}function T(){WALK.USER_MSG.error("The meeting has ended. Maximum duration of meeting reached.)");ya();ua.update({})}
var V=WALK.getViewer(),ma=new H,P=new a;this.myUuid=R.uuid;var N=new n(V,this.myUuid,I,P,U,ia),da={},ua=new w(N,V),ja=new K,S=R.id,sa=R.meetingKey,Ga;ja.setToggleButtonHandlers(function(){N.toggleMic()},function(){N.toggleCamera()});N.setAvTracksStateHandlers(function(na){ja.refreshMicControls(na);ua.update(da)},function(na){ja.refreshCameraControls(na)});ja.refreshMicControls(N.micTrack);ja.refreshCameraControls(N.cameraTrack);var Ya=new D(V,ua);WALK.urlHashContains("meeting-notes")&&(Xk.show(document.getElementById("ext-meeting-notes-preview")),
B(V,N,da,ua,new y(S,I),Y));null!==R.sceneState&&qa(R.sceneState);var Za=new v(N,R,function(na){fa(na);Ca.isConnected()||Ca.connect()},ka,qa,E);U=new ql;var Ca=new p(N,R,function(na,Ea){fa(na).connectedToTwilio(Ea)},function(na){ka(na)},function(na){WALK.USER_MSG.info("Failed to acquire media.<br/>"+na.message,6E3)},E,function(){WALK.USER_MSG.error("The meeting has been ended.")},U.onConnect.bind(U),U.onDisconnect.bind(U));Xk.addClickHandler("ext-meeting-leave",function(){f("Do you want to leave this meeting?",
"Leave meeting",function(){ya();document.body.innerHTML='<div id="cover-image"></div>';f("You have left the meeting.","Join again",function(){location.reload()},!1)})});V.onBeforeRender(za);za();V.onApiUserStateChanged(function(na,Ea){Ga&&WALK.deepEqual(Ea,Ga[na])||(na={meetingKey:sa,key:na,state:Ea},WALK.ajaxPost(b()+"/meetings/"+S+"/scene-state","application/json",JSON.stringify(na),function(){return WALK.log("State updated.")},function(){return WALK.log("Failed to update state.")}))});this.startShareScreen=
function(na,Ea,Ma){WALK.log("Screen share start requested");N.startShareScreen(na,Ea,Ma,function(){return ua.update(da)})};this.stopShareScreen=function(){WALK.log("Screen share stop requested");N.stopShareScreen()};null!==R.remainingTimeSeconds&&setTimeout(T,1E3*(R.remainingTimeSeconds+5))}function W(I){(new fl(function(U,ia,R){U=new J(U,ia,R,I);WALK.getViewer()._meetingJoined(U)},I.avToken)).show()}function M(I,U){function ia(){var E=I.split("/").slice(0,-1).join("/")+"/";fetch(I).then(function(Y){return Y.json()}).then(function(Y){R(E,
Y)}).catch(function(){return WALK.USER_MSG.error("Failed to load the meeting")})}function R(E,Y){fetch(E+Y.model).then(function(X){return X.text()}).then(function(X){X=WALK.parseObj(X);WALK.setAvatarModel(E,Y,X);U()}).catch(function(){return WALK.USER_MSG.error("Failed to load the meeting")})}WALK.getViewer().onSceneLoadComplete(function(){void 0===I&&(I=WALK.getViewerAssetUrl("3dassets/avatar.json"));WALK.AVATAR_JSON_URL_OVERRIDE&&(I=WALK.AVATAR_JSON_URL_OVERRIDE);ia()})}WALK.FONT_FAMILIES_TO_LOAD.push("FontAwesomeSolid");
WALK.FONT_FAMILIES_TO_LOAD.push("FontAwesomeRegular");var ba=new G.Color(0,1,0),ha=document.getElementById("walk-canvas"),ta=WALK.urlHashGetArgument("av-region");l.prototype={constructor:l,_setUpAvatar:function(){console.assert(this._displayName,"Display name must be known to set up the avatar");WALK.log("Setting up avatar for %s:%s",this._uuid,this._displayName);this._avatar=this._viewer.addAvatar(this._uuid,{displayName:this._displayName,color:this._color})},get uuid(){return this._uuid},get color(){return this._color},
get displayName(){return this._displayName},get hasDisplayName(){return null!==this._displayName},_positionChanged:function(I){if(this._lastRenderedPositionLength!==I.length)return!0;for(var U=0;U<I.length;U++)if(1E-5<Math.abs(this._lastRenderedPosition[U]-I[U]))return!0;return!1},_setLastRenderedPosition:function(I){this._lastRenderedPositionLength=I.length;for(var U=0;U<I.length;U++)this._lastRenderedPosition[U]=I[U]},get volumeVisualizer(){return this._volumeVisualizer},updatePosition:function(I){if(this.hasDisplayName&&
this._positionChanged(I)){this._setLastRenderedPosition(I);var U=this._avatar;U.setPositionFromArray(I);U.rotate(I[3],I[4]);6<=I.length?U.placePointer(I[5],I[6],I[7]):U.hidePointer();U.visible&&(U.updateMatrixWorld(!0),this._viewer.requestFrame())}},updateSoundVolumeVisualization:function(){console.assert(null!==this._volumeMeter,"this._voulmeMeter not created");var I=this._volumeMeter.measureSoundVolume();this._onSoundVolumeUpdated(I)},_onSoundVolumeUpdated:function(I){this._volumeVisualizer.update(I)},
dispose:function(){this.isSoundMeasurementActive()&&this._stopSoundMeasurement();this._avatar&&(this._viewer.removeAvatar(this._avatar),this._avatar=null,this._viewer.requestFrame())},_updateSoundMeasurementState:function(){null!==this._micTrack&&this._micTrack.isEnabled?this._startSoundMeasurement():this._stopSoundMeasurement()},isSoundMeasurementActive:function(){return null!==this._volumeMeter},_startSoundMeasurement:function(){this.isSoundMeasurementActive()||(this._volumeMeter=new al.VolumeMeter(this._micTrack,
512,this._noSoundThreshold),this._soundVolumeUpdatesScheduler.registerUser(this))},_stopSoundMeasurement:function(){this.isSoundMeasurementActive()&&(this._soundVolumeUpdatesScheduler.unregisterUser(this),this._volumeMeter.dispose(),this._volumeMeter=null,this._avatar.onSoundSwitchedOff())}};Object.defineProperty(l.prototype,"micTrack",{get:function(){return this._micTrack}});Object.defineProperty(l.prototype,"cameraTrack",{get:function(){return this._cameraTrack}});Object.defineProperty(l.prototype,
"audioTrack",{get:function(){return this._audioTrack}});n.prototype=Object.create(l.prototype);n.prototype.constructor=n;Object.defineProperty(n.prototype,"dataTrack",{get:function(){return this._dataTrack}});Object.defineProperty(n.prototype,"screenTrack",{get:function(){return this._screenTrack}});n.prototype.getAllTracks=function(){var I=[this._dataTrack];this._micTrack&&I.push(this._micTrack);this._cameraTrack&&I.push(this._cameraTrack);this._screenTrack&&I.push(this._screenTrack);this._audioTrack&&
I.push(this._audioTrack);return I};n.prototype._sendPosition=function(I){this._positionMessage[2]=I;this._dataTrack.send(JSON.stringify(this._positionMessage))};n.prototype._resendLastPosition=function(){null!==this._lastPosition&&this._sendPosition(this._lastPosition)};n.prototype.startedConnectingToTwilio=function(){this._isPublishingTracksDuringConnecting=!0};n.prototype.failedToConnectToTwilio=function(){this._isPublishingTracksDuringConnecting=!1};n.prototype.connectedToTwilio=function(I){var U=
this;this._twilioParticipant=I;I.publishTracks(this.getAllTracks()).finally(function(){U._isPublishingTracksDuringConnecting=!1});this._resendLastPosition();this._resendInterval=setInterval(function(){return U._resendLastPosition()},1E3)};n.prototype.disconnectedFromTwilio=function(){this._twilioParticipant=null;clearInterval(this._resendInterval);this._resendInterval=null};Object.defineProperty(n.prototype,"isConnectedToTwilio",{get:function(){return null!==this._twilioParticipant}});n.prototype.updatePosition=
function(I){l.prototype.updatePosition.call(this,I);this._lastPosition=I;this.isConnectedToTwilio&&this._sendPosition(I)};n.prototype.setAvTracksStateHandlers=function(I,U){this._onMicTrackStateChanged=I;this._onCameraTrackStateChanged=U};n.prototype._removeStoppedMicTrack=function(){console.assert(this._micTrack&&this._micTrack.isStopped);WALK.log("Removing stopped local mic track");this._twilioParticipant&&(WALK.log("Unpublishing stopped local mic track"),this._twilioParticipant.unpublishTrack(this._micTrack));
this._micTrack=null};n.prototype._subscribeToMicEvents=function(){function I(){U._updateSoundMeasurementState();U._onMicTrackStateChanged&&U._onMicTrackStateChanged(U._micTrack)}var U=this;this._micTrack.on("started",I);this._micTrack.on("enabled",I);this._micTrack.on("disabled",I);this._micTrack.on("stopped",function(){I();U._removeStoppedMicTrack()})};n.prototype._createMicTrack=function(){var I=this;WALK.log("Creating local mic track");if(this._isCreatingMicTrack)WALK.log("Local mic track is already being created");
else{this._isCreatingMicTrack=!0;var U=null;Twilio.Video.createLocalAudioTrack(this._micDevice.trackOptions).then(function(ia){U=ia;if(I.isConnectedToTwilio)return WALK.log("Publishing local mic track"),I._twilioParticipant.publishTrack(U)}).then(function(ia){ia?WALK.log("Local mic track created and published"):WALK.log("Local mic track created but not yet published");I._micTrack=U;I._subscribeToMicEvents();I._onMicTrackStateChanged&&I._onMicTrackStateChanged(I._micTrack);I._isCreatingMicTrack=!1}).catch(function(ia){U&&
U.stop();I._micDevice.error=ia;I._showCreateTrackError(I._micDevice);I._isCreatingMicTrack=!1})}};n.prototype.toggleMic=function(){this._micTrack?this._micTrack.isEnabled?(WALK.log("Disabling local mic track"),this._micTrack.disable()):(WALK.log("Enabling local mic track"),this._micTrack.enable()):this._createMicTrack()};n.prototype._removeStoppedCameraTrack=function(){console.assert(this._cameraTrack&&this._cameraTrack.isStopped);WALK.log("Removing stopped local camera track");this._twilioParticipant&&
(WALK.log("Unpublishing stopped local camera track"),this._twilioParticipant.unpublishTrack(this._cameraTrack));this._cameraTrack=null};n.prototype._subscribeToCameraEvents=function(){function I(){U._onCameraTrackStateChanged&&U._onCameraTrackStateChanged(U._cameraTrack)}var U=this;this._cameraTrack.on("started",I);this._cameraTrack.on("enabled",I);this._cameraTrack.on("disabled",I);this._cameraTrack.on("stopped",function(){I();U._removeStoppedCameraTrack()})};n.prototype._createCameraTrack=function(){var I=
this;WALK.log("Creating local camera track");if(this._isCreatingCameraTrack)WALK.log("Local camera track is already being created");else{this._isCreatingCameraTrack=!0;var U=null;Twilio.Video.createLocalVideoTrack(this._cameraDevice.trackOptions).then(function(ia){U=ia;if(I.isConnectedToTwilio)return WALK.log("Publishing local camera track"),I._twilioParticipant.publishTrack(U)}).then(function(ia){ia?WALK.log("Local camera track created and published"):WALK.log("Local camera track created but not yet published");
I._cameraTrack=U;I._subscribeToCameraEvents();I._onCameraTrackStateChanged&&I._onCameraTrackStateChanged(I._cameraTrack);I._isCreatingCameraTrack=!1}).catch(function(ia){U&&U.stop();I._cameraDevice.error=ia;I._showCreateTrackError(I._cameraDevice);I._isCreatingCameraTrack=!1})}};n.prototype._showCreateTrackError=function(I){I=I.getErrorMessageInfo();Xk.showMessage(I.description,I.title)};n.prototype.toggleCamera=function(){this._cameraTrack?this._isPublishingTracksDuringConnecting?WALK.log("Cannot disable the camera track during connection process"):
this._cameraTrack.stop():this._createCameraTrack()};n.prototype.startShareScreen=function(I,U,ia,R){var E=this;null!==this._screenTrack?I():(WALK.log("Share screen start"),navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}).then(function(Y){WALK.log("share screen - stream:",Y);var X=new Twilio.Video.LocalVideoTrack(Y.getVideoTracks()[0],{name:"screen"});E._screenTrack=X;Y=Y.getAudioTracks();var fa=null;0<Y.length?(fa=new Twilio.Video.LocalAudioTrack(Y[0],{name:"audio"}),E._audioTrack=fa,R()):
console.log("Audio track not available for sharing");Y=g(E._viewer,X);E._avatar.setVideoTexture1(Y);E._viewer.requestFrame();E.isConnectedToTwilio&&(E._twilioParticipant.publishTrack(X),fa&&E._twilioParticipant.publishTrack(fa));I();X.once("stopped",function(){WALK.log("Screen track stopped");E.isConnectedToTwilio&&(E._twilioParticipant.unpublishTrack(X),null!==fa&&E._twilioParticipant.unpublishTrack(fa));E._avatar.setVideoTexture1(null);k(X);null!==fa&&k(fa);E._screenTrack=null;E._audioTrack&&(E._audioTrack=
null,R());E._viewer.requestFrame();U()})}).catch(function(){ia()}))};n.prototype.stopShareScreen=function(){null!==this._screenTrack&&(WALK.log("Share screen stop"),this._screenTrack.stop())};n.prototype.dispose=function(){this._micTrack&&this._micTrack.stop();this._cameraTrack&&this._cameraTrack.stop();this._screenTrack&&this._screenTrack.stop();l.prototype.dispose.call(this)};r.prototype=Object.create(l.prototype);r.prototype.constructor=r;r.prototype._refreshUi=function(){this._onUiRefreshNeeded&&
this._onUiRefreshNeeded(this)};r.prototype._setUpMicTrack=function(){var I=this;WALK.log("Setting up remote mic track for %s:%s",this._uuid,this._displayName);this._micTrackStateChangedBound=function(){I._updateSoundMeasurementState();I._refreshUi()};this._micTrack.on("enabled",this._micTrackStateChangedBound);this._micTrack.on("disabled",this._micTrackStateChangedBound);this._updateSoundMeasurementState();this._micTrack.attach()};r.prototype._tearDownMicTrack=function(){WALK.log("Tearing down remote mic track for %s:%s",
this._uuid,this._displayName);k(this._micTrack);this._micTrack.removeListener("enabled",this._micTrackStateChangedBound);this._micTrack.removeListener("disabled",this._micTrackStateChangedBound);this._micTrackStateChangedBound=null};r.prototype._setUpAudioTrack=function(){WALK.log("Setting up remote audio track for %s:%s",this._uuid,this._displayName);this._audioTrack.attach()};r.prototype._tearDownAudioTrack=function(){WALK.log("Tearing down remote audio track for %s:%s",this._uuid,this._displayName);
k(this._audioTrack)};r.prototype._setUpCameraTrack=function(){var I=this;WALK.log("Setting up remote camera track for %s:%s",this._uuid,this._displayName);var U=g(this._viewer,this._cameraTrack);this._cameraTrackEnabledBound=function(){I._avatar.setVideoTexture0(U)};this._cameraTrackDisabledBound=function(){I._avatar.setVideoTexture0(null)};this._cameraTrack.on("enabled",this._cameraTrackEnabledBound);this._cameraTrack.on("disabled",this._cameraTrackDisabledBound);this._avatar.setVideoTexture0(U)};
r.prototype._tearDownCameraTrack=function(){WALK.log("Tearing down remote camera track for %s:%s",this._uuid,this._displayName);this._avatar.setVideoTexture0(null);k(this._cameraTrack);this._cameraTrack.removeListener("enabled",this._cameraTrackEnabledBound);this._cameraTrack.removeListener("disabled",this._cameraTrackDisabledBound);this._cameraTrackDisabledBound=this._cameraTrackEnabledBound=null};r.prototype._setUpScreenTrack=function(){WALK.log("Setting up remote screen track for %s:%s",this._uuid,
this._displayName);var I=g(this._viewer,this._screenTrack);this._avatar.setVideoTexture1(I)};r.prototype._tearDownScreenTrack=function(){WALK.log("Tearing down remote screen track for %s:%s",this._uuid,this._displayName);this._avatar.setVideoTexture1(null);k(this._screenTrack)};r.prototype._setDisplayName=function(I){WALK.log("Remote display name known for %s:%s",this._uuid,I);this._displayName=I;this._setUpAvatar();this._micTrack&&this._setUpMicTrack();this._cameraTrack&&this._setUpCameraTrack();
this._screenTrack&&this._setUpScreenTrack();this._audioTrack&&this._setUpAudioTrack();this._refreshUi()};r.prototype._trackSubscribed=function(I){var U=this;WALK.log("Remote %s:%s track subscribed for %s:%s",I.kind,I.name,this._uuid,this._displayName);this._disposed||("data"===I.kind&&"data"===I.name?this._dataTrack?WALK.log("Ignoring duplicate data track"):(this._dataTrack=I,I.on("message",function(ia){ia=JSON.parse(ia);var R=ia[1];ia=ia[2];U.hasDisplayName||U._setDisplayName(R);U.updatePosition(ia)})):
"audio"===I.kind&&"mic"===I.name?this._micTrack?WALK.log("Ignoring duplicate mic track"):(this._micTrack=I,this.hasDisplayName&&(this._setUpMicTrack(),this._refreshUi())):"video"===I.kind?"camera"===I.name?this._cameraTrack?WALK.log("Ignoring duplicate camera track"):(this._cameraTrack=I,this._avatar&&(this._setUpCameraTrack(),this._viewer.requestFrame())):"screen"===I.name&&(this._screenTrack?WALK.log("Ignoring duplicate screen track"):(this._screenTrack=I,this._avatar&&(this._setUpScreenTrack(),
this._viewer.requestFrame()))):"audio"===I.kind&&"audio"===I.name&&(this._audioTrack?WALK.log("Ignoring duplicate audio track"):(this._audioTrack=I,this.hasDisplayName&&(this._setUpAudioTrack(),this._refreshUi()))))};r.prototype._trackUnsubscribed=function(I){WALK.log("Remote %s:%s track unsubscribed for %s:%s",I.kind,I.name,this._uuid,this._displayName);this._disposed||(I===this._dataTrack?this._dataTrack=null:I===this._micTrack?(this.hasDisplayName&&this._tearDownMicTrack(),this._micTrack=null,
this._refreshUi()):I===this._cameraTrack?(this._avatar&&(this._tearDownCameraTrack(),this._viewer.requestFrame()),this._cameraTrack=null):I===this._screenTrack?(this._avatar&&(this._tearDownScreenTrack(),this._viewer.requestFrame()),this._screenTrack=null):I===this._audioTrack&&(this.hasDisplayName&&this._tearDownAudioTrack(),this._audioTrack=null,this._refreshUi()))};r.prototype.connectedToTwilio=function(I){var U=this;this._twilioParticipant=I;I.on("trackSubscribed",this._trackSubscribedBound);
I.on("trackUnsubscribed",this._trackUnsubscribedBound);I.tracks.forEach(function(ia){ia.isSubscribed&&U._trackSubscribed(ia.track)})};r.prototype.seeAvatar=function(){this._avatar&&this._viewer.seeItem(this._avatar)};r.prototype._onSoundVolumeUpdated=function(I){l.prototype._onSoundVolumeUpdated.call(this,I);this._avatar.onSoundVolumeUpdated(I)};r.prototype.dispose=function(){this._onUiRefreshNeeded=null;this._micTrack&&this._trackUnsubscribed(this._micTrack);this._cameraTrack&&this._trackUnsubscribed(this._cameraTrack);
this._screenTrack&&this._trackUnsubscribed(this._screenTrack);this._audioTrack&&this._trackUnsubscribed(this._audioTrack);this.isConnectedToTwilio&&(this._twilioParticipant.removeListener("trackSubscribed",this._trackSubscribedBound),this._twilioParticipant.removeListener("trackUnsubscribed",this._trackUnsubscribedBound),this._twilioParticipant=null);l.prototype.dispose.call(this);this._disposed=!0};a.prototype.registerUser=function(I){this._users.add(I)};a.prototype.unregisterUser=function(I){this._users.delete(I)};
a.prototype.dispose=function(){this._users.clear()};a.prototype._onBeforeRender=function(){this._execute();this._idleCallback.deferRun()};a.prototype._execute=function(){this._users.forEach(function(I){return I.updateSoundVolumeVisualization()})};WALK.loadScriptsUrlAndExecute([WALK.getViewerAssetUrl("lib/pubnub.min.js"),WALK.getViewerAssetUrl("lib/twilio-video.min.js")],function(){var I=WALK.urlHashGetArgument("meeting"),U=WALK.urlHashGetArgument("meeting-key"),ia=WALK.urlHashGetArgument("av-mode"),
R={url:WALK.DEVEL_MEETING_SCENE_URL||window.location.href};I&&(R.meetingName=I);U&&(R.meetingKey=U);ia&&(R.avMode=ia);ta&&(R.avRegion=ta);WALK.ajaxPost(b()+"/meetings/join","application/json",JSON.stringify(R),function(E){return M(E.avatarJsonUrl,function(){return W(E)})},function(E,Y){void 0!==Y?WALK.USER_MSG.error(Y):WALK.USER_MSG.error("Failed to join the meeting. Is your link valid?")})},function(){return WALK.USER_MSG.error("Cannot load required library")});WALK.play()}
(WALK.urlHashContains("meeting-key")||WALK.urlHashContains("meeting"))&&rl();}).call(this);
